!function(e){var t=function(){function e(e,t,r,a,o){this.$stateProvider=e,this.$urlRouterProvider=t,this.$locationProvider=r,this.$logProvider=a,this.$compilerProvider=o,this.$stateProvider.state("main",{url:"/?rcode&workspaceID",template:"<ui-view/>",views:{map:{templateUrl:"Views/mapview.html",controller:"StreamStats.Controllers.MapController"},sidebar:{templateUrl:"Views/sidebarview.html",controller:"StreamStats.Controllers.SidebarController"},navbar:{templateUrl:"Views/navigationview.html",controller:"StreamStats.Controllers.NavbarController"},report:{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController"}}}),this.$urlRouterProvider.otherwise("/"),this.$locationProvider.html5Mode(!0),this.$logProvider.debugEnabled(!1),"production"==configuration.environment&&this.$compilerProvider.debugInfoEnabled(!1)}return e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$logProvider","$compileProvider"],e}();angular.module("StreamStats",["ui.router","ui.bootstrap","ui.checkbox","mobile-angular-ui","angulartics","angulartics.google.analytics","toaster","ngFileUpload","leaflet-directive","StreamStats.Services","StreamStats.Controllers","WiM.Services","WiM.Event","wim_angular","rzModule","nvd3","daterangepicker","angularjs-dropdown-multiselect"]).config(t)}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){return function(e,t){this.RegionID=e,this.Pourpoint=t,this.CoordinatedReach=null,this.ActiveExtension=[],this.NSS_Extensions=[]}}();e.StudyArea=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){return function(){this.append=[],this.remove=[]}}();e.WatershedEditDecisionList=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){var t=function(){function e(e,t){this.navigationID=e,this.navigationInfo=t,this.navigationInfo.configuration&&(this.minLocations=this.getCountByType(this.navigationInfo.configuration,"geojson point geometry")),this.navigationConfiguration=[],this.navigationPointCount=0,this._locations=[]}return Object.defineProperty(e.prototype,"locations",{get:function(){return this._locations},enumerable:!1,configurable:!0}),e.prototype.addLocation=function(e,t){var r=this;this._locations.push(t),this.navigationConfiguration.reverse().forEach(function(t,a){t.name==e&&(console.log("found this point already, deleting:",r.navigationConfiguration,a),r.navigationConfiguration.splice(a,1),r.navigationPointCount-=1)}),this.navigationPointCount+=1,this.navigationConfiguration.push({id:this.navigationPointCount,name:e,required:!0,description:"Specified lat/long/crs  navigation start location",valueType:"geojson point geometry",value:{type:"Point",coordinates:[t.Longitude,t.Latitude],crs:{properties:{name:"EPSG:"+t.crs},type:"name"}}}),this._locations.length>this.minLocations&&this._locations.shift()},e.prototype.getCountByType=function(e,t){return e.filter(function(e){return e.valueType.toLowerCase().indexOf(t)>=0}).length},e}();e.NetworkNav=t;var r=function(e){function t(){return e.call(this,2,2)||this}return __extends(t,e),t}(t);e.NetworkPath=r;var a=function(e){function t(){var t=e.call(this,1,1)||this;return t._workspaceID="",t}return __extends(t,e),Object.defineProperty(t.prototype,"workspaceID",{get:function(){return this._workspaceID},set:function(e){this._workspaceID=e},enumerable:!1,configurable:!0}),t}(t);e.FlowPath=a;var o=function(e){function t(){var t=e.call(this,3,1)||this;return t.layerOptions=[{name:"NHDFlowline",selected:!0},{name:"Gage",selected:!1},{name:"Dam",selected:!1}],t.DirectionOptions=["Upstream","Downstream"],t.selectedDirectionType=t.DirectionOptions[1],t}return __extends(t,e),t}(t);e.NetworkTrace=o}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){function e(e,t){this._name="Coordinated Reach: "+e,this._id=t,this._flowCoefficients={}}return Object.defineProperty(e.prototype,"FlowCoefficients",{get:function(){return this._flowCoefficients},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ID",{get:function(){return this._id},enumerable:!1,configurable:!0}),e.prototype.AddFlowCoefficient=function(e,t,r){null!==this._flowCoefficients[e]&&(this._flowCoefficients[e]={CoefficientA:t,CoefficientB:r})},e.prototype.Execute=function(e){try{var t=[];for(var r in this.FlowCoefficients)if(this.FlowCoefficients.hasOwnProperty(r)){var a=this.FlowCoefficients[r];t.push({code:r,description:this.getDescription(r),name:this.getName(r),unit:{unit:"cubic feet per second",abbr:"ft^3/s"},value:this.getValue(a,e[0].value)})}var o=[];for(var r in o.push({code:e[0].code,value:e[0].value,name:e[0].name,unitType:{abbr:e[0].unit,unit:e[0].unit}}),this.FlowCoefficients)o.push({code:r+"CoeffA",value:this.FlowCoefficients[r].CoefficientA.toFixed(3),name:r+" CoefficientA",unitType:{abbr:"dim",unit:"dimensionless"}}),o.push({code:r+"CoeffB",value:this.FlowCoefficients[r].CoefficientB.toFixed(3),name:r+" CoefficientB",unitType:{abbr:"dim",unit:"dimensionless"}});return{id:0,name:this.Name,code:this.ID,parameters:o,results:t}}catch(e){return null}},e.prototype.getDescription=function(e){var t="";switch(e){case"PK10":t="10";break;case"PK25":t="25";break;case"PK50":t="50";break;case"PK100":t="100";break;case"PK200":t="200";break;case"PK500":t="500";break;default:t="undefined"}return"Maximum instantaneous flow that occurs on average once in {0} years".format(t)},e.prototype.getName=function(e){var t="";switch(e){case"PK10":t="10";break;case"PK25":t="25";break;case"PK50":t="50";break;case"PK100":t="100";break;case"PK200":t="200";break;case"PK500":t="500";break;default:t="undefined"}return"{0} year Peak Flood".format(t)},e.prototype.getValue=function(e,t){try{return e.CoefficientA&&e.CoefficientB&&t?e.CoefficientA*Math.pow(t,e.CoefficientB):null}catch(e){return null}},e}();e.CoordinatedReach=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){return function(e,t){this.StationID=e,this.Name=t}}();e.ReferenceGage=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Services",[])}();__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use strict";var t=function(){return function(){}}();e.StatisticsGroup=t,e.onScenarioExtensionChanged="onScenarioExtensionChanged",e.onScenarioExtensionResultsChanged="onScenarioExtensionResultsChanged";var r=function(e){function t(t,r){void 0===t&&(t=null),void 0===r&&(r=null);var a=e.call(this)||this;return a.extensions=t,a.results=r,a}return __extends(t,e),t}(WiM.Event.EventArgs);e.NSSEventArgs=r;var a=function(t){function a(e,r,a,o,i,n){var s=t.call(this,e,configuration.baseurls.NSS)||this;return s.$q=r,s.regionservice=i,s.eventManager=n,s.toaster=a,s.modalService=o,s._onSelectedStatisticsGroupChanged=new WiM.Event.Delegate,s._onQ10Loaded=new WiM.Event.Delegate,s.clearNSSdata(),s}return __extends(a,t),Object.defineProperty(a.prototype,"onSelectedStatisticsGroupChanged",{get:function(){return this._onSelectedStatisticsGroupChanged},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onQ10Loaded",{get:function(){return this._onQ10Loaded},enumerable:!1,configurable:!0}),a.prototype.clearNSSdata=function(){this.loadingParametersByStatisticsGroupCounter=0,this.estimateFlowsCounter=0,this.selectedStatisticsGroupList=[],this.statisticsGroupList=[],this.canUpdate=!0,this.queriedRegions=!1,this.isDone=!1,this.reportGenerated=!1},a.prototype.loadStatisticsGroupTypes=function(e,t){var r=this;if(this.toaster.pop("wait","Loading Available Scenarios","Please wait...",0),e||t){var a=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupLookup.format(e,t),o=new WiM.Services.Helpers.RequestInfo(a,!0);this.loadingStatisticsGroup=!0,this.statisticsGroupList=[],this.Execute(o).then(function(e){e.data.length>0&&(r.loadingStatisticsGroup=!1,angular.forEach(e.data,function(e,t){if(r.statisticsGroupList.push(e),r.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&5==e.id){var a=JSON.parse(JSON.stringify(e));a.id+="_fdctm",a.name="Flow-Duration QPPQ Method",r.statisticsGroupList.push(a)}})),r.toaster.clear()},function(e){r.toaster.clear(),r.toaster.pop("error","There was an error Loading Available Scenarios","Please retry",0)}).finally(function(){r.loadingStatisticsGroup=!1})}},a.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},a.prototype.loadParametersByStatisticsGroup=function(t,a,o,i,n){var s=this;if(0==this.loadingParametersByStatisticsGroupCounter&&this.toaster.pop("wait","Loading Parameters by Statistics Group","Please wait...",0),this.loadingParametersByStatisticsGroupCounter++,t||a||o){var g=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupParameterLookup;this.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&a.toString().indexOf("_fdctm")>-1&&(a=a.replace("_fdctm",""),g+="&extensions=QPPQ"),g=g.format(t,a,o),void 0!=n&&(g+="&regressiontypes="+n);var c=new WiM.Services.Helpers.RequestInfo(g,!0);this.Execute(c).then(function(t){if(t.data[0].regressionRegions[0].extensions&&t.data[0].regressionRegions[0].extensions.length>0){var a=t.data[0].regressionRegions[0].extensions;s.eventManager.RaiseEvent(e.onScenarioExtensionChanged,s,new r(a))}t.data[0].regressionRegions[0].parameters&&t.data[0].regressionRegions[0].parameters.length>0&&(0==s.selectedStatisticsGroupList.length&&s.selectedStatisticsGroupList.push({name:"",id:"7",code:"",regressionRegions:[],citations:null,disclaimers:""}),s.selectedStatisticsGroupList.forEach(function(e){(t.data[0].statisticGroupID==e.id||s.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&"string"==typeof e.id&&e.id.indexOf(t.data[0].statisticGroupID,0)>-1)&&(e.statisticGroupName=e.name,e.statisticGroupID=e.id.toString().replace("_fdctm",""),t.data[0].regressionRegions.forEach(function(e){i.length>0&&i.forEach(function(t){t.code.indexOf(e.code.toUpperCase())>-1&&(e.percentWeight=t.percentWeight)})}),e.regressionRegions=t.data[0].regressionRegions,s._onSelectedStatisticsGroupChanged.raise(null,WiM.Event.EventArgs.Empty))}))},function(e){s.toaster.clear(),s.toaster.pop("error","There was an error Loading Parameters by Statistics Group","Please retry",0)}).finally(function(){s.loadingParametersByStatisticsGroupCounter--,0==s.loadingParametersByStatisticsGroupCounter&&s.toaster.clear()})}},a.prototype.estimateFlows=function(t,a,o,i,n,s){var g=this;void 0===i&&(i=!1),void 0===s&&(s=!0),(this.canUpdate||i)&&this.selectedStatisticsGroupList.forEach(function(c){g.canUpdate=!1,0==g.estimateFlowsCounter&&g.toaster.pop("wait","Estimating Flows","Please wait...",0),g.estimateFlowsCounter++,g.cleanRegressionRegions(c.regressionRegions),c.regressionRegions.forEach(function(e){e.parameters.forEach(function(e){t.forEach(function(t){e.code.toLowerCase()==t.code.toLowerCase()&&(e.value=t[a])})})});var A=angular.fromJson(angular.toJson(c));A.regressionRegions.forEach(function(e){e.results&&delete e.results,e.extensions&&e.extensions.forEach(function(e){e.result&&delete e.result})}),A=angular.toJson([A],null);var l=configuration.baseurls.NSS+configuration.queryparams.estimateFlows.format(o);g.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&"string"==typeof c.id&&c.id.indexOf("_fdctm")>-1&&(l+="&extensions=QPPQ"),""!=n&&void 0!=n&&(l+="&regressiontypes="+n);var u=new WiM.Services.Helpers.RequestInfo(l,!0,1,"json",A);c.citations=[],g.Execute(u).then(function(t){var o=t.data[0].links[0].href;if(i||g.getSelectedCitations(o,c),t.headers()["x-usgswim-messages"]){var n=t.headers()["x-usgswim-messages"].split(";");c.disclaimers={},n.forEach(function(e){var t=e.split(":");"warning"==t[0]&&(c.disclaimers.Warnings=t[1].trim()),"error"==t[0]&&(c.disclaimers.Error=t[1].trim())})}t.data[0].regressionRegions.length>0&&t.data[0].regressionRegions[0].results&&t.data[0].regressionRegions[0].results.length>0?i?c.regressionRegions.forEach(function(e){e.parameters.forEach(function(r){for(var o=t.data[0].regressionRegions,i=0;i<o.length;i++)if(o[i].id===e.id)for(var n=0;n<o[i].parameters.length;n++)o[i].Parameters[n].code==r.code&&(r[a]=o[i].parameters[n].value)}),e.results.forEach(function(r){for(var o=t.data[0].regressionRegions,i=0;i<o.length;i++)if(o[i].id===e.id)for(var n=0;n<o[i].results.length;n++)o[i].results[n].code==r.code&&(r[a]=o[i].results[n].value)})}):(t.data[0].regressionRegions.forEach(function(t){t.extensions&&(t.extensions.forEach(function(e){var r=c.regressionRegions.filter(function(e){return e.name==t.name})[0].extensions.filter(function(t){return t.code==e.code})[0];e.parameters.forEach(function(e){e.options=r.parameters.filter(function(t){return t.code==e.code})[0].options})}),g.eventManager.RaiseEvent(e.onScenarioExtensionResultsChanged,g,new r(null,t.extensions)))}),c.regressionRegions=[],c.regressionRegions=t.data[0].regressionRegions):(g.toaster.clear(),g.toaster.pop("error","There was an error Estimating Flows for "+c.name,"No results were returned",0))},function(e){g.toaster.clear(),g.toaster.pop("error","There was an error Estimating Flows","HTTP request error",0)}).finally(function(){g.estimateFlowsCounter--,g.estimateFlowsCounter<1&&(g.toaster.clear(),g.estimateFlowsCounter=0,g.canUpdate=!0,s&&(g.modalService.openModal(e.SSModalType.e_report),g.reportGenerated=!0)),g._onQ10Loaded.raise(null,WiM.Event.EventArgs.Empty)})})},a.prototype.getSelectedCitations=function(e,t){var r,a=this;r=-1==e.indexOf("https://")?"https://"+e:e;var o=new WiM.Services.Helpers.RequestInfo(r,!0,0,"json");this.Execute(o).then(function(e){e.data[0]&&e.data[0].id&&angular.forEach(e.data,function(e,r){t.citations.push(e)})},function(e){a.toaster.pop("error","There was an error getting selected Citations for "+t.name,"No results were returned",0)}).finally(function(){})},a.prototype.getflattenNSSTable=function(e){var t=[];try{this.selectedStatisticsGroupList.forEach(function(r){r.regressionRegions.forEach(function(r){r.results.forEach(function(a){t.push({Name:e,Region:r.percentWeight?r.percentWeight.toFixed(1)+"% "+r.name:r.name,Statistic:a.name,Code:a.code,Value:a.value.toUSGSvalue(),Unit:a.unit.unit,Disclaimers:r.disclaimer?r.disclaimer:void 0,Errors:a.errors&&a.errors.length>0?a.errors.map(function(e){return e.name+" : "+e.value}).join(", "):void 0,MaxLimit:a.intervalBounds&&a.intervalBounds.upper>0?a.intervalBounds.upper.toUSGSvalue():void 0,MinLimit:a.intervalBounds&&a.intervalBounds.lower>0?a.intervalBounds.lower.toUSGSvalue():void 0,EquivYears:a.equivalentYears?a.equivalentYears:void 0})})})})}catch(e){t.push({Disclaimers:"Failed to output flowstats to table. "})}return t},a.prototype.cleanRegressionRegions=function(e){for(var t=0;t<e.length;t++){"Area-Averaged"!==e[t].name?e.forEach(function(e){e.Results&&delete e.Results}):e.splice(t,1)}},a}(WiM.Services.HTTPServiceBase);function o(e,t,r,o,i,n){return new a(e,t,r,o,i,n)}o.$inject=["$http","$q","toaster","StreamStats.Services.ModalService","StreamStats.Services.RegionService","WiM.Event.EventManager"],angular.module("StreamStats.Services").factory("StreamStats.Services.nssService",o)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use strict";var t=function(){return function(){}}();e.Region=t;var r=function(){return function(){}}();e.Parameter=r,e.onSelectedRegionChanged="onSelectedRegionChanged";var a=function(t){function r(r,a,o,i){var n=t.call(this,r,configuration.baseurls.StreamStatsServices)||this;return n.$q=a,n.eventManager=i,n.toaster=o,n.regionList=[],n.parameterList=[],n.masterRegionList=configuration.regions,n.streamStatsAvailable=!1,n.eventManager.AddEvent(e.onSelectedRegionChanged),n}return __extends(r,t),Object.defineProperty(r.prototype,"selectedRegion",{get:function(){return this._selectedRegion},set:function(t){this._selectedRegion!=t&&(this._selectedRegion=t,this.eventManager.RaiseEvent(e.onSelectedRegionChanged,this,WiM.Event.EventArgs.Empty))},enumerable:!1,configurable:!0}),r.prototype.clearRegion=function(){this.regionList=[],this.parameterList=[],this.regionMapLayerList=[],this.selectedRegion=null,this.regionMapLayerListLoaded=!1,this.resetView=!1},r.prototype.clearSelectedParameters=function(){this.parameterList.forEach(function(e){e.checked=!1,delete e.value})},r.prototype.intersect=function(e,t){return Math.max(e.left,t.left)<Math.min(e.right,t.right)&&Math.min(e.top,t.top)>Math.max(e.bottom,t.bottom)},r.prototype.loadRegionListByExtent=function(e,t,r,a,o){var i=this;void 0===o&&(o=4326),this.regionList=[];var n={top:a,bottom:r,left:t,right:e};configuration.regions.forEach(function(e,t){var r={top:e.Bounds[1][0],bottom:e.Bounds[0][0],left:e.Bounds[0][1],right:e.Bounds[1][1]};i.intersect(n,r)&&i.regionList.push(e)})},r.prototype.loadRegionListByRegion=function(e){this.regionList.length=0;var t=this.getRegion(e);return null!=t&&(this.regionList.push(t),!0)},r.prototype.loadMapLayersByRegion=function(e){var t=this;this.regionMapLayerListLoaded=!1;var r=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers+"?f=pjson",a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.regionMapLayerList=[],this.Execute(a).then(function(r){r.data.layers?(r.data.layers.forEach(function(a,o){a.name==e&&a.subLayerIds.forEach(function(e,a){t.regionMapLayerList.push([r.data.layers[e].name,r.data.layers[e].id,!1])})}),t.regionMapLayerListLoaded=!0):t.toaster.pop("warning","No map layers available","",5e3)},function(e){return console.log("No region map layers found"),t.$q.reject(e.data)}).finally(function(){})},r.prototype.loadParametersByRegion=function(){var e=this;if(this.selectedRegion){var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSAvailableParams.format(this.selectedRegion.RegionID),r=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(r).then(function(t){t.data.parameters&&t.data.parameters.length>0?(e.streamStatsAvailable=!0,t.data.parameters.forEach(function(t){try{t.checked=!1,t.toggleable=!0,e.parameterList.push(t)}catch(e){alert(e)}}),e.parameterList.sort(function(e,t){return e.code>t.code?1:t.code>e.code?-1:0})):(e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3))},function(t){console.log("Bad response from the regression service"),e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3)}).finally(function(){})}},r.prototype.getRegion=function(e){var t=configuration.regions;try{for(var r=0;r<t.length;r++)if(t[r].Name.toUpperCase().trim()===e.toUpperCase().trim()||t[r].RegionID.toUpperCase().trim()===e.toUpperCase().trim())return t[r];return null}catch(e){return null}},r}(WiM.Services.HTTPServiceBase);function o(e,t,r,o){return new a(e,t,r,o)}o.$inject=["$http","$q","toaster","WiM.Event.EventManager"],angular.module("StreamStats.Services").factory("StreamStats.Services.RegionService",o)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use strict";t.onSelectedStudyAreaChanged="onSelectedStudyAreaChanged",t.onSelectedStudyParametersLoaded="onSelectedStudyParametersLoaded",t.onStudyAreaReset="onStudyAreaReset",t.onEditClick="onEditClick",t.onRegressionLoaded="onRegressionLoaded";var r=function(e){function t(t,r,a,o){void 0===t&&(t=null),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===o&&(o=!1);var i=e.call(this)||this;return i.studyArea=t,i.studyAreaVisible=r,i.parameterLoaded=a,i.additionalFeaturesLoaded=o,i}return __extends(t,e),t}(WiM.Event.EventArgs);t.StudyAreaEventArgs=r;var a=function(a){function o(e,r,o,i,n,s){var g=a.call(this,e,configuration.baseurls.StreamStatsServices)||this;return g.$http=e,g.$q=r,g.eventManager=o,g.nssService=s,g._onStudyAreaServiceFinishedChanged=new WiM.Event.Delegate,g.surfacecontributionsonly=!1,g.doSelectMapGage=!1,g.doSelectNearestGage=!1,g.NSSServicesVersion="",g.extensionDateRange=null,g.modalservices=n,o.AddEvent(t.onSelectedStudyParametersLoaded),o.AddEvent(t.onSelectedStudyAreaChanged),o.AddEvent(t.onStudyAreaReset),o.SubscribeToEvent(t.onSelectedStudyAreaChanged,new WiM.Event.EventHandler(function(e,t){g.onStudyAreaChanged(e,t)})),o.SubscribeToEvent(t.onScenarioExtensionChanged,new WiM.Event.EventHandler(function(e,t){g.onNSSExtensionChanged(e,t)})),o.SubscribeToEvent(t.onScenarioExtensionResultsChanged,new WiM.Event.EventHandler(function(e,t){g.onNSSExtensionResultsChanged(e,t)})),o.AddEvent(t.onEditClick),g._studyAreaList=[],g.toaster=i,g.clearStudyArea(),g.servicesURL=configuration.baseurls.StreamStatsServices,g._onQ10Loaded=new WiM.Event.Delegate,g.parameterloadedEventHandler=new WiM.Event.EventHandler(function(e,t){null!=t&&t.parameterLoaded&&(g.nssService.estimateFlows(g.studyAreaParameterList,"value",g.selectedStudyArea.RegionID,!1,g.regtype,!1),g.onQ10Available())}),g.statisticgroupEventHandler=new WiM.Event.EventHandler(function(){g.eventManager.SubscribeToEvent(t.onSelectedStudyParametersLoaded,g.parameterloadedEventHandler),g.loadParameters(),g.afterSelectedStatisticsGroupChanged()}),g.q10EventHandler=new WiM.Event.EventHandler(function(e,t){g.afterQ10Loaded()}),g}return __extends(o,a),Object.defineProperty(o.prototype,"onStudyAreaServiceBusyChanged",{get:function(){return this._onStudyAreaServiceFinishedChanged},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onQ10Loaded",{get:function(){return this._onQ10Loaded},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"StudyAreaList",{get:function(){return this._studyAreaList},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selectedStudyArea",{get:function(){return this._selectedStudyArea},set:function(e){this.canUpdate&&this._selectedStudyArea!=e&&(this._selectedStudyArea=e,this.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,this,r.Empty))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"selectedStudyAreaExtensions",{get:function(){return null==this.selectedStudyArea?null:this.selectedStudyArea.NSS_Extensions},enumerable:!1,configurable:!0}),o.prototype.editBasin=function(e){this.selectedStudyArea.Disclaimers.isEdited=!0,this.drawControlOption=e,this.eventManager.RaiseEvent(t.onEditClick,this,WiM.Event.EventArgs.Empty)},o.prototype.undoEdit=function(){delete this.selectedStudyArea.Disclaimers.isEdited,this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,this,r.Empty)},o.prototype.AddStudyArea=function(e){this.clearStudyArea(),this.StudyAreaList.push(e),this.selectedStudyArea=e,this.selectedStudyArea.Disclaimers={}},o.prototype.RemoveStudyArea=function(){},o.prototype.clearStudyArea=function(){this.canUpdate=!0,this.regulationCheckComplete=!0,this.parametersLoading=!1,this.doDelineateFlag=!1,this.checkingDelineatedPoint=!1,this.studyAreaParameterList=[],this.regulationCheckResults=[],this.selectedStudyArea&&(this.selectedStudyArea.Disclaimers={}),this.showEditToolbar=!1,this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this.selectedStudyArea=null,this.zoomLevel15=!0,this.regressionRegionQueryComplete=!1,this.regressionRegionQueryLoading=!1,this.eventManager.RaiseEvent(t.onStudyAreaReset,this,WiM.Event.EventArgs.Empty)},o.prototype.loadStudyBoundary=function(){var e=this;this.toaster.pop("wait","Delineating Basin","Please wait...",0),this.canUpdate=!1;var a=this.selectedStudyArea.RegionID,o=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSdelineation.format("geojson",a,this.selectedStudyArea.Pourpoint.Longitude.toString(),this.selectedStudyArea.Pourpoint.Latitude.toString(),this.selectedStudyArea.Pourpoint.crs.toString(),!1);if("MO_STL"==this.selectedStudyArea.RegionID)o=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSstormwaterDelineation.format(a,this.selectedStudyArea.Pourpoint.Longitude.toString(),this.selectedStudyArea.Pourpoint.Latitude.toString(),this.surfacecontributionsonly);var i=new WiM.Services.Helpers.RequestInfo(o,!0);i.withCredentials=!0,this.Execute(i).then(function(a){if("MO_STL"==e.selectedStudyArea.RegionID)if(a.data.layers&&a.data.layers.features&&a.data.layers.features[1].geometry.coordinates.length>0){e.selectedStudyArea.Disclaimers.isSTL_MO=!0;var o=a.data.hasOwnProperty("layers")?a.data.layers:null;o&&o.features.forEach(function(e){return e.id=e.id.toString().toLowerCase()}),e.selectedStudyArea.FeatureCollection=o,e.selectedStudyArea.WorkspaceID=a.data.hasOwnProperty("workspaceID")?a.data.workspaceID:null,e.selectedStudyArea.Date=new Date,e.toaster.clear(),e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,r.Empty),e.canUpdate=!0}else e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","A watershed was not returned from the delineation request","Please retry",0);else a.data.hasOwnProperty("featurecollection")&&a.data.featurecollection[1]&&a.data.featurecollection[1].feature.features.length>0?(e.selectedStudyArea.Server=a.headers()["usgswim-hostname"].toLowerCase(),e.selectedStudyArea.WorkspaceID=a.data.hasOwnProperty("workspaceID")?a.data.workspaceID:null,e.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:e.reconfigureWatershedResponse(a.data.featurecollection),bbox:a.data.featurecollection.filter(function(e){return"globalwatershed"==e.name})[0].feature.features[0].bbox},e.selectedStudyArea.Date=new Date,e.toaster.clear(),e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,r.Empty),e.canUpdate=!0):(e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","A watershed was not returned from the delineation request","Please retry",0));e.selectedStudyArea.FeatureCollection.features.forEach(function(e){return e.properties={}})},function(t){e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","There was an HTTP error with the delineation request","Please retry",0)}).finally(function(){})},o.prototype.loadWatershed=function(a,o){var i=this;try{this.toaster.pop("wait","Opening Basin","Please wait...",0);var n=new e.Models.StudyArea(a,null);this.AddStudyArea(n);var s=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSwatershedByWorkspace.format("geojson",a,o,4326,!1),g=new WiM.Services.Helpers.RequestInfo(s,!0);g.withCredentials=!0,this.Execute(g).then(function(e){i.selectedStudyArea.WorkspaceID=e.data.hasOwnProperty("workspaceID")?e.data.workspaceID:null,i.selectedStudyArea.Date=new Date,i.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:i.reconfigureWatershedResponse(e.data.featurecollection),bbox:e.data.featurecollection.filter(function(e){return"globalwatershed"==e.name})[0].feature.features[0].bbox};var t=e.data.featurecollection.filter(function(e){return"globalwatershedpoint"==e.name})[0].feature.features[0];i.selectedStudyArea.Pourpoint=new WiM.Models.Point(t.bbox[1],t.bbox[0],t.crs.properties.code)},function(e){i.toaster.clear(),i.toaster.pop("error","Error Delineating Basin","Please retry",0)}).finally(function(){i.canUpdate=!0,i.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,i,r.Empty),i.toaster.clear()})}catch(e){return}},o.prototype.loadEditedStudyBoundary=function(){var a=this;this.toaster.pop("wait","Loading Edited Basin","Please wait...",0),this.canUpdate=!1;var o=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSeditBasin.format("geojson",this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,this.selectedStudyArea.Pourpoint.crs.toString()),i=new WiM.Services.Helpers.RequestInfo(o,!0,WiM.Services.Helpers.methodType.PUT,"json",angular.toJson(this.WatershedEditDecisionList),{});i.withCredentials=!0,this.Execute(i).then(function(t){a.AddStudyArea(new e.Models.StudyArea(a.selectedStudyArea.RegionID,a.selectedStudyArea.Pourpoint)),a.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:a.reconfigureWatershedResponse(t.data.featurecollection),bbox:t.data.featurecollection.filter(function(e){return"globalwatershed"==e.name.toLowerCase()})[0].feature.features[0].bbox},a.selectedStudyArea.WorkspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null,a.selectedStudyArea.Date=new Date,a.toaster.clear()},function(e){a.toaster.clear(),a.toaster.pop("error","Error Delineating Basin","Please retry",0)}).finally(function(){a.canUpdate=!0;var e=new r;e.studyArea=a.selectedStudyArea,a.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,a,e),a.selectedStudyArea.Disclaimers.isEdited=!0})},o.prototype.loadParameters=function(){var e=this;this.parametersLoading=!0;var a=[];if(this.toaster.clear(),this.toaster.pop("wait","Calculating Selected Basin Characteristics","Please wait...",0),this.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,this,r.Empty),this.selectedStudyArea&&this.selectedStudyArea.WorkspaceID&&this.selectedStudyArea.RegionID){if((a=this.studyAreaParameterList.filter(function(e){return!e.value||e.value<0}).map(function(e){return e.code})).length<1){var o=new r;return o.parameterLoaded=!0,this.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,this,o),this.toaster.clear(),void(this.parametersLoading=!1)}var i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,a.join(",")),n=new WiM.Services.Helpers.RequestInfo(i,!0);n.withCredentials=!0,this.Execute(n).then(function(a){if(a.data.parameters&&a.data.parameters.length>0){e.toaster.clear();var o=!1;angular.forEach(a.data.parameters,function(e,t){e.hasOwnProperty("value")&&-999!=e.value?e.loaded=!0:(o=!0,console.error("Parameter failed to compute: ",e.code),e.loaded=!1)}),o&&(e.showModifyBasinCharacterstics=!0,e.toaster.pop("error","One or more basin characteristics failed to compute","Click the 'Calculate Missing Parameters' button or manually enter parameter values to continue",0));var i=a.data.parameters;e.loadParameterResults(i),e.getAdditionalFeatureList(),e.selectedStudyArea.Disclaimers.isRegulated&&e.loadRegulatedParameterResults(e.regulationCheckResults.parameters);var n=new r;n.parameterLoaded=!0,e.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,e,n)}},function(t){e.toaster.clear(),e.toaster.pop("error","There was an HTTP error calculating basin characteristics","Please retry",0)}).finally(function(){e.parametersLoading=!1})}else alert("No Study Area")},o.prototype.getAdditionalFeatureList=function(){var e=this,t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSavailableFeatures.format(this.selectedStudyArea.WorkspaceID),r=new WiM.Services.Helpers.RequestInfo(t,!0);r.withCredentials=!0,this.Execute(r).then(function(t){if(t.data.featurecollection&&t.data.featurecollection.length>0){var r=[];angular.forEach(t.data.featurecollection,function(t,a){-1===e.selectedStudyArea.FeatureCollection.features.map(function(e){return e.id}).indexOf(t.name)&&r.push(t.name)}),e.getAdditionalFeatures(r.join(","))}},function(t){e.toaster.clear(),e.toaster.pop("error","There was an HTTP error requesting additional feautres list","Please retry",0)}).finally(function(){})},o.prototype.getAdditionalFeatures=function(e){var t=this;if(e){var r=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSfeatures.format(this.selectedStudyArea.WorkspaceID,4326,e),a=new WiM.Services.Helpers.RequestInfo(r,!0);a.withCredentials=!0,this.Execute(a).then(function(e){if(e.data.featurecollection&&e.data.featurecollection.length>0){t.toaster.clear();var r=t.reconfigureWatershedResponse(e.data.featurecollection);angular.forEach(r,function(e,a){if(r.length<1){for(var o=0;o<t.selectedStudyArea.FeatureCollection.features.length;o++)if(t.selectedStudyArea.FeatureCollection.features[o].id.toLowerCase()===e.id.toLowerCase()){t.selectedStudyArea.FeatureCollection.features.splice(o,1);break}}else t.selectedStudyArea.FeatureCollection.features.push(e);t.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,t,new WiM.Directives.LegendLayerAddedEventArgs(e.id,"geojson",{displayName:e.id,imagesrc:null},!1))})}},function(e){t.toaster.clear(),t.toaster.pop("error","There was an HTTP error getting additional features","Please retry",0)}).finally(function(){})}},o.prototype.queryLandCover=function(){var e=this;this.toaster.pop("wait","Querying Land Cover Data with your Basin","Please wait...",0);var t='{"geometryType":"esriGeometryPolygon","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polygon", "rings":['+JSON.stringify(this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry.coordinates)+"]}}]}",r=configuration.baseurls.NationalMapRasterServices+configuration.queryparams.NLCDQueryService,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",{InputLineFeatures:t,returnZ:!0,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(t){e.toaster.clear(),t.data.length>0&&e.toaster.pop("success","Land Cover was succcessfully queried","Please continue",5e3)},function(t){return e.toaster.pop("error","There was an HTTP error querying Land Cover","Please retry",0),e.$q.reject(t.data)}).finally(function(){})},o.prototype.queryCoordinatedReach=function(){var t=this;this.toaster.pop("wait","Checking if study area is a coordinated reach.","Please wait...",0);var r=this.selectedStudyArea.Pourpoint,a=new L.Circle([r.Longitude,r.Latitude],50).getBounds(),o=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.coordinatedReachQueryService.format(this.selectedStudyArea.RegionID.toLowerCase(),a.getNorth(),a.getWest(),a.getSouth(),a.getEast(),r.crs,"eqWithStrID.BASIN_NAME,eqWithStrID.DVA_EQ_ID,eqWithStrID.a10,eqWithStrID.b10,eqWithStrID.a25,eqWithStrID.b25,eqWithStrID.a50,eqWithStrID.b50,eqWithStrID.a100,eqWithStrID.b100,eqWithStrID.a500,eqWithStrID.b500"),i=new WiM.Services.Helpers.RequestInfo(o,!0);this.Execute(i).then(function(r){if(r.data.error)t.toaster.pop("error","There was an error querying coordinated reach",r.data.error.message,0);else if(r.data.features.length>0){var a=r.data.features[0].attributes;t.selectedStudyArea.CoordinatedReach=new e.Models.CoordinatedReach(a["eqWithStrID.BASIN_NAME"],a["eqWithStrID.DVA_EQ_ID"]),delete a["eqWithStrID.BASIN_NAME"],delete a["eqWithStrID.DVA_EQ_ID"];for(var o=Object.keys(a).map(function(e,t){return e.substr("eqWithStrID.".length+1)}).filter(function(e,t,r){return r.indexOf(e)===t}),i=0;i<o.length;i++){var n=o[i],s=a["eqWithStrID.a"+n],g=a["eqWithStrID.b"+n];null!=s&&null!=g&&t.selectedStudyArea.CoordinatedReach.AddFlowCoefficient("PK"+n,s,g)}t.toaster.pop("success","Selected reach is a coordinated reach","Please continue",5e3)}},function(e){t.toaster.pop("error","There was an HTTP error querying coordinated reach","Please retry",0)})},o.prototype.queryRegressionRegions=function(){var e=this;this.toaster.pop("wait","Querying regression regions with your Basin","Please wait...",0),this.regressionRegionQueryLoading=!0,this.regressionRegionQueryComplete=!1;var t=configuration.baseurls.NSS+configuration.queryparams.RegressionRegionQueryService,r=this.simplify(angular.fromJson(angular.toJson(this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0]))).geometry,a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(r),{"Content-Type":"application/json","X-Is-StreamStats":!0});this.Execute(a).then(function(t){if(e.NSSServicesVersion=t.headers()["x-version"],e.toaster.clear(),!t.data.error)return 0==t.data.length?(e.regressionRegionQueryComplete=!0,e.selectedStudyArea.RegressionRegions=t.data,void e.toaster.pop("error","No regression regions were returned","Regression based scenario computation not allowed",0)):void(t.data.length>0&&(e.regressionRegionQueryComplete=!0,t.data.forEach(function(e){e.code=e.code.toUpperCase().split(",")}),e.selectedStudyArea.RegressionRegions=t.data,e.toaster.pop("success","Regression regions were succcessfully queried","Please continue",5e3)));e.toaster.pop("error","There was an error querying regression regions",t.data.error.message,0)},function(t){return e.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",0),e.$q.reject(t.data)}).finally(function(){e.regressionRegionQueryLoading=!1})},o.prototype.queryKarst=function(e,t){var r,a=this;this.toaster.pop("wait","Querying for Karst Areas","Please wait...",0),t.forEach(function(e){"ExcludePolys"==e[0]&&(r=e[1])}),this.regressionRegionQueryLoading=!0,this.regressionRegionQueryComplete=!1;var o={where:"1=1",geometry:'{"rings":'+angular.toJson(this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry.coordinates,null)+',"spatialReference":{"wkid":4326}}',geometryType:"esriGeometryPolygon",inSR:4326,spatialRel:"esriSpatialRelIntersects",outFields:"*",returnGeometry:!1,outSR:4326,returnIdsOnly:!1,returnCountOnly:!1,returnZ:!1,returnM:!1,returnDistinctValues:!1,returnTrueCurves:!1,f:"json"},i=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers+"/"+r+"/query",n=new WiM.Services.Helpers.RequestInfo(i,!0,WiM.Services.Helpers.methodType.POST,"json",o,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(n).then(function(e){if(a.toaster.clear(),200==e.status){a.toaster.pop("success","Karst regions were succcessfully queried","Please continue",5e3);var t=!1;e.data.features.length>0&&(e.data.features.forEach(function(e){2==e.attributes.ExcludeCode&&(t=!0,a.toaster.pop("warning","Warning",e.attributes.ExcludeReason,0),a.selectedStudyArea.Disclaimers.hasKarst=e.attributes.ExcludeReason)}),t||a.toaster.pop("success","No Karst found","Please continue",5e3))}else a.toaster.pop("error","Error","Karst region query failed",0)},function(e){return a.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",0),a.$q.reject(e.data)}).finally(function(){a.regressionRegionQueryLoading=!1})},o.prototype.queryNWIS=function(r){var a=this;if(r&&r.lng&&r.lat&&this.selectedStudyAreaExtensions){var o=this.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()});if(!(o.length<0)){var i=r,n=new L.Circle([i.lat,i.lng],100).getBounds(),s=configuration.baseurls.NWISurl+configuration.queryparams.NWISsite.format(n.getWest().toFixed(7),n.getSouth().toFixed(7),n.getEast().toFixed(7),n.getNorth().toFixed(7)),g=new WiM.Services.Helpers.RequestInfo(s,!0);this.Execute(g).then(function(r){if(r.data.error)a.toaster.pop("error","There was an error querying NWIS",r.data.error.message,0);else if(r.data){var i=[],n=r.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e}),s=n.shift().split("\t");n.shift();do{var g=n.shift().split("\t");if("00060"==g[s.indexOf("parm_cd")]){console.log(g[s.indexOf("site_no")]);var c=new e.Models.ReferenceGage(g[s.indexOf("site_no")],g[s.indexOf("station_nm")]);c.Latitude_DD=g[s.indexOf("dec_lat_va")],c.Longitude_DD=g[s.indexOf("dec_long_va")],i.push(c)}}while(n.length>0);i.length>0&&(o[0].options=i,o[0].value=i[0],a.toaster.pop("success","Found USGS NWIS reference gage","Please continue",5e3),a.modalservices.openModal(t.SSModalType.e_extensionsupport),a.doSelectMapGage=!1)}},function(e){a.toaster.pop("warning","No USGS NWIS reference gage found at this location.","Try zooming in closer or a different location",5e3)})}}},o.prototype.selectGage=function(r){var a=this.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()}),o=[],i=new e.Models.ReferenceGage(r.properties.Code,r.properties.Name);i.Latitude_DD=r.geometry.coordinates[0],i.Longitude_DD=r.geometry.coordinates[1],i.properties=r.properties,o.push(i),o.length>0&&(a[0].options=o,a[0].value=o[0],this.modalservices.openModal(t.SSModalType.e_extensionsupport),this.doSelectNearestGage=!1)},o.prototype.getStreamgages=function(e,t,r,a){var o=this,i=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesBounds.format(e,t,r,a),n=new WiM.Services.Helpers.RequestInfo(i,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(n).then(function(e){o.streamgageLayer=e.data},function(e){})},o.prototype.GetKriggedReferenceGages=function(){var t=this,r=configuration.queryparams.KrigService.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.Pourpoint.Longitude,this.selectedStudyArea.Pourpoint.Latitude,this.selectedStudyArea.Pourpoint.crs);if(this.selectedStudyAreaExtensions){var a=this.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()});if(!(a.length<0)){var o=new WiM.Services.Helpers.RequestInfo(r);this.Execute(o).then(function(r){for(var o=[],i=r.data,n=0;n<i.length;n++){var s=new e.Models.ReferenceGage(i[n].id,i[n].name);s.DrainageArea_sqMI=i[n].drainageArea,s.correlation=i[n].correlation,o.push(s)}o.length>0&&(a[0].options=o,a[0].value=o[0],t.toaster.pop("success","Found reference gages","Please continue",5e3))},function(e){t.toaster.pop("warning","No reference gage found at this location.","Please try again",5e3)}).finally(function(){t._onStudyAreaServiceFinishedChanged.raise(null,WiM.Event.EventArgs.Empty)})}}},o.prototype.upstreamRegulation=function(){var e=this;this.toaster.pop("wait","Checking for Upstream Regulation","Please wait...",0),this.regulationCheckComplete=!1;var a=angular.toJson({type:"FeatureCollection",crs:{type:"ESPG",properties:{code:4326}},features:this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})},null),o=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.regulationService.format(this.selectedStudyArea.RegionID.toLowerCase()),i=new WiM.Services.Helpers.RequestInfo(o,!0,WiM.Services.Helpers.methodType.POST,"json",{watershed:a,outputcrs:4326,f:"geojson"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(i).then(function(a){if(e.selectedStudyArea.Disclaimers.regulationChecked=!0,a.data.percentarearegulated>0){e.toaster.clear(),e.toaster.pop("success","Map updated with Regulated Area","Continue to 'Modify Basin Characteristics' to see area-weighted basin characteristics",5e3);var o=e.reconfigureWatershedResponse(a.data.featurecollection);e.selectedStudyArea.FeatureCollection.features.push(o[0]),e.regulationCheckResults=a.data,e.selectedStudyArea.Disclaimers.isRegulated=!0,e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,r.Empty)}else e.selectedStudyArea.Disclaimers.isRegulated=!1,e.toaster.clear(),e.toaster.pop("warning","No regulation found","Please continue",5e3)},function(t){e.toaster.clear(),e.toaster.pop("error","Error Checking for Upstream Regulation","Please retry",0)}).finally(function(){e.regulationCheckComplete=!0})},o.prototype.getflattenStudyArea=function(){var e=this,t=null;try{(t=this.selectedStudyArea.FeatureCollection).features.forEach(function(t){t.properties.Name=e.selectedStudyArea.WorkspaceID,t.id&&"globalwatershed"==t.id&&(t.properties=[t.properties,e.studyAreaParameterList.reduce(function(e,t){return e[t.code]=t.value,e},{})].reduce(function(e,t){return Object.keys(t).forEach(function(r){e[r]=t[r]}),e},{}))})}catch(e){t=null,console.log("Failed to flatted shapefile.")}return t},o.prototype.simplify=function(e){var t=0;try{var r=e.geometry.coordinates.reduce(function(e,t){return e+t.length},0);return r<5e3?e:(t=r<1e4?1e-4:r<1e5?.001:.01,this.toaster.pop("warning","Displaying simplified Basin.","See FAQ for more information.",0),turf.simplify(e,{tolerance:t,highQuality:!1,mutate:!0}))}catch(e){}},o.prototype.computeRegressionEquation=function(e){this.regtype=e,this.onSelectedStatisticsGroupChanged(),this.nssService.loadParametersByStatisticsGroup(this.selectedStudyArea.RegionID,"","GC1449, GC1450",[],e)},o.prototype.reconfigureWatershedResponse=function(e){var t=[];return e.forEach(function(e){for(var r=0;r<e.feature.features.length;r++){var a={type:"Feature",geometry:e.feature.features[r].geometry,id:e.feature.features.length>1&&e.feature.features[r].properties.Name?e.name+"_"+e.feature.features[r].properties.Name.toLowerCase():e.name.toLowerCase(),properties:e.feature.features[r].properties};t.push(a)}}),t},o.prototype.loadParameterResults=function(e){var t=this.studyAreaParameterList;e.map(function(e){angular.forEach(t,function(t,r){if(e.code.toUpperCase().trim()===t.code.toUpperCase().trim())return t.value=e.value,void(t.loaded=e.loaded)})})},o.prototype.loadRegulatedParameterResults=function(e){this.toaster.pop("wait","Loading Regulated Basin Characteristics","Please wait...");var t=this.studyAreaParameterList;e.map(function(r){angular.forEach(t,function(a,o){if(r.code.toUpperCase().trim()!==a.code.toUpperCase().trim());else{switch(r.operation){case"Sum":a.unRegulatedValue=a.value-r.value;break;case"WeightedAverage":var i,n,s;angular.forEach(t,function(e,t){e.code==r.operationField&&(i=e.value)}),angular.forEach(e,function(e,t){e.code==r.operationField&&(n=e.value)}),s=r.value;var g=(a.value-n*(s/i))*(i/(i-n));a.unRegulatedValue=g}a.regulatedValue=r.value}})})},o.prototype.onStudyAreaChanged=function(e,t){this.selectedStudyArea&&this.selectedStudyArea.FeatureCollection&&this.regressionRegionQueryComplete},o.prototype.onNSSExtensionChanged=function(e,t){var r=this;console.log("onNSSExtensionChanged"),t.extensions.forEach(function(e){-1==r.selectedStudyArea.NSS_Extensions.indexOf(e)&&r.selectedStudyArea.NSS_Extensions.push(e)})},o.prototype.onNSSExtensionResultsChanged=function(e,t){var r=this;t.results.forEach(function(e){var t=r.selectedStudyArea.NSS_Extensions.filter(function(t){return t.code==e.code});t.length<1||(t[0].parameters=angular.copy(e.parameters),t[0].result=angular.copy(e.result))})},o.prototype.afterSelectedStatisticsGroupChanged=function(){this.nssService.onSelectedStatisticsGroupChanged.unsubscribe(this.statisticgroupEventHandler)},o.prototype.onSelectedStatisticsGroupChanged=function(){this.nssService.onSelectedStatisticsGroupChanged.subscribe(this.statisticgroupEventHandler)},o.prototype.onQ10Available=function(){this.nssService.onQ10Loaded.subscribe(this.q10EventHandler)},o.prototype.afterQ10Loaded=function(){this.selectedStudyArea.wateruseQ10=this.nssService.selectedStatisticsGroupList[0].regressionRegions[0].results[0].value,this._onQ10Loaded.raise(null,WiM.Event.EventArgs.Empty),this.eventManager.UnSubscribeToEvent(t.onSelectedStudyParametersLoaded,this.parameterloadedEventHandler),this.nssService.selectedStatisticsGroupList=[],this.nssService.onQ10Loaded.unsubscribe(this.q10EventHandler)},o.prototype.updateExtensions=function(){var e=this;this.nssService.statisticsGroupList.forEach(function(t){t.regressionRegions&&t.regressionRegions.forEach(function(t){t.extensions&&(t.extensions=e.selectedStudyAreaExtensions)})})},o}(WiM.Services.HTTPServiceBase);function o(e,t,r,o,i,n){return new a(e,t,r,o,i,n)}o.$inject=["$http","$q","WiM.Event.EventManager","toaster","StreamStats.Services.ModalService","StreamStats.Services.nssService"],angular.module("StreamStats.Services").factory("StreamStats.Services.StudyAreaService",o)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use strict";t.onSelectExplorationMethod="onSelectExplorationMethod",t.onSelectedMethodExecuteComplete="onSelectedMethodExecuteComplete";var r=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(WiM.Event.EventArgs);t.ExplorationServiceEventArgs=r;var a,o=function(o){function i(e,r,a,i,n){var s=o.call(this,e,configuration.baseurls.StreamStatsServices)||this;return s.$q=r,s.eventManager=i,s.regionservice=n,s.toaster=a,s.drawElevationProfile=!1,s.drawMeasurement=!1,s.showElevationChart=!1,s.measurementData="",s._selectedMethod=null,s.networkNavResults=[],i.AddEvent(t.onSelectedStudyAreaChanged),s.selectElevationPoints=!1,s.DEMresolution="30m",s}return __extends(i,o),Object.defineProperty(i.prototype,"selectedMethod",{get:function(){return this._selectedMethod},enumerable:!1,configurable:!0}),i.prototype.elevationProfile=function(e){var t=this,r={InputLineFeatures:e,returnZ:!0,DEMResolution:this.DEMresolution,f:"json",MaximumSampleDistance:null};this.samplingDistance&&(r.MaximumSampleDistance=this.samplingDistance);var a=new WiM.Services.Helpers.RequestInfo("https://elevation.arcgis.com/arcgis/rest/services/Tools/ElevationSync/GPServer/Profile/execute",!0,WiM.Services.Helpers.methodType.POST,"json",r,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(e){if(console.log("elevation profile response: ",e.data),e.data&&e.data.results){var r=e.data.results[0].value.features[0].geometry.paths[0];if(r.length>0){var a=angular.fromJson(angular.toJson(r));e.data.results[0].value.fields.forEach(function(e){"ProfileLength"==e.name&&"Length Meters"==e.alias&&"meters"}),"meters"&&(r=r.map(function(e){return[e[0],e[1],3.28084*e[2]]}));var o=0;t.coordinateList=[[r[0][1].toFixed(5),r[0][0].toFixed(5),r[0][2].toFixed(2),o.toFixed(2)]];for(var i=1;i<r.length;i++){var n=L.latLng(r[i-1][1],r[i-1][0]),s=L.latLng(r[i][1],r[i][0]);o+=n.distanceTo(s),t.coordinateList.push([r[i][1].toFixed(5),r[i][0].toFixed(5),r[i][2].toFixed(2),(621371e-9*o).toFixed(2)])}t.elevationProfileGeoJSON={name:"NewFeatureType",type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:a},properties:""}]}}}else console.error("There was a zero length response from the elevation service"),t.toaster.clear(),t.toaster.pop("error","Error","No elevation results are available here",0)},function(e){console.error("There was an error requestion the elevation service"),t.toaster.clear(),t.toaster.pop("error","Error processing request","Please try again",0)}).finally(function(){})},i.prototype.getNavigationEndPoints=function(){var e=this,a=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices,o=new WiM.Services.Helpers.RequestInfo(a,!0);this.Execute(o).then(function(t){var r=t.data;e.navigationResources=r},function(a){e.toaster.pop("error","Error processing request","Please try again",0),e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,r.Empty)}).finally(function(){})},i.prototype.getNavigationConfiguration=function(e){var a=this,o=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices+"/"+e,i=new WiM.Services.Helpers.RequestInfo(o,!0);this.Execute(i).then(function(t){var r=t.data;console.log("navigation config:",r),a.setMethod(e,r)},function(e){a.toaster.pop("error","Error processing request","Please try again",0),a.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,a,r.Empty)}).finally(function(){})},i.prototype.getCountByType=function(e,t){return e.filter(function(e){return e.valueType.toLowerCase().indexOf(t)>=0}).length},i.prototype.setMethod=function(o,i){null!=this._selectedMethod&&o===this._selectedMethod.navigationID&&(o=a.undefined),this._selectedMethod=new e.Models.NetworkNav(o,i),this.eventManager.RaiseEvent(t.onSelectExplorationMethod,this,r.Empty)},i.prototype.ExecuteSelectedModel=function(){var e=this;console.log("selected method:",this.selectedMethod);var a=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices+"/"+this.selectedMethod.navigationInfo.code+"/route";console.log("url: ",a);var o=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(this.selectedMethod.navigationConfiguration));this.Execute(o).then(function(a){var o=a.data;console.log("successfull navigation request results:",o);var i={feature:{features:[],type:"FeatureCollection"},name:"netnavroute"},n={feature:{features:[],type:"FeatureCollection"},name:"netnavpoints"};o.features.forEach(function(e,t){"Point"==e.geometry.type?n.feature.features.push(e):i.feature.features.push(e)}),i.feature.features.length>0&&e.networkNavResults.push(i),n.feature.features.length>0&&e.networkNavResults.push(n);var s=new r;s.features="FeatureCollection"===o.type?o:null,s.report="Report"==o.type?o:null,e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,s)},function(a){e.toaster.pop("error","Error processing request","Please try again",0),e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,r.Empty)}).finally(function(){})},i}(WiM.Services.HTTPServiceBase);function i(e,t,r,a,i){return new o(e,t,r,a,i)}!function(e){e[e[void 0]=0]="undefined",e[e.FLOWPATH=1]="FLOWPATH",e[e.NETWORKPATH=2]="NETWORKPATH",e[e.NETWORKTRACE=3]="NETWORKTRACE"}(a=t.ExplorationMethodType||(t.ExplorationMethodType={})),i.$inject=["$http","$q","toaster","WiM.Event.EventManager","StreamStats.Services.RegionService"],angular.module("StreamStats.Services").factory("StreamStats.Services.ExplorationService",i)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use strict";var t,r=function(){function e(e){this.modal=e}return e.prototype.openModal=function(e,t){void 0===t&&(t=null),t&&(this.modalOptions=t),this.modal.open(this.getModalSettings(e))},e.prototype.getModalSettings=function(e){try{switch(e){case t.e_exploration:return{templateUrl:"Views/explorationview.html",controller:"StreamStats.Controllers.ExplorationToolsModalController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_report:return{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController",size:"lg",backdropClass:"backdropZ",windowClass:"windowZ"};case t.e_wateruse:return{templateUrl:"Views/wateruse.html",controller:"StreamStats.Controllers.WateruseController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_stormrunnoff:return{templateUrl:"Views/stormrunoff.html",controller:"StreamStats.Controllers.StormRunoffController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_about:return{templateUrl:"Views/about.html",controller:"StreamStats.Controllers.AboutController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_help:return{templateUrl:"Views/help.html",controller:"StreamStats.Controllers.HelpController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_navreport:return{templateUrl:"Views/navreportmodal.html",controller:"StreamStats.Controllers.NavigationReportModalController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_prosper:return{templateUrl:"Views/prosperview.html",controller:"StreamStats.Controllers.ProsperController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_extensionsupport:return{templateUrl:"Views/extensionview.html",controller:"StreamStats.Controllers.ExtensionModalController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_gagepage:return{templateUrl:"Views/gagepage.html",controller:"StreamStats.Controllers.GagePageController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ modal-xl"};case t.e_nearestgages:return{templateUrl:"Views/nearestgages.html",controller:"StreamStats.Controllers.NearestGagesController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ modal-xl"};default:return null}}catch(e){return null}},e}();function a(e){return new r(e)}!function(e){e[e.e_report=1]="e_report",e[e.e_wateruse=2]="e_wateruse",e[e.e_about=3]="e_about",e[e.e_help=4]="e_help",e[e.e_navreport=5]="e_navreport",e[e.e_exploration=6]="e_exploration",e[e.e_stormrunnoff=7]="e_stormrunnoff",e[e.e_prosper=8]="e_prosper",e[e.e_extensionsupport=9]="e_extensionsupport",e[e.e_gagepage=10]="e_gagepage",e[e.e_nearestgages=11]="e_nearestgages"}(t=e.SSModalType||(e.SSModalType={})),a.$inject=["$modal"],angular.module("StreamStats.Services").factory("StreamStats.Services.ModalService",a)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use strict";var t=function(t){function r(e,r,a,o){var i=t.call(this,e,configuration.baseurls.ScienceBase)||this;return i.$q=r,i.projectExtent=[[41.96765920367816,-125.48583984375],[49.603590524348704,-110.54443359375]],i.toaster=a,i.modalservices=o,i.init(),i}return __extends(r,t),Object.defineProperty(r.prototype,"SelectedPredictions",{get:function(){return this.AvailablePredictions.filter(function(e){return e.selected})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"Result",{get:function(){return this._result},enumerable:!1,configurable:!0}),r.prototype.ResetSelectedPredictions=function(){this.ResetResults(),this.AvailablePredictions.length<1||this.AvailablePredictions.forEach(function(e){return e.selected=!1})},r.prototype.ResetResults=function(){this._result=null},r.prototype.GetPredictionValues=function(t,r){var a=this;this.toaster.pop("wait","Querying prosper grids","Please wait...",0),this._result=null;var o=this.getPointArray(t.latlng).join(),i=this.getDisplayImageArray(t.originalEvent.srcElement).join(),n=this.boundsToExtentArray(r).join(),s=this.SelectedPredictions.map(function(e){return e.id}).join(),g=this.SelectedPredictions.filter(function(e){return e.id<8}).map(function(e){return e.id}),c=this.SelectedPredictions.filter(function(e){return e.id>7}).map(function(e){return e.id-8}),A=configuration.queryparams.ProsperPredictions+configuration.queryparams.ProsperIdentify.format(s,i,n,o,4326),l=configuration.queryparams.ProsperSPPPredictions1+configuration.queryparams.ProsperIdentify.format(g,i,n,o,4326),u=configuration.queryparams.ProsperSPPPredictions2+configuration.queryparams.ProsperIdentify.format(c,i,n,o,4326);this.$q.all([this.queryExecute(A),this.queryExecute(l),this.queryExecute(u)]).then(function(r){a.toaster.clear(),a._result={date:new Date,point:t.latlng,data:{SPC:null,SPP:null}};for(var o=[],i=0;i<r.length;i++){if(0==i)a._result.data.SPC=r[i];else if(1==i&&g.length>0)o=r[i];else if(2==i&&c.length>0){o=o.concat(r[i]);for(i=0;i<o.length;i++)o[i].name=o[i].name.charAt(0).toUpperCase()+o[i].name.slice(1).toLowerCase(),o[i].value=Math.round(100*o[i].value)/100}a._result.data.SPP=o}a.toaster.pop("success","Finished","See results report.",5e3),a.modalservices.openModal(e.SSModalType.e_prosper)},function(e){a.toaster.clear(),a.toaster.pop("error","There was an error querying prosper grids","Please retry",0)})},r.prototype.init=function(){this.CanQuery=!1,this._result=null,this.AvailablePredictions=[],this.loadAvailablePredictions()},r.prototype.loadAvailablePredictions=function(){var e=this;try{this.toaster.pop("wait","Loading Available Prosper Predictions","Please wait...",0);var t=configuration.queryparams.ProsperPredictions+"/legend?f=pjson",r=new WiM.Services.Helpers.RequestInfo(t);this.Execute(r).then(function(t){if(t.data.error)e.toaster.pop("error","There was an error querying prosper predictions",t.data.error.message,0);else{e.AvailablePredictions.length=0;var r=t.data.layers;r.length>0&&(r.map(function(t){return{id:t.layerId,name:e.getCleanLabel(t.layerName),selected:!1}}).forEach(function(t){return e.AvailablePredictions.push(t)}),e.DisplayedPrediction=e.AvailablePredictions[0]),e.toaster.clear()}},function(t){e.CanQuery=!1,e.toaster.clear(),e.toaster.pop("error","There was an error requesting available prosper predictions.","Please retry",0)})}catch(e){console.log("There was an error requesting available prosper predictions."+e)}},r.prototype.boundsToExtentArray=function(e){return[e.southWest.lng,e.southWest.lat,e.northEast.lng,e.northEast.lat]},r.prototype.getDisplayImageArray=function(e){return[e.width,e.height,96]},r.prototype.getPointArray=function(e){return[e.lng,e.lat]},r.prototype.getCleanLabel=function(e){return e.replace(/[^_]*_|\.[^/.]+$/g,"")},r.prototype.queryExecute=function(e){var t=this;return this.Execute(new WiM.Services.Helpers.RequestInfo(e)).then(function(e){if(t.toaster.clear(),e.data.error)throw console.log("query error"),e.data.error;if(e.data.results.length>0)return e.data.results.map(function(e){return{name:t.getCleanLabel(e.layerName),value:e.attributes["Pixel Value"]}})},function(e){throw e})},r}(WiM.Services.HTTPServiceBase);function r(e,r,a,o){return new t(e,r,a,o)}r.$inject=["$http","$q","toaster","StreamStats.Services.ModalService"],angular.module("StreamStats.Services").factory("StreamStats.Services.ProsperService",r)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Controllers",[])}(),function(e){!function(t){"use strict";var r=function(){return function(){this.lat=0,this.lng=0}}(),a=function(){return function(e,t,r){this.lat=e,this.lng=t,this.zoom=r}}(),o=function(){return function(e,t,r,a,o){void 0===o&&(o=void 0),this.name=e,this.url=t,this.type=r,this.visible=a,this.layerOptions=o}}(),i=function(){return function(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=!0),this.maxZoom=e,this.minZoom=t,this.zoomControl=r}}(),n=function(){function t(t,r,a,o,i,n,s,g,c,A,l,u,C,I,d,p,h){var f=this;this.$scope=t,this.$compile=r,this._prosperServices=I,this.modal=p,this.modalStack=h,this.center=null,this.layers=null,this.mapDefaults=null,this.mapPoint=null,this.bounds=null,this.markers=null,this.paths=null,this.geojson=null,this.events=null,this.layercontrol=null,this.regionLayer=null,this._prosperIsActive=!1,this.explorationToolsExpanded=!1,t.vm=this,this.toaster=a,this.angulartics=o,this.searchService=c,this.$locationService=i,this.regionServices=A,this.leafletBoundsHelperService=s,this.leafletData=g,this.studyArea=l,this.nssService=u,this.explorationService=C,this.eventManager=d,this.cursorStyle="pointer",this.environment=configuration.environment,this.selectedExplorationTool=null,this.init(),this.eventManager.SubscribeToEvent(e.Services.onSelectedStudyAreaChanged,new WiM.Event.EventHandler(function(){f.onSelectedStudyAreaChanged()})),this.eventManager.SubscribeToEvent(WiM.Directives.onLayerChanged,new WiM.Event.EventHandler(function(e,t){f.onLayerChanged(e,t)})),this.eventManager.SubscribeToEvent(WiM.Services.onSelectedAreaOfInterestChanged,new WiM.Event.EventHandler(function(e,t){f.onSelectedAreaOfInterestChanged(e,t)})),this.eventManager.SubscribeToEvent(e.Services.onSelectedRegionChanged,new WiM.Event.EventHandler(function(){f.onSelectedRegionChanged()})),this.eventManager.SubscribeToEvent(e.Services.onEditClick,new WiM.Event.EventHandler(function(e,t){f.basinEditor()})),this.eventManager.SubscribeToEvent(e.Services.onStudyAreaReset,new WiM.Event.EventHandler(function(){f.removeGeoJson()})),this.eventManager.SubscribeToEvent(e.Services.onSelectedMethodExecuteComplete,new WiM.Event.EventHandler(function(e,t){f.onExplorationMethodComplete(e,t)})),this.eventManager.SubscribeToEvent(e.Services.onSelectExplorationMethod,new WiM.Event.EventHandler(function(e,t){0!=e.selectedMethod.navigationID&&f.onSelectExplorationMethod(e,t),0==e.selectedMethod.navigationID&&(f.selectedExplorationTool=null)})),t.$on("leafletDirectiveMap.mainMap.mousemove",function(e,t){var r=t.leafletEvent.latlng;f.mapPoint.lat=r.lat,f.mapPoint.lng=r.lng,f.studyArea.doDelineateFlag&&(f.cursorStyle="crosshair")}),t.$on("leafletDirectiveMap.mainMap.drag",function(e,t){f.cursorStyle="grabbing"}),t.$on("leafletDirectiveMap.mainMap.dragend",function(e,t){f.cursorStyle="pointer"}),t.$on("leafletDirectiveMap.mainMap.click",function(t,r){if(f._prosperServices.CanQuery)f._prosperServices.GetPredictionValues(r.leafletEvent,f.bounds);else if(f.studyArea.doDelineateFlag)f.checkDelineatePoint(r.leafletEvent.latlng);else if(!f.studyArea.showEditToolbar&&!f.explorationService.drawMeasurement&&!f.explorationService.drawElevationProfile)if(f.studyArea.doSelectMapGage)f.studyArea.queryNWIS(r.leafletEvent.latlng);else if(null!=C.selectedMethod&&C.selectedMethod.locations.length<=C.selectedMethod.minLocations){console.log("in mapcontroller add point",C.selectedMethod.navigationPointCount,C.selectedMethod.locations.length),"Start point location"==C.explorationPointType&&C.selectedMethod.addLocation("Start point location",new WiM.Models.Point(r.leafletEvent.latlng.lat,r.leafletEvent.latlng.lng,"4326")),"End point location"==C.explorationPointType&&C.selectedMethod.addLocation("End point location",new WiM.Models.Point(r.leafletEvent.latlng.lat,r.leafletEvent.latlng.lng,"4326"));for(var a=0;a<C.selectedMethod.locations.length;a++){var o=C.selectedMethod.locations[a];f.markers["netnav_"+a]={lat:o.Latitude,lng:o.Longitude,message:C.selectedMethod.navigationName,focus:!0,draggable:!1}}f.modal.openModal(e.Services.SSModalType.e_exploration)}else f.queryPoints(r.leafletEvent)}),t.$watch(function(){return f.bounds},function(e,t){return f.mapBoundsChange(t,e)}),t.$watch(function(){return f.explorationService.elevationProfileGeoJSON},function(e,t){e&&f.displayElevationProfile()}),t.$watch(function(){return f.explorationService.drawElevationProfile},function(t,r){t&&f.modal.openModal(e.Services.SSModalType.e_exploration)}),t.$watch(function(){return f.explorationService.selectElevationPoints},function(e,t){e&&f.elevationProfile()}),t.$watch(function(){return f.explorationService.drawMeasurement},function(e,t){e&&f.measurement()}),t.$watch(function(){return f.regionServices.regionMapLayerListLoaded},function(e,t){e&&f.addRegionOverlayLayers(f.regionServices.selectedRegion.RegionID)}),t.$watch(function(){return f._prosperServices.DisplayedPrediction},function(e,t){e&&f.ProsperIsActive&&(f.removeOverlayLayers("prosper",!0),f.AddProsperLayer(e.id))}),t.$on("$locationChangeStart",function(){return f.updateRegion()}),n.rcode&&(this.regionServices.loadParametersByRegion(),this.setBoundsByRegion(n.rcode)),n.rcode&&n.workspaceID&&(this.regionServices.loadParametersByRegion(),this.studyArea.loadWatershed(n.rcode,n.workspaceID)),t.$watch(function(){return f.studyArea.regressionRegionQueryComplete},function(e,t){e&&f.studyArea.selectedStudyArea.RegressionRegions&&f.nssService.loadStatisticsGroupTypes(f.regionServices.selectedRegion.RegionID,f.studyArea.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","))}),t.$watch(function(){return f.studyArea.streamgageLayer},function(e,t){e!=t&&f.addGeoJSON("streamgages",e)})}return Object.defineProperty(t.prototype,"selectedExplorationMethodType",{get:function(){return null==this.explorationService.selectedMethod?0:this.explorationService.selectedMethod.navigationID},set:function(e){this.explorationService.setMethod(e,{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ProsperIsActive",{get:function(){return this._prosperIsActive},enumerable:!1,configurable:!0}),t.prototype.setExplorationMethodType=function(e){this.removeGeoJsonLayers("netnav_",!0),this.explorationService.getNavigationConfiguration(e)},t.prototype.ExecuteNav=function(){if(this.explorationService.selectedMethod.locations.length==this.explorationService.selectedMethod.minLocations){this.explorationService.explorationMethodBusy=!0,this.explorationService.ExecuteSelectedModel()}else this.toaster.pop("warning","Warning","You must select at least "+this.explorationService.selectedMethod.minLocations+" points.",1e4)},t.prototype.ToggleProsper=function(){this._prosperIsActive?(this._prosperIsActive=!1,this._prosperServices.CanQuery=!1,this.removeOverlayLayers("prosper",!0)):(this._prosperIsActive=!0,this.AddProsperLayer(this._prosperServices.DisplayedPrediction.id),this.ConfigureProsper())},t.prototype.ConfigureProsper=function(){this.modal.openModal(e.Services.SSModalType.e_prosper)},t.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modal.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},t.prototype.init=function(){this.setupMap(),this.explorationService.getNavigationEndPoints()},t.prototype.setupMap=function(){this.center=new a(39,-100,4),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers},this.mapDefaults=new i(null,3,!0),this.markers={},this.paths={},this.geojson={},this.regionLayer={};var e=600;$(window).width()<768&&(e=.7*$(window).width()),this.controls={scale:!0,draw:{draw:{polygon:!1,polyline:!1,rectangle:!1,circle:!1,circlemarker:!1,marker:!1}},custom:new Array(L.control.locate({follow:!1,locateOptions:{maxZoom:15}}),L.control.elevation({imperial:!0,width:e}))},this.events={map:{enable:["mousemove"]}},this.mapPoint=new r,L.Icon.Default.imagePath="images"},t.prototype.scaleLookup=function(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}},t.prototype.queryPoints=function(e){var t=this;this.toaster.pop("wait","Information","Querying Points...",0),this.cursorStyle="wait",this.markers={},this.leafletData.getMap("mainMap").then(function(r){t.leafletData.getLayers("mainMap").then(function(a){if(r.getZoom()<=8)return t.cursorStyle="pointer",t.toaster.clear(),void t.toaster.pop("warning","Warning","You must be at Zoom Level 9 or greater to query points",5e3);t.queryContent={requestCount:0,Content:$("<div>").attr("id","popupContent"),responseCount:0};var o,i=function(i){if(!a.overlays.hasOwnProperty(i))return"continue";if(["MaskLayer","draw"].indexOf(i)>-1)return"continue";if(!r.hasLayer(a.overlays[i]))return"continue";switch(t.layers.overlays[i].type){case"agsFeature":a.overlays[i].query().nearby(e.latlng,4).returnGeometry(!1).run(function(a,o){return t.handleQueryResult(i,a,o,r,e.latlng)});break;default:o=i,a.overlays[i].identify().on(r).at(e.latlng).returnGeometry(!1).tolerance(5).run(function(a,i){return t.handleQueryResult(o,a,i,r,e.latlng)})}t.queryContent.requestCount++};for(var n in a.overlays)i(n)})})},t.prototype.handleQueryResult=function(e,t,r,a,o){var i=this,n=$("<div>").attr("id",e).appendTo(this.queryContent.Content);if(this.queryContent.requestCount--,r.features.forEach(function(t){i.layers.overlays[e].hasOwnProperty("layerArray")&&i.layers.overlays[e].layerArray.forEach(function(r){if(r.layerId===t.layerId&&!(["StreamGrid","ExcludePolys","Region","Subregion","Basin","Subbasin","Watershed","Subwatershed"].indexOf(r.layerName)>-1))if(n.append("<h5>"+r.layerName+"</h5>"),i.queryContent.responseCount++,i.angulartics.eventTrack("explorationTools",{category:"Map",label:"queryPoints"}),i.layers.overlays[e].hasOwnProperty("queryProperties")&&i.layers.overlays[e].queryProperties.hasOwnProperty(r.layerName)){var a=i.layers.overlays[e].queryProperties[r.layerName];Object.keys(a).map(function(e){if("Streamgages"==r.layerName&&"FeatureURL"==e){var o=t.properties[e].split("site_no=")[1],s="https://streamstatsags.cr.usgs.gov/gagepages/html/"+o+".htm",g="vm.openGagePage('"+o+"')",c='<strong>NWIS page: </strong><a href="'+t.properties[e]+' "target="_blank">link</a></br><strong>StreamStats Gage page: </strong><a href="'+s+'" target="_blank">link</a></br><strong>New StreamStats Gage Modal: </strong><a ng-click="'+g+'">link</a></br>';n.append(c),i.angulartics.eventTrack("explorationTools",{category:"Map",label:"streamgageQuery"})}else n.append("<strong>"+a[e]+": </strong>"+t.properties[e]+"</br>")})}else angular.forEach(t.properties,function(e,t){n.append("<strong>"+t+": </strong>"+e+"</br>")})})}),this.queryContent.requestCount<1)if(this.toaster.clear(),this.cursorStyle="pointer",this.queryContent.responseCount>0){var s=this.queryContent.Content.html(),g=this.$compile(s)(this.$scope);a.openPopup(g[0],[o.lat,o.lng],{maxHeight:200})}else this.toaster.pop("warning","Information","No points were found at this location",5e3)},t.prototype.elevationProfile=function(){var e,t=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.measurementData="",this.explorationService.showElevationChart=!0,this.controls.custom.forEach(function(t){t._container.className.indexOf("elevation")>-1&&(e=t)}),this.angulartics.eventTrack("explorationTools",{category:"Map",label:"elevationProfile"}),this.leafletData.getMap("mainMap").then(function(r){t.leafletData.getLayers("mainMap").then(function(a){a.overlays.draw.clearLayers(),t.drawController({metric:!1},!0),delete t.geojson.elevationProfileLine3D,r.on("draw:drawstart",function(t){e.clear()}),r.on("draw:created",function(e){r.removeEventListener("draw:created");var a=e.layer.toGeoJSON(),o='{"geometryType":"esriGeometryPolyline","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polyline", "paths":['+JSON.stringify(a.geometry.coordinates)+"]}}]}";t.toaster.pop("wait","Information","Querying the elevation service...",0),t.explorationService.elevationProfile(o),t.explorationService.drawElevationProfile=!1,r.panBy([0,1])})})})},t.prototype.drawController=function(e,t){var r=this;if(!t)return this.drawControl.disable(),void(this.drawControl=void 0);this.leafletData.getMap("mainMap").then(function(t){r.drawControl=new L.Draw.Polyline(t,e),r.drawControl.enable()})},t.prototype.displayElevationProfile=function(){var t,r=this;this.controls.custom.forEach(function(e){e._container&&e._container.className.indexOf("elevation")>-1&&(t=e)}),this.geojson.elevationProfileLine3D={data:this.explorationService.elevationProfileGeoJSON,style:{color:"#ff7800",weight:5,opacity:.65},onEachFeature:t.addData.bind(t)},this.leafletData.getMap("mainMap").then(function(a){var o=t.onAdd(a);r.explorationService.elevationProfileHTML=o.innerHTML,r.modal.openModal(e.Services.SSModalType.e_exploration),delete r.geojson.elevationProfileLine3D}),this.toaster.clear(),this.cursorStyle="pointer",this.selectedExplorationTool=null},t.prototype.showLocation=function(){var e,t=this;this.angulartics.eventTrack("explorationTools",{category:"Map",label:"showLocation"}),this.controls.custom.forEach(function(t){t._container.className.indexOf("leaflet-control-locate")>-1&&(e=t)}),e.start(),this.leafletData.getMap("mainMap").then(function(e){e.on("locationfound",function(){t.selectedExplorationTool=null})})},t.prototype.resetExplorationTools=function(){var e=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.elevationProfileHTML="",this.drawControl&&this.drawController({},!1),this.explorationService.measurementData="",this.explorationService.drawElevationProfile=!1,this.explorationService.drawMeasurement=!1,this.explorationService.selectElevationPoints=!1,delete this.geojson.elevationProfileLine3D,this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(r){r.overlays.draw.clearLayers(),e.measurestart&&t.off("click",e.measurestart),e.measuremove&&t.off("mousemove",e.measuremove),e.measurestop&&t.off("draw:created",e.measurestop)})}),this.explorationService.networkNavResults=[],this.selectedExplorationMethodType=0,this.removeMarkerLayers("netnav_",!0),this.removeGeoJsonLayers("netnavpoints",!0),this.removeGeoJsonLayers("netnavroute",!0),this.selectedExplorationTool=null,this.explorationService.explorationPointType=null},t.prototype.measurement=function(){var e=this;this.explorationService.measurementData="Click the map to begin\nDouble click to end the Drawing",this.angulartics.eventTrack("explorationTools",{category:"Map",label:"measurement"}),this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(r){var a=!1;e.drawController({shapeOptions:{color:"blue"},metric:!1},!0);var o=r.overlays.draw;o.clearLayers(),e.measuremove=function(){e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString()},e.measurestart=function(){0==a&&(a=!0,e.explorationService.measurementData="Total Length: ",t.on("mousemove",e.measuremove))},e.measurestop=function(r){var a=r.layer;o.addLayer(a),o.addTo(t);var i=null,n=0;$.each(r.layer._latlngs,function(e,t){null!=i?(n+=i.distanceTo(t),i=t):i=t}),e.explorationService.measurementData="Total length: "+(3.28084*n).toFixed(0)+" ft",t.off("click",e.measurestart),t.off("mousemove",e.measuremove),t.off("draw:created",e.measurestop),e.drawControl.disable(),e.explorationService.drawMeasurement=!1,e.selectedExplorationTool=null},t.on("click",e.measurestart),t.on("draw:created",e.measurestop)})})},t.prototype.checkDelineatePoint=function(e){var t=this;this.leafletData.getMap("mainMap").then(function(r){t.leafletData.getLayers("mainMap").then(function(a){if(r.getZoom()<15)t.toaster.pop("error","Delineation not allowed at this zoom level","Please zoom in to level 15 or greater",5e3);else{t.toaster.clear(),t.studyArea.checkingDelineatedPoint=!0,t.toaster.pop("info","Information","Validating your clicked point...",!0,0),t.cursorStyle="wait",t.markers={},t.markers.pourpoint={lat:e.lat,lng:e.lng,message:"Your clicked point</br></br><strong>Latitude: </strong>"+e.lat.toFixed(5)+"</br><strong>Longitude: </strong>"+e.lng.toFixed(5),focus:!0,draggable:!0},t.studyArea.doDelineateFlag=!1;var o="visible:";t.regionServices.regionMapLayerList.forEach(function(e){"ExcludePolys"==e[0]&&(o+=e[1])}),t.angulartics.eventTrack("delineationClick",{category:"Map",label:t.regionServices.selectedRegion.Name}),r.invalidateSize();var i=t.regionServices.selectedRegion.RegionID+"_region";if("visible:"===o)return t.toaster.clear(),t.toaster.pop("warning","Selected State/Region does not have exlusion areas defined","Delineating with no exclude polygon layer...",!0,0),t.startDelineate(e,!0),t.angulartics.eventTrack("validatePoint",{category:"Map",label:"not advised (no point query)"}),void(t.cursorStyle="pointer");a.overlays[i].identify().on(r).at(e).returnGeometry(!1).layers(o).run(function(r,a){if(t.toaster.clear(),0==a.features.length)t.angulartics.eventTrack("validatePoint",{category:"Map",label:"valid"}),t.toaster.pop("success","Your clicked point is valid","Delineating your basin now...",5e3),t.studyArea.checkingDelineatedPoint=!1,t.startDelineate(e,!1);else{t.studyArea.checkingDelineatedPoint=!1;var o=a.features[0].properties.ExcludeCod,i=a.features[0].properties.ExcludeRea;1==o?(t.toaster.pop("error","Delineation and flow statistic computation not allowed here",i,0),t.angulartics.eventTrack("validatePoint",{category:"Map",label:"not allowed"})):(t.toaster.pop("warning","Delineation and flow statistic computation possible but not advised",i,!0,0),t.startDelineate(e,!0,i),t.angulartics.eventTrack("validatePoint",{category:"Map",label:"not advised"}))}t.cursorStyle="pointer"})}})})},t.prototype.basinEditor=function(){var e=this;this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(r){var a=r.overlays.draw;a.clearLayers(),new L.Draw.Polygon(t,a).enable(),t.on("draw:created",function(r){t.removeEventListener("draw:created");var o=r.layer;a.addLayer(o);var i=o.toGeoJSON();"add"==e.studyArea.drawControlOption&&(e.checkEditIntersects("adds",i)?e.toaster.pop("warning","Warning","Overlapping add and remove edit areas are not allowed",5e3):(e.addGeoJSON("adds",i),e.angulartics.eventTrack("basinEditor",{category:"Map",label:"addArea"}),e.studyArea.WatershedEditDecisionList.append.push(i))),"remove"==e.studyArea.drawControlOption&&(e.checkEditIntersects("removes",i)?e.toaster.pop("warning","Warning","Overlapping add and remove edit areas are not allowed",5e3):(e.addGeoJSON("removes",i),e.angulartics.eventTrack("basinEditor",{category:"Map",label:"removeArea"}),e.studyArea.WatershedEditDecisionList.remove.push(i))),a.clearLayers()})})})},t.prototype.checkEditIntersects=function(e,t){var r,a=!1;return r="adds"===e?"removes":"adds",this.geojson.hasOwnProperty(r)&&this.geojson[r].data.features.forEach(function(e){void 0!=turf.intersect(t,e)&&(a=!0)}),a},t.prototype.canSelectExplorationTool=function(t){switch(t){case e.Services.ExplorationMethodType.NETWORKPATH:case e.Services.ExplorationMethodType.FLOWPATH:case e.Services.ExplorationMethodType.NETWORKTRACE:break;default:return!1}return!0},t.prototype.onExplorationMethodComplete=function(t,r){var a=this;this.angulartics.eventTrack("explorationTools",{category:"Map",label:"networknav-"+this.explorationService.selectedMethod.navigationInfo.code}),this.explorationService.explorationMethodBusy=!1,null!=r.features&&r.features.features.length>0&&(this.removeMarkerLayers("netnav_",!0),this.explorationService.networkNavResults.forEach(function(e,t){a.addGeoJSON(e.name,e.feature),"netnavroute"==e.name&&a.leafletData.getMap("mainMap").then(function(t){var r=L.geoJson(e.feature);t.fitBounds(r.getBounds())}),a.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,a,new WiM.Directives.LegendLayerAddedEventArgs(e.name,"geojson",a.geojson[e.name].style))}),this.selectedExplorationMethodType=0,this.selectedExplorationTool=null,this.modalStack.dismissAll()),null!=r.report&&""!=r.report&&this.modal.openModal(e.Services.SSModalType.e_navreport,{placeholder:r.report})},t.prototype.onSelectExplorationMethod=function(t,r){this.modal.openModal(e.Services.SSModalType.e_exploration)},t.prototype.onSelectedAreaOfInterestChanged=function(e,t){this.angulartics.eventTrack("Search",{category:"Sidebar"}),this.paths={};var r=t.selectedAreaOfInterest;this.paths.AOI={type:"circleMarker",radius:15,color:"#ff0000",fillOpacity:.6,stroke:!1,latlngs:{lat:r.properties.Lat,lng:r.properties.Lon}},this.leafletData.getMap("mainMap").then(function(e){e.fitBounds([[r.properties.LatMin,r.properties.LonMin],[r.properties.LatMax,r.properties.LonMax]]),setTimeout(function(){e.getZoom()<8&&e.setZoom(8)},500),e.openPopup($.map(Object.keys(r.properties),function(e){if(-1!=["Label","ElevFt","Lat","Lon","Source"].indexOf(e))return"<b>"+e+": </b>"+r.properties[e]}).join("<br/>"),[r.properties.Lat,r.properties.Lon])})},t.prototype.onSelectedRegionChanged=function(){this.regionServices.selectedRegion&&(this.removeOverlayLayers("_region",!0),this.regionServices.loadMapLayersByRegion(this.regionServices.selectedRegion.RegionID))},t.prototype.onSelectedStudyAreaChanged=function(){var e,t=this;if(this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.FeatureCollection&&(this.markers={},this.removeOverlayLayers("globalwatershed",!0),this.studyArea.selectedStudyArea.FeatureCollection.features.forEach(function(e){var r=angular.fromJson(angular.toJson(e)),a=r.id.toLowerCase();t.addGeoJSON(a,r),t.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,t,new WiM.Directives.LegendLayerAddedEventArgs(a,"geojson",t.geojson[a].style))}),this.studyArea.selectedStudyArea.FeatureCollection.bbox&&(e=this.studyArea.selectedStudyArea.FeatureCollection.bbox,this.leafletData.getMap("mainMap").then(function(t){t.fitBounds([[e[1],e[0]],[e[3],e[2]]],{})})),this.regionServices.selectedRegion.Applications.indexOf("KarstCheck")>-1&&this.studyArea.queryKarst(this.regionServices.selectedRegion.RegionID,this.regionServices.regionMapLayerList),!this.nssService.queriedRegions)){if(!this.regionServices.selectedRegion.ScenariosAvailable)return void(this.studyArea.regressionRegionQueryComplete=!0);this.nssService.queriedRegions=!0}},t.prototype.AddProsperLayer=function(e){this.layers.overlays["prosper"+e]=new o("Prosper Layer",configuration.baseurls.ScienceBase+configuration.queryparams.ProsperPredictions,"agsDynamic",!0,{opacity:1,layers:[e],format:"png8",f:"image"})},t.prototype.removeGeoJson=function(e){for(var t in void 0===e&&(e=""),this.geojson)"function"!=typeof this.geojson[t]&&"streamgages"!=t&&(delete this.geojson[t],this.eventManager.RaiseEvent(WiM.Directives.onLayerRemoved,this,new WiM.Directives.LegendLayerRemovedEventArgs(t,"geojson")))},t.prototype.addGeoJSON=function(e,t){if("globalwatershed"==e){var r=this.studyArea.simplify(t);this.geojson[e]={data:r,style:{displayName:"Basin Boundary",imagesrc:"data:image/png;base64,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",fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}}}else if("globalwatershedpoint"==e){var a=this.studyArea.selectedStudyArea.Pourpoint.Latitude,o=this.studyArea.selectedStudyArea.Pourpoint.Longitude,i=this.studyArea.selectedStudyArea.RegionID,n=this.studyArea.selectedStudyArea.WorkspaceID;this.geojson[e]={data:t,onEachFeature:function(e,t){var r="<strong>Latitude: </strong>"+a+"</br><strong>Longitude: </strong>"+o+"</br><strong>Region: </strong>"+i+"</br><strong>WorkspaceID: </strong>"+n+"</br>";angular.forEach(e.properties,function(e,t){r+="<strong>"+t+": </strong>"+e+"</br>"}),t.bindPopup(r)},style:{displayName:"Basin Clicked Point",imagesrc:"data:image/png;base64,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",visible:!0}}}else if("regulatedWatershed"==e)this.geojson[e]={data:t,style:{displayName:"Basin Boundary (Regulated Area)",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAWCAYAAAArdgcFAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAUlJREFUeNrs1L9LAnEYx/H7pxyEghpyFmqov+E2raFbbpKoqYamDISSBqeWuCEUdLEyIgwJU+HwR2V4ZufpHZ73bvAIgsqKu6aGD8+X75fntTw8X8GSAvgV4R//U9yMh/3Bh/EwTu/Qe9zcCTF+igP57+OmHMSMzUyqHPzwvZ9cxqztAmdAeTo+2Jyjn1zBSEfRugc8PO7Rzq7RUUQ0RUTLrtMqbNCq7DN4PgWnBHYNSwoIX+LDrXmwUkAWuASu3VwBBffuBigDFaAB4zaWFBCm4kZiCcgBRRjfwUgFWwVUoArUJmdHBbsJ1v0bPBXXT0Tg4l3DT/IpbsZm6edloOg9PtxeoNc7Akp+4CF0PQXceo8biUX0l2Og6j2uKSL2KAfUvcc76Qi2fQ60/MEdxydcS0fcLWz6gGei7po3vMe7mVX3H/n9QF8HAGNo54Dt7QOyAAAAAElFTkSuQmCC",fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}};else if(-1!=e.indexOf("netnavpoints"))this.geojson[e]={data:t,onEachFeature:function(e,t){var r="<strong>Network navigation start/end point</strong></br>";angular.forEach(e.properties,function(e,t){r+="<strong>"+t+": </strong>"+e+"</br>"}),t.bindPopup(r)},pointToLayer:function(e,t){var r="wmm-pin wmm-mutedblue wmm-icon-noicon wmm-icon-black wmm-size-25";"ss_gages"==e.properties.source&&(r="wmm-pin wmm-blue wmm-icon-triangle wmm-icon-black wmm-size-25"),"WQP"==e.properties.source&&(r="wmm-pin wmm-sky wmm-icon-square wmm-icon-black wmm-size-25");var a=L.divIcon({className:r});return L.marker(t,{icon:a})},style:{displayName:"Network navigation point",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAlCAYAAAC+uuLPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAA57GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoV2luZG93cyk8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMTgtMDEtMzBUMTU6NTk6NDgtMDU6MDA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxOC0wMS0zMVQxMTowMDoyMC0wNTowMDwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXA6TWV0YWRhdGFEYXRlPjIwMTgtMDEtMzFUMTE6MDA6MjAtMDU6MDA8L3htcDpNZXRhZGF0YURhdGU+CiAgICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2UvcG5nPC9kYzpmb3JtYXQ+CiAgICAgICAgIDxwaG90b3Nob3A6Q29sb3JNb2RlPjM8L3Bob3Rvc2hvcDpDb2xvck1vZGU+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnhtcC5paWQ6M2FkNDgxMTctYjA3Mi05NjQ4LTk5MmYtZmIyZTgzNTcwOTkxPC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD5hZG9iZTpkb2NpZDpwaG90b3Nob3A6ZDZiMzhiZmUtMDY5Zi0xMWU4LTk2OTAtOGIzNWZmM2I1YzJjPC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06T3JpZ2luYWxEb2N1bWVudElEPnhtcC5kaWQ6NDQ0OTVjNjYtY2JjZS04ZDQyLWFhYmUtYjJmZTM4MjRmYWI3PC94bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpIaXN0b3J5PgogICAgICAgICAgICA8cmRmOlNlcT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y3JlYXRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOjQ0NDk1YzY2LWNiY2UtOGQ0Mi1hYWJlLWIyZmUzODI0ZmFiNzwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxOC0wMS0zMFQxNTo1OTo0OC0wNTowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDozYWQ0ODExNy1iMDcyLTk2NDgtOTkyZi1mYjJlODM1NzA5OTE8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTgtMDEtMzFUMTE6MDA6MjAtMDU6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChXaW5kb3dzKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj45NjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjk2MDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT42NTUzNTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+Mjk8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+Mzc8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pj4hpkQAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2xJREFUeNrs181rI3Ucx/H3b2YyD8mkMZslSZOsaVfsXpaFlYLg3jwvgl4XRVGPXZ8FRawXQQVXlD3pQegee+tfIQiFZV1auw9tau3zQ9KkM5OZyfw81JV1aZNMCiq43/Mwr9985/f9zG+ElJJ/uhT+hfr/oFq/F07PzMj7tWU2t7dwHBdVU0nbaYbzea6++YaIg4peG+n7qSk5e+sX6o0GrucRBAGdKEIIgaqq6IkESctiuJDnufFxXrp8WZwI/fSLL+XthQUOHIdei9M0jbSd4pnz5/lwYkIMhL4/OSkX7i/S9n2EomAPDZErFknZaSzbJooimvU6rUaDxu4OTrMJgGWajF+4wCfvvStioR9Mfibn7t0lCEIM06JYrVKqjmBYJqqqoagqSEkYhnQ6Ic5+k5XFe2yurBBFEaZh8OzFi3z8ztuiL/Tza9/In2Zn8YOAoewpqmPnyBUK6IYB4ujFR1FE23VYW66xfOcOvueRtCyev3SJiSM22d9G5sb0tPz55k38ICBp25RGRsmXy+imeSwIoCgKVsqmVB2lNDKKoig4rsut+fnec3p7fh7X89ASCU4XhymcqaBqfU8VhmWRL5XJ5vMArK6v89X167IrenepBoCdyZCvVDAMM9bQCyEYymYpVs6gmyZBGLK6vtH9SVsHBwAk7TSZ3OmuLT221apKKpPBzmQAqO83uqNSSrREAjOZRFXVgWMukdAxTAsAx3F7Z6+iqmha4kTZqmoaCV0HIOiEvVEpJVEUnTDS5V8JpiB6o6Hv0/bcE5GBH+D/eQ/d0LujQgiklATtNr7nDYy2PZeDZutwElKp7uhw4XC+9vf22FpbHQj0220aOzs4rcMszj2R7Y6OnX0KANc5YGPlNxq7O/HeZBSxt7XJ+nKNqNNhKG3z9NnR7uhHb10VpWIRGUXUt3dYq9VitblZr7O6tITTOmxttVLh9StXRF9fmRdffU06rotumpRHRqmOnTvM3y61v7fL4twc2+trdMKQJ8tlfrj2dX9fmQf1wsuvyLbv9wU/CpYKBX787lsR+2A2c2NKGLqO73n8vrRIbeHXI1sdF+x5GuwFDwL2dTA7rtWe6wwE9o0+CmdO5QDY3dyIDcZCH4YVVUUAnU4nNhgbfRgGBgIHQh/AuWx2IHBg9PFf22P0P4H+MQCyncndp+2ZGQAAAABJRU5ErkJggg==",visible:!0}};else if("netnavroute"==e)this.geojson[e]={data:t,visible:!0,style:{displayName:"Network navigation route",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA2CAYAAACMRWrdAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAVaSURBVGhDzZr5VxpXFMf7n7ZpkqZLmqbRaIxaEzWyzIjghhtuQBQNuKMii0vSnqZb2qZNm66iwfavuL33jVbEOzBvmBn44XOOHD3P+TD3vXu/MG95MsdQL3h38rDgjsLu9fvw9O07hll6MAb9Sz9eWKuuxGaCSch8+IC9eD1Stx7B4OK3l9aqGzHf+q+w2jYM++82sQIcB+80QNSfAF/yt0vr1Y1Y1B+H7I12vOCGSwJ6rLX0w+CT78CbPrq0Xl2IBR9/CVt3vHgHGlkBjtyNNpiYzIGS+ptds+ZivZt/QOLhBOxdvccK6DGvzEEfli+3JlFzsdmhtdMDw3gJbjaqMBz7Ckswz65J1FSM9keyySdVgntXm2FqdBvUrb/YNc+omZiSOoTFnlnYvdbCCugR75qEwPJP7JrF1EwsFMrCzsfdcCBRgvT3I5HPRSPn1iymJmL+lZ9h7f4A7F+5ywpwHFxphPDAqjhsuDVLcVyMes68GoPce62sgB4r2LwH4t+Dh+lZHI6LjYafwfZtt9SBkX2/Hcan98S+5NbkcFSsN/k7LHeM4tjUzAroMYd32Lf+ml1TD0fFwgMrkP3gM7xY4wfGRlMfDC18w45N5XBMbCj2NSSxscqU4O71FpicSIOyXb5ncTgiRhcW756CvWtyY9OiKwz+1VfsmpVwRGxqLAXpm514scZLkA4YGo6N9CwO28UCyy9h/V5AqmfR384Mb+DYZKxncdgqRhs+5n0Mu5I9a6njNOpLHhjF2Co2PrMPqU96RNLlBDjSHz2EsdmnWILGexaHbWIU9VfarYv6stgmJqI+TgxWRX1ZbBELzmHUb5CL+rQPaeLXi/qyWC6mbv0JiU75qB/zRKFv7Rd2TTNYLkafDdIBIBX1GxQYnn9eNurLYqnYQPwFbDT3YXYy3rMo6k+Pbok7za1pFsvEzEb9RGfIUNSXxTKx0CRG/VtyUZ/GrNHIs6p7FoclYv61Vxj1B6WjfqR/WWQ0bs1qsURsrndBfDLLCeix2jYkFfVlqVqMPjXa+tT+qC9LVWJORn1ZqhIzF/V9pqK+LKbF6OJMRf3xHVBNRH1ZTInRPPeke9rRqC+LKTF613duduHFGi/B7duuqqJ+Ke5TPJk3oGQ1vIg7ewyuzJG8mIj6GC9MRX2DH09XgoRcaeINvi6AmjsReHMFcKFYdzYvJ2Y26tPJWW3UL0aICXixLlmxMYz626ai/gEoFo9NWimSGJVhAcuwIH4m4UcypejbeI1RP1izqM+jiXlwbwkpUZ7H0IO/MywWCSzhxCDXs9ZbAjC4aE3UL8WLJSfAn8/3nAbdSUNiwbnnIgzWMuqXoqCUKsSOUCYPPfjmCSk8ULzpQmUxLeqHah71S1FQSM0eoVge99WZGJYkSqnpfyqLTY9sSkd9embD6qhfiiaWPxfD19rdOoHe9L/lxfoTP2DU98tHfXwzrI76FzlCsTyoyLkY7S08HfFulRWjSLHgjkg/iaZF/ZfsmtahiSkZaiGHQoz6F/U0pZIYPc5DT5ZJ9SyK+mF7ov5FcG9hmStp/D+Im8qQxLCXKRkS09ljFPVXWynqy/Qse6P+RbB9oJjYw8iZGDVpJYtTCO4zVsxU1G+lqP/CsrGpIvh/NDGUotdiCCYxumtMHxuJfoFR3yPVsyjqT0zt2tazWETPopNQa8hi+vifksmDHg6hx1DpZOME9HAi6hejzYnnU8bZaEXl6Mbe5i4dgrUn0TrwYo0fGMm7veKLc7ujfjFnA7AGDb/aACxkUcyVKxITUR8vUqYEaRqh75ediPrFaGIF5ARfY1zBacOLzVmI4UHSkzuE/wDtg18mgH26LgAAAABJRU5ErkJggg==",color:"red"}};else if("adds"==e)this.geojson.hasOwnProperty(e)?this.geojson[e].data.features.push(t):this.geojson[e]={data:{type:"FeatureCollection",features:[t]},visible:!0,style:{displayName:e,fillColor:"green",color:"green"}};else if("removes"==e)this.geojson.hasOwnProperty(e)?this.geojson[e].data.features.push(t):this.geojson[e]={data:{type:"FeatureCollection",features:[t]},visible:!0,style:{displayName:e,fillColor:"red",color:"red"}};else if("streamgages"==e){var s=this;this.geojson[e]={data:t,style:{displayName:"Streamgages"},onEachFeature:function(e,t){var r=e.properties.Code,a="https://streamstatsags.cr.usgs.gov/gagepages/html/"+r+".htm",o="http://nwis.waterdata.usgs.gov/nwis/inventory/?site_no="+r,i=L.DomUtil.create("div","testDiv");i.innerHTML="<strong>Station ID: </strong>"+r+"</br><strong>Station Name: </strong>"+e.properties.Name+"</br><strong>Latitude: </strong>"+e.geometry.coordinates[1]+"</br><strong>Longitude: </strong>"+e.geometry.coordinates[0]+"</br><strong>Station Type</strong>: "+e.properties.StationType.name+'</br><strong>NWIS page: </strong><a href="'+o+' "target="_blank">link</a></br><strong>StreamStats Gage page: </strong><a href="'+a+'" target="_blank">link</a></br><strong>New StreamStats Gage Modal: </strong><a id="gagePageLink" class="'+r+'">link</a><br>',t.bindPopup(i);var n=configuration.overlayedLayers.SSLayer.layerArray[0].legend.filter(function(t){return t.label.toLowerCase()==e.properties.StationType.name.toLowerCase()})[0];void 0==n&&(n=configuration.overlayedLayers.SSLayer.layerArray[0].legend.filter(function(e){return"Unknown"==e.label})[0]);var g=L.icon({iconUrl:"data:image/png;base64,"+n.imageData,iconSize:[15,16],iconAnchor:[7.5,8],popupAnchor:[0,-11]});t.setIcon(g),L.DomEvent.on(i,"click",function(e){"gagePageLink"===e.target.id&&s.openGagePage(r)}),t.on("mouseover",function(e){s.studyArea.doSelectMapGage&&this.openPopup()}),t.on("click",function(t){s.studyArea.doSelectMapGage?(s.studyArea.selectGage(e),s.studyArea.doSelectMapGage=!1):this.openPopup()})}}}else this.geojson[e]={data:t,visible:!0,style:{displayName:e,fillColor:"blue",color:"blue"}}},t.prototype.onLayerChanged=function(e,t){var r=this;if("visible"===t.PropertyName)if(t.Value){if(this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.FeatureCollection.features.length>0&&this.studyArea.selectedStudyArea.FeatureCollection.features.forEach(function(e){if(e.id==t.LayerName){var a=angular.fromJson(angular.toJson(e)),o=a.id;r.addGeoJSON(o,a)}}),this.explorationService.networkNavResults)for(var a=0;a<this.explorationService.networkNavResults.length;a++){var o=angular.fromJson(angular.toJson(this.explorationService.networkNavResults[a]));o.name==t.LayerName&&this.addGeoJSON(t.LayerName,o.feature)}}else delete this.geojson[t.LayerName]},t.prototype.mapBoundsChange=function(e,t){this.nomnimalZoomLevel=this.scaleLookup(this.center.zoom),this.center.zoom>=8&&e!==t&&(this.regionServices.loadRegionListByExtent(this.bounds.northEast.lng,this.bounds.southWest.lng,this.bounds.southWest.lat,this.bounds.northEast.lat),this.regionServices.selectedRegion||this.toaster.pop("info","Information","User input is needed to continue",5e3),this.center.zoom>=9&&this.studyArea.getStreamgages(this.bounds.southWest.lng,this.bounds.northEast.lng,this.bounds.southWest.lat,this.bounds.northEast.lat)),this.center.zoom<8&&e!==t&&(this.regionServices.regionList=[]),this.center.zoom>=15?this.studyArea.zoomLevel15=!0:this.studyArea.zoomLevel15=!1},t.prototype.updateRegion=function(){var e=this.$locationService.search().region;this.setBoundsByRegion(e)},t.prototype.setBoundsByRegion=function(e){e&&this.regionServices.loadRegionListByRegion(e)&&(this.regionServices.selectedRegion=this.regionServices.regionList[0],this.bounds=this.leafletBoundsHelperService.createBoundsFromArray(this.regionServices.selectedRegion.Bounds))},t.prototype.addRegionOverlayLayers=function(e){if(!(this.regionServices.regionMapLayerList.length<1)){var t=[];this.regionServices.regionMapLayerList.map(function(e){t.push(e[1])});this.layers.overlays[e+"_region"]=new o(e+" Map layers",configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers,"agsDynamic",!0,{opacity:1,layers:t,format:"png8",f:"image"}),this.leafletData.getLayers("mainMap").then(function(t){t.overlays[e+"_region"].bringToBack(),t.overlays.SSLayer.bringToFront()});var r=this.regionServices.selectedRegion.Layers;if(void 0!=r)for(var a in r)this.layers.overlays[a+"_region"]=r[a]}},t.prototype.removeOverlayLayers=function(e,t){var r=this;void 0===t&&(t=!1),this.getLayerIdsByID(e,this.layers.overlays,t).forEach(function(e){delete r.layers.overlays[e]})},t.prototype.removeMarkerLayers=function(e,t){var r=this;void 0===t&&(t=!1),this.getLayerIdsByID(e,this.markers,t).forEach(function(e){delete r.markers[e]})},t.prototype.removeGeoJsonLayers=function(e,t){var r=this;void 0===t&&(t=!1),this.getLayerIdsByID(e,this.geojson,t).forEach(function(e){delete r.geojson[e]})},t.prototype.getLayerIdsByName=function(e,t,r){var a=[];for(var o in t)t[o].hasOwnProperty("name")&&(r?t[o].name.indexOf(e)>-1:t[o].name===e)&&a.push(o);return a},t.prototype.getLayerIdsByID=function(e,t,r){var a=[];for(var o in t)(r?o.indexOf(e)>-1:o===e)&&a.push(o);return a},t.prototype.startDelineate=function(t,r,a){var o=new e.Models.StudyArea(this.regionServices.selectedRegion.RegionID,new WiM.Models.Point(t.lat,t.lng,"4326"));this.studyArea.AddStudyArea(o),this.studyArea.loadStudyBoundary(),r&&(this.studyArea.selectedStudyArea.Disclaimers.isInExclusionArea="The delineation point is in an exclusion area. "+a)},t.$inject=["$scope","$compile","toaster","$analytics","$location","$stateParams","leafletBoundsHelpers","leafletData","WiM.Services.SearchAPIService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ExplorationService","StreamStats.Services.ProsperService","WiM.Event.EventManager","StreamStats.Services.ModalService","$modalStack"],t}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.MapController",n)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(t){"use strinct";var r,a=function(){function t(t,a,o,i,n,s,g,c,A,l){var u=this;this.EventManager=l,this.SSServicesVersion="1.2.22",this.dateRange={dates:{startDate:new Date,endDate:new Date},minDate:new Date(1900,1,1),maxDate:new Date},t.vm=this,this.init(),this.toaster=a,this.angulartics=o,this.sideBarCollapsed=!1,this.selectedProcedure=r.INIT,this.regionService=i,this.nssService=s,this.studyAreaService=n,this.modalService=g,this.leafletData=c,this.multipleParameterSelectorAdd=!0,this.explorationService=A,s.onSelectedStatisticsGroupChanged.subscribe(this._onSelectedStatisticsGroupChangedHandler),t.$watch(function(){return u.regionService.selectedRegion},function(e,t){null==e?u.setProcedureType(1):u.setProcedureType(2)}),t.$watch(function(){return u.studyAreaService.regressionRegionQueryComplete},function(e,t){e!=t&&(null==e?u.setProcedureType(2):u.regionService.selectedRegion.ScenariosAvailable?u.setProcedureType(3):u.setProcedureType(2))}),t.$watchCollection(function(){return u.studyAreaService.selectedStudyAreaExtensions},function(e,t){e!=t&&(u.scenarioHasExtenstions=u.studyAreaService.selectedStudyAreaExtensions.length>0)}),l.SubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,new WiM.Event.EventHandler(function(e,t){u.parametersLoaded=t.parameterLoaded,u.parametersLoaded?u.setProcedureType(4):u.setProcedureType(3)}))}return Object.defineProperty(t.prototype,"ParameterValuesMissing",{get:function(){if(!this.studyAreaService.studyAreaParameterList||this.studyAreaService.studyAreaParameterList.length<1)return!0;for(var e=0;e<this.studyAreaService.studyAreaParameterList.length;e++){var t=this.studyAreaService.studyAreaParameterList[e];if(!t.value||t.value<0)return!0}return!1},enumerable:!1,configurable:!0}),t.prototype.setProcedureType=function(e){this.selectedProcedure!=e&&this.canUpdateProcedure(e)?this.selectedProcedure=e:2!=this.selectedProcedure||3!=e&&4!=e||this.toaster.pop("warning","Warning","Make sure you have delineated a basin and clicked continue",5e3)},t.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},t.prototype.onAOISelect=function(e){this.EventManager.RaiseEvent(WiM.Services.onSelectedAreaOfInterestChanged,this,new WiM.Services.SearchAPIEventArgs(e))},t.prototype.zoomRegion=function(e){angular.fromJson(e)},t.prototype.setRegion=function(e){this.angulartics.eventTrack("initialOperation",{category:"SideBar",label:"Region Selection Button"}),void 0!=this.regionService.selectedRegion&&this.regionService.selectedRegion.RegionID===e.RegionID||(this.regionService.selectedRegion=e),this.setProcedureType(2),this.regionService.loadParametersByRegion()},t.prototype.openStatePage=function(t,r){t.stopPropagation(),t.preventDefault(),this.modalService.openModal(e.Services.SSModalType.e_about,{tabName:"regionInfo",regionID:r})},t.prototype.resetWorkSpace=function(){this.regionService.clearSelectedParameters(),this.studyAreaService.clearStudyArea(),this.studyAreaService.zoomLevel15=!0,this.nssService.clearNSSdata(),this.multipleParameterSelectorAdd=!1},t.prototype.startSearch=function(e){e.stopPropagation(),e.preventDefault(),$("#searchBox").trigger($.Event("keyup",{keyCode:13}))},t.prototype.startDelineate=function(){var e=this;this.leafletData.getMap("mainMap").then(function(t){t.getZoom()<15?e.toaster.pop("error","Delineate","You must be at or above zoom level 15 to delineate."):(e.toaster.pop("success","Delineate","Click on a blue stream cell to start delineation"),e.studyAreaService.doDelineateFlag=!e.studyAreaService.doDelineateFlag)})},t.prototype.setStatisticsGroup=function(e){var t=this.checkArrayForObj(this.nssService.selectedStatisticsGroupList,e);if(-1!=t)this.nssService.selectedStatisticsGroupList.splice(t,1),0==this.nssService.selectedStatisticsGroupList.length&&(this.studyAreaService.studyAreaParameterList=[],this.regionService.parameterList.forEach(function(e){e.checked=!1,e.toggleable=!0}));else{if(this.nssService.selectedStatisticsGroupList.push(e),null!=this.studyAreaService.selectedStudyArea.CoordinatedReach&&"PFS"==e.code.toUpperCase())return this.addParameterToStudyAreaList("DRNAREA"),void(this.nssService.showFlowsTable=!0);this.nssService.loadParametersByStatisticsGroup(this.regionService.selectedRegion.RegionID,e.id,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","),this.studyAreaService.selectedStudyArea.RegressionRegions)}},t.prototype.multipleParameterSelector=function(){var e=this;this.regionService.parameterList.forEach(function(t){var r=e.checkArrayForObj(e.studyAreaService.studyAreaParameterList,t);e.multipleParameterSelectorAdd?(-1==r&&e.studyAreaService.studyAreaParameterList.push(t),t.checked=!0):r>-1&&t.toggleable&&(e.studyAreaService.studyAreaParameterList.splice(r,1),t.checked=!1)}),this.multipleParameterSelectorAdd=!this.multipleParameterSelectorAdd},t.prototype.updateStudyAreaParameterList=function(e){if(0==e.toggleable)return this.toaster.pop("warning",e.code+" is required by one of the selected scenarios","It cannot be unselected"),void(e.checked=!0);var t=this.studyAreaService.studyAreaParameterList.indexOf(e);!e.checked&&t>-1?this.studyAreaService.studyAreaParameterList.splice(t,1):e.checked&&-1==t&&this.studyAreaService.studyAreaParameterList.push(e),this.checkParameters()},t.prototype.checkParameters=function(){for(var e=!0,t=0,r=this.regionService.parameterList;t<r.length;t++){r[t].checked||(e=!1)}this.multipleParameterSelectorAdd=!e},t.prototype.calculateParameters=function(){this.angulartics.eventTrack("CalculateParameters",{category:"SideBar",label:this.regionService.selectedRegion.Name+"; "+this.studyAreaService.studyAreaParameterList.map(function(e){return e.code}).join(",")}),this.studyAreaService.loadParameters(),this.scenarioHasExtenstions&&(this.modalService.openModal(e.Services.SSModalType.e_extensionsupport),1==this.nssService.selectedStatisticsGroupList.length&&(this.nssService.showBasinCharacteristicsTable=!1))},t.prototype.submitBasinEdits=function(){this.angulartics.eventTrack("basinEditor",{category:"Map",label:"sumbitEdits"}),this.studyAreaService.showEditToolbar=!1,this.toaster.pop("wait","Submitting edited basin","Please wait...",0),this.studyAreaService.selectedStudyArea.Disclaimers.isEdited&&(this.nssService.clearNSSdata(),this.studyAreaService.loadEditedStudyBoundary())},t.prototype.selectScenarios=function(){this.setProcedureType(3)},t.prototype.refreshWindow=function(){window.location.reload()},t.prototype.generateReport=function(){var t=this;if(this.toaster.pop("wait","Opening Report","Please wait...",5e3),this.angulartics.eventTrack("CalculateFlows",{category:"SideBar",label:this.regionService.selectedRegion.Name+"; "+this.nssService.selectedStatisticsGroupList.map(function(e){return e.name}).join(",")}),this.nssService.selectedStatisticsGroupList.length>0&&this.nssService.showFlowsTable){var r=[];if(null!=this.studyAreaService.selectedStudyArea.CoordinatedReach)for(var a=0;a<this.nssService.selectedStatisticsGroupList.length;a++){var o=this.nssService.selectedStatisticsGroupList[a];if("PFS"===o.code.toUpperCase()){o.citations=[{author:"Indiana DNR,",title:"Coordinated Discharges of Selected Streams in Indiana.",citationURL:"http://www.in.gov/dnr/water/4898.htm"}],o.regressionRegions=[];var i=this.studyAreaService.selectedStudyArea.CoordinatedReach.Execute(this.studyAreaService.studyAreaParameterList.filter(function(e){return"DRNAREA"===e.code}));o.regressionRegions.push(i),r.push(o),this.nssService.selectedStatisticsGroupList.splice(a,1);break}}this.nssService.estimateFlows(this.studyAreaService.studyAreaParameterList,"value",this.regionService.selectedRegion.RegionID),-1!=this.regionService.selectedRegion.Applications.indexOf("RegulationFlows")&&setTimeout(function(){t.nssService.estimateFlows(t.studyAreaService.studyAreaParameterList,"unRegulatedValue",t.regionService.selectedRegion.RegionID,!0)},500),null!=o&&"PFS"===o.code.toUpperCase()&&(this.nssService.selectedStatisticsGroupList.push(o),1==this.nssService.selectedStatisticsGroupList.length&&(this.toaster.clear(),this.modalService.openModal(e.Services.SSModalType.e_report),this.nssService.reportGenerated=!0))}else this.toaster.clear(),this.modalService.openModal(e.Services.SSModalType.e_report),this.nssService.reportGenerated=!0;this.leafletData.getMap("mainMap").then(function(e){t.leafletData.getLayers("mainMap").then(function(r){for(var a in r.baselayers)e.hasLayer(r.baselayers[a])&&(t.studyAreaService.baseMap={},t.studyAreaService.baseMap[a]=configuration.basemaps[a])})})},t.prototype.checkRegulation=function(){this.studyAreaService.upstreamRegulation()},t.prototype.queryRegressionRegions=function(){if(!this.regionService.selectedRegion.ScenariosAvailable)return this.studyAreaService.regressionRegionQueryComplete=!0,void this.setProcedureType(r.SELECT);this.nssService.queriedRegions=!0,-1!=this.regionService.selectedRegion.Applications.indexOf("CoordinatedReach")&&this.studyAreaService.queryCoordinatedReach(),this.studyAreaService.selectedStudyArea.RegressionRegions?this.setProcedureType(3):this.studyAreaService.queryRegressionRegions()},t.prototype.queryStatisticsGroupTypes=function(){this.nssService.loadStatisticsGroupTypes(this.regionService.selectedRegion.RegionID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","))},t.prototype.updateParameterValue=function(e){},t.prototype.onSelectedStatisticsGroupChanged=function(){var e=this;this.nssService.selectedStatisticsGroupList.length>0?this.nssService.showFlowsTable=!0:this.nssService.showFlowsTable=!1,this.nssService.selectedStatisticsGroupList.forEach(function(t){t.regressionRegions&&t.regressionRegions.forEach(function(t){t.parameters.forEach(function(t){for(var r=!1,a=0;a<e.regionService.parameterList.length;a++){var o=e.regionService.parameterList[a];if(o.code.toLowerCase()==t.code.toLowerCase()){e.addParameterToStudyAreaList(o.code),r=!0;break}}if(!r){e.toaster.pop("warning","Missing Parameter: "+t.code,"The selected scenario requires a parameter not available in this State/Region.  The value for this parameter will need to be entered manually.",0);var i={name:t.name,description:t.description,code:t.code,unit:t.unitType.unit,value:null,regulatedValue:null,unRegulatedValue:null,loaded:null,checked:!1,toggleable:!0};e.regionService.parameterList.push(i),e.addParameterToStudyAreaList(t.code)}})})})},t.prototype.OpenWateruse=function(){this.modalService.openModal(e.Services.SSModalType.e_wateruse)},t.prototype.OpenStormRunoff=function(){this.modalService.openModal(e.Services.SSModalType.e_stormrunnoff)},t.prototype.OpenNearestGages=function(){this.modalService.openModal(e.Services.SSModalType.e_nearestgages)},t.prototype.downloadGeoJSON=function(){var e=angular.toJson(this.studyAreaService.selectedStudyArea.FeatureCollection),t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"data.geojson");else{var r=document.createElement("a"),a=URL.createObjectURL(t);void 0!==r.download?(r.setAttribute("href",a),r.setAttribute("download","data.geojson"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(a)}},t.prototype.downloadKML=function(){var e=JSON.parse(angular.toJson(this.studyAreaService.selectedStudyArea.FeatureCollection)),t=tokml(e),r=new Blob([t],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,"data.kml");else{var a=document.createElement("a"),o=URL.createObjectURL(r);void 0!==a.download?(a.setAttribute("href",o),a.setAttribute("download","data.kml"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(o)}},t.prototype.downloadShapeFile=function(){try{var e=null;this.nssService.showFlowsTable&&(e=this.nssService.getflattenNSSTable(this.studyAreaService.selectedStudyArea.WorkspaceID));var t=this.studyAreaService.getflattenStudyArea(),r="Application Version: "+configuration.version;this.SSServicesVersion&&(r+="\nStreamStats Services Version: "+this.SSServicesVersion),shpwrite.download(t,e,"USGS Data Disclaimer: Unless otherwise stated, all data, metadata and related materials are considered to satisfy the quality standards relative to the purpose for which the data were collected. Although these data and associated metadata have been reviewed for accuracy and completeness and approved for release by the U.S. Geological Survey (USGS), no warranty expressed or implied is made regarding the display or utility of the data for other purposes, nor on all computer systems, nor shall the act of distribution constitute any such warranty.\nUSGS Software Disclaimer: This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the functionality of the software and related material nor shall the fact of release constitute any such warranty. Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held liable for any damages resulting from its authorized or unauthorized use.\nUSGS Product Names Disclaimer: Any use of trade, firm, or product names is for descriptive purposes only and does not imply endorsement by the U.S. Government.\n\n"+r)}catch(e){console.log(e)}},t.prototype.init=function(){var e=this;this._onSelectedStatisticsGroupChangedHandler=new WiM.Event.EventHandler(function(){e.onSelectedStatisticsGroupChanged()})},t.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},t.prototype.addParameterToStudyAreaList=function(e){try{for(var t=0;t<this.regionService.parameterList.length;t++){var r=this.regionService.parameterList[t];if(r.code.toUpperCase()===e.toUpperCase()&&-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,r)){this.studyAreaService.studyAreaParameterList.push(r),r.checked=!0,r.toggleable=!1;break}}}catch(e){return!1}},t.prototype.canUpdateProcedure=function(e){try{switch(e){case r.INIT:return!0;case r.IDENTIFY:return null!=this.regionService.selectedRegion;case r.SELECT:return this.studyAreaService.regressionRegionQueryComplete;case r.BUILD:return this.studyAreaService.regressionRegionQueryComplete&&this.parametersLoaded;default:return!1}}catch(e){return!1}},t.prototype.sm=function(e){},t.$inject=["$scope","toaster","$analytics","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ModalService","leafletData","StreamStats.Services.ExplorationService","WiM.Event.EventManager"],t}();!function(e){e[e.INIT=1]="INIT",e[e.IDENTIFY=2]="IDENTIFY",e[e.SELECT=3]="SELECT",e[e.BUILD=4]="BUILD"}(r||(r={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.SidebarController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use strict";var r=function(t){function r(e,r,a,o){var i=t.call(this,r,configuration.baseurls.StreamStats)||this;return e.vm=i,i.modalService=a,i.checkActiveNews(),i.newArticleCount=0,i.environment=configuration.environment,i.AppVersion=configuration.version,i.cloud=configuration.cloud,i}return __extends(r,t),r.prototype.checkActiveNews=function(){var t=this;console.log("Checking for active news articles");var r={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.ActiveNewsFolder,o=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",r);this.Execute(o).then(function(r){console.log("Successfully retrieved active news articles page"),r.data.folder.articles.length>0&&(r.data.folder.articles.forEach(function(e){null==t.readCookie(e.id)&&(console.log("New news article found: ",e),t.newArticleCount+=1,t.createCookie(e.id,!0,30))}),t.newArticleCount>0&&t.modalService.openModal(e.Services.SSModalType.e_about,{tabName:"news",regionID:""}))},function(e){}).finally(function(){})},r.prototype.openReport=function(){this.modalService.openModal(e.Services.SSModalType.e_report)},r.prototype.openAbout=function(){this.modalService.openModal(e.Services.SSModalType.e_about)},r.prototype.openHelp=function(){this.modalService.openModal(e.Services.SSModalType.e_help)},r.prototype.readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var o=r[a];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null},r.prototype.createCookie=function(e,t,r){if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3);var o="; expires="+a.toUTCString()}else o="";document.cookie=e+"="+t+o+"; path=/"},r.$inject=["$scope","$http","StreamStats.Services.ModalService","StreamStats.Services.StudyAreaService"],r}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavbarController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(t){"use strinct";var r=function(){return function(e,t,r){this.lat=e,this.lng=t,this.zoom=r}}(),a=function(){function t(e,t,r,a,o,i,n,s){var g=this;this.regionService=n,this.modal=s,this.disclaimer="USGS Data Disclaimer: Unless otherwise stated, all data, metadata and related materials are considered to satisfy the quality standards relative to the purpose for which the data were collected. Although these data and associated metadata have been reviewed for accuracy and completeness and approved for release by the U.S. Geological Survey (USGS), no warranty expressed or implied is made regarding the display or utility of the data for other purposes, nor on all computer systems, nor shall the act of distribution constitute any such warranty.\nUSGS Software Disclaimer: This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the functionality of the software and related material nor shall the fact of release constitute any such warranty. Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held liable for any damages resulting from its authorized or unauthorized use.\nUSGS Product Names Disclaimer: Any use of trade, firm, or product names is for descriptive purposes only and does not imply endorsement by the U.S. Government.\n\n",this.markers=null,this.overlays=null,this.center=null,this.layers=null,this.geojson=null,this.isExceedanceTableOpen=!1,this.isFlowTableOpen=!1,this.SSServicesVersion="1.2.22",this._graphData={data:{},options:{}},e.vm=this,this.angulartics=t,this.studyAreaService=a,this.nssService=o,this.leafletData=i,this.reportTitle="StreamStats Report",this.reportComments="Some comments here",this.AppVersion=configuration.version,this.extensions=this.ActiveExtensions,this.environment=configuration.environment,this.initMap(),e.$on("leafletDirectiveMap.reportMap.load",function(e,t){g.showFeatures()}),this.close=function(){r.dismiss("cancel")},this.print=function(){window.print()},this.NSSServicesVersion=this.studyAreaService.NSSServicesVersion}return Object.defineProperty(t.prototype,"showReport",{get:function(){if(!this.studyAreaService.studyAreaParameterList)return!1;for(var e=0;e<this.studyAreaService.studyAreaParameterList.length;e++){var t=this.studyAreaService.studyAreaParameterList[e];if(t.value&&t.value>=0)return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canShowDisclaimers",{get:function(){return null!=this.studyAreaService.selectedStudyArea.Disclaimers&&Object.keys(this.studyAreaService.selectedStudyArea.Disclaimers).length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showRegulation",{get:function(){return this.regionService.selectedRegion.Applications.indexOf("RegulationFlows")>-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ActiveExtensions",{get:function(){return this.studyAreaService.selectedStudyArea.NSS_Extensions&&this.studyAreaService.selectedStudyArea.NSS_Extensions.length>0?this.studyAreaService.selectedStudyArea.NSS_Extensions:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GraphData",{get:function(){return this._graphData},enumerable:!1,configurable:!0}),t.prototype.downloadCSV=function(){var e=this;this.angulartics.eventTrack("Download",{category:"Report",label:"CSV"});var t,r="StreamStats Output Report\n\nState/Region ID,"+this.studyAreaService.selectedStudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.studyAreaService.selectedStudyArea.WorkspaceID+"\nLatitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString()+"\n";(this.nssService.selectedStatisticsGroupList.length>1||this.extensions&&"QPPQ"!=this.extensions[0].code)&&(r+=(this.studyAreaService.studyAreaParameterList,t="\nBasin Characteristics\n",(t+=e.tableToCSV($("#mainParamTable")))+"\n")),this.nssService.selectedStatisticsGroupList.forEach(function(t){r+=function(t){var r="\n";return t.regressionRegions.forEach(function(a){if("Area-Averaged"!=a.name){var o="";a.percentWeight&&(o=a.percentWeight.toFixed(1)+" Percent "),r+=t.name+" Parameters,"+o+a.name.split("_").join(" ")+"\r\n",r+=e.tableToCSV($(document.getElementById(e.camelize(t.name+a.name+"ScenarioParamTable"))))+"\n"}}),r+"\n"}(t),t.disclaimers&&(t.disclaimers.Warnings||t.disclaimers.Errors)&&(r+=function(e){var t="*** "+e.name+" Disclaimers ***\r\n";return angular.forEach(e.disclaimer,function(e,r){t+=r+","+e+"\r\n"}),t+"\r\n"}(t)),r+=function(t){var r="";return t.regressionRegions.forEach(function(a){if(a.results){var o="";a.percentWeight&&(o=a.percentWeight.toFixed(1)+" Percent "),r+=t.name+" Flow Report,"+o+a.name.split("_").join(" ")+"\r\n",a.results[0].intervalBounds&&a.results[0].errors&&a.results[0].errors.length>0&&(r+='"PIl: Prediction Interval- Lower, PIu: Prediction Interval- Upper, SEp: Standard Error of Prediction, SE: Standard Error (other-- see report)"\r\n'),r+=e.tableToCSV($(document.getElementById(e.camelize(t.name+a.name+"ScenarioFlowTable"))))+"\n"}}),r+"\n"}(t)}),this.isExceedanceTableOpen=!0,this.isFlowTableOpen=!0;var a=this;setTimeout(function(){var e="";if(a.extensions){for(var t=0,o=a.extensions;t<o.length;t++){var i=o[t];if("QPPQ"==i.code){e+=i.name+=" ("+i.code+")\n";for(var n=0,s=i.parameters;n<s.length;n++){var g=s[n];if(["sdate","edate"].indexOf(g.code)>-1){var c=new Date(g.value);e+=g.name+":, "+c.toLocaleDateString()+"\n"}}e+="\n",e+=a.tableToCSV($("#ReferanceGage")),e+="\n\nExceedance Probabilities\n",e+=a.tableToCSV($("#exceedanceTable")),e+="\n\nEstimated Flows\n",e+=a.tableToCSV($("#flowTable"))}}r+=e+"\n\n"}r+=a.disclaimer+"Application Version: "+a.AppVersion,a.SSServicesVersion&&(r+="\nStreamStats Services Version: "+a.SSServicesVersion),a.NSSServicesVersion&&(r+="\nNSS Services Version: "+a.NSSServicesVersion);var A=new Blob([r],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(A,"data.csv");else{var l=document.createElement("a"),u=URL.createObjectURL(A);void 0!==l.download?(l.setAttribute("href",u),l.setAttribute("download","data.csv"),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)):window.open(u)}this.isExceedanceTableOpen=!1,this.isFlowTableOpen=!1},300)},t.prototype.downloadGeoJSON=function(){var e=this,t=this.studyAreaService.selectedStudyArea.FeatureCollection;t.features.forEach(function(t){t.properties.Name=e.studyAreaService.selectedStudyArea.WorkspaceID,t.id&&"globalwatershed"==t.id&&(t.properties=[t.properties,e.studyAreaService.studyAreaParameterList.reduce(function(e,t){return e[t.code]=t.value,e},{})].reduce(function(e,t){return Object.keys(t).forEach(function(r){e[r]=t[r]}),e},{}),t.properties.FlowStatistics=e.nssService.selectedStatisticsGroupList)});var r=angular.toJson(t),a=new Blob([r],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,"data.geojson");else{var o=document.createElement("a"),i=URL.createObjectURL(a);void 0!==o.download?(o.setAttribute("href",i),o.setAttribute("download","data.geojson"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)):window.open(i)}},t.prototype.downloadKML=function(){var e=this,t=this.studyAreaService.selectedStudyArea.FeatureCollection;t.features.forEach(function(t){t.properties.Name=e.studyAreaService.selectedStudyArea.WorkspaceID,t.id&&"globalwatershed"==t.id&&(t.properties=[t.properties,e.studyAreaService.studyAreaParameterList.reduce(function(e,t){return e[t.code]=t.value,e},{})].reduce(function(e,t){return Object.keys(t).forEach(function(r){e[r]=t[r]}),e},{}),t.properties.FlowStatistics=e.nssService.selectedStatisticsGroupList)});var r=JSON.parse(angular.toJson(t)),a=tokml(r),o=new Blob([a],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(o,"data.kml");else{var i=document.createElement("a"),n=URL.createObjectURL(o);void 0!==i.download?(i.setAttribute("href",n),i.setAttribute("download","data.kml"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)):window.open(n)}},t.prototype.downloadShapeFile=function(){try{var e=null;this.nssService.showFlowsTable&&(e=this.nssService.getflattenNSSTable(this.studyAreaService.selectedStudyArea.WorkspaceID));var t=this.studyAreaService.getflattenStudyArea(),r="Application Version: "+this.AppVersion;this.SSServicesVersion&&(r+="\nStreamStats Services Version: "+this.SSServicesVersion),this.NSSServicesVersion&&(r+="\nNSS Services Version: "+this.NSSServicesVersion),shpwrite.download(t,e,this.disclaimer+r)}catch(e){console.log(e)}},t.prototype.downloadPNG=function(e){for(var t,r=document.getElementById(e).children,a=0;a<r.length;a++)"svg"===r[a].tagName&&(t=r[a]);saveSvgAsPng(t,e+".png")},t.prototype.downloadPDF=function(){var e=new jsPDF("p","pt","letter"),t=document.getElementById("printArea").innerHTML,r={top:80,bottom:60,left:40,width:522};e.fromHTML(t,r.left,r.top,{width:r.width,elementHandlers:{"#bypassme":function(e,t){return!0}}},function(t){e.save("Test.pdf")},r)},t.prototype.ActivateGraphs=function(e){for(var t in e.graphdata={exceedance:{data:[{values:[],area:!0,color:"#7777ff"}],options:{chart:{type:"lineChart",height:450,margin:{top:20,right:30,bottom:60,left:65},x:function(e){return e.label},y:function(e){return e.value},showLegend:!1,valueFormat:function(e){return d3.format(",.3f")(e)},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Discharge (cfs)",tickFormat:function(e){return d3.format(",.0f")(e)},tickValues:[1,10,100,1e3,1e4,1e6]},yScale:d3.scale.log(),title:{enable:!0,text:"Flow Duration Curve Transfer Method (QPPQ) Model Estimated Exceedance Probabilities"}}}},flow:{data:[{key:e.referanceGage.name,values:e.referanceGage.discharge.observations.map(function(e){return{x:new Date(e.date).getTime(),y:e.value?"number"==typeof e.value?e.value.toUSGSvalue():e.value:null}})},{key:"Estimated",values:e.estimatedFlow.observations.map(function(e){return{x:new Date(e.date).getTime(),y:e.value?"number"==typeof e.value?e.value.toUSGSvalue():e.value:null}})}],options:{chart:{type:"lineChart",height:450,margin:{top:20,right:20,bottom:50,left:75},x:function(e){return new Date(e.x).getTime()},y:function(e){return e.y},useInteractiveGuideline:!1,interactive:!1,tooltips:!0,xAxis:{tickFormat:function(e){return d3.time.format("%x")(new Date(e))},rotateLabels:30,showMaxMin:!1},yAxis:{axisLabel:"Estimated Discharge (cfs)",tickFormat:function(e){return d3.format(".02f")(e)},showMaxMin:!1},zoom:{enabled:!1,scaleExtent:[1,10],useFixedDomain:!1,useNiceScale:!1,horizontalOff:!1,verticalOff:!1,unzoomEventType:"dblclick.zoom"}}}}},e.exceedanceProbabilities)e.graphdata.exceedance.data[0].values.push({label:t,value:e.exceedanceProbabilities[t]})},t.prototype.initMap=function(){this.center=new r(39,-96,4),this.layers={baselayers:configuration.basemaps,overlays:{}},this.geojson={},L.Icon.Default.imagePath="images",this.defaults={scrollWheelZoom:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1}},t.prototype.GetRegressionRegionHeader=function(e){var t=e.name.split("_").join(" ");if(e.percentWeight&&e.percentWeight<100)for(var r=0;r<this.studyAreaService.selectedStudyArea.RegressionRegions.length;r++){var a=this.studyAreaService.selectedStudyArea.RegressionRegions[r];if(null!=e.code&&a.code.indexOf(e.code.toUpperCase())>-1){t="{0} Percent ({1} square miles) {2}".format(e.percentWeight.toFixed(1),a.area.toUSGSvalue(),t);break}}return"["+t+"]"},t.prototype.showFeatures=function(){var e=this;if(this.studyAreaService.selectedStudyArea){var t;this.overlays={},this.studyAreaService.selectedStudyArea.FeatureCollection.features.forEach(function(t){e.addGeoJSON(t.id,t)}),this.studyAreaService.selectedGage?(t={type:"Feature",geometry:{coordinates:[this.studyAreaService.selectedGage.Latitude_DD,this.studyAreaService.selectedGage.Longitude_DD],type:"Point"}},this.addGeoJSON("referenceGage",t)):(t={type:"Feature",geometry:{coordinates:[40.18505,-89.36904],type:"Point"}},this.addGeoJSON("referenceGage",t));var r=this.studyAreaService.selectedStudyArea.FeatureCollection.bbox;this.leafletData.getMap("reportMap").then(function(e){e.invalidateSize(),e.fitBounds([[r[1],r[0]],[r[3],r[2]]])})}},t.prototype.addGeoJSON=function(e,t){"globalwatershed"==e?this.layers.overlays[e]={name:"Basin Boundary",type:"geoJSONShape",data:this.studyAreaService.simplify(angular.fromJson(angular.toJson(t))),visible:!0,layerOptions:{style:{fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}}}:"globalwatershedpoint"==e?this.layers.overlays[e]={name:"Basin Clicked Point",type:"geoJSONShape",data:t,visible:!0}:"referenceGage"==e?this.geojson[e]={data:t,style:{displayName:"Reference Gage"},onEachFeature:function(e,t){var r=L.icon({iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAaJJREFUOI3dzz1IW1EYxvF/TMqpFQsJCF4QOuhUpTpEVCw6RSsdQhFB6hfiF0IDFqkoOCqKEhxEqm0H20YUgpQoqOBWOkgjpQgXowREEC5SuVBE6QtFHXQwYjSJmXzgDO85hx/PayPJsd0TcD6sqM6ZBFqAk7uD4dCyqu3dkLnhRmD6bqB/ q5DwZrl4hv6rb2MWEfEDR4mD + q9ZSl + mAC75 + HOGxvwuYDAx8MNaK / +Os3mUfj5nP + tSSlsUMbKAvfhA / dSKb3qEqvrLtwUS0CeVW + sWkbfxgcsr4zx12rFe + ZJu75PMPK / jcKfQNM1gbKBPz2Az2EzJi + ten / B1LdUse9AGxAhu//ZTXPkwanurrRd3RyeBqRrAfzM48b2IvwfPcWRG9QC76nnvlMDUY2ABkOjgbshHxWvrTRqAYPGo/s9uGWh6A3ivBR3epTZTpeWQmnabB6CkqqFOjbbvi0gG8CcSXF1NMZdCw7zqjAW7iKWOT+sVqtX5TkR6IkGXqx4IMub5EYeIQAlQrmlarmEY+uWVv1ycRDJgGAaRDZOUpINnJ5KDtx5X6hkAAAAASUVORK5CYII=",iconSize:[15,16],iconAnchor:[7.5,8],popupAnchor:[0,-11]});t.setIcon(r)},layerArray:[{layerName:"Reference Gage",legend:[{contentType:"image/png",imageData:"iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAaJJREFUOI3dzz1IW1EYxvF/TMqpFQsJCF4QOuhUpTpEVCw6RSsdQhFB6hfiF0IDFqkoOCqKEhxEqm0H20YUgpQoqOBWOkgjpQgXowREEC5SuVBE6QtFHXQwYjSJmXzgDO85hx/PayPJsd0TcD6sqM6ZBFqAk7uD4dCyqu3dkLnhRmD6bqB/ q5DwZrl4hv6rb2MWEfEDR4mD + q9ZSl + mAC75 + HOGxvwuYDAx8MNaK / +Os3mUfj5nP + tSSlsUMbKAvfhA / dSKb3qEqvrLtwUS0CeVW + sWkbfxgcsr4zx12rFe + ZJu75PMPK / jcKfQNM1gbKBPz2Az2EzJi + ten / B1LdUse9AGxAhu//ZTXPkwanurrRd3RyeBqRrAfzM48b2IvwfPcWRG9QC76nnvlMDUY2ABkOjgbshHxWvrTRqAYPGo/s9uGWh6A3ivBR3epTZTpeWQmnabB6CkqqFOjbbvi0gG8CcSXF1NMZdCw7zqjAW7iKWOT+sVqtX5TkR6IkGXqx4IMub5EYeIQAlQrmlarmEY+uWVv1ycRDJgGAaRDZOUpINnJ5KDtx5X6hkAAAAASUVORK5CYII=",label:"Reference Gage"}]}]}:this.layers.overlays[e]="regulatedWatershed"==e?{name:"Basin Boundary (Regulated Area)",type:"geoJSONShape",data:t,visible:!0,layerOptions:{style:{fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}}}:{name:e,type:"geoJSONShape",data:t,visible:!1,layerOptions:{style:{fillColor:"red",color:"red"}}}},t.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),r=e.find("tr:has(td)"),a=String.fromCharCode(11),o=String.fromCharCode(0),i='","',n='"\r\n"',s='"';return s+=g(t.map(c)),s+=n,s+=g(r.map(c))+'"';function g(e){return e.get().join(o).split(o).join(n).split(a).join(i)}function c(e,t){var r=$(t),o=r.find("td");return o.length||(o=r.find("th")),o.map(A).get().join(a)}function A(e,t){return $(t).text().replace('"','""')}},t.prototype.camelize=function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")},t.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modal.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},t.$inject=["$scope","$analytics","$modalInstance","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","leafletData","StreamStats.Services.RegionService","StreamStats.Services.ModalService"],t}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ReportController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use strict";var t,r,a=function(){return function(){this.Annual={Graph:{},Table:{}},this.Monthly={Graph:{withdrawals:null,returns:null},Table:{}}}}(),o=function(e){function o(t,r,a,o,i,n,s){var g=e.call(this,r,configuration.baseurls.WaterUseServices)||this;return g.$timeout=i,g.eventManager=n,g.permits_sw={name:"Temporary water-use registrations (surface water)",aveReturn:"",aveWithdrawal:"---"},g.permits_gw={name:"Temporary water-use registrations (ground water)",aveReturn:"",aveWithdrawal:"---"},g.AnnualTotalWithdrawals=0,g.AnnualTotalReturns=0,t.vm=g,g.modalInstance=o,g.StudyArea=a.selectedStudyArea,g.StudyAreaService=a,g.NSSService=s,g.init(),g}return __extends(o,e),Object.defineProperty(o.prototype,"StartYear",{get:function(){return this._startYear},set:function(e){this.spanYear||(this.EndYear=e),e<=this.EndYear&&e>=this.YearRange.floor&&(this._startYear=e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"EndYear",{get:function(){return this._endYear},set:function(e){e>=this.StartYear&&e<=this.YearRange.ceil&&(this._endYear=e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"YearRange",{get:function(){return this._yearRange},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"IndexWOReg",{get:function(){return this._indexWOReg},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"IndexWReg",{get:function(){return this._indexWReg},enumerable:!1,configurable:!0}),o.prototype.GetWaterUse=function(){var e=this;this.CanContinue=!1;var r=configuration.queryparams.Wateruse.format(this.StartYear,this.EndYear,this.includePermits,this.computeReturns,this.computeDomesticWU),a=this.StudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry,o=new WiM.Services.Helpers.RequestInfo(r,!1,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(a));this.Execute(o).then(function(r){e.showResults=!0,e.result=r.data,"Wateruse not available at specified site."!==e.result.Messages&&(r.data.hasOwnProperty("withdrawal")||r.data.hasOwnProperty("return"))||alert("Wateruse not available at specified site."),e.ReportData.Monthly.Graph=e.loadGraphData(t.Monthly),e.ReportData.Annual.Graph=e.loadGraphData(t.Annual),e.ReportData.Monthly.Table=e.GetTableData(t.Monthly),e.ReportData.Annual.Table=e.GetTableData(t.Annual)},function(e){}).finally(function(){e.setIndexes(),e.CanContinue=!0})},o.prototype.Close=function(){this.modalInstance.dismiss("cancel")},o.prototype.Reset=function(){this.init()},o.prototype.Print=function(){window.print()},o.prototype.setIndexes=function(){null!=this.Q10&&null!=this.AnnualTotalReturns&&null!=this.AnnualTotalWithdrawals&&null!=this.permits_gw.aveWithdrawal&&null!=this.permits_sw.aveWithdrawal?(this._indexWOReg=(+this.AnnualTotalWithdrawals-+this.AnnualTotalReturns)/+this.Q10,this._indexWReg=(+this.permits_gw.aveWithdrawal+ +this.permits_sw.aveWithdrawal+(+this.AnnualTotalWithdrawals-+this.AnnualTotalReturns))/+this.Q10):(this._indexWOReg="---",this._indexWReg="---")},o.prototype.loadGraphData=function(e){try{var r={returns:[],withdrawals:[]};switch(e){case t.Monthly:new Array(12);if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var a in this.result.withdrawal.monthly){var o=this.result.withdrawal.monthly[a].code;for(var i in o){for(var n=-1,s=0;s<r.withdrawals.length;s++){if(r.withdrawals[s].key==o[i].name){n=s;break}}if(n<0){var g=[];for(s=1;s<=12;s++)g.push({label:this.getMonth(s),stack:"withdrawal",value:0});n=r.withdrawals.push({key:o[i].name,values:g,color:this.generateColorShade(190,350)})-1}r.withdrawals[n].values[+a-1].value=o[i].value}}if(this.result.hasOwnProperty("return")){var c=[];for(var a in this.result.return.monthly)c.push({label:this.getMonth(+a),stack:"withdrawal",value:this.Sum(this.result.return.monthly[a].month,"value")});r.returns.push({key:"returns",color:this.generateColorShade(0,170),values:c})}return r;case t.Annual:if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("annual"))for(var A in this.result.withdrawal.annual){var l=this.result.withdrawal.annual[A];r.withdrawals.push({name:l.name,value:l.value,color:this.generateColorShade(190,350)})}if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("annual"))for(var A in this.result.return.annual){l=this.result.return.annual[A];r.returns.push({name:l.name,value:l.value,color:this.generateColorShade(0,170)})}return r}}catch(e){}},o.prototype.GetTableData=function(e){var r=[],a=[];try{switch(e){case t.Monthly:for(var o=1;o<=12;o++)a.push({month:this.getMonth(o),returns:{name:"return",SW:"---",GW:"---"},withdrawals:{SW:"---",GW:"---",code:[]}});if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var i in this.result.return.monthly)a[+i-1].returns.GW=this.result.return.monthly[i].month.hasOwnProperty("GW")?this.result.return.monthly[i].month.GW.value.toFixed(3):"---",a[+i-1].returns.SW=this.result.return.monthly[i].month.hasOwnProperty("SW")?this.result.return.monthly[i].month.SW.value.toFixed(3):"---",this.AnnualTotalReturns+=("---"==a[+i-1].returns.GW?0:+a[+i-1].returns.GW)+("---"==a[+i-1].returns.SW?0:+a[+i-1].returns.SW);if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var n in this.result.withdrawal.monthly)if(a[+n-1].withdrawals.GW=this.result.withdrawal.monthly[n].month.hasOwnProperty("GW")?this.result.withdrawal.monthly[n].month.GW.value.toFixed(3):"---",a[+n-1].withdrawals.SW=this.result.withdrawal.monthly[n].month.hasOwnProperty("SW")?this.result.withdrawal.monthly[n].month.SW.value.toFixed(3):"---",this.AnnualTotalWithdrawals+=("---"==a[+n-1].withdrawals.GW?0:+a[+n-1].withdrawals.GW)+("---"==a[+n-1].withdrawals.SW?0:+a[+n-1].withdrawals.SW),this.result.withdrawal.monthly[n].hasOwnProperty("code")){var s=this.result.withdrawal.monthly[n].code;for(var g in s){var c=-1;for(o=0;o<r.length;o++){if(r[o]==s[g].name){c=o;break}}c<0&&(c=r.push(s[g].name)-1,a.forEach(function(e){e.withdrawals.code.push({name:s[g].name,value:"---"})})),a[+n-1].withdrawals.code[c].value=s[g].value.toFixed(3)}}break;case t.Annual:r=["","Average Return","Average Withdrawal"];var A={name:"Surface Water",aveReturn:"---",aveWithdrawal:"---",unit:"MGD"},l={name:"Groundwater",aveReturn:"---",aveWithdrawal:"---",unit:"MGD"};if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("annual")){var u=this.result.withdrawal.annual;u.hasOwnProperty("SW")&&(A.aveWithdrawal=u.SW.value.toFixed(3)),u.hasOwnProperty("GW")&&(l.aveWithdrawal=u.GW.value.toFixed(3))}if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("annual")){var C=this.result.return.annual;C.hasOwnProperty("SW")&&(A.aveReturn=C.SW.value.toFixed(3)),C.hasOwnProperty("GW")&&(l.aveReturn=C.GW.value.toFixed(3))}if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("permitted")){var I=this.result.withdrawal.permitted;I.hasOwnProperty("Intake")&&(this.permits_sw.aveWithdrawal=I.Intake.value),I.hasOwnProperty("Well")&&(this.permits_gw.aveWithdrawal=I.Well.value)}a.push(A),a.push(l),a.push({name:"Total",aveReturn:isNaN(+A.aveReturn)&&isNaN(+l.aveReturn)?"---":((isNaN(+A.aveReturn)?0:+A.aveReturn)+(isNaN(+l.aveReturn)?0:+l.aveReturn)).toFixed(3),aveWithdrawal:isNaN(+A.aveWithdrawal)&&isNaN(+l.aveWithdrawal)?"---":((isNaN(+A.aveWithdrawal)?0:+A.aveWithdrawal)+(isNaN(+l.aveWithdrawal)?0:+l.aveWithdrawal)).toFixed(3)}),a.push({name:"",aveReturn:"",aveWithdrawal:""}),a.push(this.permits_sw),a.push(this.permits_gw),a.push({name:"Temporary water-use registrations (total)",aveReturn:"",aveWithdrawal:isNaN(+this.permits_sw.aveWithdrawal)&&isNaN(+this.permits_gw.aveWithdrawal)?"---":(isNaN(+this.permits_sw.aveWithdrawal)?0:+this.permits_sw.aveWithdrawal)+(isNaN(+this.permits_gw.aveWithdrawal)?0:+this.permits_gw.aveWithdrawal)}),a.push({name:"",aveReturn:"",aveWithdrawal:""})}return{values:a,Fields:r}}catch(e){return{values:[],Fields:[]}}},o.prototype.Reduce=function(e){return e.reduce(function(e,t){return isNaN(+e)&&isNaN(+t)?"---":((isNaN(+e)?0:+e)+(isNaN(+t)?0:+t)).toFixed(3)},0)},o.prototype.Sum=function(e,t){var r=0;for(var a in e)r+=e[a][t];return r},o.prototype.Add=function(e,t){return isNaN(+e)&&isNaN(+t)?"---":((isNaN(+e)?0:+e)+(isNaN(+t)?0:+t)).toFixed(3)},o.prototype.DownloadCSV=function(){var e,t=this,r="StreamStats Water Use Report\nState/Region ID,"+this.StudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.StudyArea.WorkspaceID+"\nLatitude,"+this.StudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.StudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime:,"+this.result.processDate.toLocaleString()+"\nStart Year:,"+this.StartYear+"\nEnd Year:,"+this.EndYear+"\r\n";r+=(e=t.StartYear+"-"+t.EndYear+" Average Annual Water Use reported in million gallons/day\n",(e+=t.tableToCSV($("#AnnualWaterUseTable")))+"\r\n"),r+=function(){var e=t.StartYear+"-"+t.EndYear+" Average Water Use by Month reported in million gallons/day\n";return(e+=t.tableToCSV($("#MonthlyWaterUseTable")))+"\r\n"}();var a=new Blob([r],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,"wateruseSummary.csv");else{var o=document.createElement("a"),i=URL.createObjectURL(a);void 0!==o.download?(o.setAttribute("href",i),o.setAttribute("download","wateruseSummary.csv"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)):window.open(i)}},o.prototype.DownloadCSVBySource=function(){var e=this,t=configuration.queryparams.WateruseSourceCSV.format(this.StartYear,this.EndYear,this.includePermits,this.computeReturns,this.computeDomesticWU),r=this.StudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry,a=new WiM.Services.Helpers.RequestInfo(t,!1,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(r),{Accept:"text/csv",Authorization:"Basic dGVzdE1hbmFnZXI6RG9nMQ=="});this.Execute(a).then(function(e){var t="wateruseSummaryBySource.csv",r=new Blob([e.data],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,t);else{var o=document.createElement("a"),i=URL.createObjectURL(r);void 0!==o.download?(o.setAttribute("href",i),o.setAttribute("download",t),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)):window.open(i)}},function(e){}).finally(function(){e.CanContinue=!0})},o.prototype.init=function(){var e=this;"OH"==this.StudyArea.RegionID&&this.StudyAreaService.computeRegressionEquation("Q10");var o=configuration.queryparams.WateruseConfig.format(this.StudyArea.RegionID),i=new WiM.Services.Helpers.RequestInfo(o);this.Execute(i).then(function(t){var r=t.data;e.spanYear=r.minYear!=r.maxYear,e._startYear=r.minYear,e._endYear=r.maxYear,e.includePermits=r.hasPermits,e.computeReturns=r.canComputeReturns,e.computeDomesticWU="oh"==e.StudyArea.RegionID.toLowerCase(),e._yearRange={floor:r.minYear,draggableRange:!0,noSwitching:!0,showTicks:!1,ceil:r.maxYear}},function(t){e._startYear=2005,e._endYear=2012,e._yearRange={floor:2005,draggableRange:!0,noSwitching:!0,showTicks:!1,ceil:2012}}).finally(function(){e.StudyAreaService.onQ10Loaded.subscribe(new WiM.Event.EventHandler(function(t,r){e.Q10=.646316889697*+e.StudyAreaService.selectedStudyArea.wateruseQ10,e.CanContinue=!0,e.StudyAreaService.onQ10Loaded.unsubscribe(new WiM.Event.EventHandler(function(e,t){}))})),e.showResults=!1,e.SelectedTab=r.Graph,e.SelectedWaterUseType=t.Annual,e.ReportData=new a,e.MonthlyReportOptions={chart:{type:"multiBarHorizontalChart",height:450,visible:!0,stacked:!0,showControls:!1,margin:{top:60,right:30,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},dispatch:{stateChange:function(){e.$timeout(function(){e.loadGraphLabels(0)},500)},renderEnd:function(){e.$timeout(function(){e.loadGraphLabels(0)},500)},resize:function(){console.log("resize"),e.$timeout(function(){e.loadGraphLabels(0)},500)}},showValues:!0,valueFormat:function(e){return d3.format(",.4f")(e)},tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Values in million gallons/day",tickFormat:function(e){return d3.format(",.3f")(e)}},refreshDataOnly:!0,legend:{margin:{top:5,right:40,left:40,bottom:50}}}},e.MonthlyReturnReportOptions={chart:{type:"multiBarHorizontalChart",height:450,visible:!0,stacked:!0,showControls:!1,margin:{top:20,right:30,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format(",.3f")(e)},tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Values in million gallons/day",tickFormat:function(e){return d3.format(",.3f")(e)}}}},e.AnnualReportOptions={chart:{type:"pieChart",height:400,x:function(e){return e.name},y:function(e){return e.value},showLabels:!0,tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},duration:500,labelThreshold:.01,labelSunbeamLayout:!1,legend:{margin:{top:5,right:35,bottom:5,left:0}}}}}),$(window).resize(function(){e.$timeout(function(){e.loadGraphLabels(0)},500)})},o.prototype.getMonth=function(e){switch(e){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec"}},o.prototype.getWUText=function(e){switch(e.toUpperCase()){case"AQ":return"Aquaculture";case"CO":return"Commercial";case"DO":return"Domestic";case"PH":return"Hydro Electric";case"IN":return"Industrial";case"IR":return"Irrigation";case"LV":return"Livestock";case"MI":return"Mining";case"RM":return"Remediation";case"TE":return"Thermoelectric";case"ST":return"Waste Water Treatment";case"WS":return"Public Supply";case"MF":return"Hydrofracturing";case"CW":return"Wetland augmentation";case"PC":return"Thermoelectric (closed cycle)";case"PO":return"Thermoelectric (once through)"}return e.toUpperCase()},o.prototype.loadGraphLabels=function(e){var t=d3.selectAll(".nv-multibarHorizontal .nv-group"),r=t.map(function(e){return e.length-2});t.filter(function(e,t){return t==r[0]});t.each(function(e,t){var a=d3.select(this);a.selectAll("text").remove(),a.selectAll(".nv-bar").each(function(e){var o=d3.select(this),i=o.node().getBBox().width;o.node().getBBox().height;a.append("text").attr("transform",o.attr("transform")).text(function(){if(t>=r[0])return e.y<.001?0:d3.format(",.3f")((Number(e.y)+Number(e.y0)).toFixed(3))}).attr("dy","1.5em").attr("x",function(){var e=this.getBBox().width;return i-e/2}).attr("class","bar-values")})})},o.prototype.generateColorShade=function(e,t){try{return"hsla("+this.rand(e,e)+","+this.rand(30,100)+"%,"+this.rand(30,70)+"%,1)"}catch(e){return null}},o.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),r=e.find("tr:has(td)"),a=String.fromCharCode(11),o=String.fromCharCode(0),i='","',n='"\r\n"',s='"';return s+=g(t.map(c)),s+=n,s+=g(r.map(c))+'"';function g(e){return e.get().join(o).split(o).join(n).split(a).join(i)}function c(e,t){var r=$(t),o=r.find("td");return o.length||(o=r.find("th")),o.map(A).get().join(a)}function A(e,t){return $(t).text().replace('"','""')}},o.prototype.HSLtoRGB=function(e,t,r){var a,o,i;if(0==t)a=o=i=r;else{var n=function(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e},s=r<.5?r*(1+t):r+t-r*t,g=2*r-s;a=n(g,s,e+1/3),o=n(g,s,e),i=n(g,s,e-1/3)}return{r:Math.round(255*a),g:Math.round(255*o),b:Math.round(255*i)}},o.prototype.RGBtoHEX=function(e,t,r){return this.ToHex(e)+this.ToHex(t)+this.ToHex(r)},o.prototype.ToHex=function(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t},o.prototype.rand=function(e,t){return parseInt(Math.random()*(t-e+1),10)+e},o.$inject=["$scope","$http","StreamStats.Services.StudyAreaService","$modalInstance","$timeout","WiM.Event.EventManager","StreamStats.Services.nssService"],o}(WiM.Services.HTTPServiceBase);!function(e){e[e.Annual=1]="Annual",e[e.Monthly=2]="Monthly"}(t||(t={})),function(e){e[e.Graph=1]="Graph",e[e.Table=2]="Table"}(r||(r={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.WateruseController",o)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use strict";var r,a=function(){return function(){this.TR55={Graph:{},Table:{},PeakQ:{},Infiltration:{},ExcessPrecip:{}},this.RationalMethod={Graph:{},Table:{},PeakQ:{},Infiltration:{},ExcessPrecip:{}}}}(),o=function(t){function o(e,r,a,o,i,n,s,g,c){var A=t.call(this,a,configuration.baseurls.StormRunoffServices)||this;return A.$timeout=g,A.EventManager=c,A.regionParameters=[],A.PrecipOptions=[],A.SelectedParameterList=[],A.GraphLabels=[],A.GraphXValues=[],A.padY=0,A.padY2=0,A.domainY=[],A.domainY2=[],e.vm=A,A.angulartics=r,A.modalInstance=s,A.StudyArea=o.selectedStudyArea,A.nssService=i,A.studyAreaService=o,A.regionParameters=n.parameterList,A.BrowserIE=A.detectIE(),A.AppVersion=configuration.version,A.parameterloadedEventHandler=new WiM.Event.EventHandler(function(e,t){t.parameterLoaded&&A.loadParameters()}),A.init(),A.print=function(){window.print()},A}return __extends(o,t),Object.defineProperty(o.prototype,"SelectedPrecip",{get:function(){return this._selectedPrecip},set:function(e){this._selectedPrecip=e,this.PIntensity=null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"SelectedTab",{get:function(){return this._selectedTab},set:function(e){this._selectedTab!=e&&(this._selectedTab=e,this.selectRunoffType())},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"SelectedParametersAreValid",{get:function(){for(var e=0;e<this.SelectedParameterList.length;e++){var t=this.SelectedParameterList[e];if(isNaN(t.value))return!1}return!0},enumerable:!1,configurable:!0}),o.prototype.GetStormRunoffResults=function(){var e=this;try{this.CanContinue=!1;if(1==this.SelectedTab){r.TR55;var t=configuration.queryparams.StormRunoffTR55.format(this.SelectedParameterList[0].value,this.SelectedPrecip.value,this.SelectedParameterList[1].value,this.SelectedPrecip.code)}else if(2==this.SelectedTab)r.RationalMethod,t=configuration.queryparams.StormRunoffRationalMethod.format(this.DrnAreaAcres,this.PIntensity,this.SelectedParameterList[1].value,this.SelectedPrecip.code);var a=new WiM.Services.Helpers.RequestInfo(t);this.Execute(a).then(function(t){e.showResults=!0,e.result=t.data,1==e.SelectedTab?(e.ReportData.TR55.Graph=e.loadGraphData(),e.ReportData.TR55.Table=e.GetTableData(),e.setGraphOptions()):2==e.SelectedTab&&e.setPeakQ(e.result.q)},function(e){}).finally(function(){e.CanContinue=!0,e.hideAlerts=!0})}catch(e){console.log("oops GetStormRunoffResults failed to load ",e)}},o.prototype.validateForm=function(e){return e.$valid?(this.CheckDASize(),!0):(this.CheckDASize(),this.showResults=!1,this.hideAlerts=!1,!1)},o.prototype.ClearResults=function(){for(var e in this.studyAreaService.studyAreaParameterList)this.studyAreaService.studyAreaParameterList[e].value=null;this.SelectedPrecip=this.PrecipOptions[0],this.SelectedPrecip.value=null,this.DrnAreaAcres=null,this.PIntensity=null,this.showResults=!1},o.prototype.CalculateParameters=function(){var t=this;try{this.CanContinue=!1,this.EventManager.SubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,this.parameterloadedEventHandler);var r=configuration.baseurls.ScienceBase+configuration.queryparams.SSURGOexCOMS+configuration.queryparams.SSURGOexCO.format(this.studyAreaService.selectedStudyArea.FeatureCollection.bbox),a=new WiM.Services.Helpers.RequestInfo(r,!0);this.Execute(a).then(function(e){t.showResults=!0,t.excludearea=e.data,t.excludearea.count>0&&alert("The selected basin may have inadequate SSURGO data to properly compute the runoff curve number.")},function(e){}).finally(function(){t.CanContinue=!0,t.hideAlerts=!0});for(var o=0;o<this.SelectedParameterList.length;o++){var i=this.SelectedParameterList[o];-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,i)&&this.studyAreaService.studyAreaParameterList.push(i)}null!=this.SelectedPrecip&&-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,this.SelectedPrecip)&&this.studyAreaService.studyAreaParameterList.push(this.SelectedPrecip),this.studyAreaService.loadParameters()}catch(e){console.log("oops CalculateParams failed to load ",e)}},o.prototype.CheckDASize=function(){switch(this._selectedTab){case r.TR55:return void(this.SelectedParameterList[0].value>25?this.DASizeAlert="Value is greater than recommended maximum threshold of 25 square miles":this.DASizeAlert=null);default:return void(this.DrnAreaAcres>200?this.DASizeAlert="Value is greater than recommended maximum threshold of 200 acres":this.DASizeAlert=null)}},o.prototype.Close=function(){this.modalInstance.dismiss("cancel")},o.prototype.Reset=function(){this.init()},o.prototype.downloadCSV=function(){var e=this;this.angulartics.eventTrack("Download",{category:"Report",label:"CSV"});var t="StreamStats Output Report\n\nState/Region ID,"+this.studyAreaService.selectedStudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.studyAreaService.selectedStudyArea.WorkspaceID+"\nLatitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString()+"\n\n";1==this.SelectedTab?t+=function(t){var r="Peak Runoff from "+e.SelectedPrecip.name+" (TR55)\n";r+=e.tableToCSV($("#TR55ParameterTable")),r+="\n"+e.tableToCSV($("#TR55SummaryTable")),r+="\n\n"+e.tableToCSV($("#TR55TabularHydrograph"));var a="";if(e.SelectedParameterList){var o;for(var i in o=Object.keys(e.ReportData.TR55.Table.values[0]))parseInt(i)<14&&"time"!=o[i]&&("span"==o[i]?a+="#,Time,Time (HH:MM)\n":a+="#,"+e.getHeading(o[i])+","+e.getTitle(o[i])+"\n")}return a+"\n"+r+"\r\n"}(this.studyAreaService.studyAreaParameterList):2==this.SelectedTab&&(t+=function(t){var r="Peak Runoff from "+e.SelectedPrecip.name+" (Rational Method)\n";r+=e.tableToCSV($("#RMParameterTable")),r+="\n"+e.tableToCSV($("#RMSummaryTable"));var a="";if(e.SelectedParameterList){var o;for(var i in o=Object.keys(e.ReportData.TR55.Table.values[0]))parseInt(i)<14&&"time"!=o[i]&&("span"==o[i]?a+="#,Time,Time (HH:MM)\n":a+="#,"+e.getHeading(o[i])+","+e.getTitle(o[i])+"\n")}return a+"\n"+r+"\r\n"}(this.studyAreaService.studyAreaParameterList));var r=new Blob([t],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,"data.csv");else{var a=document.createElement("a"),o=URL.createObjectURL(r);void 0!==a.download?(a.setAttribute("href",o),a.setAttribute("download","data.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(o)}},o.prototype.generateColorShade=function(e,t){try{return"hsla("+this.rand(e,e)+","+this.rand(30,100)+"%,"+this.rand(30,70)+"%,1)"}catch(e){return null}},o.prototype.update=function(e){console.log(e)},o.prototype.loadGraphData=function(){try{var e,t=[],r=[],a=[];this.GraphXValues.length=0;for(var o in this.result){var i,n=this.result[o].duration,s=parseFloat(o);this.duration=n,i=this.computeTime(s,n),r.push({x:i,y:this.result[o].q}),a.push({x:i,y:this.result[o].p})}for(var g in r.sort(function(e,t){return e.x-t.x}),a.sort(function(e,t){return e.x-t.x}),e=r[0].x,r)r[g].label=this.getTimeSpan(e,r[g].x),a[g].label=this.getTimeSpan(e,a[g].x);for(var c in r)r[c].hours=this.computeHours(e,r[c].x),a[c].hours=this.computeHours(e,r[c].x);return this.loadGraphLabels(r),this.loadGraphXValues(r),this.loadPadY(r),this.loadDomainY(r),this.loadPadY2(a),this.loadDomainY2(a),t.push({values:r,key:"Discharge (ft³/s)",color:" #009900",type:"line",yAxis:1}),t.push({values:a,key:"Cum. precipitation (in)",color:"#0033ff",type:"line",yAxis:2}),t}catch(e){}},o.prototype.GetTableData=function(){this.ReportData.TR55.PeakQ=0,this.ReportData.TR55.Infiltration=0,this.ReportData.TR55.ExcessPrecip=0;var e=[],t=[];try{for(var r in this.result){var a,o,i=this.result[r].duration,n=parseFloat(r);if(a=this.computeTime(n,i),this.result[r].time=a,t.push(this.result[r]),0==e.length)for(var s in this.result[r])e.push(s);this.setPeakQ(this.result[r].q),this.setInfiltration(this.result[r].pl),this.setExcessPrecip(this.result[r].dPe)}for(var g in t.sort(function(e,t){return e.time-t.time}),o=t[0].time,t)t[g].span=this.getTimeSpan(o,t[g].time);return{values:t,Fields:e}}catch(e){}},o.prototype.setPeakQ=function(e){try{if(1==this.SelectedTab){var t=e;this.ReportData.TR55.PeakQ<t&&(this.ReportData.TR55.PeakQ=t)}else this.ReportData.RationalMethod.PeakQ=e}catch(e){}},o.prototype.setInfiltration=function(e){try{this.ReportData.TR55.Infiltration=this.ReportData.TR55.Infiltration+e}catch(e){}},o.prototype.setExcessPrecip=function(e){try{this.ReportData.TR55.ExcessPrecip=this.ReportData.TR55.ExcessPrecip+e}catch(e){}},o.prototype.getPrecipTitle=function(){return 2==this.SelectedTab?"Precipitation intensity is computed by dividing the "+this.SelectedPrecip.name+" by "+this.SelectedPrecip.name.substr(0,2):void 0},o.prototype.getTitle=function(e){try{switch(e){case"q":return"Discharge (cubic feet per second)";case"drnarea":return"Drainage area (square miles)";case"p":return"Cumulative precipitation (inches)";case"rcn":return"Runoff curve number (unitless)";case"duration":return"Duration of storm (hours)";case"ia":return"Initial abstraction (inches)";case"s":return"Total maximum retention (inches)";case"dP":return"Incremental precipitation (inches)";case"pIa":return"Cumulative precipitation minus initial abstraction (inches)";case"pl":return"Precipitation loss (inches)";case"pe":return"Cumulative precipitation excess (inches)";case"dPe":return"Incremental precipitation excess (inches)"}}catch(e){}},o.prototype.getHeading=function(e){try{switch(e){case"q":return"Q";case"drnarea":return"DRNAREA";case"p":return"P";case"rcn":return"RCN";case"duration":return"Duration";case"ia":return"Ia";case"s":return"S";case"dP":return"dP";case"pIa":return"P-Ia";case"pl":return"Pl";case"pe":return"Pe";case"dPe":return"dPe"}}catch(e){}},o.prototype.setGraphOptions=function(){this.ReportOptions={chart:{type:"multiChart",height:275,width:650,margin:{top:10,right:80,bottom:80,left:90},x:function(e){return e.hours},y:function(e){return e.y},legend:{align:!1,padding:50,width:500},dispatch:{stateChange:function(e){console.log("stateChange")},changeState:function(e){console.log("changeState")},tooltipShow:function(e){console.log("tooltipShow")},tooltipHide:function(e){console.log("tooltipHide")}},useInteractiveGuideline:!0,interactiveLayer:{tooltip:{contentGenerator:function(e){var t=60*e.value%60,r=Math.trunc(e.value),a=(r<10?"0"+r:r)+":"+(t<10?"0"+t:t),o="";for(var i in e.series){var n,s,g=parseFloat(e.series[i].value);g>1e6&&g<1e7&&(s=1e4),g>1e5&&g<1e6&&(s=1e3),g>1e4&&g<1e5&&(s=100),g>1e3&&g<1e4&&(s=10),g>100&&g<1e3&&(s=1),n=parseInt(((g+.5*s)/s).toString())*s,g<100&&(n=Number(g.toPrecision(3))),o+="<tr><td class='legend-color-guide' style='width: 1em;'><div style='background-color: "+e.series[i].color+";'></div></td><td class='key'>"+e.series[i].key+":</td><td><strong>"+n+"</strong></td></tr>"}return"<table>"+("<thead><tr><td colspan='3'><b>"+a+"</b> (HH:mm)</td></tr></thead>")+"<tbody>"+o+"</tbody></table>"}}},xAxis:{showMaxMin:!1,tickValues:this.GraphXValues,axisLabel:"Time (HH:mm)",tickFormat:function(e){var t=Math.trunc(e),r=60*e%60;return(t<10?"0"+t:t)+":"+(r<10?"0"+r:r)},rotateLabels:"45"},yAxis1:{axisLabel:"Discharge (Q), in ft³/s",axisLabelDistance:this.padY,tickFormat:function(e){return d3.format(",.0f")(e)},showMaxMin:!1},yAxis2:{axisLabel:"Cum. precipitation (P), in inches",axisLabelDistance:this.padY2,tickFormat:function(e){return d3.format(",.0f")(e)},showMaxMin:!1},yDomain1:this.domainY,yDomain2:this.domainY2},title:{enable:!0,text:"Runoff hydrograph from "+this.SelectedPrecip.name,css:{"font-size":"10pt","font-weight":"bold"}}}},o.prototype.BrowserAlert=function(){this.BrowserIE&&alert("The Storm Runoff Modeling tool is best viewed with the following browsers\n\n\tChrome\n\tFirefox\n\tEdge")},o.prototype.detectIE=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10),!0;if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10),!0}return-1!=navigator.userAgent.indexOf("Chrome")&&(this.BrowserChrome=!0),!1},o.prototype.init=function(){this.SelectedTab=r.TR55,this.showResults=!1,this.hideAlerts=!1,this.CanContinue=!0,this.showPrint=!1,this.ReportData=new a},o.prototype.loadParameters=function(){this.EventManager.UnSubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,this.parameterloadedEventHandler),this.DrnAreaAcres=(640*this.SelectedParameterList[0].value).toUSGSvalue();var t=parseInt(this.SelectedPrecip.name.substr(0,2));this.PIntensity=(this.SelectedPrecip.value/t).toUSGSvalue(),this.CanContinue=!0},o.prototype.selectRunoffType=function(){switch(this._selectedTab){case r.TR55:this.SelectedParameterList=this.regionParameters.filter(function(e){return-1!=["DRNAREA","RCN"].indexOf(e.code)}),this.SelectedParameterList.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.showResults=!1;break;default:this.SelectedParameterList=this.regionParameters.filter(function(e){return-1!=["DRNAREA","RUNCO_CO"].indexOf(e.code)}),this.SelectedParameterList.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.showResults=!1}this.PrecipOptions=this.regionParameters.filter(function(e){return-1!=["I6H2Y","I6H100Y","I24H2Y","I24H100Y"].indexOf(e.code)}),this.PrecipOptions.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.SelectedPrecip||(this.SelectedPrecip=this.PrecipOptions[0])},o.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),r=e.find("tr:has(td)"),a=String.fromCharCode(11),o=String.fromCharCode(0),i='","',n='"\r\n"',s='"';return s+=g(t.map(c)),s+=n,s+=g(r.map(c))+'"';function g(e){return e.get().join(o).split(o).join(n).split(a).join(i)}function c(e,t){var r=$(t),o=r.find("td");return o.length||(o=r.find("th")),o.map(A).get().join(a)}function A(e,t){return $(t).text().replace('"','""')}},o.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},o.prototype.rand=function(e,t){return parseInt(Math.random()*(t-e+1),10)+e},o.prototype.computeTime=function(e,t){var r=new Date("January 1, 2018 00:00:00"),a=60*e;return r.setMinutes(a),r},o.prototype.computeHours=function(e,t){return(t-e)/36e5},o.prototype.getTimeSpan=function(e,t){var r=t-e,a=r/6e4%60,o=Math.trunc(r/36e5);return(o<10?"0"+o:o)+":"+(a<10?"0"+a:a)},o.prototype.loadGraphLabels=function(e){for(var t in e)this.GraphLabels[t]=e[t].span},o.prototype.loadGraphXValues=function(e){var t=0;if(24==this.duration)for(var r in e)++t%2!=0&&this.GraphXValues.push(e[r].hours);else for(var r in e)this.GraphXValues[r]=e[r].hours},o.prototype.loadPadY=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));t<1e3?this.padY=-10:t>=1e3&&t<1e4?this.padY2=0:t>=1e4&&t<1e6?this.padY=20:t>=1e6&&t<1e8&&(this.padY=30)},o.prototype.loadDomainY=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));this.domainY=[0,10*Math.round((t+.18*t)/10)]},o.prototype.loadDomainY2=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));this.domainY2=[0,t+.18*t]},o.prototype.loadPadY2=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));t<1e3?this.padY2=-30:t>=1e3&&(this.padY2=-10)},o.prototype.sortByKey=function(e,t){return e.sort(function(e,r){var a=e[t],o=r[t];return a<o?-1:a>o?1:0})},o.$inject=["$scope","$analytics","$http","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.RegionService","$modalInstance","$timeout","WiM.Event.EventManager"],o}(WiM.Services.HTTPServiceBase);!function(e){e[e.TR55=1]="TR55",e[e.RationalMethod=2]="RationalMethod"}(r||(r={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.StormRunoffController",o)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use string";var t=function(){return function(){}}(),r=function(e){function r(r,a,o,i,n,s){var g=e.call(this,a,"")||this;return r.vm=g,g.StudyArea=i.selectedStudyArea,g.Upload=s,g.http=a,g.sce=o,g.modalInstance=n,g.StudyArea=i.selectedStudyArea,g.freshdeskTicketData=new t,g.selectedHelpTabName="help",g.showSuccessAlert=!1,g.submittingSupportTicket=!1,g.init(),g}return __extends(r,e),r.prototype.Close=function(){this.showSuccessAlert=!1,this.modalInstance.dismiss("cancel")},r.prototype.submitFreshDeskTicket=function(e){var r=this;if(e){var a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.CreateTicket,o=new FormData;o.append("helpdesk_ticket[email]",this.freshdeskTicketData.email),o.append("helpdesk_ticket[subject]",this.freshdeskTicketData.subject),o.append("helpdesk_ticket[description]",this.freshdeskTicketData.description),o.append("helpdesk_ticket[custom_field][regionid_"+configuration.SupportTicketService.AccountID+"]",this.RegionID),o.append("helpdesk_ticket[custom_field][workspaceid_"+configuration.SupportTicketService.AccountID+"]",this.WorkspaceID),o.append("helpdesk_ticket[custom_field][server_"+configuration.SupportTicketService.AccountID+"]",this.Server),o.append("helpdesk_ticket[custom_field][browser_"+configuration.SupportTicketService.AccountID+"]",this.Browser),o.append("helpdesk_ticket[custom_field][softwareversion_"+configuration.SupportTicketService.AccountID+"]",this.AppVersion),this.freshdeskTicketData.attachment&&o.append("helpdesk_ticket[attachments][][resource]",this.freshdeskTicketData.attachment,this.freshdeskTicketData.attachment.name);var i={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X"),"Content-Type":void 0},n=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",o,i,angular.identity);this.submittingSupportTicket=!0,this.Execute(n).then(function(e){r.freshdeskTicketData=new t,r.showSuccessAlert=!0},function(e){}).finally(function(){r.submittingSupportTicket=!1})}},r.prototype.getFreshDeskArticles=function(e){var t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+e,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);return this.Execute(a).then(function(e){var t=[];if(e.data.folder.articles.length)return e.data.folder.articles.forEach(function(e){2==e.status&&t.push(e)}),t},function(e){return"There was a problem getting this article"}).finally(function(){})},r.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},r.prototype.selectHelpTab=function(e){this.selectedHelpTabName!=e&&(this.selectedHelpTabName=e)},r.prototype.init=function(){var e=this;this.getBrowser(),this.AppVersion=configuration.version,this.getFreshDeskArticles(configuration.SupportTicketService.FAQarticlesFolder).then(function(t){e.faqArticles=t}),this.getFreshDeskArticles(configuration.SupportTicketService.UserManualArticlesFolder).then(function(t){e.helpArticles=t}),this.StudyArea&&this.StudyArea.WorkspaceID?this.WorkspaceID=this.StudyArea.WorkspaceID:this.WorkspaceID="",this.StudyArea&&this.StudyArea.RegionID?this.RegionID=this.StudyArea.RegionID:this.RegionID="",this.StudyArea&&this.StudyArea.Server?this.Server=this.StudyArea.Server:this.Server=""},r.prototype.getBrowser=function(){(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)&&(this.Browser="Opera"),"undefined"!=typeof InstallTrigger&&(this.Browser="Firefox"),Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0&&(this.Browser="Safari"),window.chrome&&window.chrome.webstore&&(this.Browser="Chrome"),!document.documentMode&&window.StyleMedia&&(this.Browser="Edge"),document.documentMode&&(this.Browser="IE")},r.$inject=["$scope","$http","$sce","StreamStats.Services.StudyAreaService","$modalInstance","Upload"],r}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.HelpController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use string";var t=function(e){function t(t,r,a,o,i,n,s){var g=e.call(this,r,configuration.baseurls.StreamStats)||this;return t.vm=g,g.sce=a,g.modalInstance=s,g.modalService=o,g.StudyArea=n.selectedStudyArea,g.regionService=i,g.selectedAboutTabName="about",g.regionArticle="<h3>No State or Region Selected</h3>",g.init(),g}return __extends(t,e),t.prototype.Close=function(){this.modalInstance.dismiss("cancel")},t.prototype.selectAboutTab=function(e){this.selectedAboutTabName!=e&&(this.selectedAboutTabName=e)},t.prototype.getActiveNews=function(){var e=this,t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.ActiveNewsFolder,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){var r=[];t.data.folder.articles.length&&("test.streamstats.usgs.gov"==window.location.host?e.activeNewsArticles=t.data.folder.articles:(t.data.folder.articles.forEach(function(e){2==e.status&&r.push(e)}),e.activeNewsArticles=r))},function(e){}).finally(function(){})},t.prototype.getPastNews=function(){var e=this,t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.PastNewsFolder,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){var r=[];t.data.folder.articles.length&&(window.location.host.indexOf("test.streamstats.usgs.gov")>-1?e.pastNewsArticles=t.data.folder.articles:(t.data.folder.articles.forEach(function(e){2==e.status&&r.push(e)}),e.pastNewsArticles=r))},function(e){}).finally(function(){})},t.prototype.getAboutArticle=function(){var e=this,t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.AboutArticle,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){e.aboutArticle=t.data.article.description},function(e){}).finally(function(){})},t.prototype.getRegionHelpArticle=function(){var e,t=this;if(this.modalService.modalOptions&&(this.modalService.modalOptions.tabName&&this.selectAboutTab(this.modalService.modalOptions.tabName),e=this.modalService.modalOptions.regionID),this.regionService.selectedRegion&&(e=this.regionService.selectedRegion.Name),e){var r={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.RegionInfoFolder,o=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",r);configuration.regions.forEach(function(r,a){r.Name===e&&(r.regionEnabled?(t.regionArticle='<i class="fa fa-spinner fa-3x fa-spin loadingSpinner"></i>',t.Execute(o).then(function(r){r.data.folder.articles.forEach(function(r){r.title!=e||(window.location.host.indexOf("test.streamstats.usgs.gov")>-1?t.regionArticle=r.description:2==r.status&&(t.regionArticle=r.description))})},function(e){}).finally(function(){})):t.regionArticle='<div class="wim-alert">StreamStats has not been developed for <strong>'+r.Name+'</strong>.  Please contact the <a href="mailto:support@streamstats.freshdesk.com">streamstats team</a> if you would like StreamStats enabled for this State/Region.</div>')})}},t.prototype.getDisclaimersArticle=function(){var e=this;console.log("Trying to open disclaimers article");var t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.DisclaimersArticle,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){console.log("Successfully retrieved disclaimers article"),e.disclaimersArticle=t.data.article.description},function(e){}).finally(function(){e.getCreditsArticle()})},t.prototype.getCreditsArticle=function(){var e=this;console.log("Trying to open credits article");var t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.CreditsArticle,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){console.log("Successfully retrieved credits article"),e.disclaimersArticle+=t.data.article.description},function(e){}).finally(function(){})},t.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},t.prototype.init=function(){this.AppVersion=configuration.version,this.getAboutArticle(),this.getRegionHelpArticle(),this.getActiveNews(),this.getPastNews(),this.getDisclaimersArticle()},t.prototype.readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var o=r[a];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null},t.prototype.createCookie=function(e,t,r){if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3);var o="; expires="+a.toUTCString()}else o="";document.cookie=e+"="+t+o+"; path=/"},t.$inject=["$scope","$http","$sce","StreamStats.Services.ModalService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","$modalInstance"],t}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.AboutController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use string";var t=function(){function e(e,t,r,a){e.vm=this,this.sce=t,this.modalInstance=r,this.pagecontent=a.modalOptions.placeholder}return e.prototype.Close=function(){this.modalInstance.dismiss("cancel")},e.prototype.convertUnsafe=function(e){return console.log("converting..."),this.sce.trustAsHtml(e)},e.prototype.replaceAll=function(e,t,r){return e.replace(new RegExp(t,"g"),r)},e.prototype.getOldGWWpage=function(){this.pagecontent=""},e.$inject=["$scope","$sce","$modalInstance","StreamStats.Services.ModalService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavigationReportModalController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use string";var t=function(){function e(e,t,r,a,o,i,n){e.vm=this,this.sce=r,this.angulartics=t,this.modalInstance=a,this.explorationService=i,this.studyAreaService=n,this.DEMresolutionList=["FINEST","10m","30m","90m","1000m"],this.explorationService.selectedMethod.navigationInfo.configuration&&(this.selectExclusiveOption("downstream","Direction"),this.selectOption("flowline","Query Source"),this.checkWorkspaceID()),this.print=function(){window.print()}}return e.prototype.close=function(){this.explorationService.showElevationChart=!1,this.explorationService.setMethod(0,{}),this.modalInstance.dismiss("cancel")},e.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},e.prototype.selectElevationPoints=function(){this.modalInstance.dismiss("cancel"),this.explorationService.selectElevationPoints=!0},e.prototype.addExplorationPointFromMapt=function(e){this.modalInstance.dismiss("cancel"),this.explorationService.explorationPointType=e},e.prototype.addExplorationPointFromPourpoint=function(e,t,r,a){this.explorationService.selectedMethod.addLocation(e,new WiM.Models.Point(t,r,a))},e.prototype.downloadCSV=function(){this.angulartics.eventTrack("Download",{category:"ElevationProfile",label:"CSV"});var e="long,lat,elevation(feet),distance(mi)\r\n";this.explorationService.coordinateList.forEach(function(t){e+=t.join(",")+"\r\n"});var t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"elevation-profile.csv");else{var r=document.createElement("a"),a=URL.createObjectURL(t);void 0!==r.download?(r.setAttribute("href",a),r.setAttribute("download","elevation-profile.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(a)}},e.prototype.addLimit=function(e){var t=this;this.selectedLimit=e,this.deleteConfig("Limit"),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(e,r){if("Limit"==e.name){var a=JSON.parse(JSON.stringify(e));a.value=t.selectedLimit,t.explorationService.selectedMethod.navigationConfiguration.push(a)}})},e.prototype.selectExclusiveOption=function(e,t){var r=this;this.selectedDirection=e,this.deleteConfig(t),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(a,o){if(a.name==t){var i=JSON.parse(JSON.stringify(a));i.value=e,r.explorationService.selectedMethod.navigationConfiguration.push(i)}})},e.prototype.selectOption=function(e,t){var r=this;this.selectedQuerySourceList||(this.selectedQuerySourceList=[]);var a=this.selectedQuerySourceList.indexOf(e);a>-1?this.selectedQuerySourceList.splice(a,1):this.selectedQuerySourceList.push(e),this.deleteConfig(t),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(e,a){if(e.name==t){var o=JSON.parse(JSON.stringify(e));o.value=r.selectedQuerySourceList,r.explorationService.selectedMethod.navigationConfiguration.push(o)}})},e.prototype.checkWorkspaceID=function(){var e=this;this.studyAreaService.selectedStudyArea&&""!==this.studyAreaService.selectedStudyArea.WorkspaceID&&this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(t,r){"Limit"==t.name&&t.value.forEach(function(t,r){"Polygon geometry"==t.name&&(t.name="Polygon geometry from delineated watershed",t.value=e.studyAreaService.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry)})})},e.prototype.ExecuteNav=function(){if(this.explorationService.selectedMethod.navigationPointCount==this.explorationService.selectedMethod.minLocations){this.explorationService.explorationMethodBusy=!0,this.explorationService.ExecuteSelectedModel()}},e.prototype.deleteConfig=function(e){var t=this;this.explorationService.selectedMethod.navigationConfiguration.forEach(function(r,a){r.name==e&&t.explorationService.selectedMethod.navigationConfiguration.splice(a,1)})},e.$inject=["$scope","$analytics","$sce","$modalInstance","StreamStats.Services.ModalService","StreamStats.Services.ExplorationService","StreamStats.Services.StudyAreaService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ExplorationToolsModalController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use strict";var t=function(){function e(e,t,r,a){e.vm=this,this.sce=r,this.modalInstance=t,this._prosperServices=a,this.init()}return Object.defineProperty(e.prototype,"Location",{get:function(){return this._results.point},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Date",{get:function(){return this._results.date},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Table",{get:function(){return this._table},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ResultsAvailable",{get:function(){return this._resultsAvailable},enumerable:!1,configurable:!0}),e.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},Object.defineProperty(e.prototype,"Description",{get:function(){return this.sce.trustAsHtml("The PRObability of Streamflow PERmanence (PROSPER) model provides annual (2004-2016) streamflow permanence probabilities (SPPs; probabilistic predictions) and streamflow permanence classes (SPCs; categorical wet/ dry with an associated confidence level). Probabilities are of a stream channel having year- round flow at a 30- m spatial resolution. Model methods, output, and appropriate uses are detailed in Jaeger et al. (2018). Interpretation of a pixel as wet or dry will be based on combined consideration of the SPP, the sign of the SPC (negative for dry, positive for wet), and the associated confidence (1 - 5 representing 50% - 95 %). For example, predictions with a negative (positive) sign, high confidence level indicated by an SPC of - 5(5), and an SPP of less than (greater than) 0.5 will be the most reliable.<a href = 'https://doi.org/10.1016/j.hydroa.2018.100005' target = '_blank' > Click here for more information.</a><br><br><b>Contact information:</b><br>Roy Sando<br>U.S. Geological Survey, Wyoming-Montana Water Science Center<br>Email: <a href='mailto:tsando@usgs.gov' target='_blank'>tsando@usgs.gov</a> <br>Phone: 406-457-5953")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"AvailablePredictions",{get:function(){return this._prosperServices.AvailablePredictions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"DisplayedPredictionLayer",{get:function(){return this._prosperServices.DisplayedPrediction},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"SelectedPredictions",{get:function(){return this._prosperServices.SelectedPredictions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Graph",{get:function(){return this._graph},enumerable:!1,configurable:!0}),e.prototype.Close=function(){this.modalInstance.dismiss("cancel")},e.prototype.Reset=function(){this._prosperServices.ResetSelectedPredictions(),this.init()},e.prototype.Print=function(){window.print()},e.prototype.DownloadCSV=function(){var e="StreamStats PROSPER Report\n\n\nLatitude,"+this.Location.lat.toFixed(5)+"\nLongitude,"+this.Location.lng.toFixed(5)+"\nTime,"+this.Date.toLocaleString()+"\n\n";e+=this.Description+"\n\n",e+=this.tableToCSV($("#prosperResults"));var t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"prosper.csv");else{var r=document.createElement("a"),a=URL.createObjectURL(t);void 0!==r.download?(r.setAttribute("href",a),r.setAttribute("download","prosper.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(a)}},e.prototype.Query=function(){this._prosperServices.CanQuery=!0,this.modalInstance.dismiss()},e.prototype.ChangeDisplayedLayer=function(e){this.DisplayedPredictionLayer!=e&&(this._prosperServices.DisplayedPrediction=e)},e.prototype.init=function(){null==this._prosperServices.Result?(this._resultsAvailable=!1,this._results=null,this._graph=null):(this._resultsAvailable=!0,this.setResults(this._prosperServices.Result),this._graph={data:this.getGraphData(),options:{chart:{showLegend:!1,height:450,type:"scatterChart",showValues:!1,pointShape:function(e){return"square"},pointSize:10,pointDomain:[0,10],transitionDuration:350,rotateLabels:45,yDomain:[-5,5],margin:{top:20,right:50,bottom:100,left:60},yAxis:{axisLabel:"Streamflow Permanence Class",tickValues:[-5,-4,-3,-2,-1,0,1,2,3,4,5]},xAxis:{tickValues:this._xValues,showMaxMin:!1,rotateLabels:45},scatter:{onlyCircles:!1}}}})},e.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),r=e.find("tr:has(td)"),a=String.fromCharCode(11),o=String.fromCharCode(0),i='","',n='"\r\n"',s='"';return s+=g(t.map(c)),s+=n,s+=g(r.map(c))+'"';function g(e){return e.get().join(o).split(o).join(n).split(a).join(i)}function c(e,t){var r=$(t),o=r.find("td");return o.length||(o=r.find("th")),o.map(A).get().join(a)}function A(e,t){return $(t).text().replace('"','""')}},e.prototype.setResults=function(e){for(var t in this._results=e,this._table={},this._xValues=[],this._results.data)for(var r=0;r<this._results.data[t].length;r++){var a=this._results.data[t][r];"2"==a.name.charAt(0)&&this._xValues.push(a.name),a.name in this._table||(this._table[a.name]={}),this._table[a.name][t]=a.value}this._prosperServices.ResetResults()},e.prototype.getGraphData=function(){var e=this,t=[];return this._results.data.SPC.map(function(e){return e.value}).filter(function(e,t,r){return r.indexOf(e)===t}).forEach(function(r){t.push({key:r,color:e.getDefinedColor(r),values:e._results.data.SPC.filter(function(e){return e.value===r&&"mean"!=e.name.toLowerCase()}).map(function(e){return{x:parseInt(e.name),y:parseInt(e.value)}})})}),t},e.prototype.getDefinedColor=function(e){switch(e){case"-5":return"rgb(255,102,102)";case"-4":return"rgb(255,164,102)";case"-3":return"rgb(255,202,102)";case"-2":return"rgb(255,242,102)";case"-1":return"rgb(241,255,146)";case"0":return"rgb(211,255,188)";case"1":return"rgb(169,255,228)";case"2":return"rgb(122,239,255)";case"3":return"rgb(137,196,255)";case"4":return"rgb(134,155,255)";case"5":return"rgb(109,109,255)";default:return"rgb(64,0,64)"}},e.$inject=["$scope","$modalInstance","$sce","StreamStats.Services.ProsperService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ProsperController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use string";var r=function(t){function r(e,r,a,o,i,n,s,g){var c=t.call(this,s,configuration.baseurls.StreamStats)||this;return c.events=n,c.isBusy=!1,c.selectedReferenceGage=null,c.queryBy="Nearest",c.getNearest=!1,c.distance=10,e.vm=c,c.angulartics=r,c.modalInstance=a,c.studyAreaService=i,c.modalService=o,c.eventManager=n,c.toaster=g,c.dateRangeOptions={locale:{format:"MMMM D, YYYY"},eventHandlers:{"hide.daterangepicker":function(e){return c.SetExtensionDate(e)}}},c.init(),c.load(),e.$watch(function(){return c.usePublishedFDC},function(e,t){e!=t&&c.studyAreaService.selectedStudyAreaExtensions.forEach(function(e){e.parameters.forEach(function(e){"usePublishedFDC"==e.code&&(e.value=c.usePublishedFDC)})})}),e.$watch(function(){return c.dateRange.dates},function(e,t){c.studyAreaService.selectedStudyAreaExtensions.forEach(function(e){e.parameters.forEach(function(e){"sdate"==e.code&&(e.value=c.dateRange.dates.startDate),"edate"==e.code&&(e.value=c.dateRange.dates.endDate)})})}),c}return __extends(r,t),r.prototype.close=function(){this.modalInstance.dismiss("cancel")},r.prototype.ok=function(){this.verifyExtensionCanContinue()&&this.close()},r.prototype.setReferenceGageFromMap=function(e){this.isBusy=!0,this.studyAreaService.doSelectMapGage=!0,this.modalInstance.dismiss("cancel")},r.prototype.setBestCorrelatedReferenceGage=function(){var e=this;this.isBusy=!0,this.studyAreaService.onStudyAreaServiceBusyChanged.subscribe(new WiM.Event.EventHandler(function(){e.onStudyServiceBusyChanged()})),this.studyAreaService.GetKriggedReferenceGages()},r.prototype.SetExtensionDate=function(e){var t=this;this.getExtensionParameters(["sdate","edate"]).forEach(function(e){"sdate"===e.code&&(e.value=t.dateRange.dates.startDate),"edate"===e.code&&(e.value=t.dateRange.dates.endDate)}),this.studyAreaService.extensionDateRange=this.dateRange},r.prototype.init=function(){if(this.selectedReferenceGage=null,null!=this.studyAreaService.selectedStudyAreaExtensions){this.title=this.studyAreaService.selectedStudyAreaExtensions.map(function(e){return e.name}).join(", ");var t=this.getExtensionParameters(),r=t.map(function(e){return e.code});["sid"].some(function(e){return r.indexOf(e)>-1})&&(this.selectedReferenceGage=new e.Models.ReferenceGage("","")),["sdate","edate"].every(function(e){return r.indexOf(e)>-1})&&(void 0!=this.studyAreaService.extensionDateRange?this.dateRange=this.studyAreaService.extensionDateRange:this.dateRange={dates:{startDate:this.addDay(new Date,-30),endDate:this.addDay(new Date,-1)},minDate:new Date(1900,1,1),maxDate:this.addDay(new Date,-1)},t[r.indexOf("sdate")].value=this.dateRange.dates.startDate,t[r.indexOf("edate")].value=this.dateRange.dates.endDate),["usePublishedFDC"].some(function(e){return r.indexOf(e)>-1})&&(this.usePublishedFDC=!1)}},r.prototype.load=function(){var e=this.getExtensionParameters(),t=function(){var t=e.pop();r.selectedReferenceGage&&["sid"].indexOf(t.code)>-1&&("string"!=typeof t.value?r.selectedReferenceGage=t.value:"object"==typeof t.options&&(r.selectedReferenceGage=t.options.filter(function(e){return e.StationID==t.value})[0]),r.referenceGageList=t.options),r.dateRange&&["sdate","edate"].indexOf(t.code)>-1&&("sdate"==t.code&&(r.dateRange.dates.startDate=t.value),"edate"==t.code&&(r.dateRange.dates.endDate=t.value)),void 0!=r.usePublishedFDC&&["usePublishedFDC"].indexOf(t.code)>-1&&(r.usePublishedFDC=t.value)},r=this;do{t()}while(e.length>0);this.studyAreaService.selectedGage=this.selectedReferenceGage,this.getGageInfo()},r.prototype.verifyExtensionCanContinue=function(){var e=this;return(!this.dateRange||(this.dateRange.dates.startDate<=this.dateRange.maxDate||this.dateRange.dates.endDate<=this.dateRange.maxDate)&&(this.dateRange.dates.startDate>=this.dateRange.minDate||this.dateRange.dates.endDate>=this.dateRange.minDate)&&this.dateRange.dates.startDate<=this.dateRange.dates.endDate)&&((!this.selectedReferenceGage||""!=this.selectedReferenceGage.StationID)&&(this.studyAreaService.selectedStudyAreaExtensions.forEach(function(t){t.parameters.forEach(function(t){"sid"==t.code&&"string"!=typeof t.value&&(void 0!=t.options&&0!=t.options.length||(t.options=[e.selectedReferenceGage]),t.value=e.selectedReferenceGage.StationID),"usePublishedFDC"==t.code&&(t.value=e.usePublishedFDC),"sdate"==t.code&&(t.value=e.dateRange.dates.startDate),"edate"==t.code&&(t.value=e.dateRange.dates.endDate)})}),this.studyAreaService.updateExtensions(),!0))},r.prototype.addDay=function(e,t){try{return new Date(e.getTime()+864e5*t)}catch(t){return e}},r.prototype.getExtensionParameters=function(e){void 0===e&&(e=null);var t=this.studyAreaService.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]);return e&&(t=t.filter(function(t){return e.indexOf(t.code)>-1})),t},r.prototype.onStudyServiceBusyChanged=function(){var e=this;this.studyAreaService.onStudyAreaServiceBusyChanged.unsubscribe(new WiM.Event.EventHandler(function(){e.onStudyServiceBusyChanged()})),this.load(),this.isBusy=!1},r.prototype.updateReferenceGage=function(e){this.selectedReferenceGage=e,this.studyAreaService.selectedGage=e},r.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modalService.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},r.prototype.getGageInfo=function(){var e=this,t=!1;if(this.referenceGageList&&this.referenceGageList.forEach(function(r){console.log(r),r.StationID==e.selectedReferenceGage.StationID&&(t=!0);var a=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStations+r.StationID,o=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json");e.Execute(o).then(function(e){console.log(e.data);var t=e.data;if(t.hasOwnProperty("statistics")){var a=!1;t.statistics.forEach(function(e){"FDS"==e.statisticGroupType.code&&(a=!0)}),r.properties.HasFlowDurationStats=a}t.hasOwnProperty("characteristics")&&t.characteristics.forEach(function(e){"DRNAREA"==e.variableType.code&&(r.properties.DrainageArea=e.value)})},function(e){}).finally(function(){})}),this.selectedReferenceGage&&!t){var r=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStations+this.selectedReferenceGage.StationID,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(a).then(function(t){var r=t.data;if(r.hasOwnProperty("statistics")){var a=!1;r.statistics.forEach(function(e){"FDS"==e.statisticGroupType.code&&(a=!0)}),e.selectedReferenceGage.properties.HasFlowDurationStats=a}r.hasOwnProperty("characteristics")&&r.characteristics.forEach(function(t){"DRNAREA"==t.variableType.code&&(e.selectedReferenceGage.properties.DrainageArea=t.value)})},function(e){}).finally(function(){})}},r.prototype.getNearestGages=function(){var e=this;this.toaster.pop("wait","Searching for gages","Please wait...",0);var t=this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),r=this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),a=configuration.baseurls.GageStatsServices;"Nearest"==this.queryBy&&(a+=configuration.queryparams.GageStatsServicesNearest.format(t,r,this.distance)),"Network"==this.queryBy&&(a+=configuration.queryparams.GageStatsServicesNetwork.format(t,r,this.distance));var o=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",{"X-Is-Streamstats":!0});this.referenceGageList=[],this.Execute(o).then(function(t){if(e.toaster.clear(),"string"==typeof t.data?e.toaster.pop("warning","Warning",t.data,0):t.data.hasOwnProperty("features")&&0==t.data.features.length?e.toaster.pop("warning","Warning","No stations located within search distance"):t.data.hasOwnProperty("features")&&t.data.features.length>0&&(t.data.features.forEach(function(e){if(e.properties.hasOwnProperty("Statistics")){var t=!1;e.properties.Statistics.forEach(function(e){"FDS"==e.statisticGroupType.code&&(t=!0)}),e.properties.HasFlowDurationStats=t}e.properties.hasOwnProperty("Characteristics")&&e.properties.Characteristics.forEach(function(t){"DRNAREA"==t.variableType.code&&(e.properties.DrainageArea=t.value)}),e.properties.code?e.StationID=e.properties.code:e.properties.Code&&(e.StationID=e.properties.Code)}),e.referenceGageList=t.data.features),t.headers()["x-usgswim-messages"]){var r=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(r).forEach(function(t){r[t].forEach(function(r){e.toaster.pop(t,t,r)})})}},function(t){if(e.toaster.clear(),console.log(t),t.headers()["x-usgswim-messages"]){var r=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(r).forEach(function(t){r[t].forEach(function(r){e.toaster.pop(t,t,r)})})}else e.toaster.pop("error","There was an error finding nearby gages.","Please retry",0)})},r.prototype.selectGage=function(t){this.selectedReferenceGage=t;var r=this.studyAreaService.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()}),a=new e.Models.ReferenceGage(t.properties.Code,t.properties.Name);a.Latitude_DD=t.geometry.coordinates[0],a.Longitude_DD=t.geometry.coordinates[1],a.properties=t.properties,r[0].options=this.referenceGageList,r[0].value=a,this.selectedReferenceGage=a},r.prototype.getStyling=function(e){return e.StationID==this.selectedReferenceGage.StationID?{"background-color":"#ebf0f5"}:{"background-color":"unset"}},r.$inject=["$scope","$analytics","$modalInstance","StreamStats.Services.ModalService","StreamStats.Services.StudyAreaService","WiM.Event.EventManager","$http","toaster"],r}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ExtensionModalController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use strict";var t=function(){return function(e){this.code=e}}(),r=(function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(e){function r(t,r,a,o){var i=e.call(this,r,configuration.baseurls.StreamStats)||this;return i.showPreferred=!1,i.multiselectOptions={displayProp:"name"},t.vm=i,i.modalInstance=o,i.modalService=a,i.init(),i.selectedStatisticGroups=[],i.showPreferred=!1,i}return __extends(r,e),r.prototype.Close=function(){this.modalInstance.dismiss("cancel")},r.prototype.getGagePage=function(){var e=this;this.gage=new t(this.modalService.modalOptions.siteid);var r=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStations+this.gage.code,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(a).then(function(t){e.gage=t.data,e.gage.lat=t.data.location.coordinates[1],e.gage.lng=t.data.location.coordinates[0],e.gage.statisticsgroups=[],e.gage.citations=[],e.getStationCharacteristics(t.data.characteristics),e.getStationStatistics(t.data.statistics),e.getNWISInfo()},function(e){}).finally(function(){})},r.prototype.setPreferred=function(e){this.showPreferred=e},r.prototype.getStationCharacteristics=function(e){var t=this;e.forEach(function(e,r){e.hasOwnProperty("citation")&&e.citation.id&&(e.citation&&e.citation.citationURL&&(e.citation.citationURL=e.citation.citationURL.replace("#","")),t.checkForCitation(e.citation.id)||t.gage.citations.push(e.citation))})},r.prototype.checkForCitation=function(e){return this.gage.citations.some(function(t){return t.id===e})},r.prototype.getStationStatistics=function(e){var t=this;e.forEach(function(e,r){if(e.hasOwnProperty("citation")&&e.citation.id&&(e.citation&&e.citation.citationURL&&(e.citation.citationURL=e.citation.citationURL.replace("#","")),t.checkForCitation(e.citation.id)||t.gage.citations.push(e.citation)),!t.checkForStatisticGroup(e.statisticGroupTypeID))if(e.hasOwnProperty("statisticGroupType")){var a=e.statisticGroupType;t.gage.statisticsgroups.push(a)}else t.getStatGroup(e.statisticGroupTypeID)})},r.prototype.getStatGroup=function(e){var t=this,r=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStatGroups+e,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(a).then(function(e){t.checkForStatisticGroup(e.data.id)||t.gage.statisticsgroups.push(e.data)})},r.prototype.checkForStatisticGroup=function(e){return this.gage.statisticsgroups.some(function(t){return t.id===e})},r.prototype.checkForPredInt=function(e){return this.gage.statistics.some(function(t){return t.statisticGroupTypeID==e&&t.hasOwnProperty("predictionInterval")})},r.prototype.getNWISInfo=function(){var e=this,t=configuration.baseurls.NWISurl+configuration.queryparams.NWISsiteinfo+this.gage.code,r=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(r).then(function(t){var r=t.data.split(e.gage.name)[1].match(/[+-]?((\d+(\.\d*)?)|(\.\d+))/g);e.NWISlat=r[0],e.NWISlng=r[1]})},r.prototype.init=function(){this.AppVersion=configuration.version,this.getGagePage()},r.$inject=["$scope","$http","StreamStats.Services.ModalService","$modalInstance"],r}(WiM.Services.HTTPServiceBase));angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.GagePageController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use strict";var r=function(t){function r(e,r,a,o,i,n){var s=t.call(this,a,configuration.baseurls.StreamStats)||this;return s.showPreferred=!1,s.multiselectOptions={displayProp:"name"},s.queryBy="Nearest",s.distance=10,s.nearbyGages=[],e.vm=s,s.modalInstance=i,s.modalService=o,s.init(),s.selectedStatisticGroups=[],s.showPreferred=!1,s.studyAreaService=n,s.toaster=r,s}return __extends(r,t),r.prototype.Close=function(){this.modalInstance.dismiss("cancel")},r.prototype.getNearestGages=function(){var e=this;this.toaster.pop("wait","Searching for gages","Please wait...",0);var t=this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),r=this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),a=configuration.baseurls.GageStatsServices;"Nearest"==this.queryBy&&(a+=configuration.queryparams.GageStatsServicesNearest.format(t,r,this.distance)),"Network"==this.queryBy&&(a+=configuration.queryparams.GageStatsServicesNetwork.format(t,r,this.distance));var o=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",{"X-Is-Streamstats":!0});this.nearbyGages=[],this.Execute(o).then(function(t){if(e.toaster.clear(),"string"==typeof t.data?e.toaster.pop("warning","Warning",t.data,0):t.data.hasOwnProperty("features")&&0==t.data.features.length?e.toaster.pop("warning","Warning","No stations located within search distance"):t.data.hasOwnProperty("features")&&t.data.features.length>0&&(t.data.features.forEach(function(e){if(e.properties.hasOwnProperty("Statistics")){var t=!1;e.properties.Statistics.forEach(function(e){"FDS"==e.statisticGroupType.code&&(t=!0)}),e.properties.HasFlowDurationStats=t}e.properties.hasOwnProperty("Characteristics")&&e.properties.Characteristics.forEach(function(t){"DRNAREA"==t.variableType.code&&(e.properties.DrainageArea=t.value)})}),e.nearbyGages=t.data.features),t.headers()["x-usgswim-messages"]){var r=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(r).forEach(function(t){r[t].forEach(function(r){e.toaster.pop(t,t,r)})})}},function(t){if(e.toaster.clear(),console.log(t),t.headers()["x-usgswim-messages"]){var r=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(r).forEach(function(t){r[t].forEach(function(r){e.toaster.pop(t,t,r)})})}else e.toaster.pop("error","There was an error finding nearby gages.","Please retry",0)})},r.prototype.selectGage=function(e){this.studyAreaService.doSelectNearestGage&&(this.Close(),this.studyAreaService.selectGage(e))},r.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modalService.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},r.prototype.init=function(){this.AppVersion=configuration.version},r.$inject=["$scope","toaster","$http","StreamStats.Services.ModalService","$modalInstance","StreamStats.Services.StudyAreaService"],r}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NearestGagesController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));