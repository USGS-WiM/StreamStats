var StreamStats;!function(e){var t=function(){function e(e,t,r,a,o){this.$stateProvider=e,this.$urlRouterProvider=t,this.$locationProvider=r,this.$logProvider=a,this.$compilerProvider=o,this.$stateProvider.state("main",{url:"/?rcode&workspaceID",template:"<ui-view/>",views:{map:{templateUrl:"Views/mapview.html",controller:"StreamStats.Controllers.MapController"},sidebar:{templateUrl:"Views/sidebarview.html",controller:"StreamStats.Controllers.SidebarController"},navbar:{templateUrl:"Views/navigationview.html",controller:"StreamStats.Controllers.NavbarController"},report:{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController"}}}),this.$urlRouterProvider.otherwise("/"),this.$locationProvider.html5Mode(!0),this.$logProvider.debugEnabled(!1),"production"==configuration.environment&&this.$compilerProvider.debugInfoEnabled(!1)}return e}();t.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$logProvider","$compileProvider"],angular.module("StreamStats",["ui.router","ui.bootstrap","ui.checkbox","mobile-angular-ui","angulartics","angulartics.google.analytics","toaster","ngFileUpload","leaflet-directive","StreamStats.Services","StreamStats.Controllers","WiM.Services","WiM.Event","wim_angular","rzModule","nvd3"]).config(t)}(StreamStats||(StreamStats={}));var StreamStats;!function(e){!function(e){var t=function(){function e(e,t){this.RegionID=e,this.Pourpoint=t,this.CoordinatedReach=null}return e}();e.StudyArea=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){!function(e){var t=function(){function e(){this.append=[],this.remove=[]}return e}();e.WatershedEditDecisionList=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),StreamStats;!function(e){!function(e){var t=function(){function e(e,t){this.navigationID=e,this.navigationInfo=t,this.navigationInfo.configuration&&(this.minLocations=this.getCountByType(this.navigationInfo.configuration,"geojson point geometry")),this.navigationConfiguration=[],this.navigationPointCount=0,this._locations=[]}return Object.defineProperty(e.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0}),e.prototype.addLocation=function(e,t){var r=this;this._locations.push(t),this.navigationConfiguration.reverse().forEach(function(t,a){t.name==e&&(console.log("found this point already, deleting:",r.navigationConfiguration,a),r.navigationConfiguration.splice(a,1),r.navigationPointCount-=1)}),this.navigationPointCount+=1,this.navigationConfiguration.push({id:this.navigationPointCount,name:e,required:!0,description:"Specified lat/long/crs  navigation start location",valueType:"geojson point geometry",value:{type:"Point",coordinates:[t.Longitude,t.Latitude],crs:{properties:{name:"EPSG:"+t.crs},type:"name"}}}),this._locations.length>this.minLocations&&this._locations.shift()},e.prototype.getCountByType=function(e,t){return e.filter(function(e){return e.valueType.toLowerCase().indexOf(t)>=0}).length},e}();e.NetworkNav=t;var r=function(e){function t(){return e.call(this,2,2)||this}return __extends(t,e),t}(t);e.NetworkPath=r;var a=function(e){function t(){var t=e.call(this,1,1)||this;return t._workspaceID="",t}return __extends(t,e),Object.defineProperty(t.prototype,"workspaceID",{get:function(){return this._workspaceID},set:function(e){this._workspaceID=e},enumerable:!0,configurable:!0}),t}(t);e.FlowPath=a;var o=function(e){function t(){var t=e.call(this,3,1)||this;return t.layerOptions=[{name:"NHDFlowline",selected:!0},{name:"Gage",selected:!1},{name:"Dam",selected:!1}],t.DirectionOptions=["Upstream","Downstream"],t.selectedDirectionType=t.DirectionOptions[1],t}return __extends(t,e),t}(t);e.NetworkTrace=o}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){!function(e){var t=function(){function e(e,t){this._name="Coordinated Reach: "+e,this._id=t,this._flowCoefficients={}}return Object.defineProperty(e.prototype,"FlowCoefficients",{get:function(){return this._flowCoefficients},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ID",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.AddFlowCoefficient=function(e,t,r){null!==this._flowCoefficients[e]&&(this._flowCoefficients[e]={CoefficientA:t,CoefficientB:r})},e.prototype.Execute=function(e){try{var t=[];for(var r in this.FlowCoefficients)if(this.FlowCoefficients.hasOwnProperty(r)){var a=this.FlowCoefficients[r];t.push({Code:r,Description:this.getDescription(r),Name:this.getName(r),Unit:{Unit:"cubic feet per second",Abbr:"ft^3/s"},Value:this.getValue(a,e[0].value)})}var o=[];o.push({Code:e[0].code,Value:e[0].value,Name:e[0].name,UnitType:{Abbr:e[0].unit,Unit:e[0].unit}});for(var r in this.FlowCoefficients)o.push({Code:r+"CoeffA",Value:this.FlowCoefficients[r].CoefficientA.toFixed(3),Name:r+" CoefficientA",UnitType:{Abbr:"dim",Unit:"dimensionless"}}),o.push({Code:r+"CoeffB",Value:this.FlowCoefficients[r].CoefficientB.toFixed(3),Name:r+" CoefficientB",UnitType:{Abbr:"dim",Unit:"dimensionless"}});return{ID:0,Name:this.Name,Code:this.ID,Parameters:o,Results:t}}catch(e){return null}},e.prototype.getDescription=function(e){var t="";switch(e){case"PK10":t="10";break;case"PK25":t="25";break;case"PK50":t="50";break;case"PK100":t="100";break;case"PK200":t="200";break;case"PK500":t="500";break;default:t="undefined"}return"Maximum instantaneous flow that occurs on average once in {0} years".format(t)},e.prototype.getName=function(e){var t="";switch(e){case"PK10":t="10";break;case"PK25":t="25";break;case"PK50":t="50";break;case"PK100":t="100";break;case"PK200":t="200";break;case"PK500":t="500";break;default:t="undefined"}return"{0} year Peak Flood".format(t)},e.prototype.getValue=function(e,t){try{return e.CoefficientA&&e.CoefficientB&&t?e.CoefficientA*Math.pow(t,e.CoefficientB):null}catch(e){return null}},e}();e.CoordinatedReach=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Services",[])}();var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),StreamStats;!function(e){!function(e){"use strict";function t(e,t,r,o){return new a(e,t,r,o)}var r=function(){function e(){}return e}();e.StatisticsGroup=r;var a=function(e){function t(t,r,a,o){var i=e.call(this,t,configuration.baseurls.NSS)||this;return i.$q=r,i.toaster=a,i.modalService=o,i._onSelectedStatisticsGroupChanged=new WiM.Event.Delegate,i.clearNSSdata(),i}return __extends(t,e),Object.defineProperty(t.prototype,"onSelectedStatisticsGroupChanged",{get:function(){return this._onSelectedStatisticsGroupChanged},enumerable:!0,configurable:!0}),t.prototype.clearNSSdata=function(){this.loadingParametersByStatisticsGroupCounter=0,this.estimateFlowsCounter=0,this.selectedStatisticsGroupList=[],this.statisticsGroupList=[],this.canUpdate=!0,this.queriedRegions=!1,this.isDone=!1,this.reportGenerated=!1},t.prototype.loadStatisticsGroupTypes=function(e,t){var r=this;if(this.toaster.pop("wait","Loading Available Scenarios","Please wait...",0),e||t){"MO_STL"===e&&(e=e.substring(0,e.indexOf("_")));var a=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupLookup.format(e,t),o=new WiM.Services.Helpers.RequestInfo(a,!0);this.loadingStatisticsGroup=!0,this.statisticsGroupList=[],this.Execute(o).then(function(e){e.data.length>0&&(r.loadingStatisticsGroup=!1,angular.forEach(e.data,function(e,t){r.statisticsGroupList.push(e)})),r.toaster.clear()},function(e){r.toaster.clear(),r.toaster.pop("error","There was an error Loading Available Scenarios","Please retry",0)}).finally(function(){r.loadingStatisticsGroup=!1})}},t.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},t.prototype.loadParametersByStatisticsGroup=function(e,t,r,a){var o=this;if(0==this.loadingParametersByStatisticsGroupCounter&&this.toaster.pop("wait","Loading Parameters by Statistics Group","Please wait...",0),this.loadingParametersByStatisticsGroupCounter++,e||t||r){"MO_STL"===e&&(e=e.substring(0,e.indexOf("_")));var i=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupParameterLookup.format(e,t,r),n=new WiM.Services.Helpers.RequestInfo(i,!0);this.Execute(n).then(function(e){e.data[0].RegressionRegions[0].Parameters&&e.data[0].RegressionRegions[0].Parameters.length>0&&o.selectedStatisticsGroupList.forEach(function(t){e.data[0].StatisticGroupName==t.Name&&(t.StatisticGroupName=t.Name,t.StatisticGroupID=t.ID,e.data[0].RegressionRegions.forEach(function(e){a.forEach(function(t){t.code.indexOf(e.Code.toUpperCase())>-1&&(e.PercentWeight=t.percent)})}),t.RegressionRegions=e.data[0].RegressionRegions,o._onSelectedStatisticsGroupChanged.raise(null,WiM.Event.EventArgs.Empty))})},function(e){o.toaster.clear(),o.toaster.pop("error","There was an error Loading Parameters by Statistics Group","Please retry",0)}).finally(function(){0==--o.loadingParametersByStatisticsGroupCounter&&o.toaster.clear()})}},t.prototype.estimateFlows=function(e,t,r,a,o){var i=this;void 0===o&&(o=!1),(this.canUpdate||o)&&this.selectedStatisticsGroupList.forEach(function(n){i.canUpdate=!1,0==i.estimateFlowsCounter&&i.toaster.pop("wait","Estimating Flows","Please wait...",0),i.estimateFlowsCounter++,i.cleanRegressionRegions(n.RegressionRegions),n.RegressionRegions.forEach(function(r){r.Parameters.forEach(function(r){e.forEach(function(e){r.Code.toLowerCase()==e.code.toLowerCase()&&(r.Value=e[t])})})});var s=angular.fromJson(angular.toJson(n));s.RegressionRegions.forEach(function(e){e.Results&&delete e.Results}),s=angular.toJson([s],null),"MO_STL"===r&&(r=r.substring(0,r.indexOf("_")));var g=configuration.baseurls.NSS+configuration.queryparams.estimateFlows.format(r,n.ID,a),A=new WiM.Services.Helpers.RequestInfo(g,!0,1,"json",s);n.Citations=[],i.Execute(A).then(function(e){var r=e.data[0].Links[0].Href;if(o||i.getSelectedCitations(r,n),e.headers()["usgswim-messages"]){var a=e.headers()["usgswim-messages"].split(";");n.Disclaimers={},a.forEach(function(e){var t=e.split(":");"warning"==t[0]&&(n.Disclaimers.Warnings=t[1].trim()),"error"==t[0]&&(n.Disclaimers.Error=t[1].trim())})}e.data[0].RegressionRegions.length>0&&e.data[0].RegressionRegions[0].Results&&e.data[0].RegressionRegions[0].Results.length>0?o?n.RegressionRegions.forEach(function(r){r.Parameters.forEach(function(a){for(var o=e.data[0].RegressionRegions,i=0;i<o.length;i++)if(o[i].ID===r.ID)for(var n=0;n<o[i].Parameters.length;n++)o[i].Parameters[n].Code==a.Code&&(a[t]=o[i].Parameters[n].Value)}),r.Results.forEach(function(a){for(var o=e.data[0].RegressionRegions,i=0;i<o.length;i++)if(o[i].ID===r.ID)for(var n=0;n<o[i].Results.length;n++)o[i].Results[n].code==a.code&&(a[t]=o[i].Results[n].Value)})}):(n.RegressionRegions=[],n.RegressionRegions=e.data[0].RegressionRegions):(i.toaster.clear(),i.toaster.pop("error","There was an error Estimating Flows for "+n.Name,"No results were returned",0))},function(e){i.toaster.clear(),i.toaster.pop("error","There was an error Estimating Flows","HTTP request error",0)}).finally(function(){--i.estimateFlowsCounter<1&&(i.toaster.clear(),i.estimateFlowsCounter=0,i.canUpdate=!0)})})},t.prototype.getSelectedCitations=function(e,t){var r=this,a=e,o=new WiM.Services.Helpers.RequestInfo(a,!0,0,"json");this.Execute(o).then(function(e){e.data[0]&&e.data[0].ID&&angular.forEach(e.data,function(e,r){t.Citations.push(e)})},function(e){r.toaster.pop("error","There was an error getting selected Citations for "+t.Name,"No results were returned",0)}).finally(function(){})},t.prototype.cleanRegressionRegions=function(e){for(var t=0;t<e.length;t++){"Area-Averaged"!==e[t].Name?e.forEach(function(e){e.Results&&delete e.Results}):e.splice(t,1)}},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster","StreamStats.Services.ModalService"],angular.module("StreamStats.Services").factory("StreamStats.Services.nssService",t)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),StreamStats;!function(e){!function(e){"use strict";function t(e,t,r,a){return new o(e,t,r,a)}var r=function(){function e(){}return e}();e.Region=r;var a=function(){function e(){}return e}();e.Parameter=a,e.onSelectedRegionChanged="onSelectedRegionChanged";var o=function(t){function r(r,a,o,i){var n=t.call(this,r,configuration.baseurls.StreamStatsServices)||this;return n.$q=a,n.eventManager=i,n.toaster=o,n.regionList=[],n.parameterList=[],n.masterRegionList=configuration.regions,n.streamStatsAvailable=!1,n.eventManager.AddEvent(e.onSelectedRegionChanged),n}return __extends(r,t),Object.defineProperty(r.prototype,"selectedRegion",{get:function(){return this._selectedRegion},set:function(t){this._selectedRegion!=t&&(this._selectedRegion=t,this.eventManager.RaiseEvent(e.onSelectedRegionChanged,this,WiM.Event.EventArgs.Empty))},enumerable:!0,configurable:!0}),r.prototype.clearRegion=function(){this.regionList=[],this.parameterList=[],this.regionMapLayerList=[],this.selectedRegion=null,this.regionMapLayerListLoaded=!1,this.resetView=!1},r.prototype.clearSelectedParameters=function(){this.parameterList.forEach(function(e){e.checked=!1,delete e.value})},r.prototype.intersect=function(e,t){return Math.max(e.left,t.left)<Math.min(e.right,t.right)&&Math.min(e.top,t.top)>Math.max(e.bottom,t.bottom)},r.prototype.loadRegionListByExtent=function(e,t,r,a,o){var i=this;void 0===o&&(o=4326),this.regionList=[];var n={top:a,bottom:r,left:t,right:e};configuration.regions.forEach(function(e,t){var r={top:e.Bounds[1][0],bottom:e.Bounds[0][0],left:e.Bounds[0][1],right:e.Bounds[1][1]};i.intersect(n,r)&&i.regionList.push(e)})},r.prototype.loadRegionListByRegion=function(e){this.regionList.length=0;var t=this.getRegion(e);return null!=t&&(this.regionList.push(t),!0)},r.prototype.loadMapLayersByRegion=function(e){var t=this;this.regionMapLayerListLoaded=!1;var r=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers+"?f=pjson",a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.regionMapLayerList=[],this.Execute(a).then(function(r){if(!r.data.layers)return void t.toaster.pop("warning","No map layers available","",5e3);r.data.layers.forEach(function(a,o){a.name==e&&a.subLayerIds.forEach(function(e,a){t.regionMapLayerList.push([r.data.layers[e].name,r.data.layers[e].id,!1])})}),t.regionMapLayerListLoaded=!0},function(e){return console.log("No region map layers found"),t.$q.reject(e.data)}).finally(function(){})},r.prototype.loadParametersByRegion=function(){var e=this;if(this.selectedRegion){var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSAvailableParams.format(this.selectedRegion.RegionID),r=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(r).then(function(t){t.data.parameters&&t.data.parameters.length>0?(e.streamStatsAvailable=!0,t.data.parameters.forEach(function(t){try{t.checked=!1,t.toggleable=!0,e.parameterList.push(t)}catch(e){alert(e)}}),e.parameterList.sort(function(e,t){return e.code>t.code?1:t.code>e.code?-1:0})):(e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3))},function(t){console.log("Bad response from the regression service"),e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3)}).finally(function(){})}},r.prototype.getRegion=function(e){var t=configuration.regions;try{for(var r=0;r<t.length;r++)if(t[r].Name.toUpperCase().trim()===e.toUpperCase().trim()||t[r].RegionID.toUpperCase().trim()===e.toUpperCase().trim())return t[r];return null}catch(e){return null}},r}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster","WiM.Event.EventManager"],angular.module("StreamStats.Services").factory("StreamStats.Services.RegionService",t)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),StreamStats;!function(e){!function(t){"use strict";function r(e,t,r,a){return new o(e,t,r,a)}t.onSelectedStudyAreaChanged="onSelectedStudyAreaChanged",t.onSelectedStudyParametersLoaded="onSelectedStudyParametersLoaded",t.onStudyAreaReset="onStudyAreaReset",t.onEditClick="onEditClick";var a=function(e){function t(t,r,a,o){void 0===t&&(t=null),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===o&&(o=!1);var i=e.call(this)||this;return i.studyArea=t,i.studyAreaVisible=r,i.parameterLoaded=a,i.additionalFeaturesLoaded=o,i}return __extends(t,e),t}(WiM.Event.EventArgs);t.StudyAreaEventArgs=a;var o=function(r){function o(e,a,o,i){var n=r.call(this,e,configuration.baseurls.StreamStatsServices)||this;return n.$http=e,n.$q=a,n.eventManager=o,n.surfacecontributionsonly=!1,o.AddEvent(t.onSelectedStudyParametersLoaded),o.AddEvent(t.onSelectedStudyAreaChanged),o.AddEvent(t.onStudyAreaReset),o.SubscribeToEvent(t.onSelectedStudyAreaChanged,new WiM.Event.EventHandler(function(e,t){n.onStudyAreaChanged(e,t)})),o.AddEvent(t.onEditClick),n._studyAreaList=[],n.toaster=i,n.clearStudyArea(),n.servicesURL=configuration.baseurls.StreamStatsServices,n}return __extends(o,r),Object.defineProperty(o.prototype,"StudyAreaList",{get:function(){return this._studyAreaList},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectedStudyArea",{get:function(){return this._selectedStudyArea},set:function(e){this.canUpdate&&this._selectedStudyArea!=e&&(this._selectedStudyArea=e,this.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,this,a.Empty))},enumerable:!0,configurable:!0}),o.prototype.editBasin=function(e){this.selectedStudyArea.Disclaimers.isEdited=!0,this.drawControlOption=e,this.eventManager.RaiseEvent(t.onEditClick,this,WiM.Event.EventArgs.Empty)},o.prototype.undoEdit=function(){delete this.selectedStudyArea.Disclaimers.isEdited,this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,this,a.Empty)},o.prototype.AddStudyArea=function(e){this.clearStudyArea(),this.StudyAreaList.push(e),this.selectedStudyArea=e,this.selectedStudyArea.Disclaimers={}},o.prototype.RemoveStudyArea=function(){},o.prototype.clearStudyArea=function(){this.canUpdate=!0,this.regulationCheckComplete=!0,this.parametersLoading=!1,this.doDelineateFlag=!1,this.checkingDelineatedPoint=!1,this.studyAreaParameterList=[],this.regulationCheckResults=[],this.selectedStudyArea&&(this.selectedStudyArea.Disclaimers={}),this.showEditToolbar=!1,this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this.selectedStudyArea=null,this.zoomLevel15=!0,this.regressionRegionQueryComplete=!1,this.regressionRegionQueryLoading=!1,this.eventManager.RaiseEvent(t.onStudyAreaReset,this,WiM.Event.EventArgs.Empty)},o.prototype.loadStudyBoundary=function(){var e=this;this.toaster.pop("wait","Delineating Basin","Please wait...",0),this.canUpdate=!1;var r=this.selectedStudyArea.RegionID,o=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSdelineation.format("geojson",r,this.selectedStudyArea.Pourpoint.Longitude.toString(),this.selectedStudyArea.Pourpoint.Latitude.toString(),this.selectedStudyArea.Pourpoint.crs.toString(),!1);if("MO_STL"==this.selectedStudyArea.RegionID)var o=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSstormwaterDelineation.format(r,this.selectedStudyArea.Pourpoint.Longitude.toString(),this.selectedStudyArea.Pourpoint.Latitude.toString(),this.surfacecontributionsonly);var i=new WiM.Services.Helpers.RequestInfo(o,!0);i.withCredentials=!0,this.Execute(i).then(function(r){if("MO_STL"==e.selectedStudyArea.RegionID)if(r.data.layers&&r.data.layers.features&&r.data.layers.features[1].geometry.coordinates.length>0){e.selectedStudyArea.Disclaimers.isSTL_MO=!0;var o=r.data.hasOwnProperty("layers")?r.data.layers:null;o&&o.features.forEach(function(e){return e.id=e.id.toString().toLowerCase()}),e.selectedStudyArea.FeatureCollection=o,e.selectedStudyArea.WorkspaceID=r.data.hasOwnProperty("workspaceID")?r.data.workspaceID:null,e.selectedStudyArea.Date=new Date,e.toaster.clear(),e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,a.Empty),e.canUpdate=!0}else e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","A watershed was not returned from the delineation request","Please retry",0);else r.data.hasOwnProperty("featurecollection")&&r.data.featurecollection[1]&&r.data.featurecollection[1].feature.features.length>0?(e.selectedStudyArea.Server=r.headers()["usgswim-hostname"].toLowerCase(),e.selectedStudyArea.WorkspaceID=r.data.hasOwnProperty("workspaceID")?r.data.workspaceID:null,e.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:e.reconfigureWatershedResponse(r.data.featurecollection),bbox:r.data.featurecollection.filter(function(e){return"globalwatershed"==e.name})[0].feature.features[0].bbox},e.selectedStudyArea.Date=new Date,e.toaster.clear(),e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,a.Empty),e.canUpdate=!0):(e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","A watershed was not returned from the delineation request","Please retry",0));e.selectedStudyArea.FeatureCollection.features.forEach(function(e){return e.properties={}})},function(t){e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","There was an HTTP error with the delineation request","Please retry",0)}).finally(function(){})},o.prototype.loadWatershed=function(r,o){var i=this;try{this.toaster.pop("wait","Opening Basin","Please wait...",0);var n=new e.Models.StudyArea(r,null);this.AddStudyArea(n);var s=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSwatershedByWorkspace.format("geojson",r,o,4326,!1),g=new WiM.Services.Helpers.RequestInfo(s,!0);g.withCredentials=!0,this.Execute(g).then(function(e){i.selectedStudyArea.WorkspaceID=e.data.hasOwnProperty("workspaceID")?e.data.workspaceID:null,i.selectedStudyArea.Date=new Date,i.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:i.reconfigureWatershedResponse(e.data.featurecollection),bbox:e.data.featurecollection.filter(function(e){return"globalwatershed"==e.name})[0].feature.features[0].bbox};var t=e.data.featurecollection.filter(function(e){return"globalwatershedpoint"==e.name})[0].feature.features[0];i.selectedStudyArea.Pourpoint=new WiM.Models.Point(t.bbox[1],t.bbox[0],t.crs.properties.code)},function(e){i.toaster.clear(),i.toaster.pop("error","Error Delineating Basin","Please retry",0)}).finally(function(){i.canUpdate=!0,i.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,i,a.Empty),i.toaster.clear()})}catch(e){return}},o.prototype.loadEditedStudyBoundary=function(){var r=this;this.toaster.pop("wait","Loading Edited Basin","Please wait...",0),this.canUpdate=!1;var o=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSeditBasin.format("geojson",this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,this.selectedStudyArea.Pourpoint.crs.toString()),i=new WiM.Services.Helpers.RequestInfo(o,!0,WiM.Services.Helpers.methodType.PUT,"json",angular.toJson(this.WatershedEditDecisionList),{});i.withCredentials=!0,this.Execute(i).then(function(t){r.AddStudyArea(new e.Models.StudyArea(r.selectedStudyArea.RegionID,r.selectedStudyArea.Pourpoint)),r.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:r.reconfigureWatershedResponse(t.data.featurecollection),bbox:t.data.featurecollection.filter(function(e){return"globalwatershed"==e.name.toLowerCase()})[0].feature.features[0].bbox},r.selectedStudyArea.WorkspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null,r.selectedStudyArea.Date=new Date,r.toaster.clear()},function(e){r.toaster.clear(),r.toaster.pop("error","Error Delineating Basin","Please retry",0)}).finally(function(){r.canUpdate=!0;var e=new a;e.studyArea=r.selectedStudyArea,r.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,r,e),r.selectedStudyArea.Disclaimers.isEdited=!0})},o.prototype.loadParameters=function(){var e=this;this.parametersLoading=!0;var r=[];if(this.toaster.clear(),this.toaster.pop("wait","Calculating Selected Basin Characteristics","Please wait...",0),this.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,this,a.Empty),!this.selectedStudyArea||!this.selectedStudyArea.WorkspaceID||!this.selectedStudyArea.RegionID)return void alert("No Study Area");if(r=this.studyAreaParameterList.filter(function(e){return!e.value||e.value<0}).map(function(e){return e.code}),r.length<1){var o=new a;return o.parameterLoaded=!0,this.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,this,o),this.toaster.clear(),void(this.parametersLoading=!1)}var i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,r.join(",")),n=new WiM.Services.Helpers.RequestInfo(i,!0);n.withCredentials=!0,this.Execute(n).then(function(r){if(r.data.parameters&&r.data.parameters.length>0){e.toaster.clear();var o=!1;angular.forEach(r.data.parameters,function(e,t){e.hasOwnProperty("value")&&-999!=e.value?e.loaded=!0:(o=!0,console.error("Parameter failed to compute: ",e.code),e.loaded=!1)}),o&&(e.showModifyBasinCharacterstics=!0,e.toaster.pop("error","One or more basin characteristics failed to compute","Click the 'Calculate Missing Parameters' button or manually enter parameter values to continue",0));var i=r.data.parameters;e.loadParameterResults(i),e.getAdditionalFeatureList(),e.selectedStudyArea.Disclaimers.isRegulated&&e.loadRegulatedParameterResults(e.regulationCheckResults.parameters);var n=new a;n.parameterLoaded=!0,e.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,e,n)}},function(t){e.toaster.clear(),e.toaster.pop("error","There was an HTTP error calculating basin characteristics","Please retry",0)}).finally(function(){e.parametersLoading=!1})},o.prototype.getAdditionalFeatureList=function(){var e=this,t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSavailableFeatures.format(this.selectedStudyArea.WorkspaceID),r=new WiM.Services.Helpers.RequestInfo(t,!0);r.withCredentials=!0,this.Execute(r).then(function(t){if(t.data.featurecollection&&t.data.featurecollection.length>0){var r=[];angular.forEach(t.data.featurecollection,function(t,a){-1===e.selectedStudyArea.FeatureCollection.features.map(function(e){return e.id}).indexOf(t.name)&&r.push(t.name)}),e.getAdditionalFeatures(r.join(","))}},function(t){e.toaster.clear(),e.toaster.pop("error","There was an HTTP error requesting additional feautres list","Please retry",0)}).finally(function(){})},o.prototype.getAdditionalFeatures=function(e){var t=this;if(e){var r=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSfeatures.format(this.selectedStudyArea.WorkspaceID,4326,e),a=new WiM.Services.Helpers.RequestInfo(r,!0);a.withCredentials=!0,this.Execute(a).then(function(e){if(e.data.featurecollection&&e.data.featurecollection.length>0){t.toaster.clear();var r=t.reconfigureWatershedResponse(e.data.featurecollection);angular.forEach(r,function(e,a){if(r.length<1){for(var o=0;o<t.selectedStudyArea.FeatureCollection.features.length;o++)if(t.selectedStudyArea.FeatureCollection.features[o].id.toLowerCase()===e.id.toLowerCase()){t.selectedStudyArea.FeatureCollection.features.splice(o,1);break}}else t.selectedStudyArea.FeatureCollection.features.push(e);t.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,t,new WiM.Directives.LegendLayerAddedEventArgs(e.id,"geojson",{displayName:e.id,imagesrc:null},!1))})}},function(e){t.toaster.clear(),t.toaster.pop("error","There was an HTTP error getting additional features","Please retry",0)}).finally(function(){})}},o.prototype.queryLandCover=function(){var e=this;this.toaster.pop("wait","Querying Land Cover Data with your Basin","Please wait...",0);var t='{"geometryType":"esriGeometryPolygon","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polygon", "rings":['+JSON.stringify(this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry.coordinates)+"]}}]}",r=configuration.baseurls.NationalMapRasterServices+configuration.queryparams.NLCDQueryService,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",{InputLineFeatures:t,returnZ:!0,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(t){e.toaster.clear(),t.data.length>0&&e.toaster.pop("success","Land Cover was succcessfully queried","Please continue",5e3)},function(t){return e.toaster.pop("error","There was an HTTP error querying Land Cover","Please retry",0),e.$q.reject(t.data)}).finally(function(){})},o.prototype.queryCoordinatedReach=function(){var t=this;this.toaster.pop("wait","Checking if study area is a coordinated reach.","Please wait...",0);var r=this.selectedStudyArea.Pourpoint,a=new L.Circle([r.Longitude,r.Latitude],50).getBounds(),o=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.coordinatedReachQueryService.format(this.selectedStudyArea.RegionID.toLowerCase(),a.getNorth(),a.getWest(),a.getSouth(),a.getEast(),r.crs,"eqWithStrID.BASIN_NAME,eqWithStrID.DVA_EQ_ID,eqWithStrID.a10,eqWithStrID.b10,eqWithStrID.a25,eqWithStrID.b25,eqWithStrID.a50,eqWithStrID.b50,eqWithStrID.a100,eqWithStrID.b100,eqWithStrID.a500,eqWithStrID.b500"),i=new WiM.Services.Helpers.RequestInfo(o,!0);this.Execute(i).then(function(r){if(r.data.error)return void t.toaster.pop("error","There was an error querying coordinated reach",r.data.error.message,0);if(r.data.features.length>0){var a=r.data.features[0].attributes;t.selectedStudyArea.CoordinatedReach=new e.Models.CoordinatedReach(a["eqWithStrID.BASIN_NAME"],a["eqWithStrID.DVA_EQ_ID"]),delete a["eqWithStrID.BASIN_NAME"],delete a["eqWithStrID.DVA_EQ_ID"];for(var o=Object.keys(a).map(function(e,t){return e.substr("eqWithStrID.".length+1)}).filter(function(e,t,r){return r.indexOf(e)===t}),i=0;i<o.length;i++){var n=o[i],s=a["eqWithStrID.a"+n],g=a["eqWithStrID.b"+n];null!=s&&null!=g&&t.selectedStudyArea.CoordinatedReach.AddFlowCoefficient("PK"+n,s,g)}t.toaster.pop("success","Selected reach is a coordinated reach","Please continue",5e3)}},function(e){t.toaster.pop("error","There was an HTTP error querying coordinated reach","Please retry",0)})},o.prototype.queryRegressionRegions=function(){var e=this;if(this.toaster.pop("wait","Querying regression regions with your Basin","Please wait...",0),this.regressionRegionQueryLoading=!0,this.regressionRegionQueryComplete=!1,"MO_STL"==this.selectedStudyArea.RegionID)return this.selectedStudyArea.RegressionRegions=[{name:"Peak_Urban_Statewide_SIR_2010_5073",code:"gc1486",percent:100,areasqmeter:-9999,
maskareasqmeter:-9999}],this.regressionRegionQueryComplete=!0,this.regressionRegionQueryLoading=!1,void this.toaster.pop("success","Regression regions were succcessfully queried","Please continue",5e3);var t=angular.toJson({type:"FeatureCollection",crs:{type:"ESPG",properties:{code:4326}},features:this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})},null),r=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.RegressionRegionQueryService,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",{geometry:t,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(t){return e.toaster.clear(),t.data.error?void e.toaster.pop("error","There was an error querying regression regions",t.data.error.message,0):0==t.data.length?(e.regressionRegionQueryComplete=!0,e.selectedStudyArea.RegressionRegions=t.data,void e.toaster.pop("error","No regression regions were returned","Regression based scenario computation not allowed",0)):void(t.data.length>0&&(e.regressionRegionQueryComplete=!0,t.data.forEach(function(e){e.code=e.code.toUpperCase().split(",")}),e.selectedStudyArea.RegressionRegions=t.data,e.toaster.pop("success","Regression regions were succcessfully queried","Please continue",5e3)))},function(t){return e.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",0),e.$q.reject(t.data)}).finally(function(){e.regressionRegionQueryLoading=!1})},o.prototype.queryKarst=function(e,t){var r=this;this.toaster.pop("wait","Querying for Karst Areas","Please wait...",0);var a;t.forEach(function(e){"ExcludePolys"==e[0]&&(a=e[1])}),this.regressionRegionQueryLoading=!0,this.regressionRegionQueryComplete=!1;var o='{"rings":'+angular.toJson(this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry.coordinates,null)+',"spatialReference":{"wkid":4326}}',i={where:"1=1",geometry:o,geometryType:"esriGeometryPolygon",inSR:4326,spatialRel:"esriSpatialRelIntersects",outFields:"*",returnGeometry:!1,outSR:4326,returnIdsOnly:!1,returnCountOnly:!1,returnZ:!1,returnM:!1,returnDistinctValues:!1,returnTrueCurves:!1,f:"json"},n=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers+"/"+a+"/query",s=new WiM.Services.Helpers.RequestInfo(n,!0,WiM.Services.Helpers.methodType.POST,"json",i,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(s).then(function(e){if(r.toaster.clear(),200==e.status){r.toaster.pop("success","Karst regions were succcessfully queried","Please continue",5e3);var t=!1;e.data.features.length>0&&(e.data.features.forEach(function(e){2==e.attributes.ExcludeCode&&(t=!0,r.toaster.pop("warning","Warning",e.attributes.ExcludeReason,0),r.selectedStudyArea.Disclaimers.hasKarst=e.attributes.ExcludeReason)}),t||r.toaster.pop("success","No Karst found","Please continue",5e3))}else r.toaster.pop("error","Error","Karst region query failed",0)},function(e){return r.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",0),r.$q.reject(e.data)}).finally(function(){r.regressionRegionQueryLoading=!1})},o.prototype.upstreamRegulation=function(){var e=this;this.toaster.pop("wait","Checking for Upstream Regulation","Please wait...",0),this.regulationCheckComplete=!1;var r=angular.toJson({type:"FeatureCollection",crs:{type:"ESPG",properties:{code:4326}},features:this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})},null),o=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.regulationService.format(this.selectedStudyArea.RegionID.toLowerCase()),i=new WiM.Services.Helpers.RequestInfo(o,!0,WiM.Services.Helpers.methodType.POST,"json",{watershed:r,outputcrs:4326,f:"geojson"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(i).then(function(r){if(e.selectedStudyArea.Disclaimers.regulationChecked=!0,r.data.percentarearegulated>0){e.toaster.clear(),e.toaster.pop("success","Map updated with Regulated Area","Continue to 'Modify Basin Characteristics' to see area-weighted basin characteristics",5e3);var o=e.reconfigureWatershedResponse(r.data.featurecollection);e.selectedStudyArea.FeatureCollection.features.push(o[0]),e.regulationCheckResults=r.data,e.selectedStudyArea.Disclaimers.isRegulated=!0,e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,a.Empty)}else e.selectedStudyArea.Disclaimers.isRegulated=!1,e.toaster.clear(),e.toaster.pop("warning","No regulation found","Please continue",5e3)},function(t){e.toaster.clear(),e.toaster.pop("error","Error Checking for Upstream Regulation","Please retry",0)}).finally(function(){e.regulationCheckComplete=!0})},o.prototype.reconfigureWatershedResponse=function(e){var t=[];return e.forEach(function(e){for(var r=0;r<e.feature.features.length;r++){var a={type:"Feature",geometry:e.feature.features[r].geometry,id:e.feature.features.length>1?e.name+"_"+e.feature.features[r].properties.Name.toLowerCase():e.name.toLowerCase(),properties:e.feature.features[r].properties};t.push(a)}}),t},o.prototype.loadParameterResults=function(e){var t=this.studyAreaParameterList;e.map(function(e){angular.forEach(t,function(t,r){if(e.code.toUpperCase().trim()===t.code.toUpperCase().trim())return t.value=e.value,void(t.loaded=e.loaded)})})},o.prototype.loadRegulatedParameterResults=function(e){this.toaster.pop("wait","Loading Regulated Basin Characteristics","Please wait...");var t=this.studyAreaParameterList;e.map(function(r){angular.forEach(t,function(a,o){if(r.code.toUpperCase().trim()===a.code.toUpperCase().trim()){switch(r.operation){case"Sum":a.unRegulatedValue=a.value-r.value;break;case"WeightedAverage":var i,n,s,g;angular.forEach(t,function(e,t){e.code==r.operationField&&(i=e.value)}),angular.forEach(e,function(e,t){e.code==r.operationField&&(n=e.value)}),s=r.value,g=a.value;var A=n*(s/i),C=g-A,I=i-n,c=C*(i/I);a.unRegulatedValue=c}return void(a.regulatedValue=r.value)}})})},o.prototype.onStudyAreaChanged=function(e,t){!this.selectedStudyArea||!this.selectedStudyArea.FeatureCollection||this.regressionRegionQueryComplete},o}(WiM.Services.HTTPServiceBase);r.$inject=["$http","$q","WiM.Event.EventManager","toaster"],angular.module("StreamStats.Services").factory("StreamStats.Services.StudyAreaService",r)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),StreamStats;!function(e){!function(t){"use strict";function r(e,t,r,a,o){return new i(e,t,r,a,o)}t.onSelectExplorationMethod="onSelectExplorationMethod",t.onSelectedMethodExecuteComplete="onSelectedMethodExecuteComplete";var a=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(WiM.Event.EventArgs);t.ExplorationServiceEventArgs=a;var o,i=function(r){function i(e,a,o,i,n){var s=r.call(this,e,configuration.baseurls.StreamStatsServices)||this;return s.$q=a,s.eventManager=i,s.regionservice=n,s.toaster=o,s.drawElevationProfile=!1,s.drawMeasurement=!1,s.showElevationChart=!1,s.measurementData="",s._selectedMethod=null,s.networkNavResults=[],i.AddEvent(t.onSelectedStudyAreaChanged),s.selectElevationPoints=!1,s.DEMresolution="30m",s}return __extends(i,r),Object.defineProperty(i.prototype,"selectedMethod",{get:function(){return this._selectedMethod},enumerable:!0,configurable:!0}),i.prototype.elevationProfile=function(e){var t=this,r={InputLineFeatures:e,returnZ:!0,DEMResolution:this.DEMresolution,f:"json",MaximumSampleDistance:null};this.samplingDistance&&(r.MaximumSampleDistance=this.samplingDistance);var a=new WiM.Services.Helpers.RequestInfo("https://elevation.arcgis.com/arcgis/rest/services/Tools/ElevationSync/GPServer/Profile/execute",!0,WiM.Services.Helpers.methodType.POST,"json",r,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(e){if(console.log("elevation profile response: ",e.data),e.data&&e.data.results){var r=e.data.results[0].value.features[0].geometry.paths[0];if(r.length>0){var a=angular.fromJson(angular.toJson(r)),o="feet";e.data.results[0].value.fields.forEach(function(e){"ProfileLength"==e.name&&"Length Meters"==e.alias&&(o="meters")}),(o="meters")&&(r=r.map(function(e){return[e[0],e[1],3.28084*e[2]]}));var i=0;t.coordinateList=[[r[0][1].toFixed(5),r[0][0].toFixed(5),r[0][2].toFixed(2),i.toFixed(2)]];for(var n=1;n<r.length;n++){var s=L.latLng(r[n-1][1],r[n-1][0]),g=L.latLng(r[n][1],r[n][0]);i+=s.distanceTo(g),t.coordinateList.push([r[n][1].toFixed(5),r[n][0].toFixed(5),r[n][2].toFixed(2),(621371e-9*i).toFixed(2)])}t.elevationProfileGeoJSON={name:"NewFeatureType",type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:a},properties:""}]}}}else console.error("There was a zero length response from the elevation service"),t.toaster.clear(),t.toaster.pop("error","Error","No elevation results are available here",0)},function(e){console.error("There was an error requestion the elevation service"),t.toaster.clear(),t.toaster.pop("error","Error processing request","Please try again",0)}).finally(function(){})},i.prototype.getNavigationEndPoints=function(){var e=this,r=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices,o=new WiM.Services.Helpers.RequestInfo(r,!0);this.Execute(o).then(function(t){var r=t.data;e.navigationResources=r},function(r){e.toaster.pop("error","Error processing request","Please try again",0),e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,a.Empty)}).finally(function(){})},i.prototype.getNavigationConfiguration=function(e){var r=this,o=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices+"/"+e,i=new WiM.Services.Helpers.RequestInfo(o,!0);this.Execute(i).then(function(t){var a=t.data;console.log("navigation config:",a),r.setMethod(e,a)},function(e){r.toaster.pop("error","Error processing request","Please try again",0),r.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,r,a.Empty)}).finally(function(){})},i.prototype.getCountByType=function(e,t){return e.filter(function(e){return e.valueType.toLowerCase().indexOf(t)>=0}).length},i.prototype.setMethod=function(r,i){null!=this._selectedMethod&&r===this._selectedMethod.navigationID&&(r=o.undefined),this._selectedMethod=new e.Models.NetworkNav(r,i),this.eventManager.RaiseEvent(t.onSelectExplorationMethod,this,a.Empty)},i.prototype.ExecuteSelectedModel=function(){var e=this;console.log("selected method:",this.selectedMethod);var r=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices+"/"+this.selectedMethod.navigationInfo.code+"/route";console.log("url: ",r);var o=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(this.selectedMethod.navigationConfiguration));this.Execute(o).then(function(r){var o=r.data;console.log("successfull navigation request results:",o);var i={feature:{features:[],type:"FeatureCollection"},name:"netnavroute"},n={feature:{features:[],type:"FeatureCollection"},name:"netnavpoints"};o.features.forEach(function(e,t){"Point"==e.geometry.type?n.feature.features.push(e):i.feature.features.push(e)}),i.feature.features.length>0&&e.networkNavResults.push(i),n.feature.features.length>0&&e.networkNavResults.push(n);var s=new a;s.features="FeatureCollection"===o.type?o:null,s.report="Report"==o.type?o:null,e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,s)},function(r){e.toaster.pop("error","Error processing request","Please try again",0),e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,a.Empty)}).finally(function(){})},i}(WiM.Services.HTTPServiceBase);!function(e){e[e.undefined=0]="undefined",e[e.FLOWPATH=1]="FLOWPATH",e[e.NETWORKPATH=2]="NETWORKPATH",e[e.NETWORKTRACE=3]="NETWORKTRACE"}(o=t.ExplorationMethodType||(t.ExplorationMethodType={})),r.$inject=["$http","$q","toaster","WiM.Event.EventManager","StreamStats.Services.RegionService"],angular.module("StreamStats.Services").factory("StreamStats.Services.ExplorationService",r)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){!function(e){"use strict";function t(e){return new a(e)}var r,a=function(){function e(e){this.modal=e}return e.prototype.openModal=function(e,t){void 0===t&&(t=null),t&&(this.modalOptions=t),this.modal.open(this.getModalSettings(e))},e.prototype.getModalSettings=function(e){try{switch(e){case r.e_exploration:return{templateUrl:"Views/explorationview.html",controller:"StreamStats.Controllers.ExplorationToolsModalController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case r.e_report:return{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController",size:"lg",backdropClass:"backdropZ",windowClass:"windowZ"};case r.e_wateruse:return{templateUrl:"Views/wateruse.html",controller:"StreamStats.Controllers.WateruseController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case r.e_stormrunnoff:return{templateUrl:"Views/stormrunoff.html",controller:"StreamStats.Controllers.StormRunoffController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case r.e_about:return{templateUrl:"Views/about.html",controller:"StreamStats.Controllers.AboutController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case r.e_help:return{templateUrl:"Views/help.html",controller:"StreamStats.Controllers.HelpController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case r.e_navreport:return{templateUrl:"Views/navreportmodal.html",controller:"StreamStats.Controllers.NavigationReportModalController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};default:return null}}catch(e){return null}},e}();!function(e){e[e.e_report=1]="e_report",e[e.e_wateruse=2]="e_wateruse",e[e.e_about=3]="e_about",e[e.e_help=4]="e_help",e[e.e_navreport=5]="e_navreport",e[e.e_exploration=6]="e_exploration",e[e.e_stormrunnoff=7]="e_stormrunnoff"}(r=e.SSModalType||(e.SSModalType={})),t.$inject=["$modal"],angular.module("StreamStats.Services").factory("StreamStats.Services.ModalService",t)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Controllers",[])}();var StreamStats;!function(e){!function(t){"use strict";var r=function(){function e(){this.lat=0,this.lng=0}return e}(),a=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),o=function(){function e(e,t,r,a,o){void 0===o&&(o=void 0),this.name=e,this.url=t,this.type=r,this.visible=a,this.layerOptions=o}return e}(),i=function(){function e(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=!0),this.maxZoom=e,this.minZoom=t,this.zoomControl=r}return e}(),n=function(){function t(t,r,a,o,i,n,s,g,A,C,I,c,l,u,d){var p=this;this.$scope=t,this.modal=u,this.modalStack=d,this.center=null,this.layers=null,this.mapDefaults=null,this.mapPoint=null,this.bounds=null,this.markers=null,this.paths=null,this.geojson=null,this.events=null,this.layercontrol=null,this.regionLayer=null,this.explorationToolsExpanded=!1,t.vm=this,this.toaster=r,this.angulartics=a,this.searchService=g,this.$locationService=o,this.regionServices=A,this.leafletBoundsHelperService=n,this.leafletData=s,this.studyArea=C,this.nssService=I,this.explorationService=c,this.eventManager=l,this.cursorStyle="pointer",this.environment=configuration.environment,this.selectedExplorationTool=null,this.init(),this.eventManager.SubscribeToEvent(e.Services.onSelectedStudyAreaChanged,new WiM.Event.EventHandler(function(){p.onSelectedStudyAreaChanged()})),this.eventManager.SubscribeToEvent(WiM.Directives.onLayerChanged,new WiM.Event.EventHandler(function(e,t){p.onLayerChanged(e,t)})),this.eventManager.SubscribeToEvent(WiM.Services.onSelectedAreaOfInterestChanged,new WiM.Event.EventHandler(function(e,t){p.onSelectedAreaOfInterestChanged(e,t)})),this.eventManager.SubscribeToEvent(e.Services.onSelectedRegionChanged,new WiM.Event.EventHandler(function(){p.onSelectedRegionChanged()})),this.eventManager.SubscribeToEvent(e.Services.onEditClick,new WiM.Event.EventHandler(function(e,t){p.basinEditor()})),this.eventManager.SubscribeToEvent(e.Services.onStudyAreaReset,new WiM.Event.EventHandler(function(){p.removeGeoJson()})),this.eventManager.SubscribeToEvent(e.Services.onSelectedMethodExecuteComplete,new WiM.Event.EventHandler(function(e,t){p.onExplorationMethodComplete(e,t)})),this.eventManager.SubscribeToEvent(e.Services.onSelectExplorationMethod,new WiM.Event.EventHandler(function(e,t){0!=e.selectedMethod.navigationID&&p.onSelectExplorationMethod(e,t),0==e.selectedMethod.navigationID&&(p.selectedExplorationTool=null)})),t.$on("leafletDirectiveMap.mainMap.mousemove",function(e,t){var r=t.leafletEvent.latlng;p.mapPoint.lat=r.lat,p.mapPoint.lng=r.lng,p.studyArea.doDelineateFlag&&(p.cursorStyle="crosshair")}),t.$on("leafletDirectiveMap.mainMap.drag",function(e,t){p.cursorStyle="grabbing"}),t.$on("leafletDirectiveMap.mainMap.dragend",function(e,t){p.cursorStyle="pointer"}),t.$on("leafletDirectiveMap.mainMap.click",function(t,r){if(p.studyArea.doDelineateFlag)return void p.checkDelineatePoint(r.leafletEvent.latlng);if(!p.studyArea.showEditToolbar&&!p.explorationService.drawMeasurement&&!p.explorationService.drawElevationProfile)if(null!=c.selectedMethod&&c.selectedMethod.locations.length<=c.selectedMethod.minLocations){console.log("in mapcontroller add point",c.selectedMethod.navigationPointCount,c.selectedMethod.locations.length),"Start point location"==c.explorationPointType&&c.selectedMethod.addLocation("Start point location",new WiM.Models.Point(r.leafletEvent.latlng.lat,r.leafletEvent.latlng.lng,"4326")),"End point location"==c.explorationPointType&&c.selectedMethod.addLocation("End point location",new WiM.Models.Point(r.leafletEvent.latlng.lat,r.leafletEvent.latlng.lng,"4326"));for(var a=0;a<c.selectedMethod.locations.length;a++){var o=c.selectedMethod.locations[a];p.markers["netnav_"+a]={lat:o.Latitude,lng:o.Longitude,message:c.selectedMethod.navigationName,focus:!0,draggable:!1}}p.modal.openModal(e.Services.SSModalType.e_exploration)}else p.queryPoints(r.leafletEvent)}),t.$watch(function(){return p.bounds},function(e,t){return p.mapBoundsChange(t,e)}),t.$watch(function(){return p.explorationService.elevationProfileGeoJSON},function(e,t){e&&p.displayElevationProfile()}),t.$watch(function(){return p.explorationService.drawElevationProfile},function(t,r){t&&p.modal.openModal(e.Services.SSModalType.e_exploration)}),t.$watch(function(){return p.explorationService.selectElevationPoints},function(e,t){e&&p.elevationProfile()}),t.$watch(function(){return p.explorationService.drawMeasurement},function(e,t){e&&p.measurement()}),t.$watch(function(){return p.regionServices.regionMapLayerListLoaded},function(e,t){e&&p.addRegionOverlayLayers(p.regionServices.selectedRegion.RegionID)}),t.$on("$locationChangeStart",function(){return p.updateRegion()}),i.rcode&&(this.regionServices.loadParametersByRegion(),this.setBoundsByRegion(i.rcode)),i.rcode&&i.workspaceID&&(this.regionServices.loadParametersByRegion(),this.studyArea.loadWatershed(i.rcode,i.workspaceID)),t.$watch(function(){return p.studyArea.regressionRegionQueryComplete},function(e,t){e&&p.studyArea.selectedStudyArea.RegressionRegions&&p.nssService.loadStatisticsGroupTypes(p.regionServices.selectedRegion.RegionID,p.studyArea.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","))})}return Object.defineProperty(t.prototype,"selectedExplorationMethodType",{get:function(){return null==this.explorationService.selectedMethod?0:this.explorationService.selectedMethod.navigationID},set:function(e){this.explorationService.setMethod(e,{})},enumerable:!0,configurable:!0}),t.prototype.setExplorationMethodType=function(e){this.removeGeoJsonLayers("netnav_",!0),this.explorationService.getNavigationConfiguration(e)},t.prototype.ExecuteNav=function(){if(this.explorationService.selectedMethod.locations.length!=this.explorationService.selectedMethod.minLocations)return void this.toaster.pop("warning","Warning","You must select at least "+this.explorationService.selectedMethod.minLocations+" points.",1e4);this.explorationService.explorationMethodBusy=!0,this.explorationService.ExecuteSelectedModel()},t.prototype.init=function(){this.setupMap(),this.explorationService.getNavigationEndPoints()},t.prototype.setupMap=function(){this.center=new a(39,-100,4),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers},this.mapDefaults=new i(null,3,!0),this.markers={},this.paths={},this.geojson={},this.regionLayer={};var e=600;$(window).width()<768&&(e=.7*$(window).width()),this.controls={scale:!0,draw:{draw:{polygon:!1,polyline:!1,rectangle:!1,circle:!1,circlemarker:!1,marker:!1}},custom:new Array(L.control.locate({follow:!1,locateOptions:{maxZoom:15}}),L.control.elevation({imperial:!0,width:e}))},this.events={map:{enable:["mousemove"]}},this.mapPoint=new r,L.Icon.Default.imagePath="images"},t.prototype.scaleLookup=function(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}},t.prototype.queryPoints=function(e){var t=this;this.toaster.pop("wait","Information","Querying Points...",0),this.cursorStyle="wait",this.markers={},this.angulartics.eventTrack("explorationTools",{category:"Map",label:"queryPoints"}),this.leafletData.getMap("mainMap").then(function(r){t.leafletData.getLayers("mainMap").then(function(a){if(r.getZoom()<=8)return t.cursorStyle="pointer",t.toaster.clear(),void t.toaster.pop("warning","Warning","You must be at Zoom Level 9 or greater to query points",5e3);var o=$("<div>").attr("id","popupContent"),i=0;t.regionServices.selectedRegion&&a.overlays[t.regionServices.selectedRegion.RegionID+"_region"].identify().on(r).at(e.latlng).returnGeometry(!1).tolerance(5).run(function(a,n){var s=$("<div>").attr("id","regionLayers").appendTo(o);t.toaster.clear(),t.cursorStyle="pointer",n.features.forEach(function(a){t.layers.overlays[t.regionServices.selectedRegion.RegionID+"_region"].layerArray.forEach(function(n){if(n.layerId===a.layerId){var g=n.layerName;"Bridge"===g&&(i+=1,s.append("<h5>"+g+"</h5>"),angular.forEach(a.properties,function(e,t){s.append("<strong>"+t+": </strong>"+e+"</br>")}))}i>0?(r.openPopup(o.html(),[e.latlng.lat,e.latlng.lng],{maxHeight:200}),t.toaster.clear()):t.toaster.pop("warning","Information","No points were found at this location",5e3)})})}),a.overlays.SSLayer.identify().on(r).at(e.latlng).returnGeometry(!1).tolerance(5).run(function(a,n){var s=$("<div>").attr("id","nationalLayers").appendTo(o);t.toaster.clear(),t.cursorStyle="pointer",n.features.forEach(function(a){var n;if(t.layers.overlays.SSLayer.layerArray.forEach(function(e){e.layerId===a.layerId&&(n=e.layerName)}),"Streamgages"===n){i+=1;var g=[{name:"sta_id",label:"Station ID"},{name:"sta_name",label:"Station Name"},{name:"latitude",label:"Latitude"},{name:"longitude",label:"Longitude"},{name:"featureurl",label:"URL"}];s.append("<h5>"+n+"</h5>"),angular.forEach(g,function(e,t){angular.forEach(a.properties,function(t,r){if(e.name===r)if("featureurl"==r){var a=t.split("site_no=")[1],o="https://streamstatsags.cr.usgs.gov/gagepages/html/"+a+".htm";s.append('<strong>NWIS page: </strong><a href="'+t+' "target="_blank">link</a></br><strong>StreamStats Gage page: </strong><a href="'+o+'" target="_blank">link</a></br>')}else s.append("<strong>"+e.label+": </strong>"+t+"</br>")})})}i>0?(r.openPopup(o.html(),[e.latlng.lat,e.latlng.lng],{maxHeight:200}),t.toaster.clear()):t.toaster.pop("warning","Information","No points were found at this location",5e3)})})})})},t.prototype.elevationProfile=function(){var e=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.measurementData="",this.explorationService.showElevationChart=!0;var t;this.controls.custom.forEach(function(e){e._container.className.indexOf("elevation")>-1&&(t=e)}),this.angulartics.eventTrack("explorationTools",{category:"Map",label:"elevationProfile"}),this.leafletData.getMap("mainMap").then(function(r){e.leafletData.getLayers("mainMap").then(function(a){a.overlays.draw.clearLayers(),e.drawController({metric:!1},!0),delete e.geojson.elevationProfileLine3D,r.on("draw:drawstart",function(e){t.clear()}),r.on("draw:created",function(t){r.removeEventListener("draw:created");var a=t.layer.toGeoJSON(),o='{"geometryType":"esriGeometryPolyline","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polyline", "paths":['+JSON.stringify(a.geometry.coordinates)+"]}}]}";e.toaster.pop("wait","Information","Querying the elevation service...",0),e.explorationService.elevationProfile(o),e.explorationService.drawElevationProfile=!1,r.panBy([0,1])})})})},t.prototype.drawController=function(e,t){var r=this;if(!t)return this.drawControl.disable(),void(this.drawControl=void 0);this.leafletData.getMap("mainMap").then(function(t){r.drawControl=new L.Draw.Polyline(t,e),r.drawControl.enable()})},t.prototype.displayElevationProfile=function(){var t,r=this;this.controls.custom.forEach(function(e){e._container&&e._container.className.indexOf("elevation")>-1&&(t=e)}),this.geojson.elevationProfileLine3D={data:this.explorationService.elevationProfileGeoJSON,style:{color:"#ff7800",weight:5,opacity:.65},onEachFeature:t.addData.bind(t)},this.leafletData.getMap("mainMap").then(function(a){var o=t.onAdd(a);r.explorationService.elevationProfileHTML=o.innerHTML,r.modal.openModal(e.Services.SSModalType.e_exploration),delete r.geojson.elevationProfileLine3D}),this.toaster.clear(),this.cursorStyle="pointer",this.selectedExplorationTool=null},t.prototype.showLocation=function(){var e=this;this.angulartics.eventTrack("explorationTools",{category:"Map",label:"showLocation"});var t;this.controls.custom.forEach(function(e){e._container.className.indexOf("leaflet-control-locate")>-1&&(t=e)}),t.start(),this.leafletData.getMap("mainMap").then(function(t){t.on("locationfound",function(){e.selectedExplorationTool=null})})},t.prototype.resetExplorationTools=function(){var e=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.elevationProfileHTML="",this.drawControl&&this.drawController({},!1),this.explorationService.measurementData="",this.explorationService.drawElevationProfile=!1,this.explorationService.drawMeasurement=!1,this.explorationService.selectElevationPoints=!1,delete this.geojson.elevationProfileLine3D,this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(r){r.overlays.draw.clearLayers(),e.measurestart&&t.off("click",e.measurestart),e.measuremove&&t.off("mousemove",e.measuremove),e.measurestop&&t.off("draw:created",e.measurestop)})}),this.explorationService.networkNavResults=[],this.selectedExplorationMethodType=0,this.removeMarkerLayers("netnav_",!0),this.removeGeoJsonLayers("netnavpoints",!0),this.removeGeoJsonLayers("netnavroute",!0),this.selectedExplorationTool=null,this.explorationService.explorationPointType=null},t.prototype.measurement=function(){var e=this;this.explorationService.measurementData="Click the map to begin\nDouble click to end the Drawing",this.angulartics.eventTrack("explorationTools",{category:"Map",label:"measurement"}),this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(r){var a=!1;e.drawController({shapeOptions:{color:"blue"},metric:!1},!0);var o=r.overlays.draw;o.clearLayers(),e.measuremove=function(){e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString()},e.measurestart=function(){0==a&&(a=!0,e.explorationService.measurementData="Total Length: ",t.on("mousemove",e.measuremove))},e.measurestop=function(r){var a=r.layer;o.addLayer(a),o.addTo(t);var i=null,n=0;$.each(r.layer._latlngs,function(e,t){if(null==i)return void(i=t);n+=i.distanceTo(t),i=t}),e.explorationService.measurementData="Total length: "+(3.28084*n).toFixed(0)+" ft",t.off("click",e.measurestart),t.off("mousemove",e.measuremove),t.off("draw:created",e.measurestop),e.drawControl.disable(),e.explorationService.drawMeasurement=!1,e.selectedExplorationTool=null},t.on("click",e.measurestart),t.on("draw:created",e.measurestop)})})},t.prototype.checkDelineatePoint=function(e){var t=this;this.leafletData.getMap("mainMap").then(function(r){t.leafletData.getLayers("mainMap").then(function(a){if(r.getZoom()<15)t.toaster.pop("error","Delineation not allowed at this zoom level","Please zoom in to level 15 or greater",5e3);else{t.toaster.clear(),t.studyArea.checkingDelineatedPoint=!0,t.toaster.pop("info","Information","Validating your clicked point...",!0,0),t.cursorStyle="wait",t.markers={},t.markers.pourpoint={lat:e.lat,lng:e.lng,message:"Your clicked point</br></br><strong>Latitude: </strong>"+e.lat.toFixed(5)+"</br><strong>Longitude: </strong>"+e.lng.toFixed(5),focus:!0,draggable:!0},t.studyArea.doDelineateFlag=!1;var o="visible:";t.regionServices.regionMapLayerList.forEach(function(e){"ExcludePolys"==e[0]&&(o+=e[1])}),t.angulartics.eventTrack("delineationClick",{category:"Map",label:t.regionServices.selectedRegion.Name}),r.invalidateSize();var i=t.regionServices.selectedRegion.RegionID+"_region";if("visible:"===o)return t.toaster.clear(),t.toaster.pop("warning","Selected State/Region does not have exlusion areas defined","Delineating with no exclude polygon layer...",!0,0),t.startDelineate(e,!0),t.angulartics.eventTrack("validatePoint",{category:"Map",label:"not advised (no point query)"}),void(t.cursorStyle="pointer");a.overlays[i].identify().on(r).at(e).returnGeometry(!1).layers(o).run(function(r,a){if(t.toaster.clear(),0==a.features.length)t.angulartics.eventTrack("validatePoint",{category:"Map",label:"valid"}),t.toaster.pop("success","Your clicked point is valid","Delineating your basin now...",5e3),t.studyArea.checkingDelineatedPoint=!1,t.startDelineate(e,!1);else{t.studyArea.checkingDelineatedPoint=!1;var o=a.features[0].properties.ExcludeCod,i=a.features[0].properties.ExcludeRea;1==o?(t.toaster.pop("error","Delineation and flow statistic computation not allowed here",i,0),t.angulartics.eventTrack("validatePoint",{category:"Map",label:"not allowed"})):(t.toaster.pop("warning","Delineation and flow statistic computation possible but not advised",i,!0,0),t.startDelineate(e,!0,i),t.angulartics.eventTrack("validatePoint",{category:"Map",label:"not advised"}))}t.cursorStyle="pointer"})}})})},t.prototype.basinEditor=function(){var e=this,t=angular.fromJson(angular.toJson(this.geojson.globalwatershed.data.features[0])),r=[];t.geometry.coordinates[0].forEach(function(e){r.push([e[1],e[0]])}),this.leafletData.getMap("mainMap").then(function(a){e.leafletData.getLayers("mainMap").then(function(o){var i=o.overlays.draw;i.clearLayers(),new L.Draw.Polygon(a,i).enable(),a.on("draw:created",function(o){a.removeEventListener("draw:created");var n=o.layer;i.addLayer(n)
;var s=n.toGeoJSON().geometry.coordinates[0],g=[];s.forEach(function(e){g.push([e[1],e[0]])});var A=L.polygon(r),C=L.polygon(g);if("add"==e.studyArea.drawControlOption){e.angulartics.eventTrack("basinEditor",{category:"Map",label:"addArea"});var I=greinerHormann.union(A,C);e.studyArea.WatershedEditDecisionList.append.push(n.toGeoJSON())}if("remove"==e.studyArea.drawControlOption){e.angulartics.eventTrack("basinEditor",{category:"Map",label:"removeArea"});var I=greinerHormann.diff(A,C);if(2==I.length)return alert("Splitting polygons is not permitted"),void i.clearLayers();e.studyArea.WatershedEditDecisionList.remove.push(n.toGeoJSON())}t.geometry.coordinates[0]=[],I.forEach(function(e){t.geometry.coordinates[0].push([e[1],e[0]])}),e.geojson.globalwatershed.data.features[0]=t,i.clearLayers()})})})},t.prototype.canSelectExplorationTool=function(t){switch(t){case e.Services.ExplorationMethodType.NETWORKPATH:case e.Services.ExplorationMethodType.FLOWPATH:case e.Services.ExplorationMethodType.NETWORKTRACE:break;default:return!1}return!0},t.prototype.onExplorationMethodComplete=function(t,r){var a=this;this.angulartics.eventTrack("explorationTools",{category:"Map",label:"networknav-"+this.explorationService.selectedMethod.navigationInfo.code}),this.explorationService.explorationMethodBusy=!1,null!=r.features&&r.features.features.length>0&&(this.removeMarkerLayers("netnav_",!0),this.explorationService.networkNavResults.forEach(function(e,t){a.addGeoJSON(e.name,e.feature),"netnavroute"==e.name&&a.leafletData.getMap("mainMap").then(function(t){var r=L.geoJson(e.feature);t.fitBounds(r.getBounds())}),a.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,a,new WiM.Directives.LegendLayerAddedEventArgs(e.name,"geojson",a.geojson[e.name].style))}),this.selectedExplorationMethodType=0,this.selectedExplorationTool=null,this.modalStack.dismissAll()),null!=r.report&&""!=r.report&&this.modal.openModal(e.Services.SSModalType.e_navreport,{placeholder:r.report})},t.prototype.onSelectExplorationMethod=function(t,r){this.modal.openModal(e.Services.SSModalType.e_exploration)},t.prototype.onSelectedAreaOfInterestChanged=function(e,t){this.angulartics.eventTrack("Search",{category:"Sidebar"}),this.paths={};var r=t.selectedAreaOfInterest;this.paths.AOI={type:"circleMarker",radius:15,color:"#ff0000",fillOpacity:.6,stroke:!1,latlngs:{lat:r.properties.Lat,lng:r.properties.Lon}},this.leafletData.getMap("mainMap").then(function(e){e.fitBounds([[r.properties.LatMin,r.properties.LonMin],[r.properties.LatMax,r.properties.LonMax]]),setTimeout(function(){e.getZoom()<8&&e.setZoom(8)},500),e.openPopup($.map(Object.keys(r.properties),function(e){if(-1!=["Label","ElevFt","Lat","Lon","Source"].indexOf(e))return"<b>"+e+": </b>"+r.properties[e]}).join("<br/>"),[r.properties.Lat,r.properties.Lon])})},t.prototype.onSelectedRegionChanged=function(){this.regionServices.selectedRegion&&(this.removeOverlayLayers("_region",!0),this.regionServices.loadMapLayersByRegion(this.regionServices.selectedRegion.RegionID))},t.prototype.onSelectedStudyAreaChanged=function(){var e,t=this;if(this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.FeatureCollection&&(this.markers={},this.removeOverlayLayers("globalwatershed",!0),this.studyArea.selectedStudyArea.FeatureCollection.features.forEach(function(e){var r=angular.fromJson(angular.toJson(e)),a=r.id.toLowerCase();t.addGeoJSON(a,r),t.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,t,new WiM.Directives.LegendLayerAddedEventArgs(a,"geojson",t.geojson[a].style))}),this.studyArea.selectedStudyArea.FeatureCollection.bbox&&(e=this.studyArea.selectedStudyArea.FeatureCollection.bbox,this.leafletData.getMap("mainMap").then(function(t){t.fitBounds([[e[1],e[0]],[e[3],e[2]]],{})})),this.regionServices.selectedRegion.Applications.indexOf("KarstCheck")>-1&&this.studyArea.queryKarst(this.regionServices.selectedRegion.RegionID,this.regionServices.regionMapLayerList),!this.nssService.queriedRegions)){if(!this.regionServices.selectedRegion.ScenariosAvailable)return void(this.studyArea.regressionRegionQueryComplete=!0);this.nssService.queriedRegions=!0}},t.prototype.removeGeoJson=function(e){void 0===e&&(e="");for(var t in this.geojson)"function"!=typeof this.geojson[t]&&(delete this.geojson[t],this.eventManager.RaiseEvent(WiM.Directives.onLayerRemoved,this,new WiM.Directives.LegendLayerRemovedEventArgs(t,"geojson")))},t.prototype.addGeoJSON=function(e,t){if("globalwatershed"==e)this.geojson[e]={data:t,style:{displayName:"Basin Boundary",imagesrc:"data:image/png;base64,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",fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}};else if("globalwatershedpoint"==e){var r=this.studyArea.selectedStudyArea.Pourpoint.Latitude,a=this.studyArea.selectedStudyArea.Pourpoint.Longitude,o=this.studyArea.selectedStudyArea.RegionID,i=this.studyArea.selectedStudyArea.WorkspaceID;this.geojson[e]={data:t,onEachFeature:function(e,t){var n="<strong>Latitude: </strong>"+r+"</br><strong>Longitude: </strong>"+a+"</br><strong>Region: </strong>"+o+"</br><strong>WorkspaceID: </strong>"+i+"</br>";angular.forEach(e.properties,function(e,t){n+="<strong>"+t+": </strong>"+e+"</br>"}),t.bindPopup(n)},style:{displayName:"Basin Clicked Point",imagesrc:"data:image/png;base64,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",visible:!0}}}else"regulatedWatershed"==e?this.geojson[e]={data:t,style:{displayName:"Basin Boundary (Regulated Area)",imagesrc:"data:image/png;base64,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",fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}}:-1!=e.indexOf("netnavpoints")?this.geojson[e]={data:t,onEachFeature:function(e,t){var r="<strong>Network navigation start/end point</strong></br>";angular.forEach(e.properties,function(e,t){r+="<strong>"+t+": </strong>"+e+"</br>"}),t.bindPopup(r)},pointToLayer:function(e,t){var r="wmm-pin wmm-mutedblue wmm-icon-noicon wmm-icon-black wmm-size-25";"ss_gages"==e.properties.source&&(r="wmm-pin wmm-blue wmm-icon-triangle wmm-icon-black wmm-size-25"),"WQP"==e.properties.source&&(r="wmm-pin wmm-sky wmm-icon-square wmm-icon-black wmm-size-25");var a=L.divIcon({className:r});return L.marker(t,{icon:a})},style:{displayName:"Network navigation point",
imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAlCAYAAAC+uuLPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAA57GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoV2luZG93cyk8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMTgtMDEtMzBUMTU6NTk6NDgtMDU6MDA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxOC0wMS0zMVQxMTowMDoyMC0wNTowMDwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXA6TWV0YWRhdGFEYXRlPjIwMTgtMDEtMzFUMTE6MDA6MjAtMDU6MDA8L3htcDpNZXRhZGF0YURhdGU+CiAgICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2UvcG5nPC9kYzpmb3JtYXQ+CiAgICAgICAgIDxwaG90b3Nob3A6Q29sb3JNb2RlPjM8L3Bob3Rvc2hvcDpDb2xvck1vZGU+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnhtcC5paWQ6M2FkNDgxMTctYjA3Mi05NjQ4LTk5MmYtZmIyZTgzNTcwOTkxPC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD5hZG9iZTpkb2NpZDpwaG90b3Nob3A6ZDZiMzhiZmUtMDY5Zi0xMWU4LTk2OTAtOGIzNWZmM2I1YzJjPC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06T3JpZ2luYWxEb2N1bWVudElEPnhtcC5kaWQ6NDQ0OTVjNjYtY2JjZS04ZDQyLWFhYmUtYjJmZTM4MjRmYWI3PC94bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpIaXN0b3J5PgogICAgICAgICAgICA8cmRmOlNlcT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y3JlYXRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOjQ0NDk1YzY2LWNiY2UtOGQ0Mi1hYWJlLWIyZmUzODI0ZmFiNzwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxOC0wMS0zMFQxNTo1OTo0OC0wNTowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDozYWQ0ODExNy1iMDcyLTk2NDgtOTkyZi1mYjJlODM1NzA5OTE8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTgtMDEtMzFUMTE6MDA6MjAtMDU6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChXaW5kb3dzKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj45NjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjk2MDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT42NTUzNTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+Mjk8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+Mzc8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pj4hpkQAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2xJREFUeNrs181rI3Ucx/H3b2YyD8mkMZslSZOsaVfsXpaFlYLg3jwvgl4XRVGPXZ8FRawXQQVXlD3pQegee+tfIQiFZV1auw9tau3zQ9KkM5OZyfw81JV1aZNMCiq43/Mwr9985/f9zG+ElJJ/uhT+hfr/oFq/F07PzMj7tWU2t7dwHBdVU0nbaYbzea6++YaIg4peG+n7qSk5e+sX6o0GrucRBAGdKEIIgaqq6IkESctiuJDnufFxXrp8WZwI/fSLL+XthQUOHIdei9M0jbSd4pnz5/lwYkIMhL4/OSkX7i/S9n2EomAPDZErFknZaSzbJooimvU6rUaDxu4OTrMJgGWajF+4wCfvvStioR9Mfibn7t0lCEIM06JYrVKqjmBYJqqqoagqSEkYhnQ6Ic5+k5XFe2yurBBFEaZh8OzFi3z8ztuiL/Tza9/In2Zn8YOAoewpqmPnyBUK6IYB4ujFR1FE23VYW66xfOcOvueRtCyev3SJiSM22d9G5sb0tPz55k38ICBp25RGRsmXy+imeSwIoCgKVsqmVB2lNDKKoig4rsut+fnec3p7fh7X89ASCU4XhymcqaBqfU8VhmWRL5XJ5vMArK6v89X167IrenepBoCdyZCvVDAMM9bQCyEYymYpVs6gmyZBGLK6vtH9SVsHBwAk7TSZ3OmuLT221apKKpPBzmQAqO83uqNSSrREAjOZRFXVgWMukdAxTAsAx3F7Z6+iqmha4kTZqmoaCV0HIOiEvVEpJVEUnTDS5V8JpiB6o6Hv0/bcE5GBH+D/eQ/d0LujQgiklATtNr7nDYy2PZeDZutwElKp7uhw4XC+9vf22FpbHQj0220aOzs4rcMszj2R7Y6OnX0KANc5YGPlNxq7O/HeZBSxt7XJ+nKNqNNhKG3z9NnR7uhHb10VpWIRGUXUt3dYq9VitblZr7O6tITTOmxttVLh9StXRF9fmRdffU06rotumpRHRqmOnTvM3y61v7fL4twc2+trdMKQJ8tlfrj2dX9fmQf1wsuvyLbv9wU/CpYKBX787lsR+2A2c2NKGLqO73n8vrRIbeHXI1sdF+x5GuwFDwL2dTA7rtWe6wwE9o0+CmdO5QDY3dyIDcZCH4YVVUUAnU4nNhgbfRgGBgIHQh/AuWx2IHBg9PFf22P0P4H+MQCyncndp+2ZGQAAAABJRU5ErkJggg==",visible:!0}}:this.geojson[e]="netnavroute"==e?{data:t,visible:!0,style:{displayName:"Network navigation route",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA2CAYAAACMRWrdAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAVaSURBVGhDzZr5VxpXFMf7n7ZpkqZLmqbRaIxaEzWyzIjghhtuQBQNuKMii0vSnqZb2qZNm66iwfavuL33jVbEOzBvmBn44XOOHD3P+TD3vXu/MG95MsdQL3h38rDgjsLu9fvw9O07hll6MAb9Sz9eWKuuxGaCSch8+IC9eD1Stx7B4OK3l9aqGzHf+q+w2jYM++82sQIcB+80QNSfAF/yt0vr1Y1Y1B+H7I12vOCGSwJ6rLX0w+CT78CbPrq0Xl2IBR9/CVt3vHgHGlkBjtyNNpiYzIGS+ptds+ZivZt/QOLhBOxdvccK6DGvzEEfli+3JlFzsdmhtdMDw3gJbjaqMBz7Ckswz65J1FSM9keyySdVgntXm2FqdBvUrb/YNc+omZiSOoTFnlnYvdbCCugR75qEwPJP7JrF1EwsFMrCzsfdcCBRgvT3I5HPRSPn1iymJmL+lZ9h7f4A7F+5ywpwHFxphPDAqjhsuDVLcVyMes68GoPce62sgB4r2LwH4t+Dh+lZHI6LjYafwfZtt9SBkX2/Hcan98S+5NbkcFSsN/k7LHeM4tjUzAroMYd32Lf+ml1TD0fFwgMrkP3gM7xY4wfGRlMfDC18w45N5XBMbCj2NSSxscqU4O71FpicSIOyXb5ncTgiRhcW756CvWtyY9OiKwz+1VfsmpVwRGxqLAXpm514scZLkA4YGo6N9CwO28UCyy9h/V5AqmfR384Mb+DYZKxncdgqRhs+5n0Mu5I9a6njNOpLHhjF2Co2PrMPqU96RNLlBDjSHz2EsdmnWILGexaHbWIU9VfarYv6stgmJqI+TgxWRX1ZbBELzmHUb5CL+rQPaeLXi/qyWC6mbv0JiU75qB/zRKFv7Rd2TTNYLkafDdIBIBX1GxQYnn9eNurLYqnYQPwFbDT3YXYy3rMo6k+Pbok7za1pFsvEzEb9RGfIUNSXxTKx0CRG/VtyUZ/GrNHIs6p7FoclYv61Vxj1B6WjfqR/WWQ0bs1qsURsrndBfDLLCeix2jYkFfVlqVqMPjXa+tT+qC9LVWJORn1ZqhIzF/V9pqK+LKbF6OJMRf3xHVBNRH1ZTInRPPeke9rRqC+LKTF613duduHFGi/B7duuqqJ+Ke5TPJk3oGQ1vIg7ewyuzJG8mIj6GC9MRX2DH09XgoRcaeINvi6AmjsReHMFcKFYdzYvJ2Y26tPJWW3UL0aICXixLlmxMYz626ai/gEoFo9NWimSGJVhAcuwIH4m4UcypejbeI1RP1izqM+jiXlwbwkpUZ7H0IO/MywWCSzhxCDXs9ZbAjC4aE3UL8WLJSfAn8/3nAbdSUNiwbnnIgzWMuqXoqCUKsSOUCYPPfjmCSk8ULzpQmUxLeqHah71S1FQSM0eoVge99WZGJYkSqnpfyqLTY9sSkd9embD6qhfiiaWPxfD19rdOoHe9L/lxfoTP2DU98tHfXwzrI76FzlCsTyoyLkY7S08HfFulRWjSLHgjkg/iaZF/ZfsmtahiSkZaiGHQoz6F/U0pZIYPc5DT5ZJ9SyK+mF7ov5FcG9hmStp/D+Im8qQxLCXKRkS09ljFPVXWynqy/Qse6P+RbB9oJjYw8iZGDVpJYtTCO4zVsxU1G+lqP/CsrGpIvh/NDGUotdiCCYxumtMHxuJfoFR3yPVsyjqT0zt2tazWETPopNQa8hi+vifksmDHg6hx1DpZOME9HAi6hejzYnnU8bZaEXl6Mbe5i4dgrUn0TrwYo0fGMm7veKLc7ujfjFnA7AGDb/aACxkUcyVKxITUR8vUqYEaRqh75ediPrFaGIF5ARfY1zBacOLzVmI4UHSkzuE/wDtg18mgH26LgAAAABJRU5ErkJggg==",color:"red"}}:{data:t,visible:!0,style:{displayName:e,fillColor:"red",color:"red"}}},t.prototype.onLayerChanged=function(e,t){var r=this;if("visible"===t.PropertyName)if(t.Value){if(this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.FeatureCollection.features.length>0&&this.studyArea.selectedStudyArea.FeatureCollection.features.forEach(function(e){if(e.id==t.LayerName){var a=angular.fromJson(angular.toJson(e)),o=a.id;r.addGeoJSON(o,a)}}),this.explorationService.networkNavResults)for(var a=0;a<this.explorationService.networkNavResults.length;a++){var o=angular.fromJson(angular.toJson(this.explorationService.networkNavResults[a]));o.name==t.LayerName&&this.addGeoJSON(t.LayerName,o.feature)}}else delete this.geojson[t.LayerName]},t.prototype.mapBoundsChange=function(e,t){this.nomnimalZoomLevel=this.scaleLookup(this.center.zoom),this.center.zoom>=8&&e!==t&&(this.regionServices.loadRegionListByExtent(this.bounds.northEast.lng,this.bounds.southWest.lng,this.bounds.southWest.lat,this.bounds.northEast.lat),this.regionServices.selectedRegion||this.toaster.pop("info","Information","User input is needed to continue",5e3)),this.center.zoom<8&&e!==t&&(this.regionServices.regionList=[]),this.center.zoom>=15?this.studyArea.zoomLevel15=!0:this.studyArea.zoomLevel15=!1},t.prototype.updateRegion=function(){var e=this.$locationService.search().region;this.setBoundsByRegion(e)},t.prototype.setBoundsByRegion=function(e){e&&this.regionServices.loadRegionListByRegion(e)&&(this.regionServices.selectedRegion=this.regionServices.regionList[0],this.bounds=this.leafletBoundsHelperService.createBoundsFromArray(this.regionServices.selectedRegion.Bounds))},t.prototype.addRegionOverlayLayers=function(e){if(!(this.regionServices.regionMapLayerList.length<1)){var t=[];this.regionServices.regionMapLayerList.map(function(e){t.push(e[1])});this.layers.overlays[e+"_region"]=new o(e+" Map layers",configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers,"agsDynamic",!0,{opacity:1,layers:t,format:"png8",f:"image"});var r=this.regionServices.selectedRegion.Layers;if(void 0!=r)for(var a in r)this.layers.overlays[a+"_region"]=r[a]}},t.prototype.removeOverlayLayers=function(e,t){var r=this;void 0===t&&(t=!1);var a;a=this.getLayerIdsByID(e,this.layers.overlays,t),a.forEach(function(e){delete r.layers.overlays[e]})},t.prototype.removeMarkerLayers=function(e,t){var r=this;void 0===t&&(t=!1);var a;a=this.getLayerIdsByID(e,this.markers,t),a.forEach(function(e){delete r.markers[e]})},t.prototype.removeGeoJsonLayers=function(e,t){var r=this;void 0===t&&(t=!1);var a;a=this.getLayerIdsByID(e,this.geojson,t),a.forEach(function(e){delete r.geojson[e]})},t.prototype.getLayerIdsByName=function(e,t,r){var a=[];for(var o in t)t[o].hasOwnProperty("name")&&(r?t[o].name.indexOf(e)>-1:t[o].name===e)&&a.push(o);return a},t.prototype.getLayerIdsByID=function(e,t,r){var a=[];for(var o in t)(r?o.indexOf(e)>-1:o===e)&&a.push(o);return a},t.prototype.startDelineate=function(t,r,a){var o=new e.Models.StudyArea(this.regionServices.selectedRegion.RegionID,new WiM.Models.Point(t.lat,t.lng,"4326"));this.studyArea.AddStudyArea(o),this.studyArea.loadStudyBoundary(),r&&(this.studyArea.selectedStudyArea.Disclaimers.isInExclusionArea="The delineation point is in an exclusion area. "+a)},t}();n.$inject=["$scope","toaster","$analytics","$location","$stateParams","leafletBoundsHelpers","leafletData","WiM.Services.SearchAPIService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ExplorationService","WiM.Event.EventManager","StreamStats.Services.ModalService","$modalStack"],angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.MapController",n)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){!function(t){"use strinct";var r=function(){function t(t,r,o,i,n,s,g,A,C,I){var c=this;this.EventManager=I,t.vm=this,this.init(),this.toaster=r,this.angulartics=o,this.sideBarCollapsed=!1,this.selectedProcedure=a.INIT,this.regionService=i,this.nssService=s,this.studyAreaService=n,this.modalService=g,this.leafletData=A,this.multipleParameterSelectorAdd=!0,this.explorationService=C,s.onSelectedStatisticsGroupChanged.subscribe(this._onSelectedStatisticsGroupChangedHandler),t.$watch(function(){return c.regionService.selectedRegion},function(e,t){null==e?c.setProcedureType(1):c.setProcedureType(2)}),t.$watch(function(){return c.studyAreaService.regressionRegionQueryComplete},function(e,t){e!=t&&(null==e?c.setProcedureType(2):c.regionService.selectedRegion.ScenariosAvailable?c.setProcedureType(3):c.setProcedureType(2))}),I.SubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,new WiM.Event.EventHandler(function(e,t){c.parametersLoaded=t.parameterLoaded,c.parametersLoaded?c.setProcedureType(4):c.setProcedureType(3)}))}return Object.defineProperty(t.prototype,"ParameterValuesMissing",{get:function(){if(!this.studyAreaService.studyAreaParameterList||this.studyAreaService.studyAreaParameterList.length<1)return!0;for(var e=0;e<this.studyAreaService.studyAreaParameterList.length;e++){var t=this.studyAreaService.studyAreaParameterList[e];if(!t.value||t.value<0)return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.setProcedureType=function(e){if(this.selectedProcedure==e||!this.canUpdateProcedure(e))return void(2!=this.selectedProcedure||3!=e&&4!=e||this.toaster.pop("warning","Warning","Make sure you have delineated a basin and clicked continue",5e3));this.selectedProcedure=e},t.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},t.prototype.onAOISelect=function(e){this.EventManager.RaiseEvent(WiM.Services.onSelectedAreaOfInterestChanged,this,new WiM.Services.SearchAPIEventArgs(e))},t.prototype.zoomRegion=function(e){angular.fromJson(e)},t.prototype.setRegion=function(e){this.angulartics.eventTrack("initialOperation",{category:"SideBar",label:"Region Selection Button"}),void 0!=this.regionService.selectedRegion&&this.regionService.selectedRegion.RegionID===e.RegionID||(this.regionService.selectedRegion=e),this.setProcedureType(2),this.regionService.loadParametersByRegion()},t.prototype.openStatePage=function(t,r){t.stopPropagation(),t.preventDefault(),this.modalService.openModal(e.Services.SSModalType.e_about,{tabName:"regionInfo",regionID:r})},t.prototype.resetWorkSpace=function(){this.regionService.clearSelectedParameters(),this.studyAreaService.clearStudyArea(),this.studyAreaService.zoomLevel15=!0,this.nssService.clearNSSdata()},t.prototype.startSearch=function(e){e.stopPropagation(),e.preventDefault(),$("#searchBox").trigger($.Event("keyup",{keyCode:13}))},t.prototype.startDelineate=function(){var e=this;this.leafletData.getMap("mainMap").then(function(t){if(t.getZoom()<15)return void e.toaster.pop("error","Delineate","You must be at or above zoom level 15 to delineate.");e.toaster.pop("success","Delineate","Click on a blue stream cell to start delineation"),e.studyAreaService.doDelineateFlag=!e.studyAreaService.doDelineateFlag})},t.prototype.setStatisticsGroup=function(e){var t=this.checkArrayForObj(this.nssService.selectedStatisticsGroupList,e);if(-1!=t)this.nssService.selectedStatisticsGroupList.splice(t,1),0==this.nssService.selectedStatisticsGroupList.length&&(this.studyAreaService.studyAreaParameterList=[],this.regionService.parameterList.forEach(function(e){e.checked=!1,e.toggleable=!0}));else{if(this.nssService.selectedStatisticsGroupList.push(e),null!=this.studyAreaService.selectedStudyArea.CoordinatedReach&&"PFS"==e.Code.toUpperCase())return this.addParameterToStudyAreaList("DRNAREA"),void(this.nssService.showFlowsTable=!0);this.nssService.loadParametersByStatisticsGroup(this.regionService.selectedRegion.RegionID,e.ID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","),this.studyAreaService.selectedStudyArea.RegressionRegions)}},t.prototype.multipleParameterSelector=function(){var e=this;this.regionService.parameterList.forEach(function(t){var r=e.checkArrayForObj(e.studyAreaService.studyAreaParameterList,t);e.multipleParameterSelectorAdd?(-1==r&&e.studyAreaService.studyAreaParameterList.push(t),t.checked=!0):r>-1&&t.toggleable&&(e.studyAreaService.studyAreaParameterList.splice(r,1),t.checked=!1)}),this.multipleParameterSelectorAdd=!this.multipleParameterSelectorAdd},t.prototype.updateStudyAreaParameterList=function(e){if(0==e.toggleable)return this.toaster.pop("warning",e.code+" is required by one of the selected scenarios","It cannot be unselected"),void(e.checked=!0);var t=this.studyAreaService.studyAreaParameterList.indexOf(e)
;!e.checked&&t>-1?this.studyAreaService.studyAreaParameterList.splice(t,1):e.checked&&-1==t&&this.studyAreaService.studyAreaParameterList.push(e)},t.prototype.calculateParameters=function(){this.angulartics.eventTrack("CalculateParameters",{category:"SideBar",label:this.regionService.selectedRegion.Name+"; "+this.studyAreaService.studyAreaParameterList.map(function(e){return e.code}).join(",")}),this.studyAreaService.loadParameters()},t.prototype.submitBasinEdits=function(){this.angulartics.eventTrack("basinEditor",{category:"Map",label:"sumbitEdits"}),this.studyAreaService.showEditToolbar=!1,this.studyAreaService.selectedStudyArea.Disclaimers.isEdited&&(this.nssService.clearNSSdata(),this.studyAreaService.loadEditedStudyBoundary())},t.prototype.selectScenarios=function(){this.setProcedureType(3)},t.prototype.refreshWindow=function(){window.location.reload()},t.prototype.generateReport=function(){var t=this;if(this.toaster.pop("wait","Opening Report","Please wait...",5e3),this.angulartics.eventTrack("CalculateFlows",{category:"SideBar",label:this.regionService.selectedRegion.Name+"; "+this.nssService.selectedStatisticsGroupList.map(function(e){return e.Name}).join(",")}),this.nssService.selectedStatisticsGroupList.length>0&&this.nssService.showFlowsTable){var r=[];if(null!=this.studyAreaService.selectedStudyArea.CoordinatedReach)for(var a=0;a<this.nssService.selectedStatisticsGroupList.length;a++){var o=this.nssService.selectedStatisticsGroupList[a];if("PFS"===o.Code.toUpperCase()){o.Citations=[{Author:"Indiana DNR,",Title:"Coordinated Discharges of Selected Streams in Indiana.",CitationURL:"http://www.in.gov/dnr/water/4898.htm"}],o.RegressionRegions=[];var i=this.studyAreaService.selectedStudyArea.CoordinatedReach.Execute(this.studyAreaService.studyAreaParameterList.filter(function(e){return"DRNAREA"===e.code}));o.RegressionRegions.push(i),r.push(o),this.nssService.selectedStatisticsGroupList.splice(a,1);break}}this.nssService.estimateFlows(this.studyAreaService.studyAreaParameterList,"value",this.regionService.selectedRegion.RegionID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(",")),-1!=this.regionService.selectedRegion.Applications.indexOf("RegulationFlows")&&setTimeout(function(){t.nssService.estimateFlows(t.studyAreaService.studyAreaParameterList,"unRegulatedValue",t.regionService.selectedRegion.RegionID,t.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","),!0)},500),null!=o&&this.nssService.selectedStatisticsGroupList.push(o)}this.modalService.openModal(e.Services.SSModalType.e_report),this.nssService.reportGenerated=!0,this.leafletData.getMap("mainMap").then(function(e){t.leafletData.getLayers("mainMap").then(function(r){for(var a in r.baselayers)e.hasLayer(r.baselayers[a])&&(t.studyAreaService.baseMap={},t.studyAreaService.baseMap[a]=configuration.basemaps[a])})})},t.prototype.checkRegulation=function(){this.studyAreaService.upstreamRegulation()},t.prototype.queryRegressionRegions=function(){if(!this.regionService.selectedRegion.ScenariosAvailable)return this.studyAreaService.regressionRegionQueryComplete=!0,void this.setProcedureType(a.SELECT);this.nssService.queriedRegions=!0,-1!=this.regionService.selectedRegion.Applications.indexOf("CoordinatedReach")&&this.studyAreaService.queryCoordinatedReach(),this.studyAreaService.selectedStudyArea.RegressionRegions?this.setProcedureType(3):this.studyAreaService.queryRegressionRegions()},t.prototype.queryStatisticsGroupTypes=function(){this.nssService.loadStatisticsGroupTypes(this.regionService.selectedRegion.RegionID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","))},t.prototype.updateParameterValue=function(e){},t.prototype.onSelectedStatisticsGroupChanged=function(){var e=this;this.nssService.selectedStatisticsGroupList.length>0?this.nssService.showFlowsTable=!0:this.nssService.showFlowsTable=!1,this.nssService.selectedStatisticsGroupList.forEach(function(t){t.RegressionRegions&&t.RegressionRegions.forEach(function(t){t.Parameters.forEach(function(t){for(var r=!1,a=0;a<e.regionService.parameterList.length;a++){var o=e.regionService.parameterList[a];if(o.code.toLowerCase()==t.Code.toLowerCase()){e.addParameterToStudyAreaList(o.code),r=!0;break}}if(!r){e.toaster.pop("warning","Missing Parameter: "+t.Code,"The selected scenario requires a parameter not available in this State/Region.  The value for this parameter will need to be entered manually.",0);var i={name:t.name,description:t.Description,code:t.Code,unit:t.UnitType.Unit,value:null,regulatedValue:null,unRegulatedValue:null,loaded:null,checked:!1,toggleable:!0};e.regionService.parameterList.push(i),e.addParameterToStudyAreaList(t.Code)}})})})},t.prototype.OpenWateruse=function(){this.modalService.openModal(e.Services.SSModalType.e_wateruse)},t.prototype.OpenStormRunoff=function(){this.modalService.openModal(e.Services.SSModalType.e_stormrunnoff)},t.prototype.downloadGeoJSON=function(){var e=angular.toJson(this.studyAreaService.selectedStudyArea.FeatureCollection),t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"data.geojson");else{var r=document.createElement("a"),a=URL.createObjectURL(t);void 0!==r.download?(r.setAttribute("href",a),r.setAttribute("download","data.geojson"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(a)}},t.prototype.init=function(){var e=this;this._onSelectedStatisticsGroupChangedHandler=new WiM.Event.EventHandler(function(){e.onSelectedStatisticsGroupChanged()})},t.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},t.prototype.addParameterToStudyAreaList=function(e){try{for(var t=0;t<this.regionService.parameterList.length;t++){var r=this.regionService.parameterList[t];if(r.code.toUpperCase()===e.toUpperCase()&&-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,r)){this.studyAreaService.studyAreaParameterList.push(r),r.checked=!0,r.toggleable=!1;break}}}catch(e){return!1}},t.prototype.canUpdateProcedure=function(e){try{switch(e){case a.INIT:return!0;case a.IDENTIFY:return null!=this.regionService.selectedRegion;case a.SELECT:return this.studyAreaService.regressionRegionQueryComplete;case a.BUILD:return this.studyAreaService.regressionRegionQueryComplete&&this.parametersLoaded;default:return!1}}catch(e){return!1}},t.prototype.sm=function(e){},t}();r.$inject=["$scope","toaster","$analytics","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ModalService","leafletData","StreamStats.Services.ExplorationService","WiM.Event.EventManager"];var a;!function(e){e[e.INIT=1]="INIT",e[e.IDENTIFY=2]="IDENTIFY",e[e.SELECT=3]="SELECT",e[e.BUILD=4]="BUILD"}(a||(a={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.SidebarController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),StreamStats;!function(e){!function(t){"use strict";var r=function(t){function r(e,r,a,o){var i=t.call(this,r,configuration.baseurls.StreamStats)||this;return e.vm=i,i.modalService=a,i.checkActiveNews(),i.newArticleCount=0,i.environment=configuration.environment,i.AppVersion=configuration.version,i.cloud=configuration.cloud,i}return __extends(r,t),r.prototype.checkActiveNews=function(){var t=this;console.log("Checking for active news articles");var r={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.ActiveNewsFolder,o=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",r);this.Execute(o).then(function(r){console.log("Successfully retrieved active news articles page"),r.data.folder.articles.length>0&&(r.data.folder.articles.forEach(function(e){null==t.readCookie(e.id)&&(console.log("New news article found: ",e),t.newArticleCount+=1,t.createCookie(e.id,!0,30))}),t.newArticleCount>0&&t.modalService.openModal(e.Services.SSModalType.e_about,{tabName:"news",regionID:""}))},function(e){}).finally(function(){})},r.prototype.openReport=function(){this.modalService.openModal(e.Services.SSModalType.e_report)},r.prototype.openAbout=function(){this.modalService.openModal(e.Services.SSModalType.e_about)},r.prototype.openHelp=function(){this.modalService.openModal(e.Services.SSModalType.e_help)},r.prototype.readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var o=r[a];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null},r.prototype.createCookie=function(e,t,r){if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3);var o="; expires="+a.toUTCString()}else var o="";document.cookie=e+"="+t+o+"; path=/"},r}(WiM.Services.HTTPServiceBase);r.$inject=["$scope","$http","StreamStats.Services.ModalService","StreamStats.Services.StudyAreaService"],angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavbarController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){!function(e){"use strinct";var t=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),r=function(){function e(e,t,r,a,o,i,n){var s=this;this.regionService=n,this.disclaimer="USGS Data Disclaimer: Unless otherwise stated, all data, metadata and related materials are considered to satisfy the quality standards relative to the purpose for which the data were collected. Although these data and associated metadata have been reviewed for accuracy and completeness and approved for release by the U.S. Geological Survey (USGS), no warranty expressed or implied is made regarding the display or utility of the data for other purposes, nor on all computer systems, nor shall the act of distribution constitute any such warranty.\nUSGS Software Disclaimer: This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the functionality of the software and related material nor shall the fact of release constitute any such warranty. Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held liable for any damages resulting from its authorized or unauthorized use.\nUSGS Product Names Disclaimer: Any use of trade, firm, or product names is for descriptive purposes only and does not imply endorsement by the U.S. Government.\n\n",this.markers=null,this.overlays=null,this.center=null,this.layers=null,e.vm=this,this.angulartics=t,this.studyAreaService=a,this.nssService=o,this.leafletData=i,this.reportTitle="StreamStats Report",this.reportComments="Some comments here",this.AppVersion=configuration.version,this.initMap(),e.$on("leafletDirectiveMap.reportMap.load",function(e,t){s.showFeatures()}),this.close=function(){r.dismiss("cancel")},this.print=function(){window.print()},this.getPercentWeights()}return Object.defineProperty(e.prototype,"showReport",{get:function(){if(!this.studyAreaService.studyAreaParameterList)return!1;for(var e=0;e<this.studyAreaService.studyAreaParameterList.length;e++){var t=this.studyAreaService.studyAreaParameterList[e];if(t.value&&t.value>=0)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canShowDisclaimers",{get:function(){return null!=this.studyAreaService.selectedStudyArea.Disclaimers&&Object.keys(this.studyAreaService.selectedStudyArea.Disclaimers).length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showRegulation",{get:function(){return this.regionService.selectedRegion.Applications.indexOf("RegulationFlows")>-1},enumerable:!0,configurable:!0}),e.prototype.downloadCSV=function(){var e=this;this.angulartics.eventTrack("Download",{category:"Report",label:"CSV"});var t=function(t){var r="";return t.RegressionRegions.forEach(function(a){if("Area-Averaged"!=a.Name){var o="";a.PercentWeight&&(o=a.PercentWeight.toFixed(0)+" Percent "),r+="\r\n"+t.Name+" Parameters,"+o+a.Name.split("_").join(" ")+"\r\n",r+=e.tableToCSV($(document.getElementById(e.camelize(t.Name+a.Name+"ScenarioParamTable"))))+"\r\n"}}),r+"\r\n"},r=function(e){var t="*** "+e.Name+" Disclaimers ***\r\n";return angular.forEach(e.Disclaimers,function(e,r){t+=r+","+e+"\r\n"}),t+"\r\n"},a=function(t){var r="";return t.RegressionRegions.forEach(function(a){if(a.Results){var o="";a.PercentWeight&&(o=a.PercentWeight.toFixed(0)+" Percent "),r+=t.Name+" Flow Report,"+o+a.Name.split("_").join(" ")+"\r\n",a.Results[0].IntervalBounds&&a.Results[0].Errors&&a.Results[0].Errors.length>0&&(r+='"PIl: Prediction Interval- Lower, PIu: Prediction Interval- Upper, SEp: Standard Error of Prediction, SE: Standard Error (other-- see report)"\r\n'),r+=e.tableToCSV($(document.getElementById(e.camelize(t.Name+a.Name+"ScenarioFlowTable"))))+"\r\n\r\n"}}),r+"\r\n"},o="StreamStats Output Report\n\nState/Region ID,"+this.studyAreaService.selectedStudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.studyAreaService.selectedStudyArea.WorkspaceID+"\nLatitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString()+"\n\n";o+=function(t){var r="Basin Characteristics\n";return(r+=e.tableToCSV($("#mainParamTable")))+"\r\n"}(this.studyAreaService.studyAreaParameterList),this.nssService.selectedStatisticsGroupList.forEach(function(e){o+=t(e),e.Disclaimers&&(e.Disclaimers.Warnings||e.Disclaimers.Errors)&&(o+=r(e)),o+=a(e)}),o+=this.disclaimer+"Application Version: "+this.AppVersion;var i=new Blob([o],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,"data.csv");else{var n=document.createElement("a"),s=URL.createObjectURL(i);void 0!==n.download?(n.setAttribute("href",s),n.setAttribute("download","data.csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)):window.open(s)}},e.prototype.downloadGeoJSON=function(){var e=this,t=this.studyAreaService.selectedStudyArea.FeatureCollection;t.features.forEach(function(t){t.properties.Name=e.studyAreaService.selectedStudyArea.WorkspaceID,t.id&&"globalwatershed"==t.id&&(t.properties=[t.properties,e.studyAreaService.studyAreaParameterList.reduce(function(e,t){return e[t.code]=t.value,e},{})].reduce(function(e,t){return Object.keys(t).forEach(function(r){e[r]=t[r]}),e},{}),t.properties.FlowStatistics=e.nssService.selectedStatisticsGroupList)});var r=angular.toJson(t),a=new Blob([r],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,"data.geojson");else{var o=document.createElement("a"),i=URL.createObjectURL(a);void 0!==o.download?(o.setAttribute("href",i),o.setAttribute("download","data.geojson"),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)):window.open(i)}},e.prototype.downloadShapeFile=function(){var e=this,t=null;this.nssService.showFlowsTable&&(t=this.flattenNSSTable());var r=this.studyAreaService.selectedStudyArea.FeatureCollection;r.features.forEach(function(t){t.properties.Name=e.studyAreaService.selectedStudyArea.WorkspaceID,t.id&&"globalwatershed"==t.id&&(t.properties=[t.properties,e.studyAreaService.studyAreaParameterList.reduce(function(e,t){return e[t.code]=t.value,e},{})].reduce(function(e,t){return Object.keys(t).forEach(function(r){e[r]=t[r]}),e},{}))}),shpwrite.download(r,t,this.disclaimer+"Application Version: "+this.AppVersion)},e.prototype.downloadPDF=function(){var e=new jsPDF("p","pt","letter"),t=document.getElementById("printArea").innerHTML,r={"#bypassme":function(e,t){return!0}},a={top:80,bottom:60,left:40,width:522};e.fromHTML(t,a.left,a.top,{width:a.width,elementHandlers:r},function(t){e.save("Test.pdf")},a)},e.prototype.initMap=function(){this.center=new t(39,-96,4),this.layers={baselayers:configuration.basemaps,overlays:{}},L.Icon.Default.imagePath="images",this.defaults={scrollWheelZoom:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1}},e.prototype.getPercentWeights=function(){var e=this;this.nssService.selectedStatisticsGroupList.forEach(function(t){t.RegressionRegions.forEach(function(t){e.studyAreaService.selectedStudyArea.RegressionRegions.forEach(function(r){null!=t.Code&&r.code.indexOf(t.Code.toUpperCase())>-1&&(e.areaSQMI=3.86102159e-7*r.maskareasqmeter)})})})},e.prototype.showFeatures=function(){var e=this;if(this.studyAreaService.selectedStudyArea){this.overlays={},this.studyAreaService.selectedStudyArea.FeatureCollection.features.forEach(function(t){"globalwatershed"==t.id?e.layers.overlays[t.id]={name:"Basin Boundary",type:"geoJSONShape",data:t,visible:!0,layerOptions:{style:{fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}}}:"globalwatershedpoint"==t.id?e.layers.overlays[t.id]={name:"Basin Clicked Point",type:"geoJSONShape",data:t,visible:!0}:"regulatedWatershed"==t.id?e.layers.overlays.globalwatershedregulated={name:"Basin Boundary (Regulated Area)",type:"geoJSONShape",data:t,visible:!0,layerOptions:{style:{fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}}}:e.layers.overlays[t.id]={name:t.id,type:"geoJSONShape",data:t,visible:!1,layerOptions:{style:{fillColor:"red",color:"red"}}}});var t=this.studyAreaService.selectedStudyArea.FeatureCollection.bbox;this.leafletData.getMap("reportMap").then(function(e){e.invalidateSize(),e.fitBounds([[t[1],t[0]],[t[3],t[2]]])})}},e.prototype.tableToCSV=function(e){function t(e){return e.get().join(s).split(s).join(A).split(n).join(g)}function r(e,t){var r=$(t),o=r.find("td");return o.length||(o=r.find("th")),o.map(a).get().join(n)}function a(e,t){return $(t).text().replace('"','""')}var o=e.find("tr:has(th)"),i=e.find("tr:has(td)"),n=String.fromCharCode(11),s=String.fromCharCode(0),g='","',A='"\r\n"',C='"';return C+=t(o.map(r)),C+=A,C+=t(i.map(r))+'"'},e.prototype.camelize=function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")},e.prototype.flattenNSSTable=function(){var e=this.studyAreaService.selectedStudyArea.WorkspaceID,t=[];try{this.nssService.selectedStatisticsGroupList.forEach(function(r){r.RegressionRegions.forEach(function(r){r.Results.forEach(function(a){t.push({Name:e,Region:r.PercentWeight?r.PercentWeight.toFixed(0)+"% "+r.Name:r.Name,Statistic:a.Name,Value:a.Value.toUSGSvalue(),Unit:a.Unit.Unit,Disclaimers:r.Disclaimer?r.Disclaimer:void 0,Errors:a.Errors&&a.Errors.length>0?a.Errors.map(function(e){return e.Name+" : "+e.Value}).join(", "):void 0,MaxLimit:a.IntervalBounds&&a.IntervalBounds.Upper>0?a.IntervalBounds.Upper.toUSGSvalue():void 0,MinLimit:a.IntervalBounds&&a.IntervalBounds.Lower>0?a.IntervalBounds.Lower.toUSGSvalue():void 0,EquivYears:a.EquivalentYears?a.EquivalentYears:void 0})})})})}catch(e){t.push({Disclaimers:"Failed to output flowstats to table. "})}return t},e}();r.$inject=["$scope","$analytics","$modalInstance","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","leafletData","StreamStats.Services.RegionService"],angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ReportController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),StreamStats;!function(e){!function(e){"use strict";var t=function(){function e(){this.Annual={Graph:{},Table:{}},this.Monthly={Graph:{withdrawals:null,returns:null},Table:{}}}return e}(),r=function(e){function r(t,r,a,o,i){var n=e.call(this,r,configuration.baseurls.WaterUseServices)||this;return n.$timeout=i,t.vm=n,n.modalInstance=o,n.StudyArea=a.selectedStudyArea,n.init(),n}return __extends(r,e),Object.defineProperty(r.prototype,"StartYear",{get:function(){return this._startYear},set:function(e){this.spanYear||(this.EndYear=e),e<=this.EndYear&&e>=this.YearRange.floor&&(this._startYear=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"EndYear",{get:function(){return this._endYear},set:function(e){e>=this.StartYear&&e<=this.YearRange.ceil&&(this._endYear=e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"YearRange",{get:function(){return this._yearRange},enumerable:!0,configurable:!0}),r.prototype.GetWaterUse=function(){var e=this;this.CanContiue=!1;var t=configuration.queryparams.Wateruse.format(this.StartYear,this.EndYear,this.includePermits,this.includeReturns,this.computeDomesticWU),r=this.StudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry,o=new WiM.Services.Helpers.RequestInfo(t,!1,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(r));this.Execute(o).then(function(t){e.showResults=!0,e.result=t.data,"Wateruse not available at specified site."!==e.result.Messages&&(t.data.hasOwnProperty("withdrawal")||t.data.hasOwnProperty("return"))||alert("Wateruse not available at specified site."),e.ReportData.Monthly.Graph=e.loadGraphData(a.Monthly),e.ReportData.Annual.Graph=e.loadGraphData(a.Annual),e.ReportData.Monthly.Table=e.GetTableData(a.Monthly),e.ReportData.Annual.Table=e.GetTableData(a.Annual)},function(e){}).finally(function(){e.CanContiue=!0})},r.prototype.Close=function(){this.modalInstance.dismiss("cancel")},r.prototype.Reset=function(){this.init()},r.prototype.Print=function(){window.print()},r.prototype.loadGraphData=function(e){try{var t={returns:[],withdrawals:[]};switch(e){case a.Monthly:new Array(12);if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var r in this.result.withdrawal.monthly){var o=this.result.withdrawal.monthly[r].code;for(var i in o){for(var n=-1,s=0;s<t.withdrawals.length;s++){var g=t.withdrawals[s];if(g.key==o[i].name){n=s;break}}if(n<0){for(var A=[],s=1;s<=12;s++)A.push({label:this.getMonth(s),stack:"withdrawal",value:0});n=t.withdrawals.push({key:o[i].name,values:A,color:this.generateColorShade(190,350)})-1}t.withdrawals[n].values[+r-1].value=o[i].value}}if(this.result.hasOwnProperty("return")){var C=[];for(var r in this.result.return.monthly)C.push({label:this.getMonth(+r),stack:"withdrawal",value:this.Sum(this.result.return.monthly[r].month,"value")});t.returns.push({key:"returns",color:this.generateColorShade(0,170),values:C})}return t;case a.Annual:if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("annual"))for(var I in this.result.withdrawal.annual){var c=this.result.withdrawal.annual[I];t.withdrawals.push({name:c.name,value:c.value,color:this.generateColorShade(190,350)})}if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("annual"))for(var I in this.result.return.annual){var c=this.result.return.annual[I];t.returns.push({name:c.name,value:c.value,color:this.generateColorShade(0,170)})}return t}}catch(e){}},r.prototype.GetTableData=function(e){var t=[],r=[];try{switch(e){case a.Monthly:for(var o=1;o<=12;o++)r.push({month:this.getMonth(o),returns:{name:"return",SW:"---",GW:"---"},withdrawals:{SW:"---",GW:"---",code:[]}});if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var i in this.result.return.monthly)r[+i-1].returns.GW=this.result.return.monthly[i].month.hasOwnProperty("GW")?this.result.return.monthly[i].month.GW.value.toFixed(3):"---",r[+i-1].returns.SW=this.result.return.monthly[i].month.hasOwnProperty("SW")?this.result.return.monthly[i].month.SW.value.toFixed(3):"---";if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var n in this.result.withdrawal.monthly)if(r[+n-1].withdrawals.GW=this.result.withdrawal.monthly[n].month.hasOwnProperty("GW")?this.result.withdrawal.monthly[n].month.GW.value.toFixed(3):"---",r[+n-1].withdrawals.SW=this.result.withdrawal.monthly[n].month.hasOwnProperty("SW")?this.result.withdrawal.monthly[n].month.SW.value.toFixed(3):"---",this.result.withdrawal.monthly[n].hasOwnProperty("code")){var s=this.result.withdrawal.monthly[n].code;for(var g in s){for(var A=-1,o=0;o<t.length;o++){var C=t[o];if(C==s[g].name){A=o;break}}A<0&&(A=t.push(s[g].name)-1,r.forEach(function(e){e.withdrawals.code.push({name:s[g].name,value:"---"})})),r[+n-1].withdrawals.code[A].value=s[g].value.toFixed(3)}}break;case a.Annual:t=["","Average Return","Average Withdrawal"];var I={name:"Surface Water",aveReturn:"---",aveWithdrawal:"---",unit:"MGD"},c={name:"Groundwater",aveReturn:"---",aveWithdrawal:"---",unit:"MGD"};if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("annual")){var l=this.result.withdrawal.annual;l.hasOwnProperty("SW")&&(I.aveWithdrawal=l.SW.value.toFixed(3)),l.hasOwnProperty("GW")&&(c.aveWithdrawal=l.GW.value.toFixed(3))}if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("annual")){var u=this.result.return.annual;u.hasOwnProperty("SW")&&(I.aveReturn=u.SW.value.toFixed(3)),u.hasOwnProperty("GW")&&(c.aveReturn=u.GW.value.toFixed(3))}r.push(I),r.push(c),r.push({name:"Total",aveReturn:isNaN(+I.aveReturn)&&isNaN(+c.aveReturn)?"---":((isNaN(+I.aveReturn)?0:+I.aveReturn)+(isNaN(+c.aveReturn)?0:+c.aveReturn)).toFixed(3),aveWithdrawal:isNaN(+I.aveWithdrawal)&&isNaN(+c.aveWithdrawal)?"---":((isNaN(+I.aveWithdrawal)?0:+I.aveWithdrawal)+(isNaN(+c.aveWithdrawal)?0:+c.aveWithdrawal)).toFixed(3)}),r.push({name:"",aveReturn:"",aveWithdrawal:""}),this.result.hasOwnProperty("TotalTempStats")&&(r.push({name:"Temporary water use registrations (surface water)[permit]",aveReturn:"",aveWithdrawal:this.result.TotalTempStats[2].value.toFixed(3),unit:"MGD"}),r.push({name:"Temporary water use registrations (groundwater[permit])",aveReturn:"",aveWithdrawal:this.result.TotalTempStats[1].value.toFixed(3),unit:"MGD"}),r.push({name:"Temporary water use registrations (total)[permit]",aveReturn:"",aveWithdrawal:this.result.TotalTempStats[0].value.toFixed(3),unit:"MGD"}),r.push({name:"",aveReturn:"",aveWithdrawal:""}),r.push({name:"Water use index (dimensionless) without temporary registrations:[totalnet/lowflowstat]",aveReturn:"",aveWithdrawal:this.result.TotalTempStats[4].value.toFixed(3),unit:"Dimensionless"}),r.push({name:"Water use index (dimensionless) with temporary registrations:[permit w/ totalnet/lowflow stat]",aveReturn:"",aveWithdrawal:this.result.TotalTempStats[3].value.toFixed(3),unit:"Dimensionless"}))}return{values:r,Fields:t}}catch(e){return{values:[],Fields:[]}}},r.prototype.Reduce=function(e){return e.reduce(function(e,t){return isNaN(+e)&&isNaN(+t)?"---":((isNaN(+e)?0:+e)+(isNaN(+t)?0:+t)).toFixed(3)},0)},r.prototype.Sum=function(e,t){var r=0;for(var a in e)r+=e[a][t];return r},r.prototype.Add=function(e,t){return isNaN(+e)&&isNaN(+t)?"---":((isNaN(+e)?0:+e)+(isNaN(+t)?0:+t)).toFixed(3)},r.prototype.DownloadCSV=function(){var e=this,t="StreamStats Water Use Report\nState/Region ID,"+this.StudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.StudyArea.WorkspaceID+"\nLatitude,"+this.StudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.StudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime:,"+this.result.processDate.toLocaleString()+"\nStart Year:,"+this.StartYear+"\nEnd Year:,"+this.EndYear+"\r\n";t+=function(){var t=e.StartYear+"-"+e.EndYear+" Average Annual Water Use reported in million gallons/day\n";return(t+=e.tableToCSV($("#AnnualWaterUseTable")))+"\r\n"}(),t+=function(){var t=e.StartYear+"-"+e.EndYear+" Average Water Use by Month reported in million gallons/day\n";return(t+=e.tableToCSV($("#MonthlyWaterUseTable")))+"\r\n"}();var r=new Blob([t],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,"wateruseSummary.csv");else{var a=document.createElement("a"),o=URL.createObjectURL(r);void 0!==a.download?(a.setAttribute("href",o),a.setAttribute("download","wateruseSummary.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(o)}},r.prototype.DownloadCSVBySource=function(){var e=this,t={Accept:"text/csv",Authorization:"Basic dGVzdE1hbmFnZXI6RG9nMQ=="},r=configuration.queryparams.WateruseSourceCSV.format(this.StartYear,this.EndYear,this.includePermits,this.includeReturns,this.computeDomesticWU),a=this.StudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry,o=new WiM.Services.Helpers.RequestInfo(r,!1,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(a),t);this.Execute(o).then(function(e){var t="wateruseSummaryBySource.csv",r=new Blob([e.data],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(o,t);else{var a=document.createElement("a"),i=URL.createObjectURL(r);void 0!==a.download?(a.setAttribute("href",i),a.setAttribute("download",t),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(i)}},function(e){}).finally(function(){e.CanContiue=!0})},r.prototype.init=function(){var e=this,r=configuration.queryparams.WateruseConfig.format(this.StudyArea.RegionID),i=new WiM.Services.Helpers.RequestInfo(r);this.Execute(i).then(function(t){var r=t.data;e.spanYear=r.minYear!=r.maxYear,e._startYear=r.minYear,e._endYear=r.maxYear,e.includePermits=r.hasPermits,e.includeReturns=r.hasReturns,e.computeDomesticWU=!1,e._yearRange={floor:r.minYear,draggableRange:!0,noSwitching:!0,showTicks:!1,ceil:r.maxYear}},function(t){e._startYear=2005,e._endYear=2012,e._yearRange={floor:2005,draggableRange:!0,noSwitching:!0,showTicks:!1,ceil:2012}}).finally(function(){e.CanContiue=!0,e.showResults=!1,e.SelectedTab=o.Graph,e.SelectedWaterUseType=a.Annual,e.ReportData=new t,e.MonthlyReportOptions={chart:{type:"multiBarHorizontalChart",height:450,visible:!0,stacked:!0,showControls:!1,margin:{top:20,right:30,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},dispatch:{stateChange:function(){e.$timeout(function(){e.loadGraphLabels(0)},500)},renderEnd:function(){e.$timeout(function(){e.loadGraphLabels(0)},500)},resize:function(){console.log("resize"),e.$timeout(function(){e.loadGraphLabels(0)},500)}},showValues:!0,valueFormat:function(e){return d3.format(",.4f")(e)},tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Values in million gallons/day",tickFormat:function(e){return d3.format(",.3f")(e)}},refreshDataOnly:!0}},e.MonthlyReturnReportOptions={chart:{type:"multiBarHorizontalChart",height:450,visible:!0,stacked:!0,showControls:!1,margin:{top:20,right:30,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format(",.3f")(e)},tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Values in million gallons/day",tickFormat:function(e){return d3.format(",.3f")(e)}}}},e.AnnualReportOptions={chart:{type:"pieChart",height:400,x:function(e){return e.name},y:function(e){return e.value},
showLabels:!0,tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},duration:500,labelThreshold:.01,labelSunbeamLayout:!1,legend:{margin:{top:5,right:35,bottom:5,left:0}}}}}),$(window).resize(function(){e.$timeout(function(){e.loadGraphLabels(0)},500)})},r.prototype.getMonth=function(e){switch(e){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec"}},r.prototype.getWUText=function(e){switch(e.toUpperCase()){case"AQ":return"Aquaculture";case"CO":return"Commercial";case"DO":return"Domestic";case"PH":return"Hydro Electric";case"IN":return"Industrial";case"IR":return"Irrigation";case"LV":return"Livestock";case"MI":return"Mining";case"RM":return"Remediation";case"TE":return"Thermoelectric";case"ST":return"Waste Water Treatment";case"WS":return"Public Supply";case"MF":return"Hydrofracturing";case"CW":return"Wetland augmentation";case"PC":return"Thermoelectric (closed cycle)";case"PO":return"Thermoelectric (once through)"}return e.toUpperCase()},r.prototype.loadGraphLabels=function(e){var t=d3.selectAll(".nv-multibarHorizontal .nv-group"),r=t.map(function(e){return e.length-2});t.filter(function(e,t){return t==r[0]});t.each(function(e,t){var a=d3.select(this);a.selectAll("text").remove(),a.selectAll(".nv-bar").each(function(e){var o=d3.select(this),i=o.node().getBBox().width;o.node().getBBox().height;a.append("text").attr("transform",o.attr("transform")).text(function(){if(t>=r[0])return d3.format(",.3f")((Number(e.y)+Number(e.y0)).toFixed(3))}).attr("dy","1.5em").attr("x",function(){var e=this.getBBox().width;return i-e/2}).attr("class","bar-values")})})},r.prototype.generateColorShade=function(e,t){try{return"hsla("+this.rand(e,e)+","+this.rand(30,100)+"%,"+this.rand(30,70)+"%,1)"}catch(e){return null}},r.prototype.tableToCSV=function(e){function t(e){return e.get().join(s).split(s).join(A).split(n).join(g)}function r(e,t){var r=$(t),o=r.find("td");return o.length||(o=r.find("th")),o.map(a).get().join(n)}function a(e,t){return $(t).text().replace('"','""')}var o=e.find("tr:has(th)"),i=e.find("tr:has(td)"),n=String.fromCharCode(11),s=String.fromCharCode(0),g='","',A='"\r\n"',C='"';return C+=t(o.map(r)),C+=A,C+=t(i.map(r))+'"'},r.prototype.HSLtoRGB=function(e,t,r){var a,o,i;if(0==t)a=o=i=r;else{var n=function(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e},s=r<.5?r*(1+t):r+t-r*t,g=2*r-s;a=n(g,s,e+1/3),o=n(g,s,e),i=n(g,s,e-1/3)}return{r:Math.round(255*a),g:Math.round(255*o),b:Math.round(255*i)}},r.prototype.RGBtoHEX=function(e,t,r){return this.ToHex(e)+this.ToHex(e)+this.ToHex(e)},r.prototype.ToHex=function(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t},r.prototype.rand=function(e,t){return parseInt(Math.random()*(t-e+1),10)+e},r}(WiM.Services.HTTPServiceBase);r.$inject=["$scope","$http","StreamStats.Services.StudyAreaService","$modalInstance","$timeout"];var a;!function(e){e[e.Annual=1]="Annual",e[e.Monthly=2]="Monthly"}(a||(a={}));var o;!function(e){e[e.Graph=1]="Graph",e[e.Table=2]="Table"}(o||(o={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.WateruseController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),StreamStats;!function(e){!function(t){"use strict";var r=function(){function e(){this.TR55={Graph:{},Table:{},PeakQ:{},Infiltration:{},ExcessPrecip:{}},this.RationalMethod={Graph:{},Table:{},PeakQ:{},Infiltration:{},ExcessPrecip:{}}}return e}(),a=function(t){function a(e,r,a,o,i,n,s,g,A){var C=t.call(this,a,configuration.baseurls.StormRunoffServices)||this;return C.$timeout=g,C.EventManager=A,C.regionParameters=[],C.PrecipOptions=[],C.SelectedParameterList=[],C.GraphLabels=[],C.GraphXValues=[],C.padY=0,C.padY2=0,C.domainY=[],C.domainY2=[],e.vm=C,C.angulartics=r,C.modalInstance=s,C.StudyArea=o.selectedStudyArea,C.nssService=i,C.studyAreaService=o,C.regionParameters=n.parameterList,C.BrowserIE=C.detectIE(),C.parameterloadedEventHandler=new WiM.Event.EventHandler(function(e,t){t.parameterLoaded&&C.loadParameters()}),C.init(),C.print=function(){window.print()},C}return __extends(a,t),Object.defineProperty(a.prototype,"SelectedPrecip",{get:function(){return this._selectedPrecip},set:function(e){this._selectedPrecip=e,console.log(this._selectedPrecip.code)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"SelectedTab",{get:function(){return this._selectedTab},set:function(e){this._selectedTab!=e&&(this._selectedTab=e,this.selectRunoffType())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"SelectedParametersAreValid",{get:function(){for(var e=0;e<this.SelectedParameterList.length;e++){var t=this.SelectedParameterList[e];if(isNaN(t.value))return!1}return!0},enumerable:!0,configurable:!0}),a.prototype.GetStormRunoffResults=function(){var e=this;try{this.CanContinue=!1;if(1==this.SelectedTab)var t=(o.TR55,configuration.queryparams.StormRunoffTR55.format(this.SelectedParameterList[0].value,this.SelectedPrecip.value,this.SelectedParameterList[1].value,this.SelectedPrecip.code));else if(2==this.SelectedTab)var t=(o.RationalMethod,configuration.queryparams.StormRunoffRationalMethod.format(this.DrnAreaAcres,this.PIntensity,this.SelectedParameterList[1].value,this.SelectedPrecip.code));var r=new WiM.Services.Helpers.RequestInfo(t);this.Execute(r).then(function(t){e.showResults=!0,e.result=t.data,1==e.SelectedTab?(e.ReportData.TR55.Graph=e.loadGraphData(),e.ReportData.TR55.Table=e.GetTableData(),e.setGraphOptions()):2==e.SelectedTab&&e.setPeakQ(e.result.q)},function(e){}).finally(function(){e.CanContinue=!0,e.hideAlerts=!0})}catch(e){console.log("oops GetStormRunoffResults failed to load ",e)}},a.prototype.validateForm=function(e){return!!e.$valid||(this.showResults=!1,this.hideAlerts=!1,!1)},a.prototype.CalculateParameters=function(){try{this.CanContinue=!1,this.EventManager.SubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,this.parameterloadedEventHandler);for(var t=0;t<this.SelectedParameterList.length;t++){var r=this.SelectedParameterList[t];-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,r)&&this.studyAreaService.studyAreaParameterList.push(r)}null!=this.SelectedPrecip&&-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,this.SelectedPrecip)&&this.studyAreaService.studyAreaParameterList.push(this.SelectedPrecip),this.studyAreaService.loadParameters()}catch(e){console.log("oops CalculateParams failed to load ",e)}},a.prototype.Close=function(){this.modalInstance.dismiss("cancel")},a.prototype.Reset=function(){this.init()},a.prototype.downloadCSV=function(){var e=this;this.angulartics.eventTrack("Download",{category:"Report",label:"CSV"});var t="StreamStats Output Report\n\nState/Region ID,"+this.studyAreaService.selectedStudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.studyAreaService.selectedStudyArea.WorkspaceID+"\nLatitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString()+"\n\n";1==this.SelectedTab?t+=function(t){var r="Peak Runoff from "+e.SelectedPrecip.name+" (TR55)\n";r+=e.tableToCSV($("#TR55ParameterTable")),r+="\n"+e.tableToCSV($("#TR55SummaryTable")),r+="\n\n"+e.tableToCSV($("#TR55TabularHydrograph"));var a="";if(e.SelectedParameterList){var o=[];o=Object.keys(e.ReportData.TR55.Table.values[0]);for(var i in o)parseInt(i)<14&&"time"!=o[i]&&("span"==o[i]?a+="#,Time,Time (HH:MM)\n":a+="#,"+e.getHeading(o[i])+","+e.getTitle(o[i])+"\n")}return a+"\n"+r+"\r\n"}(this.studyAreaService.studyAreaParameterList):2==this.SelectedTab&&(t+=function(t){var r="Peak Runoff from "+e.SelectedPrecip.name+" (Rational Method)\n";r+=e.tableToCSV($("#RMParameterTable")),r+="\n"+e.tableToCSV($("#RMSummaryTable"));var a="";if(e.SelectedParameterList){var o=[];o=Object.keys(e.ReportData.TR55.Table.values[0]);for(var i in o)parseInt(i)<14&&"time"!=o[i]&&("span"==o[i]?a+="#,Time,Time (HH:MM)\n":a+="#,"+e.getHeading(o[i])+","+e.getTitle(o[i])+"\n")}return a+"\n"+r+"\r\n"}(this.studyAreaService.studyAreaParameterList));var r=new Blob([t],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,"data.csv");else{var a=document.createElement("a"),o=URL.createObjectURL(r);void 0!==a.download?(a.setAttribute("href",o),a.setAttribute("download","data.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(o)}},a.prototype.generateColorShade=function(e,t){try{return"hsla("+this.rand(e,e)+","+this.rand(30,100)+"%,"+this.rand(30,70)+"%,1)"}catch(e){return null}},a.prototype.update=function(e){console.log(e)},a.prototype.loadGraphData=function(){try{var e=[],t=[],r=[];this.GraphXValues.length=0;var a;for(var o in this.result){var i,n=this.result[o].duration,s=parseFloat(o);this.duration=n,i=this.computeTime(s,n),t.push({x:i,y:this.result[o].q}),r.push({x:i,y:this.result[o].p})}t.sort(function(e,t){return e.x-t.x}),r.sort(function(e,t){return e.x-t.x}),a=t[0].x;for(var g in t)t[g].label=this.getTimeSpan(a,t[g].x),r[g].label=this.getTimeSpan(a,r[g].x);for(var A in t)t[A].hours=this.computeHours(a,t[A].x),r[A].hours=this.computeHours(a,t[A].x);return this.loadGraphLabels(t),this.loadGraphXValues(t),this.loadPadY(t),this.loadDomainY(t),this.loadPadY2(r),this.loadDomainY2(r),e.push({values:t,key:"Discharge (ft³/s)",color:" #009900",type:"line",yAxis:1}),e.push({values:r,key:"Cum. precipitation (in)",color:"#0033ff",type:"line",yAxis:2}),e}catch(e){}},a.prototype.GetTableData=function(){this.ReportData.TR55.PeakQ=0,this.ReportData.TR55.Infiltration=0,this.ReportData.TR55.ExcessPrecip=0;var e=[],t=[];try{for(var r in this.result){var a,o,i=this.result[r].duration,n=parseFloat(r);if(a=this.computeTime(n,i),this.result[r].time=a,t.push(this.result[r]),0==e.length)for(var s in this.result[r])e.push(s);this.setPeakQ(this.result[r].q),this.setInfiltration(this.result[r].pl),this.setExcessPrecip(this.result[r].dPe)}t.sort(function(e,t){return e.time-t.time}),o=t[0].time;for(var g in t)t[g].span=this.getTimeSpan(o,t[g].time);return{values:t,Fields:e}}catch(e){}},a.prototype.setPeakQ=function(e){try{if(1==this.SelectedTab){var t=e;this.ReportData.TR55.PeakQ<t&&(this.ReportData.TR55.PeakQ=t)}else this.ReportData.RationalMethod.PeakQ=e}catch(e){}},a.prototype.setInfiltration=function(e){try{this.ReportData.TR55.Infiltration=this.ReportData.TR55.Infiltration+e}catch(e){}},a.prototype.setExcessPrecip=function(e){try{this.ReportData.TR55.ExcessPrecip=this.ReportData.TR55.ExcessPrecip+e}catch(e){}},a.prototype.getPrecipTitle=function(){return 2==this.SelectedTab?"Precipitation intensity is computed by dividing the "+this.SelectedPrecip.name+" by "+this.SelectedPrecip.name.substr(0,2):void 0},a.prototype.getTitle=function(e){try{switch(e){case"q":return"Discharge (cubic feet per second)";case"drnarea":return"Drainage area (square miles)";case"p":return"Cumulative precipitation (inches)";case"rcn":return"Runoff curve number (unitless)";case"duration":return"Duration of storm (hours)";case"ia":return"Initial abstraction (inches)";case"s":return"Total maximum retention (inches)";case"dP":return"Incremental precipitation (inches)";case"pIa":return"Cumulative precipitation minus initial abstraction (inches)";case"pl":return"Precipitation loss (inches)";case"pe":return"Cumulative precipitation excess (inches)";case"dPe":return"Incremental precipitation excess (inches)"}}catch(e){}},a.prototype.getHeading=function(e){try{switch(e){case"q":return"Q";case"drnarea":return"DRNAREA";case"p":return"P";case"rcn":return"RCN";case"duration":return"Duration";case"ia":return"Ia";case"s":return"S";case"dP":return"dP";case"pIa":return"P-Ia";case"pl":return"Pl";case"pe":return"Pe";case"dPe":return"dPe"}}catch(e){}},a.prototype.setGraphOptions=function(){this.ReportOptions={chart:{type:"multiChart",height:275,width:650,margin:{top:10,right:80,bottom:80,left:90},x:function(e){return e.hours},y:function(e){return e.y},legend:{align:!1,padding:50,width:500},dispatch:{stateChange:function(e){console.log("stateChange")},changeState:function(e){console.log("changeState")},tooltipShow:function(e){console.log("tooltipShow")},tooltipHide:function(e){console.log("tooltipHide")}},useInteractiveGuideline:!0,interactiveLayer:{tooltip:{contentGenerator:function(e){var t,r,a=60*e.value%60,o=Math.trunc(e.value);t=o<10?"0"+o:o,r=a<10?"0"+a:a;var i=t+":"+r,n="";for(var s in e.series){var g,A,C=parseFloat(e.series[s].value);C>1e6&&C<1e7&&(A=1e4),C>1e5&&C<1e6&&(A=1e3),C>1e4&&C<1e5&&(A=100),C>1e3&&C<1e4&&(A=10),C>100&&C<1e3&&(A=1),g=parseInt(((C+.5*A)/A).toString())*A,C<100&&(g=Number(C.toPrecision(3))),n+="<tr><td class='legend-color-guide' style='width: 1em;'><div style='background-color: "+e.series[s].color+";'></div></td><td class='key'>"+e.series[s].key+":</td><td><strong>"+g+"</strong></td></tr>"}return"<table><thead><tr><td colspan='3'><b>"+i+"</b> (HH:mm)</td></tr></thead><tbody>"+n+"</tbody></table>"}}},xAxis:{showMaxMin:!1,tickValues:this.GraphXValues,axisLabel:"Time (HH:mm)",tickFormat:function(e){var t,r,a=Math.trunc(e),o=60*e%60;return t=a<10?"0"+a:a,r=o<10?"0"+o:o,t+":"+r},rotateLabels:"45"},yAxis1:{axisLabel:"Discharge (Q), in ft³/s",axisLabelDistance:this.padY,tickFormat:function(e){return d3.format(",.0f")(e)},showMaxMin:!1},yAxis2:{axisLabel:"Cum. precipitation (P), in inches",axisLabelDistance:this.padY2,tickFormat:function(e){return d3.format(",.0f")(e)},showMaxMin:!1},yDomain1:this.domainY,yDomain2:this.domainY2},title:{enable:!0,text:"Runoff hydrograph from "+this.SelectedPrecip.name,css:{"font-size":"10pt","font-weight":"bold"}}}},a.prototype.BrowserAlert=function(){this.BrowserIE&&alert("The Storm Runoff Modeling tool is best viewed with the following browsers\n\n\tChrome\n\tFirefox\n\tEdge")},a.prototype.detectIE=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10),!0;if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10),!0}return-1!=navigator.userAgent.indexOf("Chrome")&&(this.BrowserChrome=!0),!1},a.prototype.init=function(){this.SelectedTab=o.TR55,this.showResults=!1,this.hideAlerts=!1,this.CanContinue=!0,this.showPrint=!1,this.ReportData=new r},a.prototype.loadParameters=function(){this.EventManager.UnSubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,this.parameterloadedEventHandler),this.DrnAreaAcres=640*this.SelectedParameterList[0].value;var t=parseInt(this.SelectedPrecip.name.substr(0,2));this.PIntensity=(this.SelectedPrecip.value/t).toUSGSvalue(),this.CanContinue=!0},a.prototype.selectRunoffType=function(){switch(this._selectedTab){case o.TR55:this.SelectedParameterList=this.regionParameters.filter(function(e){return-1!=["DRNAREA","RCN"].indexOf(e.code)}),this.SelectedParameterList.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.showResults=!1;break;default:this.SelectedParameterList=this.regionParameters.filter(function(e){return-1!=["DRNAREA","RUNCO_CO"].indexOf(e.code)}),this.SelectedParameterList.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.showResults=!1}this.PrecipOptions=this.regionParameters.filter(function(e){return-1!=["I6H2Y","I6H100Y","I24H2Y","I24H100Y"].indexOf(e.code)}),this.PrecipOptions.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.SelectedPrecip=this.PrecipOptions[0]},a.prototype.tableToCSV=function(e){function t(e){return e.get().join(s).split(s).join(A).split(n).join(g)}function r(e,t){var r=$(t),o=r.find("td");return o.length||(o=r.find("th")),o.map(a).get().join(n)}function a(e,t){return $(t).text().replace('"','""')}var o=e.find("tr:has(th)"),i=e.find("tr:has(td)"),n=String.fromCharCode(11),s=String.fromCharCode(0),g='","',A='"\r\n"',C='"';return C+=t(o.map(r)),C+=A,C+=t(i.map(r))+'"'},a.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},a.prototype.rand=function(e,t){return parseInt(Math.random()*(t-e+1),10)+e},a.prototype.computeTime=function(e,t){var r=new Date("January 1, 2018 00:00:00"),a=60*e;return r.setMinutes(a),r},a.prototype.computeHours=function(e,t){return(t-e)/36e5},a.prototype.getTimeSpan=function(e,t){var r,a,o=t-e,i=o/6e4%60,n=Math.trunc(o/36e5);return r=n<10?"0"+n:n,a=i<10?"0"+i:i,r+":"+a},a.prototype.loadGraphLabels=function(e){for(var t in e)this.GraphLabels[t]=e[t].span},a.prototype.loadGraphXValues=function(e){var t=0;if(24==this.duration)for(var r in e)++t%2!=0&&this.GraphXValues.push(e[r].hours);else for(var r in e)this.GraphXValues[r]=e[r].hours},a.prototype.loadPadY=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));t<1e3?this.padY=-10:t>=1e3&&t<1e4?this.padY2=0:t>=1e4&&t<1e6?this.padY=20:t>=1e6&&t<1e8&&(this.padY=30)},a.prototype.loadDomainY=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));this.domainY=[0,10*Math.round((t+.18*t)/10)]},a.prototype.loadDomainY2=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));this.domainY2=[0,t+.18*t]},a.prototype.loadPadY2=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));t<1e3?this.padY2=-30:t>=1e3&&(this.padY2=-10)},a.prototype.sortByKey=function(e,t){return e.sort(function(e,r){var a=e[t],o=r[t];return a<o?-1:a>o?1:0})},a}(WiM.Services.HTTPServiceBase);a.$inject=["$scope","$analytics","$http","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.RegionService","$modalInstance","$timeout","WiM.Event.EventManager"];var o;!function(e){e[e.TR55=1]="TR55",e[e.RationalMethod=2]="RationalMethod"}(o||(o={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.StormRunoffController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),StreamStats;!function(e){!function(e){"use string";var t=function(){function e(){}return e}(),r=function(e){function r(r,a,o,i,n,s){var g=e.call(this,a,"")||this;return r.vm=g,g.StudyArea=i.selectedStudyArea,g.Upload=s,g.http=a,g.sce=o,g.modalInstance=n,g.StudyArea=i.selectedStudyArea,g.freshdeskTicketData=new t,g.selectedHelpTabName="help",g.showSuccessAlert=!1,g.submittingSupportTicket=!1,g.init(),g}return __extends(r,e),r.prototype.Close=function(){this.showSuccessAlert=!1,this.modalInstance.dismiss("cancel")},r.prototype.submitFreshDeskTicket=function(e){var r=this;if(e){var a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.CreateTicket,o=new FormData;o.append("helpdesk_ticket[email]",this.freshdeskTicketData.email),o.append("helpdesk_ticket[subject]",this.freshdeskTicketData.subject),o.append("helpdesk_ticket[description]",this.freshdeskTicketData.description),o.append("helpdesk_ticket[custom_field][regionid_"+configuration.SupportTicketService.AccountID+"]",this.RegionID),o.append("helpdesk_ticket[custom_field][workspaceid_"+configuration.SupportTicketService.AccountID+"]",this.WorkspaceID),o.append("helpdesk_ticket[custom_field][server_"+configuration.SupportTicketService.AccountID+"]",this.Server),o.append("helpdesk_ticket[custom_field][browser_"+configuration.SupportTicketService.AccountID+"]",this.Browser),o.append("helpdesk_ticket[custom_field][softwareversion_"+configuration.SupportTicketService.AccountID+"]",this.AppVersion),this.freshdeskTicketData.attachment&&o.append("helpdesk_ticket[attachments][][resource]",this.freshdeskTicketData.attachment,this.freshdeskTicketData.attachment.name);var i={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X"),"Content-Type":void 0},n=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",o,i,angular.identity);this.submittingSupportTicket=!0,this.Execute(n).then(function(e){r.freshdeskTicketData=new t,r.showSuccessAlert=!0},function(e){}).finally(function(){r.submittingSupportTicket=!1})}},r.prototype.getFreshDeskArticles=function(e){var t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+e,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);return this.Execute(a).then(function(e){var t=[];if(e.data.folder.articles.length)return e.data.folder.articles.forEach(function(e){2==e.status&&t.push(e)}),t},function(e){return"There was a problem getting this article"}).finally(function(){})},r.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},r.prototype.selectHelpTab=function(e){this.selectedHelpTabName!=e&&(this.selectedHelpTabName=e)},r.prototype.init=function(){var e=this;this.getBrowser(),this.AppVersion=configuration.version,this.getFreshDeskArticles(configuration.SupportTicketService.FAQarticlesFolder).then(function(t){e.faqArticles=t}),this.getFreshDeskArticles(configuration.SupportTicketService.UserManualArticlesFolder).then(function(t){e.helpArticles=t}),this.StudyArea&&this.StudyArea.WorkspaceID?this.WorkspaceID=this.StudyArea.WorkspaceID:this.WorkspaceID="",this.StudyArea&&this.StudyArea.RegionID?this.RegionID=this.StudyArea.RegionID:this.RegionID="",this.StudyArea&&this.StudyArea.Server?this.Server=this.StudyArea.Server:this.Server=""},r.prototype.getBrowser=function(){(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)&&(this.Browser="Opera"),"undefined"!=typeof InstallTrigger&&(this.Browser="Firefox"),Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0&&(this.Browser="Safari"),window.chrome&&window.chrome.webstore&&(this.Browser="Chrome"),!document.documentMode&&window.StyleMedia&&(this.Browser="Edge"),document.documentMode&&(this.Browser="IE")},r}(WiM.Services.HTTPServiceBase);r.$inject=["$scope","$http","$sce","StreamStats.Services.StudyAreaService","$modalInstance","Upload"],angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.HelpController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),StreamStats;!function(e){!function(e){"use string";var t=function(e){function t(t,r,a,o,i,n,s){var g=e.call(this,r,configuration.baseurls.StreamStats)||this;return t.vm=g,g.sce=a,g.modalInstance=s,g.modalService=o,g.StudyArea=n.selectedStudyArea,g.regionService=i,g.selectedAboutTabName="about",g.regionArticle="<h3>No State or Region Selected</h3>",g.init(),g}return __extends(t,e),t.prototype.Close=function(){this.modalInstance.dismiss("cancel")},t.prototype.selectAboutTab=function(e){this.selectedAboutTabName!=e&&(this.selectedAboutTabName=e)},t.prototype.getActiveNews=function(){var e=this,t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.ActiveNewsFolder,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){var r=[];t.data.folder.articles.length&&("test.streamstats.usgs.gov"==window.location.host?e.activeNewsArticles=t.data.folder.articles:(t.data.folder.articles.forEach(function(e){2==e.status&&r.push(e)}),e.activeNewsArticles=r))},function(e){}).finally(function(){})},t.prototype.getPastNews=function(){var e=this,t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.PastNewsFolder,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){var r=[];t.data.folder.articles.length&&(window.location.host.indexOf("test.streamstats.usgs.gov")>-1?e.pastNewsArticles=t.data.folder.articles:(t.data.folder.articles.forEach(function(e){2==e.status&&r.push(e)}),e.pastNewsArticles=r))},function(e){}).finally(function(){})},t.prototype.getAboutArticle=function(){var e=this,t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.AboutArticle,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){e.aboutArticle=t.data.article.description},function(e){}).finally(function(){})},t.prototype.getRegionHelpArticle=function(){var e,t=this;if(this.modalService.modalOptions&&(this.modalService.modalOptions.tabName&&this.selectAboutTab(this.modalService.modalOptions.tabName),e=this.modalService.modalOptions.regionID),this.regionService.selectedRegion&&(e=this.regionService.selectedRegion.Name),e){var r={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.RegionInfoFolder,o=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",r);configuration.regions.forEach(function(r,a){r.Name===e&&(r.regionEnabled?(t.regionArticle='<i class="fa fa-spinner fa-3x fa-spin loadingSpinner"></i>',t.Execute(o).then(function(r){r.data.folder.articles.forEach(function(r){if(r.title==e)return void(window.location.host.indexOf("test.streamstats.usgs.gov")>-1?t.regionArticle=r.description:2==r.status&&(t.regionArticle=r.description))})},function(e){}).finally(function(){})):t.regionArticle='<div class="wim-alert">StreamStats has not been developed for <strong>'+r.Name+'</strong>.  Please contact the <a href="mailto:support@streamstats.freshdesk.com">streamstats team</a> if you would like StreamStats enabled for this State/Region.</div>')})}},t.prototype.getDisclaimersArticle=function(){var e=this;console.log("Trying to open disclaimers article");var t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.DisclaimersArticle,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){console.log("Successfully retrieved disclaimers article"),e.disclaimersArticle=t.data.article.description},function(e){}).finally(function(){e.getCreditsArticle()})},t.prototype.getCreditsArticle=function(){var e=this;console.log("Trying to open credits article");var t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.CreditsArticle,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){console.log("Successfully retrieved credits article"),e.disclaimersArticle+=t.data.article.description},function(e){}).finally(function(){})},t.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},t.prototype.init=function(){this.AppVersion=configuration.version,this.getAboutArticle(),this.getRegionHelpArticle(),this.getActiveNews(),this.getPastNews(),this.getDisclaimersArticle()},t.prototype.readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var o=r[a];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null},t.prototype.createCookie=function(e,t,r){if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3);var o="; expires="+a.toUTCString()}else var o="";document.cookie=e+"="+t+o+"; path=/"},t}(WiM.Services.HTTPServiceBase);t.$inject=["$scope","$http","$sce","StreamStats.Services.ModalService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","$modalInstance"],angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.AboutController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){!function(e){"use string";var t=function(){function e(e,t,r,a){e.vm=this,this.sce=t,this.modalInstance=r,this.pagecontent=a.modalOptions.placeholder}return e.prototype.Close=function(){this.modalInstance.dismiss("cancel")},e.prototype.convertUnsafe=function(e){return console.log("converting..."),this.sce.trustAsHtml(e)},e.prototype.replaceAll=function(e,t,r){return e.replace(new RegExp(t,"g"),r)},e.prototype.getOldGWWpage=function(){this.pagecontent=""},e}();t.$inject=["$scope","$sce","$modalInstance","StreamStats.Services.ModalService"],angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavigationReportModalController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){!function(e){"use string";var t=function(){function e(e,t,r,a,o,i,n){e.vm=this,this.sce=r,this.angulartics=t,this.modalInstance=a,this.explorationService=i,this.studyAreaService=n,this.DEMresolutionList=["FINEST","10m","30m","90m","1000m"],this.explorationService.selectedMethod.navigationInfo.configuration&&(this.selectExclusiveOption("downstream","Direction"),this.selectOption("flowline","Query Source"),this.checkWorkspaceID()),this.print=function(){window.print()}}return e.prototype.close=function(){this.explorationService.showElevationChart=!1,this.explorationService.setMethod(0,{}),this.modalInstance.dismiss("cancel")},e.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},e.prototype.selectElevationPoints=function(){this.modalInstance.dismiss("cancel"),this.explorationService.selectElevationPoints=!0},e.prototype.addExplorationPointFromMapt=function(e){this.modalInstance.dismiss("cancel"),this.explorationService.explorationPointType=e},e.prototype.addExplorationPointFromPourpoint=function(e,t,r,a){this.explorationService.selectedMethod.addLocation(e,new WiM.Models.Point(t,r,a))},e.prototype.downloadCSV=function(){this.angulartics.eventTrack("Download",{category:"ElevationProfile",label:"CSV"});var e="long,lat,elevation(feet),distance(mi)\r\n";this.explorationService.coordinateList.forEach(function(t){e+=t.join(",")+"\r\n"});var t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"elevation-profile.csv");else{var r=document.createElement("a"),a=URL.createObjectURL(t);void 0!==r.download?(r.setAttribute("href",a),r.setAttribute("download","elevation-profile.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(a)}},e.prototype.addLimit=function(e){var t=this;this.selectedLimit=e,this.deleteConfig("Limit"),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(e,r){if("Limit"==e.name){var a=JSON.parse(JSON.stringify(e));a.value=t.selectedLimit,t.explorationService.selectedMethod.navigationConfiguration.push(a)}})},e.prototype.selectExclusiveOption=function(e,t){var r=this;this.selectedDirection=e,this.deleteConfig(t),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(a,o){if(a.name==t){
var i=JSON.parse(JSON.stringify(a));i.value=e,r.explorationService.selectedMethod.navigationConfiguration.push(i)}})},e.prototype.selectOption=function(e,t){var r=this;this.selectedQuerySourceList||(this.selectedQuerySourceList=[]);var a=this.selectedQuerySourceList.indexOf(e);a>-1?this.selectedQuerySourceList.splice(a,1):this.selectedQuerySourceList.push(e),this.deleteConfig(t),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(e,a){if(e.name==t){var o=JSON.parse(JSON.stringify(e));o.value=r.selectedQuerySourceList,r.explorationService.selectedMethod.navigationConfiguration.push(o)}})},e.prototype.checkWorkspaceID=function(){var e=this;this.studyAreaService.selectedStudyArea&&""!==this.studyAreaService.selectedStudyArea.WorkspaceID&&this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(t,r){"Limit"==t.name&&t.value.forEach(function(t,r){"Polygon geometry"==t.name&&(t.name="Polygon geometry from delineated watershed",t.value=e.studyAreaService.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry)})})},e.prototype.ExecuteNav=function(){if(this.explorationService.selectedMethod.navigationPointCount==this.explorationService.selectedMethod.minLocations){this.explorationService.explorationMethodBusy=!0,this.explorationService.ExecuteSelectedModel()}},e.prototype.deleteConfig=function(e){var t=this;this.explorationService.selectedMethod.navigationConfiguration.forEach(function(r,a){r.name==e&&t.explorationService.selectedMethod.navigationConfiguration.splice(a,1)})},e}();t.$inject=["$scope","$analytics","$sce","$modalInstance","StreamStats.Services.ModalService","StreamStats.Services.ExplorationService","StreamStats.Services.StudyAreaService"],angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ExplorationToolsModalController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),d3.selection.prototype.last=function(){var e=this.size()-1;return d3.select(this[0][e])},d3.selection.prototype.first=function(){return d3.select(this[0][0])};