!function(e){var t=function(){function e(e,t,a,r,n){this.$stateProvider=e,this.$urlRouterProvider=t,this.$locationProvider=a,this.$logProvider=r,this.$compilerProvider=n,this.$stateProvider.state("main",{url:"/?rcode&workspaceID",template:"<ui-view/>",views:{map:{templateUrl:"Views/mapview.html",controller:"StreamStats.Controllers.MapController"},sidebar:{templateUrl:"Views/sidebarview.html",controller:"StreamStats.Controllers.SidebarController"},navbar:{templateUrl:"Views/navigationview.html",controller:"StreamStats.Controllers.NavbarController"},report:{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController"}}}),this.$urlRouterProvider.otherwise("/"),this.$locationProvider.html5Mode(!0),this.$logProvider.debugEnabled(!1),"production"==configuration.environment&&this.$compilerProvider.debugInfoEnabled(!1)}return e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$logProvider","$compileProvider"],e}();angular.module("StreamStats",["ui.router","ui.bootstrap","ui.checkbox","mobile-angular-ui","toaster","ngFileUpload","leaflet-directive","StreamStats.Services","StreamStats.Controllers","WiM.Services","WiM.Event","wim_angular","rzModule","nvd3","daterangepicker","angularjs-dropdown-multiselect","ngSanitize","highcharts-ng"]).config(t)}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){return function(e,t){this.RegionID=e,this.Pourpoint=t,this.CoordinatedReach=null,this.defaultNHDStream=null,this.NHDStream=null,this.NHDStreamIntersections=null,this.defaultWBDHUC8=null,this.WBDHUC8=null,this.WBDHUC8Intersections=null,this.ActiveExtension=[],this.NSS_Extensions=[]}}();e.StudyArea=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){return function(){this.append=[],this.remove=[]}}();e.WatershedEditDecisionList=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(e){var t=function(){function e(e,t){this.navigationID=e,this.navigationInfo=t,this.navigationInfo.configuration&&(this.minLocations=this.getCountByType(this.navigationInfo.configuration,"geojson point geometry")),this.navigationConfiguration=[],this.navigationPointCount=0,this._locations=[]}return Object.defineProperty(e.prototype,"locations",{get:function(){return this._locations},enumerable:!1,configurable:!0}),e.prototype.addLocation=function(e,t){var a=this;this._locations.push(t),this.navigationConfiguration.reverse().forEach(function(t,r){t.name==e&&(console.log("found this point already, deleting:",a.navigationConfiguration,r),a.navigationConfiguration.splice(r,1),a.navigationPointCount-=1)}),this.navigationPointCount+=1,this.navigationConfiguration.push({id:this.navigationPointCount,name:e,required:!0,description:"Specified lat/long/crs  navigation start location",valueType:"geojson point geometry",value:{type:"Point",coordinates:[t.Longitude,t.Latitude],crs:{properties:{name:"EPSG:"+t.crs},type:"name"}}}),this._locations.length>this.minLocations&&this._locations.shift()},e.prototype.getCountByType=function(e,t){return e.filter(function(e){return e.valueType.toLowerCase().indexOf(t)>=0}).length},e}();e.NetworkNav=t;var a=function(e){function t(){return e.call(this,2,2)||this}return __extends(t,e),t}(t);e.NetworkPath=a;var r=function(e){function t(){var t=e.call(this,1,1)||this;return t._workspaceID="",t}return __extends(t,e),Object.defineProperty(t.prototype,"workspaceID",{get:function(){return this._workspaceID},set:function(e){this._workspaceID=e},enumerable:!1,configurable:!0}),t}(t);e.FlowPath=r;var n=function(e){function t(){var t=e.call(this,3,1)||this;return t.layerOptions=[{name:"NHDFlowline",selected:!0},{name:"Gage",selected:!1},{name:"Dam",selected:!1}],t.DirectionOptions=["Upstream","Downstream"],t.selectedDirectionType=t.DirectionOptions[1],t}return __extends(t,e),t}(t);e.NetworkTrace=n}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){function e(e,t,a,r,n,i){this._label="Coordinated Reach - Stream ID: "+r+", Stream Name: "+a+", Basin Name: "+e+", Begin Drainage Area: "+n+" sq mi, End Drainage Area: "+i+" sq mi",this._basinName=e,this._eqID=t,this._streamName=a,this._streamID=r,this._begDrainageArea=n,this._endDrainageArea=i,this._flowCoefficients={}}return Object.defineProperty(e.prototype,"FlowCoefficients",{get:function(){return this._flowCoefficients},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"basinName",{get:function(){return this._basinName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"eqID",{get:function(){return this._eqID},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"streamID",{get:function(){return this._streamID},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"begDrainageArea",{get:function(){return this._begDrainageArea},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endDrainageArea",{get:function(){return this._endDrainageArea},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"streamName",{get:function(){return this._streamName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!1,configurable:!0}),e.prototype.AddFlowCoefficient=function(e,t,a){null!==this._flowCoefficients[e]&&(this._flowCoefficients[e]={CoefficientA:t,CoefficientB:a})},e.prototype.Execute=function(e){try{var t=[];for(var a in this.FlowCoefficients)if(this.FlowCoefficients.hasOwnProperty(a)){var r=this.FlowCoefficients[a];t.push({code:a,description:this.getDescription(a),name:this.getName(a),unit:{unit:"cubic feet per second",abbr:"ft^3/s"},value:this.getValue(r,e[0].value)})}var n=[];for(var a in n.push({code:e[0].code,value:e[0].value,name:e[0].name,unitType:{abbr:e[0].unit,unit:e[0].unit}}),this.FlowCoefficients)n.push({code:a+"CoeffA",value:Number(this.FlowCoefficients[a].CoefficientA).toFixed(3),name:a+" CoefficientA",unitType:{abbr:"dim",unit:"dimensionless"}}),n.push({code:a+"CoeffB",value:Number(this.FlowCoefficients[a].CoefficientB).toFixed(3),name:a+" CoefficientB",unitType:{abbr:"dim",unit:"dimensionless"}});return{id:0,name:this.label,code:this.eqID,parameters:n,results:t}}catch(e){return console.log(e),null}},e.prototype.getDescription=function(e){var t="";switch(e){case"PK10":t="10";break;case"PK25":t="25";break;case"PK50":t="50";break;case"PK100":t="100";break;case"PK200":t="200";break;case"PK500":t="500";break;default:t="undefined"}return"Maximum instantaneous flow that occurs on average once in {0} years".format(t)},e.prototype.getName=function(e){var t="";switch(e){case"PK10":t="10";break;case"PK25":t="25";break;case"PK50":t="50";break;case"PK100":t="100";break;case"PK200":t="200";break;case"PK500":t="500";break;default:t="undefined"}return"{0} year Peak Flood".format(t)},e.prototype.getValue=function(e,t){try{return e.CoefficientA||0===e.CoefficientA||e.CoefficientB||0===e.CoefficientB||t?e.CoefficientA*Math.pow(t,e.CoefficientB):null}catch(e){return null}},e}();e.CoordinatedReach=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){return function(e,t){this.StationID=e,this.Name=t}}();e.ReferenceGage=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Services",[])}();__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(e){"use strict";var t=function(){return function(){}}();e.StatisticsGroup=t,e.onScenarioExtensionChanged="onScenarioExtensionChanged",e.onScenarioExtensionResultsChanged="onScenarioExtensionResultsChanged";var a=function(e){function t(t,a,r){void 0===t&&(t=null),void 0===a&&(a=null),void 0===r&&(r=null);var n=e.call(this)||this;return n.extensions=t,n.results=a,n.regressionRegionName=r,n}return __extends(t,e),t}(WiM.Event.EventArgs);e.NSSEventArgs=a;var r=function(t){function r(e,a,r,n,i,o){var s=t.call(this,e,configuration.baseurls.NSS)||this;return s.$q=a,s.regionservice=i,s.eventManager=o,s.equationWeightingResults=[],s.equationWeightingDisclaimers=[],s.toaster=r,s.modalService=n,s._onSelectedStatisticsGroupChanged=new WiM.Event.Delegate,s._onQ10Loaded=new WiM.Event.Delegate,s.clearNSSdata(),s}return __extends(r,t),Object.defineProperty(r.prototype,"onSelectedStatisticsGroupChanged",{get:function(){return this._onSelectedStatisticsGroupChanged},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onQ10Loaded",{get:function(){return this._onQ10Loaded},enumerable:!1,configurable:!0}),r.prototype.clearNSSdata=function(){this.loadingParametersByStatisticsGroupCounter=0,this.estimateFlowsCounter=0,this.selectedStatisticsGroupList=[],this.statisticsGroupList=[],this.canUpdate=!0,this.queriedRegions=!1,this.isDone=!1,this.reportGenerated=!1},r.prototype.loadStatisticsGroupTypes=function(e,t){var a=this;if(this.toaster.pop("wait","Loading Available Scenarios","Please wait...",0),e||t){var r=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupLookup.format(e,t),n=new WiM.Services.Helpers.RequestInfo(r,!0);this.loadingStatisticsGroup=!0,this.statisticsGroupList=[],this.Execute(n).then(function(e){e.data.length>0&&(a.loadingStatisticsGroup=!1,angular.forEach(e.data,function(e,t){if(a.statisticsGroupList.push(e),a.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&5==e.id){var r=JSON.parse(JSON.stringify(e));r.id+="_fdctm",r.name="Flow-Duration Curve Transfer Method",a.statisticsGroupList.push(r)}})),a.toaster.clear()},function(e){a.toaster.clear(),a.toaster.pop("error","There was an error Loading Available Scenarios","Please retry",0)}).finally(function(){a.loadingStatisticsGroup=!1})}},r.prototype.checkArrayForObj=function(e,t){for(var a=0;a<e.length;a++)if(angular.equals(e[a],t))return a;return-1},r.prototype.loadParametersByStatisticsGroup=function(t,r,n,i,o){var s=this;if(0==this.loadingParametersByStatisticsGroupCounter&&this.toaster.pop("wait","Loading Parameters by Statistics Group","Please wait...",0),this.loadingParametersByStatisticsGroupCounter++,t||r||n){var l=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupParameterLookup;this.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&r.toString().indexOf("_fdctm")>-1&&(r=r.replace("_fdctm",""),l+="&extensions=QPPQ"),l=l.format(t,r,n),void 0!=o&&(l+="&regressiontypes="+o);var g=new WiM.Services.Helpers.RequestInfo(l,!0);this.Execute(g).then(function(t){if(t.data[0].regressionRegions[0].extensions&&t.data[0].regressionRegions[0].extensions.length>0){var r=t.data[0].regressionRegions[0].extensions;s.eventManager.RaiseEvent(e.onScenarioExtensionChanged,s,new a(r))}t.data[0].regressionRegions[0].parameters&&t.data[0].regressionRegions[0].parameters.length>0&&(0==s.selectedStatisticsGroupList.length&&s.selectedStatisticsGroupList.push({name:"",id:"7",code:"",regressionRegions:[],citations:null,disclaimers:""}),s.selectedStatisticsGroupList.forEach(function(e){(t.data[0].statisticGroupID==e.id||s.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&"string"==typeof e.id&&e.id.indexOf(t.data[0].statisticGroupID,0)>-1)&&(e.statisticGroupName=e.name,e.statisticGroupID=e.id.toString().replace("_fdctm",""),t.data[0].regressionRegions.forEach(function(e){i.length>0&&i.forEach(function(t){t.code.indexOf(e.code.toUpperCase())>-1&&(e.percentWeight=t.percentWeight)})}),e.regressionRegions=t.data[0].regressionRegions,s._onSelectedStatisticsGroupChanged.raise(null,WiM.Event.EventArgs.Empty))}))},function(e){s.toaster.clear(),s.toaster.pop("error","There was an error Loading Parameters by Statistics Group","Please retry",0)}).finally(function(){s.loadingParametersByStatisticsGroupCounter--,0==s.loadingParametersByStatisticsGroupCounter&&s.toaster.clear()})}},r.prototype.estimateFlows=function(t,r,n,i,o,s){var l=this;void 0===i&&(i=!1),void 0===s&&(s=!0),(this.canUpdate||i)&&this.selectedStatisticsGroupList.forEach(function(g){l.canUpdate=!1,0==l.estimateFlowsCounter&&l.toaster.pop("wait","Estimating Flows","Please wait...",0),l.estimateFlowsCounter++,l.cleanRegressionRegions(g.regressionRegions),g.regressionRegions.forEach(function(e){e.disclaimer&&(e.disclaimer=null),e.parameters.forEach(function(e){t.forEach(function(t){e.code.toLowerCase()==t.code.toLowerCase()&&(e.value=t[r])})})});var c=angular.fromJson(angular.toJson(g));c.regressionRegions.forEach(function(e){e.results&&delete e.results,e.extensions&&e.extensions.forEach(function(e){e.result&&delete e.result,e.parameters&&e.parameters.forEach(function(e){e.options&&delete e.options})})}),c=angular.toJson([c],null);var u=configuration.baseurls.NSS+configuration.queryparams.estimateFlows.format(n);l.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&"string"==typeof g.id&&g.id.indexOf("_fdctm")>-1&&(u+="&extensions=QPPQ"),""!=o&&void 0!=o&&(u+="&regressiontypes="+o);var d=new WiM.Services.Helpers.RequestInfo(u,!0,1,"json",c);g.citations=[],l.Execute(d).then(function(t){var n=t.data[0].links[0].href,o=n.split("regressionregions=")[1];if(!i&&o&&o.length>0&&l.getSelectedCitations(n,g),t.headers()["x-usgswim-messages"]){var s=t.headers()["x-usgswim-messages"].split(";");g.disclaimers={},s.forEach(function(e){var t=e.split(":");"warning"==t[0]&&(g.disclaimers.Warnings=t[1].trim()),"error"==t[0]&&(g.disclaimers.Error=t[1].trim())})}t.data[0].regressionRegions.length>0&&t.data[0].regressionRegions[0].results&&t.data[0].regressionRegions[0].results.length>0?i?g.regressionRegions.forEach(function(e){e.parameters.forEach(function(a){for(var n=t.data[0].regressionRegions,i=0;i<n.length;i++)if(n[i].id===e.id)for(var o=0;o<n[i].parameters.length;o++)n[i].Parameters[o].code==a.code&&(a[r]=n[i].parameters[o].value)}),e.results.forEach(function(a){for(var n=t.data[0].regressionRegions,i=0;i<n.length;i++)if(n[i].id===e.id)for(var o=0;o<n[i].results.length;o++)n[i].results[o].code==a.code&&(a[r]=n[i].results[o].value)})}):(t.data[0].regressionRegions.forEach(function(t){t.extensions&&(t.extensions.forEach(function(e){var a=g.regressionRegions.filter(function(e){return e.name==t.name})[0].extensions.filter(function(t){return t.code==e.code})[0];e.parameters.forEach(function(e){e.options=a.parameters.filter(function(t){return t.code==e.code})[0].options})}),l.eventManager.RaiseEvent(e.onScenarioExtensionResultsChanged,l,new a(null,t.extensions,t.name)))}),g.regressionRegions=[],g.regressionRegions=t.data[0].regressionRegions):(l.toaster.clear(),l.toaster.pop("error","There was an error Estimating Flows for "+g.name,"No results were returned",0))},function(e){l.toaster.clear(),l.toaster.pop("error","There was an error Estimating Flows","HTTP request error",0)}).finally(function(){-1!=l.regionservice.selectedRegion.Applications.indexOf("ChannelWidthWeighting")&&"Peak-Flow Statistics"==g.name&&l.queryEquationWeighting(),l.estimateFlowsCounter--,l.estimateFlowsCounter<1&&(l.toaster.clear(),l.estimateFlowsCounter=0,s&&-1!=l.regionservice.selectedRegion.Applications.indexOf("ChannelWidthWeighting")?setTimeout(function(){l.canUpdate=!0,l.modalService.openModal(e.SSModalType.e_report),l.reportGenerated=!0},1e3):s&&(l.canUpdate=!0,l.modalService.openModal(e.SSModalType.e_report),l.reportGenerated=!0)),l._onQ10Loaded.raise(null,WiM.Event.EventArgs.Empty)})})},r.prototype.queryEquationWeighting=function(){var e=null,t=[];this.equationWeightingResults=[],this.equationWeightingDisclaimers=[],this.selectedStatisticsGroupList.forEach(function(a){"Peak-Flow Statistics"==a.name&&a.regressionRegions.forEach(function(a,r){"Area-Averaged"!=a.name&&a.results&&(t[r]={name:null,inUse:!1,percentWeight:null,RegressionRegionName:null,code:null,values:[]},a.results.forEach(function(n,i){n.code.includes("ACPK")?(t[r].name="ACPK",t[r].RegressionRegionName=a.name.substring(0,a.name.indexOf("Region")+"Region".length),t[r].percentWeight=a.percentWeight,n.value>0?(t[r].code=a.code,t[r].inUse=!0,t[r].values[i]={value:n.value,SEP:n.sep?n.sep:null,code:n.code}):(t[r].code=null,t[r].inUse=!1,t[r].values[i]={value:null,SEP:null,code:n.code})):n.code.includes("BWPK")?(t[r].name="BFPK",t[r].RegressionRegionName=a.name.substring(0,a.name.indexOf("Region")+"Region".length),t[r].percentWeight=a.percentWeight,n.value>0?(t[r].code=a.code,t[r].inUse=!0,t[r].values[i]={value:n.value,SEP:n.sep?n.sep:null,code:n.code}):(t[r].code=null,t[r].inUse=!1,t[r].values[i]={value:null,SEP:null,code:n.code})):n.code.includes("RSPK")?(t[r].name="RSPK",t[r].RegressionRegionName=a.name.substring(0,a.name.indexOf("Region")+"Region".length),t[r].percentWeight=a.percentWeight,n.value>0?(t[r].code=a.code,t[r].inUse=!0,t[r].values[i]={value:n.value,SEP:n.sep?n.sep:null,code:n.code}):(t[r].code=null,t[r].inUse=!1,t[r].values[i]={value:null,SEP:null,code:n.code})):(t[r].name="BCPK",t[r].RegressionRegionName=a.name.substring(0,a.name.indexOf("Region")+"Region".length),t[r].percentWeight=a.percentWeight,n.value>0?(e=n.unit,t[r].inUse=!0,t[r].values[i]={value:n.value,SEP:n.sep?n.sep:null,code:n.code}):(t[r].inUse=!1,t[r].values[i]={value:null,SEP:null,code:n.code}))}))})});var a=t.filter(function(e){return"BCPK"==e.name}),r=t.filter(function(e){return 1==e.inUse}).length/a.length;t.sort(function(e,t){return e.name.localeCompare(t.name)});for(var n=0;n<t.length;n++)t[n].values.sort(function(e,t){return e.code.localeCompare(t.code)});if(r>=2)for(var i=configuration.baseurls.WeightingServices+"/weightest/",o={accept:"application/json","Content-Type":"application/json"},s=0;s<a.length;){this.equationWeightingResults[s]={RR:t[s].RegressionRegionName,Results:[]};var l=t[0].values.length-1;this.recursiveAreaWeightSubscription(t[0].values,l,t,i,o,e,a,s),s++}else this.toaster.pop("error","Cannot Weight Channel-width Methods, not enough values")},r.prototype.recursiveAreaWeightSubscription=function(e,t,a,r,n,i,o,s){var l=this;if(t>=0){var g,c;a[0*o.length+s].code&&(c=a[0*o.length+s].code),a[1*o.length+s].code&&(c=a[1*o.length+s].code),a[2*o.length+s].code&&(c=a[2*o.length+s].code),a[3*o.length+s].code&&(c=a[3*o.length+s].code),g={x1:a[0*o.length+s].values[t].value,x2:a[1*o.length+s].values[t].value,x3:a[2*o.length+s].values[t].value,x4:a[3*o.length+s].values[t].value,sep1:a[0*o.length+s].values[t].SEP,sep2:a[1*o.length+s].values[t].SEP,sep3:a[2*o.length+s].values[t].SEP,sep4:a[3*o.length+s].values[t].SEP,regressionRegionCode:c,code1:a[0*o.length+s].values[t].code,code2:a[1*o.length+s].values[t].code,code3:a[2*o.length+s].values[t].code,code4:a[3*o.length+s].values[t].code};var u=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",JSON.stringify(g),n);this.Execute(u).then(function(e){if(l.equationWeightingResults[s].Results[t]={Name:a[1*o.length+s].values[t].code,Z:e.data.Z,Unit:i,PIl:e.data.PIL,PIu:e.data.PIU,SEPZ:e.data.SEPZ},e.headers("x-usgswim-messages")){var r=JSON.parse(e.headers()["x-usgswim-messages"]);Object.keys(r).forEach(function(e){r[e].split(". ").forEach(function(e){l.equationWeightingDisclaimers.push(e)})})}l.equationWeightingDisclaimers=l.equationWeightingDisclaimers.filter(function(e,t){return l.equationWeightingDisclaimers.indexOf(e)===t}),l.equationWeightingDisclaimers=l.equationWeightingDisclaimers.filter(Boolean)},function(e){l.toaster.clear(),e.data&&e.data.detail?l.toaster.pop("error","Cannot Weight Channel-width Methods: "+e.data.detail,"HTTP request error",0):l.toaster.pop("error","Cannot Weight Channel-width Methods")}).finally(function(){t-=1,l.recursiveAreaWeightSubscription(e,t,a,r,n,i,o,s)})}else o.length==s+1&&(this.equationWeightingResults=this.equationWeightingResults.filter(function(e){return e.Results.length>0}),o.length>1&&this.equationWeightingResults.length>0&&setTimeout(function(){l.equationWeightingResults[s+1]={RR:"Area-Averaged",Results:[]};for(var e=new Array(a[0].values.length),t=new Array(a[0].values.length),r=new Array(a[0].values.length),n=new Array(a[0].values.length),g=0;g<a[0].values.length;++g)n[g]=0,r[g]=0,t[g]=0,e[g]=0;for(var c=0;c<l.equationWeightingResults.length-1;c++){for(var u=[],d=[],A=[],h=[],p=0;p<l.equationWeightingResults[c].Results.length;p++)u.push(l.equationWeightingResults[c].Results[p].Z),d.push(l.equationWeightingResults[c].Results[p].PIl),A.push(l.equationWeightingResults[c].Results[p].PIu),h.push(l.equationWeightingResults[c].Results[p].SEPZ);u=u.map(function(e){return e*(a[c].percentWeight/100)}),d=d.map(function(e){return e*(a[c].percentWeight/100)}),A=A.map(function(e){return e*(a[c].percentWeight/100)}),h=h.map(function(e){return e*(a[c].percentWeight/100)}),n=n.map(function(e,t){return e+u[t]}),e=e.map(function(e,t){return e+d[t]}),t=t.map(function(e,t){return e+A[t]}),r=r.map(function(e,t){return e+h[t]})}for(var C=0;C<a[0].values.length;++C)l.equationWeightingResults[l.equationWeightingResults.length-1].Results[C]={Name:a[1*o.length+s].values[C].code,Z:n[C],Unit:i,PIl:e[C],PIu:t[C],SEPZ:r[C]}},75))},r.prototype.getSelectedCitations=function(e,t){var a,r=this;a=-1==e.indexOf("https://")?"https://"+e:e;var n=new WiM.Services.Helpers.RequestInfo(a,!0,0,"json");this.Execute(n).then(function(e){e.data[0]&&e.data[0].id&&angular.forEach(e.data,function(e,a){t.citations.push(e)})},function(e){r.toaster.pop("error","There was an error getting selected Citations for "+t.name,"No results were returned",0)}).finally(function(){})},r.prototype.getflattenNSSTable=function(e){var t=[];try{this.selectedStatisticsGroupList.forEach(function(a){a.regressionRegions.forEach(function(a){a.results.forEach(function(r){t.push({Name:e,Region:a.percentWeight?a.percentWeight.toFixed(1)+"% "+a.name:a.name,Statistic:r.name,Code:r.code,Value:r.value.toUSGSvalue(),Unit:r.unit.unit,Disclaimers:a.disclaimer?a.disclaimer:void 0,Errors:r.errors&&r.errors.length>0?r.errors.map(function(e){return e.name+" : "+e.value}).join(", "):void 0,MaxLimit:r.intervalBounds&&r.intervalBounds.upper>0?r.intervalBounds.upper.toUSGSvalue():void 0,MinLimit:r.intervalBounds&&r.intervalBounds.lower>0?r.intervalBounds.lower.toUSGSvalue():void 0,EquivYears:r.equivalentYears?r.equivalentYears:void 0})})})})}catch(e){t.push({Disclaimers:"Failed to output flowstats to table. "})}return t},r.prototype.getRegionList=function(){var e=this,t=configuration.baseurls.NSS+configuration.queryparams.Regions,a=new WiM.Services.Helpers.RequestInfo(t,!0);return this.Execute(a).then(function(e){return e.data},function(t){e.toaster.pop("error","There was an HTTP error returning the regions list.","Please retry",0)}).finally(function(){})},r.prototype.getFlowStatsList=function(e){var t=this;if(e){var a=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupParameterLookup.format(e,"",""),r=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",{"Content-Type":"application/json","X-Is-StreamStats":!0});return this.Execute(r).then(function(e){var t=e.data;return t.forEach(function(e){e.checked=!1}),t},function(e){t.toaster.pop("error","There was an HTTP error returning the flow statistics list.","Please retry",0)}).finally(function(){})}},r.prototype.cleanRegressionRegions=function(e){for(var t=0;t<e.length;t++){"Area-Averaged"!==e[t].name?e.forEach(function(e){e.Results&&delete e.Results}):e.splice(t,1)}},r}(WiM.Services.HTTPServiceBase);function n(e,t,a,n,i,o){return new r(e,t,a,n,i,o)}n.$inject=["$http","$q","toaster","StreamStats.Services.ModalService","StreamStats.Services.RegionService","WiM.Event.EventManager"],angular.module("StreamStats.Services").factory("StreamStats.Services.nssService",n)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(e){"use strict";var t=function(){return function(){}}();e.Region=t;var a=function(){return function(){}}();e.Parameter=a,e.onSelectedRegionChanged="onSelectedRegionChanged";var r=function(t){function a(a,r,n,i){var o=t.call(this,a,configuration.baseurls.StreamStatsServices)||this;return o.$q=r,o.eventManager=i,o.toaster=n,o.regionList=[],o.parameterList=[],o.masterRegionList=configuration.regions,o.streamStatsAvailable=!1,o.eventManager.AddEvent(e.onSelectedRegionChanged),o}return __extends(a,t),Object.defineProperty(a.prototype,"selectedRegion",{get:function(){return this._selectedRegion},set:function(t){this._selectedRegion!=t&&(this._selectedRegion=t,this.eventManager.RaiseEvent(e.onSelectedRegionChanged,this,WiM.Event.EventArgs.Empty))},enumerable:!1,configurable:!0}),a.prototype.clearRegion=function(){this.regionList=[],this.parameterList=[],this.regionMapLayerList=[],this.selectedRegion=null,this.regionMapLayerListLoaded=!1,this.resetView=!1},a.prototype.clearSelectedParameters=function(){this.parameterList.forEach(function(e){e.checked=!1,delete e.value})},a.prototype.intersect=function(e,t){return Math.max(e.left,t.left)<Math.min(e.right,t.right)&&Math.min(e.top,t.top)>Math.max(e.bottom,t.bottom)},a.prototype.loadRegionListByExtent=function(e,t,a,r,n){var i=this;void 0===n&&(n=4326),this.regionList=[];var o={top:r,bottom:a,left:t,right:e};configuration.regions.forEach(function(e,t){var a={top:e.Bounds[1][0],bottom:e.Bounds[0][0],left:e.Bounds[0][1],right:e.Bounds[1][1]};i.intersect(o,a)&&i.regionList.push(e)})},a.prototype.loadRegionListByRegion=function(e){this.regionList.length=0;var t=this.getRegion(e);return null!=t&&(this.regionList.push(t),!0)},a.prototype.loadMapLayersByRegion=function(e){var t=this;this.regionMapLayerListLoaded=!1;var a=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers+"?f=pjson",r=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json");this.regionMapLayerList=[],this.Execute(r).then(function(a){a.data.layers?(a.data.layers.forEach(function(r,n){r.name==e&&r.subLayerIds.forEach(function(e,r){t.regionMapLayerList.push([a.data.layers[e].name,a.data.layers[e].id,!1])})}),t.regionMapLayerListLoaded=!0):t.toaster.pop("warning","No map layers available","",5e3)},function(e){return console.log("No region map layers found"),t.$q.reject(e.data)}).finally(function(){})},a.prototype.loadParametersByRegion=function(){var e=this;if(this.selectedRegion){var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSAvailableParams.format(this.selectedRegion.RegionID),a=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(a).then(function(t){t.data.parameters&&t.data.parameters.length>0?(e.streamStatsAvailable=!0,t.data.parameters.forEach(function(t){try{t.checked=!1,t.toggleable=!0,e.parameterList.push(t)}catch(e){alert(e)}}),e.parameterList.sort(function(e,t){return e.code>t.code?1:t.code>e.code?-1:0})):(e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3))},function(t){console.log("Bad response from the regression service"),e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3)}).finally(function(){})}},a.prototype.getRegion=function(e){var t=configuration.regions;try{for(var a=0;a<t.length;a++)if(t[a].Name.toUpperCase().trim()===e.toUpperCase().trim()||t[a].RegionID.toUpperCase().trim()===e.toUpperCase().trim())return t[a];return null}catch(e){return null}},a}(WiM.Services.HTTPServiceBase);function n(e,t,a,n){return new r(e,t,a,n)}n.$inject=["$http","$q","toaster","WiM.Event.EventManager"],angular.module("StreamStats.Services").factory("StreamStats.Services.RegionService",n)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(t){"use strict";t.onSelectedStudyAreaChanged="onSelectedStudyAreaChanged",t.onSelectedStudyParametersLoaded="onSelectedStudyParametersLoaded",t.onStudyAreaReset="onStudyAreaReset",t.onEditClick="onEditClick",t.onAdditionalFeaturesLoaded="onAdditionalFeaturesLoaded",t.onRegressionLoaded="onRegressionLoaded";var a=function(e){function t(t,a,r){void 0===t&&(t=null),void 0===a&&(a=!1),void 0===r&&(r=!1);var n=e.call(this)||this;return n.studyArea=t,n.studyAreaVisible=a,n.parameterLoaded=r,n}return __extends(t,e),t}(WiM.Event.EventArgs);t.StudyAreaEventArgs=a;var r=function(r){function n(e,a,n,i,o,s,l){var g=r.call(this,e,configuration.baseurls.StreamStatsServices)||this;return g.$http=e,g.$q=a,g.eventManager=n,g.nssService=s,g.regionService=l,g._onStudyAreaServiceFinishedChanged=new WiM.Event.Delegate,g.surfacecontributionsonly=!1,g.doSelectMapGage=!1,g.doSelectNearestGage=!1,g.NSSServicesVersion="",g.streamgagesVisible=!0,g.additionalFeaturesLoaded=!1,g.global=!0,g.extensionDateRange=null,g.extensionsConfigured=!1,g.loadingDrainageArea=!1,g.extensionResultsChanged=0,g.flowAnywhereData=null,g.ignoreExclusionPolygons=!1,g.modalservices=o,n.AddEvent(t.onSelectedStudyParametersLoaded),n.AddEvent(t.onSelectedStudyAreaChanged),n.AddEvent(t.onStudyAreaReset),n.AddEvent(t.onAdditionalFeaturesLoaded),n.SubscribeToEvent(t.onSelectedStudyAreaChanged,new WiM.Event.EventHandler(function(e,t){g.onStudyAreaChanged(e,t)})),n.SubscribeToEvent(t.onScenarioExtensionChanged,new WiM.Event.EventHandler(function(e,t){g.onNSSExtensionChanged(e,t)})),n.SubscribeToEvent(t.onScenarioExtensionResultsChanged,new WiM.Event.EventHandler(function(e,t){g.onNSSExtensionResultsChanged(e,t)})),n.AddEvent(t.onEditClick),g._studyAreaList=[],g.toaster=i,g.clearStudyArea(),g.servicesURL=configuration.baseurls.StreamStatsServices,g._onQ10Loaded=new WiM.Event.Delegate,g.parameterloadedEventHandler=new WiM.Event.EventHandler(function(e,t){null!=t&&t.parameterLoaded&&(g.nssService.estimateFlows(g.studyAreaParameterList,"value",g.selectedStudyArea.RegionID,!1,g.regtype,!1),g.onQ10Available())}),g.statisticgroupEventHandler=new WiM.Event.EventHandler(function(){g.eventManager.SubscribeToEvent(t.onSelectedStudyParametersLoaded,g.parameterloadedEventHandler),g.loadParameters(),g.afterSelectedStatisticsGroupChanged()}),g.q10EventHandler=new WiM.Event.EventHandler(function(e,t){g.afterQ10Loaded()}),g}return __extends(n,r),Object.defineProperty(n.prototype,"onStudyAreaServiceBusyChanged",{get:function(){return this._onStudyAreaServiceFinishedChanged},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onQ10Loaded",{get:function(){return this._onQ10Loaded},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"StudyAreaList",{get:function(){return this._studyAreaList},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectedStudyArea",{get:function(){return this._selectedStudyArea},set:function(e){this.canUpdate&&this._selectedStudyArea!=e&&(this._selectedStudyArea=e,this.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,this,a.Empty))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectedStudyAreaExtensions",{get:function(){return null==this.selectedStudyArea?null:this.selectedStudyArea.NSS_Extensions},enumerable:!1,configurable:!0}),n.prototype.editBasin=function(e){this.selectedStudyArea.Disclaimers.isEdited=!0,this.drawControlOption=e,this.eventManager.RaiseEvent(t.onEditClick,this,WiM.Event.EventArgs.Empty)},n.prototype.undoEdit=function(){delete this.selectedStudyArea.Disclaimers.isEdited,this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,this,a.Empty)},n.prototype.AddStudyArea=function(e){this.clearStudyArea(),this.StudyAreaList.push(e),this.selectedStudyArea=e,this.selectedStudyArea.Disclaimers={}},n.prototype.RemoveStudyArea=function(){},n.prototype.clearStudyArea=function(){this.canUpdate=!0,this.regulationCheckComplete=!0,this.parametersLoading=!1,this.doDelineateFlag=!1,this.checkingDelineatedPoint=!1,this.studyAreaParameterList=[],this.regulationCheckResults=[],this.allIndexGages=void 0,this.selectedStudyArea&&(this.selectedStudyArea.Disclaimers={}),this.showEditToolbar=!1,this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this.selectedStudyArea=null,this.zoomLevel15=!0,this.regressionRegionQueryComplete=!1,this.regressionRegionQueryLoading=!1,this.eventManager.RaiseEvent(t.onStudyAreaReset,this,WiM.Event.EventArgs.Empty)},n.prototype.loadStudyBoundary=function(){var e=this;this.toaster.pop("wait","Delineating Basin","Please wait...",0),this.canUpdate=!1;var r=this.selectedStudyArea.RegionID,n=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSdelineation.format("geojson",r,this.selectedStudyArea.Pourpoint.Longitude.toString(),this.selectedStudyArea.Pourpoint.Latitude.toString(),this.selectedStudyArea.Pourpoint.crs.toString());if(this.regionService.selectedRegion.Applications.indexOf("StormDrain")>-1)n=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSstormwaterDelineation.format(r,this.selectedStudyArea.Pourpoint.Longitude.toString(),this.selectedStudyArea.Pourpoint.Latitude.toString(),this.surfacecontributionsonly);var i=new WiM.Services.Helpers.RequestInfo(n,!0);i.withCredentials=!0,this.Execute(i).then(function(r){try{var n=r.data.featurecollection.filter(function(e){return"globalwatershed"==e.name})[0].feature.features[0].properties.RELATEDOID;e.global=" "!=n}catch(t){e.global=!0}if(e.regionService.selectedRegion.Applications.indexOf("StormDrain")>-1)if(r.data.layers&&r.data.layers.features&&r.data.layers.features[1].geometry.coordinates.length>0){e.selectedStudyArea.Disclaimers.isStormDrain=!0;var i=r.data.hasOwnProperty("layers")?r.data.layers:null;i&&i.features.forEach(function(e){return e.id=e.id.toString().toLowerCase()}),e.selectedStudyArea.FeatureCollection=i,e.selectedStudyArea.WorkspaceID=r.data.hasOwnProperty("workspaceID")?r.data.workspaceID:null,e.selectedStudyArea.Date=new Date,e.toaster.clear(),e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,a.Empty),e.canUpdate=!0}else e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","A watershed was not returned from the delineation request","Please retry",0);else r.data.hasOwnProperty("featurecollection")&&r.data.featurecollection[1]&&r.data.featurecollection[1].feature.features.length>0?(e.selectedStudyArea.Server=r.headers()["usgswim-hostname"].toLowerCase(),e.selectedStudyArea.WorkspaceID=r.data.hasOwnProperty("workspaceID")?r.data.workspaceID:null,e.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:e.reconfigureWatershedResponse(r.data.featurecollection),bbox:r.data.featurecollection.filter(function(e){return"globalwatershed"==e.name})[0].feature.features[0].bbox},e.snappedPourPoint=r.data.featurecollection.filter(function(e){return"globalwatershedpoint"==e.name})[0].feature.features[0].geometry.coordinates,e.selectedStudyArea.Date=new Date,e.toaster.clear(),e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,a.Empty),e.canUpdate=!0,-1!=e.regionService.selectedRegion.Applications.indexOf("HydrologicFeatures")&&e.queryHydrologicFeatures()):(e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","A watershed was not returned from the delineation request","Please retry",0));e.selectedStudyArea.FeatureCollection.features.forEach(function(e){return e.properties={}})},function(t){e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","There was an HTTP error with the delineation request","Please retry",0)}).finally(function(){})},n.prototype.loadWatershed=function(r,n){var i=this;try{this.toaster.pop("wait","Opening Basin","Please wait...",0);var o=new e.Models.StudyArea(r,null);this.AddStudyArea(o);var s=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSwatershedByWorkspace.format("geojson",r,n,4326,!1),l=new WiM.Services.Helpers.RequestInfo(s,!0);l.withCredentials=!0,this.Execute(l).then(function(e){i.selectedStudyArea.WorkspaceID=e.data.hasOwnProperty("workspaceID")?e.data.workspaceID:null,i.selectedStudyArea.Date=new Date,i.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:i.reconfigureWatershedResponse(e.data.featurecollection),bbox:e.data.featurecollection.filter(function(e){return"globalwatershed"==e.name})[0].feature.features[0].bbox};var t=e.data.featurecollection.filter(function(e){return"globalwatershedpoint"==e.name})[0].feature.features[0];i.selectedStudyArea.Pourpoint=new WiM.Models.Point(t.bbox[1],t.bbox[0],t.crs.properties.code)},function(e){i.toaster.clear(),i.toaster.pop("error","Error Delineating Basin","Please retry",0)}).finally(function(){i.canUpdate=!0,i.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,i,a.Empty),i.toaster.clear()})}catch(e){return}},n.prototype.loadEditedStudyBoundary=function(){var r=this;this.toaster.pop("wait","Loading Edited Basin","Please wait...",0),this.canUpdate=!1;var n=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSeditBasin.format("geojson",this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,this.selectedStudyArea.Pourpoint.crs.toString()),i=new WiM.Services.Helpers.RequestInfo(n,!0,WiM.Services.Helpers.methodType.PUT,"json",angular.toJson(this.WatershedEditDecisionList),{});i.withCredentials=!0,this.Execute(i).then(function(t){r.AddStudyArea(new e.Models.StudyArea(r.selectedStudyArea.RegionID,r.selectedStudyArea.Pourpoint)),r.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:r.reconfigureWatershedResponse(t.data.featurecollection),bbox:t.data.featurecollection.filter(function(e){return"globalwatershed"==e.name.toLowerCase()})[0].feature.features[0].bbox},r.selectedStudyArea.WorkspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null,r.selectedStudyArea.Date=new Date,r.toaster.clear()},function(e){r.toaster.clear(),r.toaster.pop("error","Error Delineating Basin","Please retry",0)}).finally(function(){r.canUpdate=!0;var e=new a;e.studyArea=r.selectedStudyArea,r.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,r,e),r.selectedStudyArea.Disclaimers.isEdited=!0})},n.prototype.loadDrainageArea=function(){var e=this;this.loadingDrainageArea=!0,this.toaster.clear(),this.toaster.pop("wait","Calculating Drainage Area","Please wait...",0);var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,"drnarea"),a=new WiM.Services.Helpers.RequestInfo(t,!0);a.withCredentials=!0,this.Execute(a).then(function(t){if(t.data.parameters&&t.data.parameters.length>0){e.toaster.clear();var a=!1;angular.forEach(t.data.parameters,function(e,t){e.hasOwnProperty("value")&&-999!=e.value?e.loaded=!0:(a=!0,console.error("Parameter failed to compute: ",e.code),e.loaded=!1)}),a&&e.toaster.pop("error","Error","Drainage area failed to compute",0);var r=t.data.parameters;e.loadParameterResults(r),e.loadingDrainageArea=!1}},function(t){e.loadingDrainageArea=!1,e.toaster.clear(),e.toaster.pop("error","There was an HTTP error calculating drainage area","Please retry",0)}).finally(function(){})},n.prototype.loadAllIndexGages=function(){var e=this,t=configuration.baseurls.StreamStatsServices+configuration.queryparams.KrigService.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.Pourpoint.Longitude,this.selectedStudyArea.Pourpoint.Latitude,this.selectedStudyArea.Pourpoint.crs,"300"),a=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(a).then(function(t){e.allIndexGages=t.data},function(t){e.allIndexGages=[],e.toaster.clear(),e.toaster.pop("error","There was an HTTP error returning index gages.","Please retry",0)}).finally(function(){})},n.prototype.loadParameters=function(){var e=this;this.parametersLoading=!0;var r=[];if(this.toaster.clear(),this.toaster.pop("wait","Calculating Selected Basin Characteristics","Please wait...",0),this.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,this,a.Empty),this.selectedStudyArea&&this.selectedStudyArea.WorkspaceID&&this.selectedStudyArea.RegionID){if(0==(r=this.studyAreaParameterList.filter(function(e){return!e.value||e.value<0}).map(function(e){return e.code})).length&&this.regionService.selectedRegion.Applications.indexOf("FDCTM")>-1&&r.push("drnarea"),r.length<1){var n=new a;return n.parameterLoaded=!0,this.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,this,n),this.toaster.clear(),void(this.parametersLoading=!1)}var i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,r.join(",")),o=new WiM.Services.Helpers.RequestInfo(i,!0);o.withCredentials=!0,this.Execute(o).then(function(r){if(r.data.parameters&&r.data.parameters.length>0){e.toaster.clear();var n=!1;angular.forEach(r.data.parameters,function(e,t){e.hasOwnProperty("value")&&-999!=e.value?e.loaded=!0:(n=!0,console.error("Parameter failed to compute: ",e.code),e.loaded=!1)}),n&&(e.showModifyBasinCharacterstics=!0,e.toaster.pop("error","One or more basin characteristics failed to compute","Click the 'Calculate Missing Parameters' button or manually enter parameter values to continue",0));var i=r.data.parameters;e.loadParameterResults(i),e.getAdditionalFeatureList(),e.selectedStudyArea.Disclaimers.isRegulated&&e.loadRegulatedParameterResults(e.regulationCheckResults.parameters);var o=new a;o.parameterLoaded=!0,e.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,e,o)}},function(t){e.toaster.clear(),e.toaster.pop("error","There was an HTTP error calculating basin characteristics","Please retry",0)}).finally(function(){e.parametersLoading=!1})}else alert("No Study Area")},n.prototype.getAdditionalFeatureList=function(){var e=this,t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSavailableFeatures.format(this.selectedStudyArea.WorkspaceID),a=new WiM.Services.Helpers.RequestInfo(t,!0);a.withCredentials=!0,this.Execute(a).then(function(t){if(t.data.featurecollection&&t.data.featurecollection.length>0){e.additionalFeaturesLoaded=!1;var a=[];angular.forEach(t.data.featurecollection,function(t,r){-1===e.selectedStudyArea.FeatureCollection.features.map(function(e){return e.id}).indexOf(t.name)&&a.push(t.name)}),e.getAdditionalFeatures(a.join(","))}else e.additionalFeaturesLoaded=!0},function(t){e.toaster.clear(),e.additionalFeaturesLoaded=!0,e.toaster.pop("error","There was an HTTP error requesting additional feautres list","Please retry",0)}).finally(function(){})},n.prototype.getAdditionalFeatures=function(e){var a=this;if(e){this.toaster.pop("wait","Downloading additional features","Please wait...",0);var r=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSfeatures.format(this.selectedStudyArea.WorkspaceID,4326,e),n=new WiM.Services.Helpers.RequestInfo(r,!0);n.withCredentials=!0,this.Execute(n).then(function(e){if(e.data.featurecollection&&e.data.featurecollection.length>0){a.toaster.clear();var r=a.reconfigureWatershedResponse(e.data.featurecollection);angular.forEach(r,function(e,n){if(r.length<1){for(var i=0;i<a.selectedStudyArea.FeatureCollection.features.length;i++)if(a.selectedStudyArea.FeatureCollection.features[i].id.toLowerCase()===e.id.toLowerCase()){a.selectedStudyArea.FeatureCollection.features.splice(i,1);break}}else a.selectedStudyArea.FeatureCollection.features.push(e);!e||"longestflowpath3d"!=e.id&&"longestflowpath"!=e.id?a.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,a,new WiM.Directives.LegendLayerAddedEventArgs(e.id,"geojson",{displayName:e.id,imagesrc:null},!1)):a.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,a,new WiM.Directives.LegendLayerAddedEventArgs(e.id,"geojson",{displayName:e.id,imagesrc:null},!0)),a.eventManager.RaiseEvent(t.onAdditionalFeaturesLoaded,a,"")})}a.additionalFeaturesLoaded=!0},function(e){a.toaster.clear(),a.toaster.pop("error","There was an HTTP error getting additional features","Please retry",0),a.additionalFeaturesLoaded=!0}).finally(function(){})}else this.additionalFeaturesLoaded=!0},n.prototype.queryLandCover=function(){var e=this;this.toaster.pop("wait","Querying Land Cover Data with your Basin","Please wait...",0);var t='{"geometryType":"esriGeometryPolygon","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polygon", "rings":['+JSON.stringify(this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry.coordinates)+"]}}]}",a=configuration.baseurls.NationalMapRasterServices+configuration.queryparams.NLCDQueryService,r=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",{InputLineFeatures:t,returnZ:!0,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(r).then(function(t){e.toaster.clear(),t.data.length>0&&e.toaster.pop("success","Land Cover was succcessfully queried","Please continue",5e3)},function(t){return e.toaster.pop("error","There was an HTTP error querying Land Cover","Please retry",0),e.$q.reject(t.data)}).finally(function(){})},n.prototype.queryCoordinatedReach=function(){var t=this;this.toaster.pop("wait","Checking if study area is a coordinated reach.","Please wait...",0);var a=this.snappedPourPoint,r=turf.point([a[0],a[1]]),n=[];[-90,0,90,180].forEach(function(e,t){var a=turf.destination(r,.005,e);n[t]=a.geometry.coordinates[t%2==0?0:1]});var i=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.coordinatedReachQueryService.format(this.selectedStudyArea.RegionID.toLowerCase(),n[0],n[1],n[2],n[3],this.selectedStudyArea.Pourpoint.crs,"eqWithStrID.Stream_Name,eqWithStrID.StreamID_ID,eqWithStrID.BASIN_NAME,eqWithStrID.BEGIN_DA,eqWithStrID.END_DA,eqWithStrID.DVA_EQ_ID,eqWithStrID.a10,eqWithStrID.b10,eqWithStrID.a25,eqWithStrID.b25,eqWithStrID.a50,eqWithStrID.b50,eqWithStrID.a100,eqWithStrID.b100,eqWithStrID.a500,eqWithStrID.b500"),o=new WiM.Services.Helpers.RequestInfo(i,!0);this.Execute(o).then(function(a){if(a.data.error)t.toaster.pop("error","There was an error querying coordinated reach",a.data.error.message,0);else if(a.data.features.length>0){var r=a.data.features[0].attributes;t.selectedStudyArea.CoordinatedReach=new e.Models.CoordinatedReach(r["eqWithStrID.BASIN_NAME"],r["eqWithStrID.DVA_EQ_ID"],r["eqWithStrID.Stream_Name"],r["eqWithStrID.StreamID_ID"],r["eqWithStrID.BEGIN_DA"],r["eqWithStrID.END_DA"]),delete r["eqWithStrID.BASIN_NAME"],delete r["eqWithStrID.DVA_EQ_ID"];for(var n=Object.keys(r).map(function(e,t){return e.substr("eqWithStrID.".length+1)}).filter(function(e,t,a){return a.indexOf(e)===t}),i=0;i<n.length;i++){var o=n[i],s=r["eqWithStrID.a"+o],l=r["eqWithStrID.b"+o];null!=s&&null!=l&&t.selectedStudyArea.CoordinatedReach.AddFlowCoefficient("PK"+o,s,l)}t.toaster.pop("success","Selected reach is a coordinated reach","Please continue",5e3)}},function(e){t.toaster.pop("error","There was an HTTP error querying coordinated reach","Please retry",0)})},n.prototype.queryHydrologicFeatures=function(){var e=this,t=turf.point([this.snappedPourPoint[0],this.snappedPourPoint[1]]),a=this.selectedStudyArea.FeatureCollection.features[1].geometry,r={},n={url:configuration.baseurls.NationalMapServices+configuration.queryparams.NHDQueryService};L.esri.dynamicMapLayer(n).query().intersects(a).where("GNIS_ID IS NOT NULL").run(function(a,n){if(a)e.toaster.pop("error","There was an error querying NHD streams",a,0),e.selectedStudyArea.NHDStreamIntersections=[];else if(n&&n.features.length>0){n.features.forEach(function(e){if(e.properties.GNIS_ID){var a=turf.lineString(e.geometry.coordinates),n=1e3*turf.pointToLineDistance(t,a)*3.28084;-1==Object.keys(r).indexOf(e.properties.GNIS_ID)?r[e.properties.GNIS_ID]={GNIS_ID:e.properties.GNIS_ID,GNIS_NAME:e.properties.GNIS_NAME,distanceToPourPoint:n}:n<r[e.properties.GNIS_ID].distanceToPourPoint&&(r[e.properties.GNIS_ID].distanceToPourPoint=n)}}),e.selectedStudyArea.NHDStreamIntersections=Object.keys(r).map(function(e){return r[e]});var i=e.selectedStudyArea.NHDStreamIntersections.reduce(function(e,t){return e.distanceToPourPoint<t.distanceToPourPoint?e:t});e.selectedStudyArea.NHDStream=i,e.selectedStudyArea.defaultNHDStream=i}else n&&0==n.features.length?e.selectedStudyArea.NHDStreamIntersections=[]:(e.toaster.pop("error","There was an error querying NHD streams","Please retry",0),e.selectedStudyArea.NHDStreamIntersections=[])});var i={},o={url:configuration.baseurls.NationalMapServices+configuration.queryparams.WBDQueryService};L.esri.dynamicMapLayer(o).query().intersects(a).where("huc8 IS NOT NULL").run(function(a,r){if(a)e.toaster.pop("error","There was an error querying WBD HUC 8 watersheds",a,0),e.selectedStudyArea.WBDHUC8Intersections=[];else if(r&&r.features.length>0){r.features.forEach(function(e){if(e.properties.huc8){var a=turf.polygon(e.geometry.coordinates);if(turf.booleanPointInPolygon(t,a))var r=0;else r=1e3*turf.pointToLineDistance(t,turf.polygonToLineString(a))*3.28084;-1==Object.keys(i).indexOf(e.properties.huc8)?i[e.properties.huc8]={huc8:e.properties.huc8,name:e.properties.name,distanceToPourPoint:r}:r<i[e.properties.huc8].distanceToPourPoint&&(i[e.properties.huc8].distanceToPourPoint=r)}}),e.selectedStudyArea.WBDHUC8Intersections=Object.keys(i).map(function(e){return i[e]});var n=e.selectedStudyArea.WBDHUC8Intersections.reduce(function(e,t){return e.distanceToPourPoint<t.distanceToPourPoint?e:t});e.selectedStudyArea.WBDHUC8=n,e.selectedStudyArea.defaultWBDHUC8=n}else r&&0==r.features.length?e.selectedStudyArea.WBDHUC8Intersections=[]:(e.toaster.pop("error","There was an error querying WBD HUC 8 watersheds","Please retry",0),e.selectedStudyArea.WBDHUC8Intersections=[])})},n.prototype.queryRegressionRegions=function(){var e=this;this.toaster.pop("wait","Querying regression regions with your Basin","Please wait...",0),this.regressionRegionQueryLoading=!0,this.regressionRegionQueryComplete=!1;var t=configuration.baseurls.NSS+configuration.queryparams.RegressionRegionQueryService,a=this.simplify(angular.fromJson(angular.toJson(this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0]))).geometry,r=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(a),{"Content-Type":"application/json","X-Is-StreamStats":!0});this.Execute(r).then(function(t){if(e.NSSServicesVersion=t.headers()["x-version"],e.toaster.clear(),!t.data.error)return 0==t.data.length?(e.regressionRegionQueryComplete=!0,e.selectedStudyArea.RegressionRegions=t.data,void e.toaster.pop("error","No regression regions were returned","Regression based scenario computation not allowed",0)):void(t.data.length>0&&(e.regressionRegionQueryComplete=!0,t.data.forEach(function(e){e.code=e.code.toUpperCase().split(",")}),e.selectedStudyArea.RegressionRegions=t.data,e.toaster.pop("success","Regression regions were succcessfully queried","Please continue",5e3)));e.toaster.pop("error","There was an error querying regression regions",t.data.error.message,0)},function(t){return e.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",0),e.$q.reject(t.data)}).finally(function(){e.regressionRegionQueryLoading=!1})},n.prototype.queryKarst=function(e,t){var a,r=this;this.toaster.pop("wait","Querying for Karst Areas","Please wait...",0),t.forEach(function(e){"ExcludePolys"==e[0]&&(a=e[1])}),this.regressionRegionQueryLoading=!0,this.regressionRegionQueryComplete=!1;var n={where:"1=1",geometry:'{"rings":'+angular.toJson(this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry.coordinates,null)+',"spatialReference":{"wkid":4326}}',geometryType:"esriGeometryPolygon",inSR:4326,spatialRel:"esriSpatialRelIntersects",outFields:"*",returnGeometry:!1,outSR:4326,returnIdsOnly:!1,returnCountOnly:!1,returnZ:!1,returnM:!1,returnDistinctValues:!1,returnTrueCurves:!1,f:"json"},i=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers+"/"+a+"/query",o=new WiM.Services.Helpers.RequestInfo(i,!0,WiM.Services.Helpers.methodType.POST,"json",n,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(o).then(function(e){if(r.toaster.clear(),200==e.status){r.toaster.pop("success","Karst regions were succcessfully queried","Please continue",5e3);var t=!1;e.data.features.length>0&&(e.data.features.forEach(function(e){2==e.attributes.ExcludeCode&&(t=!0,r.toaster.pop("warning","Warning",e.attributes.ExcludeReason,0),r.selectedStudyArea.Disclaimers.hasKarst=e.attributes.ExcludeReason)}),t||r.toaster.pop("success","No Karst found","Please continue",5e3))}else r.toaster.pop("error","Error","Karst region query failed",0)},function(e){return r.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",0),r.$q.reject(e.data)}).finally(function(){r.regressionRegionQueryLoading=!1})},n.prototype.queryNWIS=function(a){var r=this;if(a&&a.lng&&a.lat&&this.selectedStudyAreaExtensions){var n=this.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()});if(!(n.length<0)){var i=a,o=new L.Circle([i.lat,i.lng],100).getBounds(),s=configuration.baseurls.NWISurl+configuration.queryparams.NWISsite.format(o.getWest().toFixed(7),o.getSouth().toFixed(7),o.getEast().toFixed(7),o.getNorth().toFixed(7)),l=new WiM.Services.Helpers.RequestInfo(s,!0);this.Execute(l).then(function(a){if(a.data.error)r.toaster.pop("error","There was an error querying NWIS",a.data.error.message,0);else if(a.data){var i=[],o=a.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e}),s=o.shift().split("\t");o.shift();do{var l=o.shift().split("\t");if("00060"==l[s.indexOf("parm_cd")]){console.log(l[s.indexOf("site_no")]);var g=new e.Models.ReferenceGage(l[s.indexOf("site_no")],l[s.indexOf("station_nm")]);g.Latitude_DD=l[s.indexOf("dec_lat_va")],g.Longitude_DD=l[s.indexOf("dec_long_va")],i.push(g)}}while(o.length>0);i.length>0&&(n[0].options=i,n[0].value=i[0],r.toaster.pop("success","Found USGS NWIS index gage","Please continue",5e3),r.modalservices.openModal(t.SSModalType.e_extensionsupport),r.doSelectMapGage=!1)}},function(e){r.toaster.pop("warning","No USGS NWIS index gage found at this location.","Try zooming in closer or a different location",5e3)})}}},n.prototype.selectGage=function(a){var r=this.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()}),n=[],i=new e.Models.ReferenceGage(a.properties.Code,a.properties.Name);i.Latitude_DD=a.geometry.coordinates[0],i.Longitude_DD=a.geometry.coordinates[1],i.properties=a.properties,n.push(i),n.length>0&&(r[0].options=n,r[0].value=new e.Models.ReferenceGage("",""),this.modalservices.openModal(t.SSModalType.e_extensionsupport),this.doSelectNearestGage=!1)},n.prototype.getStreamgages=function(e,t,a,r){var n=this,i=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesBounds.format(e,t,a,r),o=new WiM.Services.Helpers.RequestInfo(i,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(o).then(function(e){n.streamgageLayer=e.data,n.streamgagesVisible=!0},function(e){n.toaster.clear(),n.toaster.pop("error","Error querying streamgage layer")})},n.prototype.GetKriggedReferenceGages=function(){var t=this,a=configuration.queryparams.KrigService.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.Pourpoint.Longitude,this.selectedStudyArea.Pourpoint.Latitude,this.selectedStudyArea.Pourpoint.crs,"5");if(this.selectedStudyAreaExtensions){var r=this.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()});if(!(r.length<0)){var n=new WiM.Services.Helpers.RequestInfo(a);this.Execute(n).then(function(a){for(var n=[],i=a.data,o=0;o<i.length;o++){var s=new e.Models.ReferenceGage(i[o].id,i[o].name);s.DrainageArea_sqMI=i[o].drainageArea,s.correlation=i[o].correlation,n.push(s)}n.length>0&&(r[0].options=n,r[0].value=new e.Models.ReferenceGage("",""),t.toaster.pop("success","Found index gages","Please continue",5e3))},function(e){t.toaster.pop("warning","No index gage found at this location.","Please try again",5e3)}).finally(function(){t._onStudyAreaServiceFinishedChanged.raise(null,WiM.Event.EventArgs.Empty)})}}},n.prototype.upstreamRegulation=function(){var e=this;this.toaster.pop("wait","Checking for Upstream Regulation","Please wait...",0),this.regulationCheckComplete=!1;var r=angular.toJson({type:"FeatureCollection",crs:{type:"ESPG",properties:{code:4326}},features:this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})},null),n=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.regulationService.format(this.selectedStudyArea.RegionID.toLowerCase()),i=new WiM.Services.Helpers.RequestInfo(n,!0,WiM.Services.Helpers.methodType.POST,"json",{watershed:r,outputcrs:4326,f:"geojson"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(i).then(function(r){if(e.selectedStudyArea.Disclaimers.regulationChecked=!0,r.data.percentarearegulated>0){e.toaster.clear(),e.toaster.pop("success","Map updated with Regulated Area","Continue to 'Modify Basin Characteristics' to see area-weighted basin characteristics",5e3);var n=e.reconfigureWatershedResponse(r.data.featurecollection);e.selectedStudyArea.FeatureCollection.features.push(n[0]),e.regulationCheckResults=r.data,e.selectedStudyArea.Disclaimers.isRegulated=!0,e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,a.Empty)}else e.selectedStudyArea.Disclaimers.isRegulated=!1,e.toaster.clear(),e.toaster.pop("warning","No regulation found","Please continue",5e3)},function(t){e.toaster.clear(),e.toaster.pop("error","Error Checking for Upstream Regulation","Please retry",0)}).finally(function(){e.regulationCheckComplete=!0})},n.prototype.getflattenStudyArea=function(){var e=this,t=null;try{(t=this.selectedStudyArea.FeatureCollection).features.forEach(function(t){t.properties.Name=e.selectedStudyArea.WorkspaceID,t.id&&"globalwatershed"==t.id&&(t.properties=[t.properties,e.studyAreaParameterList.reduce(function(e,t){return e[t.code]=t.value,e},{})].reduce(function(e,t){return Object.keys(t).forEach(function(a){e[a]=t[a]}),e},{}))})}catch(e){t=null,console.log("Failed to flatted shapefile.")}return t},n.prototype.simplify=function(e){var t=0;try{var a=e.geometry.coordinates.reduce(function(e,t){return e+t.length},0);return a<5e3?e:(t=a<1e4?1e-4:a<1e5?.001:.01,this.toaster.pop("warning","Displaying simplified Basin.","See FAQ for more information.",0),turf.simplify(e,{tolerance:t,highQuality:!1,mutate:!0}))}catch(e){}},n.prototype.computeRegressionEquation=function(e){this.regtype=e,this.onSelectedStatisticsGroupChanged(),this.nssService.loadParametersByStatisticsGroup(this.selectedStudyArea.RegionID,"","GC1449, GC1450",[],e)},n.prototype.reconfigureWatershedResponse=function(e){var t=[];return e.forEach(function(e){for(var a=0;a<e.feature.features.length;a++){var r={type:"Feature",geometry:e.feature.features[a].geometry,id:e.feature.features.length>1&&e.feature.features[a].properties&&e.feature.features[a].properties.Name?e.name+"_"+e.feature.features[a].properties.Name.toLowerCase():e.name.toLowerCase(),properties:e.feature.features[a].properties};t.push(r)}}),t},n.prototype.loadParameterResults=function(e){var t=this.studyAreaParameterList,a=this;e.map(function(e){angular.forEach(t,function(t,r){if(e.code.toUpperCase().trim()===t.code.toUpperCase().trim()){if(void 0!=e.value&&"DRNAREA"==e.code.toUpperCase().trim()&&t.value!=e.value){var n=a.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+","+a.selectedStudyArea.Pourpoint.Longitude.toFixed(5),i=e.value;"square kilometers"==e.unit.toLowerCase().trim()&&(i/=2.59),gtag("event","Calculate",{Category:"DrainageArea",Location:n,Value:i.toFixed(0)})}return t.value=e.value,void(t.loaded=e.loaded)}})})},n.prototype.loadRegulatedParameterResults=function(e){this.toaster.pop("wait","Loading Regulated Basin Characteristics","Please wait...");var t=this.studyAreaParameterList;e.map(function(a){angular.forEach(t,function(r,n){if(a.code.toUpperCase().trim()!==r.code.toUpperCase().trim());else{switch(a.operation){case"Sum":r.unRegulatedValue=r.value-a.value;break;case"WeightedAverage":var i,o,s;angular.forEach(t,function(e,t){e.code==a.operationField&&(i=e.value)}),angular.forEach(e,function(e,t){e.code==a.operationField&&(o=e.value)}),s=a.value;var l=(r.value-o*(s/i))*(i/(i-o));r.unRegulatedValue=l}r.regulatedValue=a.value}})})},n.prototype.computeFlowAnywhereResults=function(){var e,t=this;this.studyAreaParameterList.forEach(function(t){"DRNAREA"==t.code&&(e=t.value)});var a={startdate:this.flowAnywhereData.dateRange.dates.startDate,enddate:this.flowAnywhereData.dateRange.dates.endDate,nwis_station_id:this.flowAnywhereData.selectedGage.StationID,parameters:[{code:"drnarea",value:e}],region:Number(this.flowAnywhereData.selectedGage.AggregatedRegion)},r=configuration.baseurls.FlowAnywhereRegressionServices+configuration.queryparams.FlowAnywhereEstimates.format(this.regionService.selectedRegion.RegionID),n=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(a));this.Execute(n).then(function(e){e.data?(t.flowAnywhereData.results=e.data,t.flowAnywhereData.estimatedFlowsArray=[],t.flowAnywhereData.results.EstimatedFlow.Observations.forEach(function(e,a){t.flowAnywhereData.estimatedFlowsArray.push({date:e.Date,estimatedFlow:e.Value,observedFlow:t.flowAnywhereData.results.ReferanceGage.Discharge.Observations[a].Value})}),t.flowAnywhereData.graphData={data:[{key:"Observed",values:t.processData(t.flowAnywhereData.results.ReferanceGage.Discharge.Observations,0)},{key:"Estimated",values:t.processData(t.flowAnywhereData.results.EstimatedFlow.Observations,1)}],options:{chart:{type:"lineChart",height:450,margin:{top:20,right:20,bottom:50,left:80},x:function(e){return new Date(e.x).getTime()},y:function(e){return e.y},useInteractiveGuideline:!1,interactive:!0,tooltips:!0,xAxis:{tickFormat:function(e){return d3.time.format("%x")(new Date(e))},rotateLabels:-30,showMaxMin:!0},yAxis:{axisLabel:"Discharge (cfs)",tickFormat:function(e){return null!=e?e.toUSGSvalue():e}},zoom:{enabled:!1},forceY:0}}}):(t.toaster.clear(),t.toaster.pop("error","Error","Error computing Flow Anywhere results",0))},function(e){t.toaster.clear(),t.toaster.pop("error","Error","Error computing Flow Anywhere results",0)}).finally(function(){})},n.prototype.processData=function(e,t){for(var a=[],r=new Date(Math.min.apply(null,e.map(function(e){return new Date(e.Date)}))),n=new Date(Math.max.apply(null,e.map(function(e){return new Date(e.Date)}))),i=r;i<=n;i.setDate(i.getDate()+1)){var o=e.filter(function(e){return new Date(e.Date).getTime()==i.getTime()})[0];void 0==o?a.push({x:i.getTime(),y:null}):a.push({x:i.getTime(),y:o.hasOwnProperty("Value")?"number"==typeof o.Value?o.Value.toUSGSvalue():o.Value:null})}return a},n.prototype.onStudyAreaChanged=function(e,t){this.selectedStudyArea&&this.selectedStudyArea.FeatureCollection&&this.regressionRegionQueryComplete},n.prototype.onNSSExtensionChanged=function(e,t){var a=this;t.extensions.forEach(function(e){-1==a.checkArrayForObj(a.selectedStudyArea.NSS_Extensions,e)&&a.selectedStudyArea.NSS_Extensions.push(e)})},n.prototype.onNSSExtensionResultsChanged=function(e,t){var a=this;t.results.forEach(function(e){var r=a.selectedStudyArea.NSS_Extensions.filter(function(t){return t.code==e.code});r.length<1||(r[0].parameters=angular.copy(e.parameters),void 0===r[0].result&&(r[0].result=[]),0==a.extensionResultsChanged&&(r[0].result=[]),r[0].result[a.extensionResultsChanged]=angular.copy(e.result),r[0].result[a.extensionResultsChanged].name=t.regressionRegionName)}),this.extensionResultsChanged++},n.prototype.afterSelectedStatisticsGroupChanged=function(){this.nssService.onSelectedStatisticsGroupChanged.unsubscribe(this.statisticgroupEventHandler)},n.prototype.onSelectedStatisticsGroupChanged=function(){this.nssService.onSelectedStatisticsGroupChanged.subscribe(this.statisticgroupEventHandler)},n.prototype.onQ10Available=function(){this.nssService.onQ10Loaded.subscribe(this.q10EventHandler)},n.prototype.afterQ10Loaded=function(){this.selectedStudyArea.wateruseQ10=this.nssService.selectedStatisticsGroupList[0].regressionRegions[0].results[0].value,this._onQ10Loaded.raise(null,WiM.Event.EventArgs.Empty),this.eventManager.UnSubscribeToEvent(t.onSelectedStudyParametersLoaded,this.parameterloadedEventHandler),this.nssService.selectedStatisticsGroupList=[],this.nssService.onQ10Loaded.unsubscribe(this.q10EventHandler)},n.prototype.updateExtensions=function(){var e=this;this.nssService.statisticsGroupList.forEach(function(t){t.regressionRegions&&t.regressionRegions.forEach(function(t){t.extensions&&(t.extensions=e.selectedStudyAreaExtensions)})})},n.prototype.checkArrayForObj=function(e,t){for(var a=0;a<e.length;a++)if(angular.equals(e[a],t))return a;return-1},n}(WiM.Services.HTTPServiceBase);function n(e,t,a,n,i,o,s){return new r(e,t,a,n,i,o,s)}n.$inject=["$http","$q","WiM.Event.EventManager","toaster","StreamStats.Services.ModalService","StreamStats.Services.nssService","StreamStats.Services.RegionService"],angular.module("StreamStats.Services").factory("StreamStats.Services.StudyAreaService",n)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(t){"use strict";t.onSelectExplorationMethod="onSelectExplorationMethod",t.onSelectedMethodExecuteComplete="onSelectedMethodExecuteComplete";var a=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(WiM.Event.EventArgs);t.ExplorationServiceEventArgs=a;var r,n=function(n){function i(e,a,r,i,o){var s=n.call(this,e,configuration.baseurls.StreamStatsServices)||this;return s.$q=a,s.eventManager=i,s.regionservice=o,s.toaster=r,s.drawElevationProfile=!1,s.drawMeasurement=!1,s.showElevationChart=!1,s.measurementData="",s._selectedMethod=null,s.networkNavResults=[],i.AddEvent(t.onSelectedStudyAreaChanged),s.selectElevationPoints=!1,s.DEMresolution="30m",s}return __extends(i,n),Object.defineProperty(i.prototype,"selectedMethod",{get:function(){return this._selectedMethod},enumerable:!1,configurable:!0}),i.prototype.elevationProfile=function(e){var t=this,a={InputLineFeatures:e,returnZ:!0,DEMResolution:this.DEMresolution,f:"json",MaximumSampleDistance:null};this.samplingDistance&&(a.MaximumSampleDistance=this.samplingDistance);var r=new WiM.Services.Helpers.RequestInfo("https://elevation.arcgis.com/arcgis/rest/services/Tools/ElevationSync/GPServer/Profile/execute",!0,WiM.Services.Helpers.methodType.POST,"json",a,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(r).then(function(e){if(console.log("elevation profile response: ",e.data),e.data&&e.data.results){var a=e.data.results[0].value.features[0].geometry.paths[0];if(a.length>0){var r=angular.fromJson(angular.toJson(a));e.data.results[0].value.fields.forEach(function(e){"ProfileLength"==e.name&&"Length Meters"==e.alias&&"meters"}),"meters"&&(a=a.map(function(e){return[e[0],e[1],3.28084*e[2]]}));var n=0;t.coordinateList=[[a[0][1].toFixed(5),a[0][0].toFixed(5),a[0][2].toFixed(2),n.toFixed(2)]];for(var i=1;i<a.length;i++){var o=L.latLng(a[i-1][1],a[i-1][0]),s=L.latLng(a[i][1],a[i][0]);n+=o.distanceTo(s),t.coordinateList.push([a[i][1].toFixed(5),a[i][0].toFixed(5),a[i][2].toFixed(2),(621371e-9*n).toFixed(2)])}t.elevationProfileGeoJSON={name:"NewFeatureType",type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:r},properties:""}]}}}else console.error("There was a zero length response from the elevation service"),t.toaster.clear(),t.toaster.pop("error","Error","No elevation results are available here",0)},function(e){console.error("There was an error requestion the elevation service"),t.toaster.clear(),t.toaster.pop("error","Error processing request","Please try again",0)}).finally(function(){})},i.prototype.getNavigationEndPoints=function(){var e=this,r=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices,n=new WiM.Services.Helpers.RequestInfo(r,!0);this.Execute(n).then(function(t){var a=t.data;e.navigationResources=a},function(r){e.toaster.pop("error","Error processing request","Please try again",0),e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,a.Empty)}).finally(function(){})},i.prototype.getNavigationConfiguration=function(e){var r=this,n=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices+"/"+e,i=new WiM.Services.Helpers.RequestInfo(n,!0);this.Execute(i).then(function(t){var a=t.data;console.log("navigation config:",a),r.setMethod(e,a)},function(e){r.toaster.pop("error","Error processing request","Please try again",0),r.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,r,a.Empty)}).finally(function(){})},i.prototype.getCountByType=function(e,t){return e.filter(function(e){return e.valueType.toLowerCase().indexOf(t)>=0}).length},i.prototype.setMethod=function(n,i){null!=this._selectedMethod&&n===this._selectedMethod.navigationID&&(n=r.undefined),this._selectedMethod=new e.Models.NetworkNav(n,i),this.eventManager.RaiseEvent(t.onSelectExplorationMethod,this,a.Empty)},i.prototype.ExecuteSelectedModel=function(){var e=this;console.log("selected method:",this.selectedMethod);var r=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices+"/"+this.selectedMethod.navigationInfo.code+"/route";console.log("url: ",r);var n=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(this.selectedMethod.navigationConfiguration));this.Execute(n).then(function(r){var n=r.data;console.log("successfull navigation request results:",n);var i={feature:{features:[],type:"FeatureCollection"},name:"netnavroute"},o={feature:{features:[],type:"FeatureCollection"},name:"netnavpoints"};n.features.forEach(function(e,t){"Point"==e.geometry.type?o.feature.features.push(e):i.feature.features.push(e)}),i.feature.features.length>0&&e.networkNavResults.push(i),o.feature.features.length>0&&e.networkNavResults.push(o);var s=new a;s.features="FeatureCollection"===n.type?n:null,s.report="Report"==n.type?n:null,e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,s)},function(r){e.toaster.pop("error","Error processing request","Please try again",0),e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,a.Empty)}).finally(function(){})},i}(WiM.Services.HTTPServiceBase);function i(e,t,a,r,i){return new n(e,t,a,r,i)}!function(e){e[e[void 0]=0]="undefined",e[e.FLOWPATH=1]="FLOWPATH",e[e.NETWORKPATH=2]="NETWORKPATH",e[e.NETWORKTRACE=3]="NETWORKTRACE"}(r=t.ExplorationMethodType||(t.ExplorationMethodType={})),i.$inject=["$http","$q","toaster","WiM.Event.EventManager","StreamStats.Services.RegionService"],angular.module("StreamStats.Services").factory("StreamStats.Services.ExplorationService",i)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use strict";var t,a=function(){function e(e){this.modal=e}return e.prototype.openModal=function(e,t){void 0===t&&(t=null),t&&(this.modalOptions=t),this.modal.open(this.getModalSettings(e))},e.prototype.getModalSettings=function(e){try{switch(e){case t.e_exploration:return{templateUrl:"Views/explorationview.html",controller:"StreamStats.Controllers.ExplorationToolsModalController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_report:return{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController",size:"lg",backdropClass:"backdropZ",windowClass:"windowZ"};case t.e_wateruse:return{templateUrl:"Views/wateruse.html",controller:"StreamStats.Controllers.WateruseController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_stormrunnoff:return{templateUrl:"Views/stormrunoff.html",controller:"StreamStats.Controllers.StormRunoffController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_scstormrunnoff:return{templateUrl:"Views/scstormrunoff.html",controller:"StreamStats.Controllers.SCStormRunoffController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_about:return{templateUrl:"Views/about.html",controller:"StreamStats.Controllers.AboutController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_help:return{templateUrl:"Views/help.html",controller:"StreamStats.Controllers.HelpController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_navreport:return{templateUrl:"Views/navreportmodal.html",controller:"StreamStats.Controllers.NavigationReportModalController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_prosper:return{templateUrl:"Views/prosperview.html",controller:"StreamStats.Controllers.ProsperController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_extensionsupport:return{templateUrl:"Views/extensionview.html",controller:"StreamStats.Controllers.ExtensionModalController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_gagepage:return{templateUrl:"Views/gagepage.html",controller:"StreamStats.Controllers.GagePageController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ modal-xl"};case t.e_nearestgages:return{templateUrl:"Views/nearestgages.html",controller:"StreamStats.Controllers.NearestGagesController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ modal-xl"};case t.e_flowanywhere:return{templateUrl:"Views/flowanywhere.html",controller:"StreamStats.Controllers.FlowAnywhereController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_warningmessage:return{templateUrl:"Views/warningmessage.html",controller:"StreamStats.Controllers.WarningMessageController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_batchprocessor:return{templateUrl:"Views/batchprocessor.html",controller:"StreamStats.Controllers.BatchProcessorController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};default:return null}}catch(e){return null}},e}();function r(e){return new a(e)}!function(e){e[e.e_report=1]="e_report",e[e.e_wateruse=2]="e_wateruse",e[e.e_about=3]="e_about",e[e.e_help=4]="e_help",e[e.e_navreport=5]="e_navreport",e[e.e_exploration=6]="e_exploration",e[e.e_stormrunnoff=7]="e_stormrunnoff",e[e.e_prosper=8]="e_prosper",e[e.e_extensionsupport=9]="e_extensionsupport",e[e.e_gagepage=10]="e_gagepage",e[e.e_nearestgages=11]="e_nearestgages",e[e.e_flowanywhere=12]="e_flowanywhere",e[e.e_warningmessage=13]="e_warningmessage",e[e.e_batchprocessor=14]="e_batchprocessor"}(t=e.SSModalType||(e.SSModalType={})),r.$inject=["$modal"],angular.module("StreamStats.Services").factory("StreamStats.Services.ModalService",r)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(e){"use strict";var t=function(t){function a(e,a,r,n){var i=t.call(this,e,configuration.baseurls.ScienceBase)||this;return i.$q=a,i.projectExtent=[[41.96765920367816,-125.48583984375],[49.603590524348704,-110.54443359375]],i.toaster=r,i.modalservices=n,i.init(),i}return __extends(a,t),Object.defineProperty(a.prototype,"SelectedPredictions",{get:function(){return this.AvailablePredictions.filter(function(e){return e.selected})},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"Result",{get:function(){return this._result},enumerable:!1,configurable:!0}),a.prototype.ResetSelectedPredictions=function(){this.ResetResults(),this.AvailablePredictions.length<1||this.AvailablePredictions.forEach(function(e){return e.selected=!1})},a.prototype.ResetResults=function(){this._result=null},a.prototype.GetPredictionValues=function(t,a){var r=this;this.toaster.pop("wait","Querying prosper grids","Please wait...",0),this._result=null;var n=this.getPointArray(t.latlng).join(),i=this.getDisplayImageArray(t.originalEvent.srcElement).join(),o=this.boundsToExtentArray(a).join(),s=this.SelectedPredictions.map(function(e){return e.id}).join(),l=this.SelectedPredictions.filter(function(e){return e.id<8}).map(function(e){return e.id}),g=this.SelectedPredictions.filter(function(e){return e.id>7}).map(function(e){return e.id-8}),c=configuration.queryparams.ProsperPredictions+configuration.queryparams.ProsperIdentify.format(s,i,o,n,4326),u=configuration.queryparams.ProsperSPPPredictions1+configuration.queryparams.ProsperIdentify.format(l,i,o,n,4326),d=configuration.queryparams.ProsperSPPPredictions2+configuration.queryparams.ProsperIdentify.format(g,i,o,n,4326);this.$q.all([this.queryExecute(c),this.queryExecute(u),this.queryExecute(d)]).then(function(a){r.toaster.clear(),r._result={date:new Date,point:t.latlng,data:{SPC:null,SPP:null}};for(var n=[],i=0;i<a.length;i++){if(0==i)r._result.data.SPC=a[i];else if(1==i&&l.length>0)n=a[i];else if(2==i&&g.length>0){n=n.concat(a[i]);for(i=0;i<n.length;i++)n[i].name=n[i].name.charAt(0).toUpperCase()+n[i].name.slice(1).toLowerCase(),n[i].value=Math.round(100*n[i].value)/100}r._result.data.SPP=n}r.toaster.pop("success","Finished","See results report.",5e3),r.modalservices.openModal(e.SSModalType.e_prosper)},function(e){r.toaster.clear(),r.toaster.pop("error","There was an error querying prosper grids","Please retry",0)})},a.prototype.init=function(){this.CanQuery=!1,this._result=null,this.AvailablePredictions=[],this.loadAvailablePredictions()},a.prototype.loadAvailablePredictions=function(){var e=this;try{var t=this.toaster.pop("wait","Loading Available Prosper Predictions","Please wait...",0),a=configuration.queryparams.ProsperPredictions+"/legend?f=pjson",r=new WiM.Services.Helpers.RequestInfo(a);this.Execute(r).then(function(a){if(a.data.error)e.toaster.pop("error","There was an error querying prosper predictions",a.data.error.message,0);else{e.AvailablePredictions.length=0;var r=a.data.layers;r.length>0&&(r.map(function(t){return{id:t.layerId,name:e.getCleanLabel(t.layerName),selected:!1}}).forEach(function(t){return e.AvailablePredictions.push(t)}),e.DisplayedPrediction=e.AvailablePredictions[0]),e.toaster.clear(t)}},function(t){e.CanQuery=!1,e.toaster.clear(),e.toaster.pop("error","There was an error requesting available prosper predictions.","Please retry",1e4)})}catch(e){console.log("There was an error requesting available prosper predictions."+e)}},a.prototype.boundsToExtentArray=function(e){return[e.southWest.lng,e.southWest.lat,e.northEast.lng,e.northEast.lat]},a.prototype.getDisplayImageArray=function(e){return[e.width,e.height,96]},a.prototype.getPointArray=function(e){return[e.lng,e.lat]},a.prototype.getCleanLabel=function(e){return e.replace(/[^_]*_|\.[^/.]+$/g,"")},a.prototype.queryExecute=function(e){var t=this;return this.Execute(new WiM.Services.Helpers.RequestInfo(e)).then(function(e){if(t.toaster.clear(),e.data.error)throw console.log("query error"),e.data.error;if(e.data.results.length>0)return e.data.results.map(function(e){return{name:t.getCleanLabel(e.layerName),value:e.attributes["Pixel Value"]}})},function(e){throw e})},a}(WiM.Services.HTTPServiceBase);function a(e,a,r,n){return new t(e,a,r,n)}a.$inject=["$http","$q","toaster","StreamStats.Services.ModalService"],angular.module("StreamStats.Services").factory("StreamStats.Services.ProsperService",a)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Controllers",[])}();__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(t){"use strict";var a=function(){return function(){this.lat=0,this.lng=0}}(),r=function(){return function(e,t,a){this.lat=e,this.lng=t,this.zoom=a}}(),n=function(){return function(e,t,a,r,n){void 0===n&&(n=void 0),this.name=e,this.url=t,this.type=a,this.visible=r,this.layerOptions=n}}(),i=function(){return function(e,t,a){void 0===e&&(e=null),void 0===t&&(t=null),void 0===a&&(a=!0),this.maxZoom=e,this.minZoom=t,this.zoomControl=a}}(),o=function(t){function o(a,r,n,i,o,s,l,g,c,u,d,A,h,p,C,f,I){var m=t.call(this,I,configuration.baseurls.StreamStats)||this;return m.$scope=a,m.$compile=r,m._prosperServices=h,m.modal=C,m.modalStack=f,m.center=null,m.layers=null,m.mapDefaults=null,m.mapPoint=null,m.bounds=null,m.markers=null,m.paths=null,m.geojson=null,m.events=null,m.layercontrol=null,m.regionLayer=null,m._prosperIsActive=!1,m.explorationToolsExpanded=!1,m.gageLegendFix=!1,m.regionLegendFix=!1,m.nonsimplifiedBasinStyle={displayName:"Non-Simplified Basin",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANkAAADJCAYAAACuaJftAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKsSURBVHhe7dwxbsJAEEBRkyPQU3L/A1HScwWCFEuRkEDB7I+t5L2Grei+lmEs7643E5D5mD+BiMggJjKIiQxiIoOYyCD2a3/hXw7H+QTbsz+f5tN4bjKIiQxiIoPYsJnMzMV/8soM5yaDmMggJjKILZ7JzGDw7dmM5iaDmMggJjKIiQxiIoOYyCAmMoj9eE9mLwaP2ZPBikQGMZFBzLOLMICZDFYkMoiJDGIig5jIICYyiIkMYvZksID3LsKGiAxiIoOYmQwG8OwirEhkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnEvOMDFvDeRdgQkUFMZBAzkz3wym9ueMZNBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQ211v5vNbLofjfPob9ufTfIL3uMkgJjKIiQxiIoOYyCAmMoiJDGLD9mT3Ru/N7vdW9ffDKG4yiIkMYiKDWDaTAV/cZBATGcREBjGRQUxkEBMZxEQGMZFBTGSQmqZPLJhZUkx8RY8AAAAASUVORK5CYII=",fillColor:"red",weight:2,opacity:1,color:"red",fillOpacity:.5},m.imageryToggled=!1,a.vm=m,m.toaster=n,m.searchService=g,m.$locationService=i,m.regionServices=c,m.leafletBoundsHelperService=s,m.leafletData=l,m.studyArea=u,m.nssService=d,m.explorationService=A,m.eventManager=p,m.cursorStyle="pointer",m.environment=configuration.environment,m.selectedExplorationTool=null,m.init(),m.eventManager.SubscribeToEvent(e.Services.onAdditionalFeaturesLoaded,new WiM.Event.EventHandler(function(){m.onAdditionalFeaturesLoaded()})),m.eventManager.SubscribeToEvent(e.Services.onSelectedStudyAreaChanged,new WiM.Event.EventHandler(function(){m.onSelectedStudyAreaChanged()})),m.eventManager.SubscribeToEvent(WiM.Directives.onLayerChanged,new WiM.Event.EventHandler(function(e,t){m.onLayerChanged(e,t)})),m.eventManager.SubscribeToEvent(WiM.Services.onSelectedAreaOfInterestChanged,new WiM.Event.EventHandler(function(e,t){m.onSelectedAreaOfInterestChanged(e,t)})),m.eventManager.SubscribeToEvent(e.Services.onSelectedRegionChanged,new WiM.Event.EventHandler(function(){m.onSelectedRegionChanged()})),m.eventManager.SubscribeToEvent(e.Services.onEditClick,new WiM.Event.EventHandler(function(e,t){m.basinEditor()})),m.eventManager.SubscribeToEvent(e.Services.onStudyAreaReset,new WiM.Event.EventHandler(function(){m.removeGeoJson()})),m.eventManager.SubscribeToEvent(e.Services.onSelectedMethodExecuteComplete,new WiM.Event.EventHandler(function(e,t){m.onExplorationMethodComplete(e,t)})),m.eventManager.SubscribeToEvent(e.Services.onSelectExplorationMethod,new WiM.Event.EventHandler(function(e,t){0!=e.selectedMethod.navigationID&&m.onSelectExplorationMethod(e,t),0==e.selectedMethod.navigationID&&(m.selectedExplorationTool=null)})),a.$on("leafletDirectiveMap.mainMap.zoomend",function(e,t){m.regionServices.selectedRegion&&m.center.zoom>8&&"ME"==m.regionServices.selectedRegion.RegionID&&m.updateLegendText("MeanAugustBaseflow")}),a.$on("leafletDirectiveMap.mainMap.mousemove",function(e,t){var a=t.leafletEvent.latlng;m.mapPoint.lat=a.lat,m.mapPoint.lng=a.lng,m.studyArea.doDelineateFlag&&(m.cursorStyle="crosshair")}),a.$on("leafletDirectiveMap.mainMap.drag",function(e,t){m.cursorStyle="grabbing"}),a.$on("leafletDirectiveMap.mainMap.dragend",function(e,t){m.cursorStyle="pointer"}),a.$on("leafletDirectiveMap.mainMap.click",function(t,a){if(m._prosperServices.CanQuery)m._prosperServices.GetPredictionValues(a.leafletEvent,m.bounds);else if(m.studyArea.doDelineateFlag)m.checkDelineatePoint(a.leafletEvent.latlng);else if(!m.studyArea.showEditToolbar&&!m.explorationService.drawMeasurement&&!m.explorationService.drawElevationProfile)if(m.studyArea.doSelectMapGage)m.studyArea.queryNWIS(a.leafletEvent.latlng);else if(null!=A.selectedMethod&&A.selectedMethod.locations.length<=A.selectedMethod.minLocations){console.log("in mapcontroller add point",A.selectedMethod.navigationPointCount,A.selectedMethod.locations.length),"Start point location"==A.explorationPointType&&A.selectedMethod.addLocation("Start point location",new WiM.Models.Point(a.leafletEvent.latlng.lat,a.leafletEvent.latlng.lng,"4326")),"End point location"==A.explorationPointType&&A.selectedMethod.addLocation("End point location",new WiM.Models.Point(a.leafletEvent.latlng.lat,a.leafletEvent.latlng.lng,"4326"));for(var r=0;r<A.selectedMethod.locations.length;r++){var n=A.selectedMethod.locations[r];m.markers["netnav_"+r]={lat:n.Latitude,lng:n.Longitude,message:A.selectedMethod.navigationName,focus:!0,draggable:!1}}m.modal.openModal(e.Services.SSModalType.e_exploration)}else m.queryPoints(a.leafletEvent)}),a.$watch(function(){return m.bounds},function(e,t){return m.mapBoundsChange(t,e)}),a.$watch(function(){return m.explorationService.elevationProfileGeoJSON},function(e,t){e&&m.displayElevationProfile()}),a.$watch(function(){return m.explorationService.drawElevationProfile},function(t,a){t&&m.modal.openModal(e.Services.SSModalType.e_exploration)}),a.$watch(function(){return m.explorationService.selectElevationPoints},function(e,t){e&&m.elevationProfile()}),a.$watch(function(){return m.explorationService.drawMeasurement},function(e,t){e&&m.measurement()}),a.$watch(function(){return m.regionServices.regionMapLayerListLoaded},function(e,t){e&&m.addRegionOverlayLayers(m.regionServices.selectedRegion.RegionID)}),a.$watch(function(){return m._prosperServices.DisplayedPrediction},function(e,t){e&&m.ProsperIsActive&&(m.removeOverlayLayers("prosper",!0),m.AddProsperLayer(e.id))}),a.$on("$locationChangeStart",function(){return m.updateRegion()}),o.rcode&&(m.regionServices.loadParametersByRegion(),m.setBoundsByRegion(o.rcode)),o.rcode&&o.workspaceID&&(m.regionServices.loadParametersByRegion(),m.studyArea.loadWatershed(o.rcode,o.workspaceID)),a.$watch(function(){return m.studyArea.regressionRegionQueryComplete},function(e,t){e&&m.studyArea.selectedStudyArea.RegressionRegions&&m.nssService.loadStatisticsGroupTypes(m.regionServices.selectedRegion.RegionID,m.studyArea.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","))}),a.$watch(function(){return m.studyArea.streamgageLayer},function(e,t){e!=t&&m.addGeoJSON("streamgages",e)}),m}return __extends(o,t),Object.defineProperty(o.prototype,"selectedExplorationMethodType",{get:function(){return null==this.explorationService.selectedMethod?0:this.explorationService.selectedMethod.navigationID},set:function(e){this.explorationService.setMethod(e,{})},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"ProsperIsActive",{get:function(){return this._prosperIsActive},enumerable:!1,configurable:!0}),o.prototype.setExplorationMethodType=function(e){this.removeGeoJsonLayers("netnav_",!0),this.explorationService.getNavigationConfiguration(e)},o.prototype.ExecuteNav=function(){if(this.explorationService.selectedMethod.locations.length==this.explorationService.selectedMethod.minLocations){this.explorationService.explorationMethodBusy=!0,this.explorationService.ExecuteSelectedModel()}else this.toaster.pop("warning","Warning","You must select at least "+this.explorationService.selectedMethod.minLocations+" points.",1e4)},o.prototype.ToggleProsper=function(){this._prosperIsActive?(this._prosperIsActive=!1,this._prosperServices.CanQuery=!1,this.removeOverlayLayers("prosper",!0)):(this._prosperIsActive=!0,this.AddProsperLayer(this._prosperServices.DisplayedPrediction.id),this.ConfigureProsper())},o.prototype.ConfigureProsper=function(){this.modal.openModal(e.Services.SSModalType.e_prosper)},o.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modal.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},o.prototype.init=function(){this.setupMap(),this.explorationService.getNavigationEndPoints()},o.prototype.setupMap=function(){this.center=new r(39,-100,4),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers},this.mapDefaults=new i(null,3,!0),this.markers={},this.paths={},this.geojson={},this.regionLayer={};var e=600;$(window).width()<768&&(e=.7*$(window).width()),this.controls={scale:!0,draw:{draw:{polygon:!1,polyline:!1,rectangle:!1,circle:!1,circlemarker:!1,marker:!1}},custom:new Array(L.control.locate({follow:!1,locateOptions:{maxZoom:15}}),L.control.elevation({imperial:!0,width:e}))},this.events={map:{enable:["mousemove"]}},this.mapPoint=new a,L.Icon.Default.imagePath="images"},o.prototype.scaleLookup=function(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}},o.prototype.queryPoints=function(e){var t=this;this.toaster.pop("wait","Information","Querying Points...",0),this.cursorStyle="wait",this.markers={},this.leafletData.getMap("mainMap").then(function(a){t.leafletData.getLayers("mainMap").then(function(r){if(a.getZoom()<=8)return t.cursorStyle="pointer",t.toaster.clear(),void t.toaster.pop("warning","Warning","You must be at Zoom Level 9 or greater to query points",5e3);t.queryContent={requestCount:0,Content:$("<div>").attr("id","popupContent"),responseCount:0};var n,i,o=function(o){if(!r.overlays.hasOwnProperty(o))return"continue";if(["MaskLayer","draw"].indexOf(o)>-1)return"continue";if(!a.hasLayer(r.overlays[o]))return"continue";switch(t.layers.overlays[o].type){case"agsFeature":n=4,null!=t.layers.overlays[o].layerOptions.queryDistance&&(n=t.layers.overlays[o].layerOptions.queryDistance),r.overlays[o].query().nearby(e.latlng,n).returnGeometry(!1).run(function(r,n){return t.handleQueryResult(o,r,n,a,e.latlng)});break;default:i=o,r.overlays[o].identify().on(a).at(e.latlng).returnGeometry(!1).tolerance(5).run(function(r,n){return t.handleQueryResult(i,r,n,a,e.latlng)})}t.queryContent.requestCount++};for(var s in r.overlays)o(s)})})},o.prototype.handleQueryResult=function(e,t,a,r,n){var i=this,o=$("<div>").attr("id",e).appendTo(this.queryContent.Content);this.queryContent.requestCount--;var s=[];if(a.features.forEach(function(t){i.layers.overlays[e].hasOwnProperty("layerArray")&&i.layers.overlays[e].layerArray.forEach(function(a){if(a.layerId===t.layerId&&!(["StreamGrid","ExcludePolys","Region","Subregion","Basin","Subbasin","Watershed","Subwatershed"].indexOf(a.layerName)>-1))if("NHD Streams"==a.layerName?t.properties.GNIS_ID&&t.properties.GNIS_NAME&&-1==s.indexOf(t.properties.GNIS_ID)&&(s.push(t.properties.GNIS_ID),o.append('<h5> NHD Streams <i ng-mouseover="showTooltip = true" ng-mouseleave="showTooltip = false" class="fa fa-info-circle"></i><span ng-show="showTooltip" class="popup-tooltip">NHD streams within 100 meters of clicked point.</span></h5>'),o.append("<strong> GNIS ID: </strong>"+t.properties.GNIS_ID+"</br>"),o.append("<strong> GNIS Name: </strong>"+t.properties.GNIS_NAME+"</br>"),i.queryContent.responseCount++):(o.append("<h5>"+a.layerName+"</h5>"),i.queryContent.responseCount++),gtag("event","ExplorationTools",{Category:"QueryPoints"}),i.layers.overlays[e].hasOwnProperty("queryProperties")&&i.layers.overlays[e].queryProperties.hasOwnProperty(a.layerName)){var r=i.layers.overlays[e].queryProperties[a.layerName];Object.keys(r).map(function(e){if("Streamgages"==a.layerName&&"FeatureURL"==e){var n='</br><br><button ng-click="'+("vm.openGagePage('"+t.properties[e].split("site_no=")[1]+"')")+'" type="button" class="btn-blue fullwidth">Open StreamStats Gage Page</button>';o.append(n),gtag("event","ExplorationTools",{Category:"QueryStreamgage"})}else"Mean August Baseflow"==a.layerName?("Drainage Area out-of-bounds"!=r[e]&&"Mean July Precip out-of-bounds"!=r[e]&&"% Aquifer Area out-of-bounds"!=r[e]&&"Regulated stream/river"!=r[e]||(0==t.properties[e]?t.properties[e]="No":1==t.properties[e]&&(t.properties[e]="Yes")),o.append("<strong>"+r[e]+": </strong>"+t.properties[e]+"</br>")):"NHD Streams"==a.layerName||o.append("<strong>"+r[e]+": </strong>"+t.properties[e]+"</br>")})}else angular.forEach(t.properties,function(e,t){o.append("<strong>"+t+": </strong>"+e+"</br>")})})}),this.queryContent.requestCount<1)if(this.toaster.clear(),this.cursorStyle="pointer",this.queryContent.responseCount>0){var l=this.queryContent.Content.html(),g=this.$compile(l)(this.$scope),c=0;g.toArray().forEach(function(e,t){e.innerHTML.length>0&&(c=t)}),r.openPopup(g[c],[n.lat,n.lng],{maxHeight:200})}else this.toaster.pop("warning","Information","No points were found at this location",5e3)},o.prototype.elevationProfile=function(){var e,t=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.measurementData="",this.explorationService.showElevationChart=!0,this.controls.custom.forEach(function(t){t._container.className.indexOf("elevation")>-1&&(e=t)}),gtag("event","ExplorationTools",{Category:"ElevationProfile"}),this.leafletData.getMap("mainMap").then(function(a){t.leafletData.getLayers("mainMap").then(function(r){r.overlays.draw.clearLayers(),t.drawController({metric:!1},!0),delete t.geojson.elevationProfileLine3D,a.on("draw:drawstart",function(t){e.clear()}),a.on("draw:created",function(e){a.removeEventListener("draw:created");var r=e.layer.toGeoJSON(),n='{"geometryType":"esriGeometryPolyline","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polyline", "paths":['+JSON.stringify(r.geometry.coordinates)+"]}}]}";t.toaster.pop("wait","Information","Querying the elevation service...",0),t.explorationService.elevationProfile(n),t.explorationService.drawElevationProfile=!1,a.panBy([0,1])})})})},o.prototype.drawController=function(e,t){var a=this;if(!t)return this.drawControl.disable(),void(this.drawControl=void 0);this.leafletData.getMap("mainMap").then(function(t){a.drawControl=new L.Draw.Polyline(t,e),a.drawControl.enable()})},o.prototype.displayElevationProfile=function(){var t,a=this;this.controls.custom.forEach(function(e){e._container&&e._container.className.indexOf("elevation")>-1&&(t=e)}),this.geojson.elevationProfileLine3D={data:this.explorationService.elevationProfileGeoJSON,style:{color:"#ff7800",weight:5,opacity:.65},onEachFeature:t.addData.bind(t)},this.leafletData.getMap("mainMap").then(function(r){var n=t.onAdd(r);a.explorationService.elevationProfileHTML=n.innerHTML,a.modal.openModal(e.Services.SSModalType.e_exploration),delete a.geojson.elevationProfileLine3D}),this.toaster.clear(),this.cursorStyle="pointer",this.selectedExplorationTool=null},o.prototype.showLocation=function(){var e,t=this;gtag("event","ExplorationTools",{Category:"ShowLocation"}),this.controls.custom.forEach(function(t){t._container.className.indexOf("leaflet-control-locate")>-1&&(e=t)}),e.start(),this.leafletData.getMap("mainMap").then(function(e){e.on("locationfound",function(){t.selectedExplorationTool=null})})},o.prototype.resetExplorationTools=function(){var e=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.elevationProfileHTML="",this.drawControl&&this.drawController({},!1),this.explorationService.measurementData="",this.explorationService.drawElevationProfile=!1,this.explorationService.drawMeasurement=!1,this.explorationService.selectElevationPoints=!1,delete this.geojson.elevationProfileLine3D,this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(a){a.overlays.draw.clearLayers(),e.measurestart&&t.off("click",e.measurestart),e.measuremove&&t.off("mousemove",e.measuremove),e.measurestop&&t.off("draw:created",e.measurestop)})}),this.explorationService.networkNavResults=[],this.selectedExplorationMethodType=0,this.removeMarkerLayers("netnav_",!0),this.removeGeoJsonLayers("netnavpoints",!0),this.removeGeoJsonLayers("netnavroute",!0),this.selectedExplorationTool=null,this.explorationService.explorationPointType=null},o.prototype.measurement=function(){var e=this;this.explorationService.measurementData="Click the map to begin\nDouble click to end the Drawing",gtag("event","ExplorationTools",{Category:"Measurement"}),this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(a){var r=!1;e.drawController({shapeOptions:{color:"blue"},metric:!1},!0);var n=a.overlays.draw;n.clearLayers(),e.measuremove=function(){e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString()},e.measurestart=function(){0==r&&(r=!0,e.explorationService.measurementData="Total Length: ",t.on("mousemove",e.measuremove))},e.measurestop=function(a){var r=a.layer;n.addLayer(r),n.addTo(t);var i=null,o=0;$.each(a.layer._latlngs,function(e,t){null!=i?(o+=i.distanceTo(t),i=t):i=t}),e.explorationService.measurementData="Total length: "+(3.28084*o).toFixed(0)+" ft",t.off("click",e.measurestart),t.off("mousemove",e.measuremove),t.off("draw:created",e.measurestop),e.drawControl.disable(),e.explorationService.drawMeasurement=!1,e.selectedExplorationTool=null},t.on("click",e.measurestart),t.on("draw:created",e.measurestop)})})},o.prototype.checkDelineatePoint=function(e){var t=this;this.leafletData.getMap("mainMap").then(function(a){t.leafletData.getLayers("mainMap").then(function(r){a.getZoom()<15?t.toaster.pop("error","Delineation not allowed at this zoom level","Please zoom in to level 15 or greater",5e3):(t.toaster.clear(),t.studyArea.checkingDelineatedPoint=!0,t.toaster.pop("info","Information","Validating your clicked point...",!0,0),t.cursorStyle="wait",t.markers={},t.markers.pourpoint={lat:e.lat,lng:e.lng,message:"Your clicked point</br></br><strong>Latitude: </strong>"+e.lat.toFixed(5)+"</br><strong>Longitude: </strong>"+e.lng.toFixed(5),focus:!0,draggable:!0},t.studyArea.doDelineateFlag=!1,gtag("event","DelineationClick",{Region:t.regionServices.selectedRegion.Name,Location:e}),a.invalidateSize(),t.queryExcludePolygons(t.regionServices.selectedRegion.RegionID,e.lat,e.lng).then(function(a){if(t.cursorStyle="pointer",t.toaster.clear(),200!=a.status)t.studyArea.checkingDelineatedPoint=!1,t.toaster.pop("error","There was an error checking exclusion polygons","HTTP request error",0),t.toaster.pop("success","Your clicked point is valid","Delineating your basin now...",5e3),gtag("event","ValidatePoint",{Label:"Not advised (no point query)"}),t.startDelineate(e,!1);else{var r=a.data.response[0];0==r.inExclude?(t.studyArea.checkingDelineatedPoint=!1,r.message&&null!=r.message.text?(t.toaster.pop("warning","Selected State/Region does not have exlusion areas defined","Delineating with no exclude polygon layer...",!0,0),gtag("event","ValidatePoint",{Label:"Not advised (no point query)"})):(t.toaster.pop("success","Your clicked point is valid","Delineating your basin now...",5e3),gtag("event","ValidatePoint",{Label:"Valid"})),t.startDelineate(e,!1)):1==r.inExclude&&(t.studyArea.checkingDelineatedPoint=!1,1==r.type?t.studyArea.ignoreExclusionPolygons?(t.toaster.pop("warning","Delineation and flow statistic computation not allowed here",r.message.text,0),t.toaster.pop("success","Ignoring exclusion areas","Delineating your basin now...",5e3),gtag("event","ValidatePoint",{Label:"Invalid (exclusion polygons ignored)"}),t.startDelineate(e,!0,r.message.text)):(t.toaster.pop("error","Delineation and flow statistic computation not allowed here",r.message.text,0),gtag("event","ValidatePoint",{Label:"Not allowed"})):(t.toaster.pop("warning","Warning",r.message.text,!0,0),gtag("event","ValidatePoint",{Label:"Not advised"}),t.startDelineate(e,!0,r.message.text)))}},function(a){t.studyArea.checkingDelineatedPoint=!1,t.toaster.pop("error","There was an error checking exclusion polygons","HTTP request error",0),t.toaster.pop("success","Your clicked point is valid","Delineating your basin now...",5e3),gtag("event","ValidatePoint",{Label:"Not advised (no point query)"}),t.startDelineate(e,!1)}).finally(function(){}))})})},o.prototype.basinEditor=function(){var e=this;this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(a){var r=a.overlays.draw;r.clearLayers(),new L.Draw.Polygon(t,r).enable(),t.on("draw:created",function(a){t.removeEventListener("draw:created");var n=a.layer;r.addLayer(n);var i=n.toGeoJSON();"add"==e.studyArea.drawControlOption&&(e.checkEditIntersects("adds",i)?e.toaster.pop("warning","Warning","Overlapping add and remove edit areas are not allowed",5e3):(e.addGeoJSON("adds",i),gtag("event","BasinEditor",{Type:"Add Area"}),e.studyArea.WatershedEditDecisionList.append.push(i))),"remove"==e.studyArea.drawControlOption&&(e.checkEditIntersects("removes",i)?e.toaster.pop("warning","Warning","Overlapping add and remove edit areas are not allowed",5e3):(e.addGeoJSON("removes",i),gtag("event","BasinEditor",{Type:"Remove Area"}),e.studyArea.WatershedEditDecisionList.remove.push(i))),r.clearLayers()})})})},o.prototype.checkEditIntersects=function(e,t){var a,r=!1;return a="adds"===e?"removes":"adds",this.geojson.hasOwnProperty(a)&&this.geojson[a].data.features.forEach(function(e){void 0!=turf.intersect(t,e)&&(r=!0)}),r},o.prototype.canSelectExplorationTool=function(t){switch(t){case e.Services.ExplorationMethodType.NETWORKPATH:case e.Services.ExplorationMethodType.FLOWPATH:case e.Services.ExplorationMethodType.NETWORKTRACE:break;default:return!1}return!0},o.prototype.onExplorationMethodComplete=function(t,a){var r=this;gtag("event","ExplorationTools",{Category:"networknav-"+this.explorationService.selectedMethod.navigationInfo.code}),this.explorationService.explorationMethodBusy=!1,null!=a.features&&a.features.features.length>0&&(this.removeMarkerLayers("netnav_",!0),this.explorationService.networkNavResults.forEach(function(e,t){r.addGeoJSON(e.name,e.feature),"netnavroute"==e.name&&r.leafletData.getMap("mainMap").then(function(t){var a=L.geoJson(e.feature);t.fitBounds(a.getBounds())}),r.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,r,new WiM.Directives.LegendLayerAddedEventArgs(e.name,"geojson",r.geojson[e.name].style))}),this.selectedExplorationMethodType=0,this.selectedExplorationTool=null,this.modalStack.dismissAll()),null!=a.report&&""!=a.report&&this.modal.openModal(e.Services.SSModalType.e_navreport,{placeholder:a.report})},o.prototype.onSelectExplorationMethod=function(t,a){this.modal.openModal(e.Services.SSModalType.e_exploration)},o.prototype.onSelectedAreaOfInterestChanged=function(e,t){gtag("event","Search",{}),this.paths={};var a=t.selectedAreaOfInterest;this.paths.AOI={type:"circleMarker",radius:15,color:"#ff0000",fillOpacity:.6,stroke:!1,latlngs:{lat:a.properties.Lat,lng:a.properties.Lon}},this.leafletData.getMap("mainMap").then(function(e){e.fitBounds([[a.properties.LatMin,a.properties.LonMin],[a.properties.LatMax,a.properties.LonMax]]),setTimeout(function(){e.getZoom()<8&&e.setZoom(8)},500),e.openPopup($.map(Object.keys(a.properties),function(e){if(-1!=["Label","ElevFt","Lat","Lon","Source"].indexOf(e))return"<b>"+e+": </b>"+a.properties[e]}).join("<br/>"),[a.properties.Lat,a.properties.Lon])})},o.prototype.onSelectedRegionChanged=function(){this.regionServices.selectedRegion&&(this.removeOverlayLayers("_region",!0),this.studyArea.zoomLevel15&&!this.imageryToggled&&this.regionServices.selectedRegion.Applications.some(function(e){return["StormDrain","Localres"].indexOf(e)>-1})&&this.toggleImageryLayer(),this.regionServices.loadMapLayersByRegion(this.regionServices.selectedRegion.RegionID))},o.prototype.onAdditionalFeaturesLoaded=function(){var e=this;this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.FeatureCollection&&(this.studyArea.selectedStudyArea.FeatureCollection.features.forEach(function(t){var a=angular.fromJson(angular.toJson(t));"longestflowpath3d"!==a.id&&"longestflowpath"!==a.id||e.addGeoJSON(a.id,a.geometry)}),this.toaster.pop("success","Additional features have been downloaded","Please continue",5e3))},o.prototype.onSelectedStudyAreaChanged=function(){var e,t=this;if(this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.FeatureCollection&&(this.markers={},this.removeOverlayLayers("globalwatershed",!0),this.studyArea.selectedStudyArea.FeatureCollection.features.forEach(function(e){var a=angular.fromJson(angular.toJson(e)),r=a.id.toLowerCase();t.addGeoJSON(r,a),t.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,t,new WiM.Directives.LegendLayerAddedEventArgs(r,"geojson",t.geojson[r].style))}),this.studyArea.selectedStudyArea.FeatureCollection.bbox&&(e=this.studyArea.selectedStudyArea.FeatureCollection.bbox,this.leafletData.getMap("mainMap").then(function(t){t.fitBounds([[e[1],e[0]],[e[3],e[2]]],{})})),this.regionServices.selectedRegion.Applications.indexOf("KarstCheck")>-1&&this.studyArea.queryKarst(this.regionServices.selectedRegion.RegionID,this.regionServices.regionMapLayerList),!this.nssService.queriedRegions)){if(!this.regionServices.selectedRegion.ScenariosAvailable)return void(this.studyArea.regressionRegionQueryComplete=!0);this.nssService.queriedRegions=!0}},o.prototype.AddProsperLayer=function(e){this.layers.overlays["prosper"+e]=new n("Prosper Layer",configuration.baseurls.ScienceBase+configuration.queryparams.ProsperPredictions,"agsDynamic",!0,{opacity:1,layers:[e],format:"png8",f:"image"})},o.prototype.removeGeoJson=function(e){for(var t in void 0===e&&(e=""),void 0==this.geojson.nonsimplifiedbasin&&void 0!=this.nonsimplifiedBasin&&(this.eventManager.RaiseEvent(WiM.Directives.onLayerRemoved,this,new WiM.Directives.LegendLayerRemovedEventArgs("nonsimplifiedbasin","geojson")),this.nonsimplifiedBasin=void 0),this.geojson)"function"==typeof this.geojson[t]||"streamgages"==t&&t!=e||(delete this.geojson[t],this.eventManager.RaiseEvent(WiM.Directives.onLayerRemoved,this,new WiM.Directives.LegendLayerRemovedEventArgs(t,"geojson")))},o.prototype.addGeoJSON=function(e,t){if("globalwatershed"==e){var a=t.geometry.coordinates.reduce(function(e,t){return e+t.length},0),r=this.studyArea.simplify(angular.copy(t)),n=r.geometry.coordinates.reduce(function(e,t){return e+t.length},0);this.geojson[e]={data:r,style:{displayName:"Basin Boundary",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADCCAYAAAC/i6XiAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKOSURBVHhe7dxBjoJAEEBRcO/9D+oBlElYTEwmE7XlI763kS2Ln0qlsefrYgIyp/UXiIgQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGL7+GztMq8PEDi3CZiEEBMhxEQIsW12QjsfRzJ4hzQJISZCiIkQYu/ZCe2AfJMXd0STEGIihJgIISZCiIkQYiKEmAghNuac0Lkg38w5IXw2EUJMhBATIcRECDERQkyEEBMhxEQIMRFCTIQQ8+0oPMq9o3AsIoSYCCFmJ4RX+T8hfDYRQkyEEBMhxEQIMRFCTIQQEyHERAgxEUJMhBATIcRECDERQkyEEBMhxEQIMRFCTIQQc8cMPMq9o3AsIoSYCCFmJ4R7g3e+/5iEEBMhxEQIMTvhj413APjNJISYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIzdfF+jzOZV4fduo8/pXhWSYhxEQIMRFCTIQQEyHERAgxEULsPeeE9+pzQ+eC7JhJCDERQkyEENtmJwT+ZBJCTISQmqYb05tLRBeJJLsAAAAASUVORK5CYII=",fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}},a!=n&&(this.nonsimplifiedBasin=t,this.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,this,new WiM.Directives.LegendLayerAddedEventArgs("nonsimplifiedbasin","geojson",this.nonsimplifiedBasinStyle,!1)))}else if("nonsimplifiedbasin"==e)this.geojson[e]={data:t,style:this.nonsimplifiedBasinStyle};else if("globalwatershedpoint"==e){var i=this.studyArea.selectedStudyArea.Pourpoint.Latitude,o=this.studyArea.selectedStudyArea.Pourpoint.Longitude,s=this.studyArea.selectedStudyArea.RegionID,l=this.studyArea.selectedStudyArea.WorkspaceID;this.geojson[e]={data:t,onEachFeature:function(e,t){var a="<strong>Latitude: </strong>"+i+"</br><strong>Longitude: </strong>"+o+"</br><strong>Region: </strong>"+s+"</br><strong>WorkspaceID: </strong>"+l+"</br>";angular.forEach(e.properties,function(e,t){a+="<strong>"+t+": </strong>"+e+"</br>"}),t.bindPopup(a)},style:{displayName:"Basin Clicked Point",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==",visible:!0}}}else if("regulatedwatershed"==e)this.geojson[e]={data:t,style:{displayName:"Basin Boundary (Regulated Area)",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAWCAYAAAArdgcFAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAUlJREFUeNrs1L9LAnEYx/H7pxyEghpyFmqov+E2raFbbpKoqYamDISSBqeWuCEUdLEyIgwJU+HwR2V4ZufpHZ73bvAIgsqKu6aGD8+X75fntTw8X8GSAvgV4R//U9yMh/3Bh/EwTu/Qe9zcCTF+igP57+OmHMSMzUyqHPzwvZ9cxqztAmdAeTo+2Jyjn1zBSEfRugc8PO7Rzq7RUUQ0RUTLrtMqbNCq7DN4PgWnBHYNSwoIX+LDrXmwUkAWuASu3VwBBffuBigDFaAB4zaWFBCm4kZiCcgBRRjfwUgFWwVUoArUJmdHBbsJ1v0bPBXXT0Tg4l3DT/IpbsZm6edloOg9PtxeoNc7Akp+4CF0PQXceo8biUX0l2Og6j2uKSL2KAfUvcc76Qi2fQ60/MEdxydcS0fcLWz6gGei7po3vMe7mVX3H/n9QF8HAGNo54Dt7QOyAAAAAElFTkSuQmCC",fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}};else if(-1!=e.indexOf("netnavpoints"))this.geojson[e]={data:t,onEachFeature:function(e,t){var a="<strong>Network navigation start/end point</strong></br>";angular.forEach(e.properties,function(e,t){a+="<strong>"+t+": </strong>"+e+"</br>"}),t.bindPopup(a)},pointToLayer:function(e,t){var a="wmm-pin wmm-mutedblue wmm-icon-noicon wmm-icon-black wmm-size-25";"ss_gages"==e.properties.source&&(a="wmm-pin wmm-blue wmm-icon-triangle wmm-icon-black wmm-size-25"),"WQP"==e.properties.source&&(a="wmm-pin wmm-sky wmm-icon-square wmm-icon-black wmm-size-25");var r=L.divIcon({className:a});return L.marker(t,{icon:r})},style:{displayName:"Network navigation point",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAlCAYAAAC+uuLPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAA57GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoV2luZG93cyk8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMTgtMDEtMzBUMTU6NTk6NDgtMDU6MDA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxOC0wMS0zMVQxMTowMDoyMC0wNTowMDwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXA6TWV0YWRhdGFEYXRlPjIwMTgtMDEtMzFUMTE6MDA6MjAtMDU6MDA8L3htcDpNZXRhZGF0YURhdGU+CiAgICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2UvcG5nPC9kYzpmb3JtYXQ+CiAgICAgICAgIDxwaG90b3Nob3A6Q29sb3JNb2RlPjM8L3Bob3Rvc2hvcDpDb2xvck1vZGU+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnhtcC5paWQ6M2FkNDgxMTctYjA3Mi05NjQ4LTk5MmYtZmIyZTgzNTcwOTkxPC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD5hZG9iZTpkb2NpZDpwaG90b3Nob3A6ZDZiMzhiZmUtMDY5Zi0xMWU4LTk2OTAtOGIzNWZmM2I1YzJjPC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06T3JpZ2luYWxEb2N1bWVudElEPnhtcC5kaWQ6NDQ0OTVjNjYtY2JjZS04ZDQyLWFhYmUtYjJmZTM4MjRmYWI3PC94bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpIaXN0b3J5PgogICAgICAgICAgICA8cmRmOlNlcT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y3JlYXRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOjQ0NDk1YzY2LWNiY2UtOGQ0Mi1hYWJlLWIyZmUzODI0ZmFiNzwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxOC0wMS0zMFQxNTo1OTo0OC0wNTowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDozYWQ0ODExNy1iMDcyLTk2NDgtOTkyZi1mYjJlODM1NzA5OTE8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTgtMDEtMzFUMTE6MDA6MjAtMDU6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChXaW5kb3dzKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj45NjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjk2MDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT42NTUzNTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+Mjk8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+Mzc8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pj4hpkQAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2xJREFUeNrs181rI3Ucx/H3b2YyD8mkMZslSZOsaVfsXpaFlYLg3jwvgl4XRVGPXZ8FRawXQQVXlD3pQegee+tfIQiFZV1auw9tau3zQ9KkM5OZyfw81JV1aZNMCiq43/Mwr9985/f9zG+ElJJ/uhT+hfr/oFq/F07PzMj7tWU2t7dwHBdVU0nbaYbzea6++YaIg4peG+n7qSk5e+sX6o0GrucRBAGdKEIIgaqq6IkESctiuJDnufFxXrp8WZwI/fSLL+XthQUOHIdei9M0jbSd4pnz5/lwYkIMhL4/OSkX7i/S9n2EomAPDZErFknZaSzbJooimvU6rUaDxu4OTrMJgGWajF+4wCfvvStioR9Mfibn7t0lCEIM06JYrVKqjmBYJqqqoagqSEkYhnQ6Ic5+k5XFe2yurBBFEaZh8OzFi3z8ztuiL/Tza9/In2Zn8YOAoewpqmPnyBUK6IYB4ujFR1FE23VYW66xfOcOvueRtCyev3SJiSM22d9G5sb0tPz55k38ICBp25RGRsmXy+imeSwIoCgKVsqmVB2lNDKKoig4rsut+fnec3p7fh7X89ASCU4XhymcqaBqfU8VhmWRL5XJ5vMArK6v89X167IrenepBoCdyZCvVDAMM9bQCyEYymYpVs6gmyZBGLK6vtH9SVsHBwAk7TSZ3OmuLT221apKKpPBzmQAqO83uqNSSrREAjOZRFXVgWMukdAxTAsAx3F7Z6+iqmha4kTZqmoaCV0HIOiEvVEpJVEUnTDS5V8JpiB6o6Hv0/bcE5GBH+D/eQ/d0LujQgiklATtNr7nDYy2PZeDZutwElKp7uhw4XC+9vf22FpbHQj0220aOzs4rcMszj2R7Y6OnX0KANc5YGPlNxq7O/HeZBSxt7XJ+nKNqNNhKG3z9NnR7uhHb10VpWIRGUXUt3dYq9VitblZr7O6tITTOmxttVLh9StXRF9fmRdffU06rotumpRHRqmOnTvM3y61v7fL4twc2+trdMKQJ8tlfrj2dX9fmQf1wsuvyLbv9wU/CpYKBX787lsR+2A2c2NKGLqO73n8vrRIbeHXI1sdF+x5GuwFDwL2dTA7rtWe6wwE9o0+CmdO5QDY3dyIDcZCH4YVVUUAnU4nNhgbfRgGBgIHQh/AuWx2IHBg9PFf22P0P4H+MQCyncndp+2ZGQAAAABJRU5ErkJggg==",visible:!0}};else if("netnavroute"==e)this.geojson[e]={data:t,visible:!0,style:{displayName:"Network navigation route",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA2CAYAAACMRWrdAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAVaSURBVGhDzZr5VxpXFMf7n7ZpkqZLmqbRaIxaEzWyzIjghhtuQBQNuKMii0vSnqZb2qZNm66iwfavuL33jVbEOzBvmBn44XOOHD3P+TD3vXu/MG95MsdQL3h38rDgjsLu9fvw9O07hll6MAb9Sz9eWKuuxGaCSch8+IC9eD1Stx7B4OK3l9aqGzHf+q+w2jYM++82sQIcB+80QNSfAF/yt0vr1Y1Y1B+H7I12vOCGSwJ6rLX0w+CT78CbPrq0Xl2IBR9/CVt3vHgHGlkBjtyNNpiYzIGS+ptds+ZivZt/QOLhBOxdvccK6DGvzEEfli+3JlFzsdmhtdMDw3gJbjaqMBz7Ckswz65J1FSM9keyySdVgntXm2FqdBvUrb/YNc+omZiSOoTFnlnYvdbCCugR75qEwPJP7JrF1EwsFMrCzsfdcCBRgvT3I5HPRSPn1iymJmL+lZ9h7f4A7F+5ywpwHFxphPDAqjhsuDVLcVyMes68GoPce62sgB4r2LwH4t+Dh+lZHI6LjYafwfZtt9SBkX2/Hcan98S+5NbkcFSsN/k7LHeM4tjUzAroMYd32Lf+ml1TD0fFwgMrkP3gM7xY4wfGRlMfDC18w45N5XBMbCj2NSSxscqU4O71FpicSIOyXb5ncTgiRhcW756CvWtyY9OiKwz+1VfsmpVwRGxqLAXpm514scZLkA4YGo6N9CwO28UCyy9h/V5AqmfR384Mb+DYZKxncdgqRhs+5n0Mu5I9a6njNOpLHhjF2Co2PrMPqU96RNLlBDjSHz2EsdmnWILGexaHbWIU9VfarYv6stgmJqI+TgxWRX1ZbBELzmHUb5CL+rQPaeLXi/qyWC6mbv0JiU75qB/zRKFv7Rd2TTNYLkafDdIBIBX1GxQYnn9eNurLYqnYQPwFbDT3YXYy3rMo6k+Pbok7za1pFsvEzEb9RGfIUNSXxTKx0CRG/VtyUZ/GrNHIs6p7FoclYv61Vxj1B6WjfqR/WWQ0bs1qsURsrndBfDLLCeix2jYkFfVlqVqMPjXa+tT+qC9LVWJORn1ZqhIzF/V9pqK+LKbF6OJMRf3xHVBNRH1ZTInRPPeke9rRqC+LKTF613duduHFGi/B7duuqqJ+Ke5TPJk3oGQ1vIg7ewyuzJG8mIj6GC9MRX2DH09XgoRcaeINvi6AmjsReHMFcKFYdzYvJ2Y26tPJWW3UL0aICXixLlmxMYz626ai/gEoFo9NWimSGJVhAcuwIH4m4UcypejbeI1RP1izqM+jiXlwbwkpUZ7H0IO/MywWCSzhxCDXs9ZbAjC4aE3UL8WLJSfAn8/3nAbdSUNiwbnnIgzWMuqXoqCUKsSOUCYPPfjmCSk8ULzpQmUxLeqHah71S1FQSM0eoVge99WZGJYkSqnpfyqLTY9sSkd9embD6qhfiiaWPxfD19rdOoHe9L/lxfoTP2DU98tHfXwzrI76FzlCsTyoyLkY7S08HfFulRWjSLHgjkg/iaZF/ZfsmtahiSkZaiGHQoz6F/U0pZIYPc5DT5ZJ9SyK+mF7ov5FcG9hmStp/D+Im8qQxLCXKRkS09ljFPVXWynqy/Qse6P+RbB9oJjYw8iZGDVpJYtTCO4zVsxU1G+lqP/CsrGpIvh/NDGUotdiCCYxumtMHxuJfoFR3yPVsyjqT0zt2tazWETPopNQa8hi+vifksmDHg6hx1DpZOME9HAi6hejzYnnU8bZaEXl6Mbe5i4dgrUn0TrwYo0fGMm7veKLc7ujfjFnA7AGDb/aACxkUcyVKxITUR8vUqYEaRqh75ediPrFaGIF5ARfY1zBacOLzVmI4UHSkzuE/wDtg18mgH26LgAAAABJRU5ErkJggg==",color:"red"}};else if("adds"==e)this.geojson.hasOwnProperty(e)?this.geojson[e].data.features.push(t):this.geojson[e]={data:{type:"FeatureCollection",features:[t]},visible:!0,style:{displayName:e,fillColor:"green",color:"green"}};else if("removes"==e)this.geojson.hasOwnProperty(e)?this.geojson[e].data.features.push(t):this.geojson[e]={data:{type:"FeatureCollection",features:[t]},visible:!0,style:{displayName:e,fillColor:"red",color:"red"}};else if("streamgages"==e){var g=this;this.geojson.streamgages={name:"Streamgages",type:"geoJSONShape",data:t,visible:!0,style:{displayName:"Streamgages"},onEachFeature:function(e,t){var a=e.properties.Code,r=L.DomUtil.create("div","innerDiv");r.innerHTML="<strong>Station ID: </strong>"+a+"</br><strong>Station Name: </strong>"+e.properties.Name+"</br><strong>Latitude: </strong>"+e.geometry.coordinates[1]+"</br><strong>Longitude: </strong>"+e.geometry.coordinates[0]+"</br><strong>Station Type</strong>: "+e.properties.StationType.name+'</br><br><button id="gagePageLink" type="button" class="btn-blue fullwidth">Open StreamStats Gage Page</button>',t.bindPopup(r);var n=configuration.streamgageSymbology.filter(function(t){return t.label.toLowerCase()==e.properties.StationType.name.toLowerCase()})[0];void 0==n&&(n=configuration.streamgageSymbology.filter(function(e){return"Unknown"==e.label})[0]);var i=L.icon({iconUrl:"data:image/png;base64,"+n.imageData,iconSize:[15,16],iconAnchor:[7.5,8],popupAnchor:[0,-11]});t.setIcon(i),L.DomEvent.on(r,"click",function(e){"gagePageLink"===e.target.id&&g.openGagePage(a)}),t.on("mouseover",function(e){g.studyArea.doSelectMapGage&&this.openPopup()}),t.on("click",function(t){gtag("event","ExplorationTools",{Category:"QueryStreamgage"}),g.studyArea.doSelectMapGage?(g.studyArea.selectGage(e),g.studyArea.doSelectMapGage=!1):this.openPopup()})}},this.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,this,new WiM.Directives.LegendLayerAddedEventArgs("streamgages","geojson",this.geojson.streamgages.style)),this.updateLegend()}else this.geojson[e]={data:t,visible:!0,style:{displayName:e,fillColor:"blue",color:"blue"}}},o.prototype.onLayerChanged=function(e,t){var a=this;if("visible"===t.PropertyName)if(t.Value){if(this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.FeatureCollection.features.length>0&&this.studyArea.selectedStudyArea.FeatureCollection.features.forEach(function(e){if(e.id==t.LayerName){var r=angular.fromJson(angular.toJson(e)),n=r.id;a.addGeoJSON(n,r)}}),"nonsimplifiedbasin"==t.LayerName&&this.addGeoJSON("nonsimplifiedbasin",this.nonsimplifiedBasin),this.explorationService.networkNavResults)for(var r=0;r<this.explorationService.networkNavResults.length;r++){var n=angular.fromJson(angular.toJson(this.explorationService.networkNavResults[r]));n.name==t.LayerName&&this.addGeoJSON(t.LayerName,n.feature)}"streamgages"==t.LayerName&&this.center.zoom>=8?this.studyArea.getStreamgages(this.bounds.southWest.lng,this.bounds.northEast.lng,this.bounds.southWest.lat,this.bounds.northEast.lat):"streamgages"==t.LayerName&&this.center.zoom<8&&(this.studyArea.streamgagesVisible=!0)}else delete this.geojson[t.LayerName],"streamgages"===t.LayerName&&(this.studyArea.streamgagesVisible=!1)},o.prototype.mapBoundsChange=function(e,t){this.nomnimalZoomLevel=this.scaleLookup(this.center.zoom),this.center.zoom>=8&&e!==t&&(this.regionServices.loadRegionListByExtent(this.bounds.northEast.lng,this.bounds.southWest.lng,this.bounds.southWest.lat,this.bounds.northEast.lat),this.regionServices.selectedRegion||this.toaster.pop("info","Information","User input is needed to continue",5e3),this.studyArea.streamgagesVisible&&this.studyArea.getStreamgages(this.bounds.southWest.lng,this.bounds.northEast.lng,this.bounds.southWest.lat,this.bounds.northEast.lat)),this.center.zoom<8&&e!==t&&(this.regionServices.regionList=[],this.removeGeoJsonLayers("streamgages")),this.center.zoom>=15?(!this.imageryToggled&&this.regionServices.selectedRegion&&this.regionServices.selectedRegion.Applications.some(function(e){return["StormDrain","Localres"].indexOf(e)>-1})&&this.toggleImageryLayer(),this.studyArea.zoomLevel15=!0):this.studyArea.zoomLevel15=!1},o.prototype.updateLegendText=function(e){var t=this;"MeanAugustBaseflow"==e&&this.leafletData.getLayers("mainMap").then(function(e){9==t.center.zoom||10==t.center.zoom||11==t.center.zoom?(t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[0].label="0.60 - 1.34 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[1].label="0.45 - 0.60 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[2].label="0.30 - 0.45 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[3].label="0.09 - 0.30 cfs/mi^2"):12==t.center.zoom||13==t.center.zoom||14==t.center.zoom?(t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[0].label="0.50 - 1.34 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[1].label="0.40 - 0.50 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[2].label="0.20 - 0.44 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[3].label="0.09 - 0.20 cfs/mi^2"):15!=t.center.zoom&&16!=t.center.zoom||(t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[0].label="0.35 - 1.34 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[1].label="0.25 - 0.35 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[2].label="0.15 - 0.25 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[3].label="0.09 - 0.15 cfs/mi^2")})},o.prototype.updateLegend=function(){var e=this;this.gageLegendFix||setTimeout(function(){var t=document.getElementsByClassName("wimLegend-application-group");for(var a in t)if(t[a].innerHTML&&t[a].innerHTML.indexOf("Application Layers")>-1){var r=t[a].children[1].children;for(var n in r)if(r[n].innerHTML&&r[n].innerHTML.indexOf("Streamgages")>-1&&!e.gageLegendFix){var i=r[n].children[0],o=document.createElement("div");o.innerHTML='<div class="legendGroup">\x3c!----\x3e<div ng-repeat="lyr in layer.layerArray ">\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAaJJREFUOI3dzz1IW1EYxvF/TMqpFQsJCF4QOuhUpTpEVCw6RSsdQhFB6hfiF0IDFqkoOCqKEhxEqm0H20YUgpQoqOBWOkgjpQgXowREEC5SuVBE6QtFHXQwYjSJmXzgDO85hx/PayPJsd0TcD6sqM6ZBFqAk7uD4dCyqu3dkLnhRmD6bqB/ q5DwZrl4hv6rb2MWEfEDR4mD + q9ZSl + mAC75 + HOGxvwuYDAx8MNaK / +Os3mUfj5nP + tSSlsUMbKAvfhA / dSKb3qEqvrLtwUS0CeVW + sWkbfxgcsr4zx12rFe + ZJu75PMPK / jcKfQNM1gbKBPz2Az2EzJi + ten / B1LdUse9AGxAhu//ZTXPkwanurrRd3RyeBqRrAfzM48b2IvwfPcWRG9QC76nnvlMDUY2ABkOjgbshHxWvrTRqAYPGo/s9uGWh6A3ivBR3epTZTpeWQmnabB6CkqqFOjbbvi0gG8CcSXF1NMZdCw7zqjAW7iKWOT+sVqtX5TkR6IkGXqx4IMub5EYeIQAlQrmlarmEY+uWVv1ycRDJgGAaRDZOUpINnJ5KDtx5X6hkAAAAASUVORK5CYII=" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAaJJREFUOI3dzz1IW1EYxvF/TMqpFQsJCF4QOuhUpTpEVCw6RSsdQhFB6hfiF0IDFqkoOCqKEhxEqm0H20YUgpQoqOBWOkgjpQgXowREEC5SuVBE6QtFHXQwYjSJmXzgDO85hx/PayPJsd0TcD6sqM6ZBFqAk7uD4dCyqu3dkLnhRmD6bqB/ q5DwZrl4hv6rb2MWEfEDR4mD + q9ZSl + mAC75 + HOGxvwuYDAx8MNaK / +Os3mUfj5nP + tSSlsUMbKAvfhA / dSKb3qEqvrLtwUS0CeVW + sWkbfxgcsr4zx12rFe + ZJu75PMPK / jcKfQNM1gbKBPz2Az2EzJi + ten / B1LdUse9AGxAhu//ZTXPkwanurrRd3RyeBqRrAfzM48b2IvwfPcWRG9QC76nnvlMDUY2ABkOjgbshHxWvrTRqAYPGo/s9uGWh6A3ivBR3epTZTpeWQmnabB6CkqqFOjbbvi0gG8CcSXF1NMZdCw7zqjAW7iKWOT+sVqtX5TkR6IkGXqx4IMub5EYeIQAlQrmlarmEY+uWVv1ycRDJgGAaRDZOUpINnJ5KDtx5X6hkAAAAASUVORK5CYII="><i>Gaging Station, Continuous Record</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAZxJREFUOI1jYaAyYBk2BjIZGAgtunDhXRwDA8M/ig10cBDKrqiwt5848WDq9u3vZlJqoIC/v3a0u7uyzLVrbxK2bz+ 8hIGB4SvZBoaGyjcnJenpMTAwMCQm6ukdPHineuPG51XkGqgVEqJjzcfHycnAwMAgIMDJFRys57px4/NpDAwMT0g2MDZWvjUoSM0AWSwsTMNgx467zcuW3Ukk1UD/nBxrdRYWZkZkQXZ2VpaEBH39HTvemb579+ 40sQay5+cbFJiZSWlik3R2ljcMDBStnjv3XQBRBqqosBeVlJgp43I6ExMTQ36 + mercuTdDGRgYVhMyUDItzdhLRoZPFpeBDAwMDLq64lolJQYpPT0XNjEwMPzEaaCDg3xzZqaRHj7DYKCoyFJ19erreQ8f / uzGaqCQkJBZRoaOJg8PBx8xBkpKcitmZpq5VFQcXsDAwPAa3UBGW1v2upAQdTNiDIOB7Gx9 / dWrr1adPfuuEN3AWAMDKbODBx + SWgKJ6 + gIhT57xj7n + fPnV5E1L2psPLuIgeEsieahgsFfwAIAW21yjgzG0zwAAAAASUVORK5CYII=" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAZxJREFUOI1jYaAyYBk2BjIZGAgtunDhXRwDA8M/ig10cBDKrqiwt5848WDq9u3vZlJqoIC/v3a0u7uyzLVrbxK2bz+ 8hIGB4SvZBoaGyjcnJenpMTAwMCQm6ukdPHineuPG51XkGqgVEqJjzcfHycnAwMAgIMDJFRys57px4/NpDAwMT0g2MDZWvjUoSM0AWSwsTMNgx467zcuW3Ukk1UD/nBxrdRYWZkZkQXZ2VpaEBH39HTvemb579+ 40sQay5+cbFJiZSWlik3R2ljcMDBStnjv3XQBRBqqosBeVlJgp43I6ExMTQ36 + mercuTdDGRgYVhMyUDItzdhLRoZPFpeBDAwMDLq64lolJQYpPT0XNjEwMPzEaaCDg3xzZqaRHj7DYKCoyFJ19erreQ8f / uzGaqCQkJBZRoaOJg8PBx8xBkpKcitmZpq5VFQcXsDAwPAa3UBGW1v2upAQdTNiDIOB7Gx9 / dWrr1adPfuuEN3AWAMDKbODBx + SWgKJ6 + gIhT57xj7n + fPnV5E1L2psPLuIgeEsieahgsFfwAIAW21yjgzG0zwAAAAASUVORK5CYII="><i>Low Flow, Partial Record</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAV5JREFUOI3d1DFIlGEYwPGfcvBRhMi3xIENURJKndfQLSEJFUGLpp6LGBoViZEpDqIQxNFUS0sQJMQhLTfZoqtzBC25B9I3BO/W8C7RJB2HV3d6U// xeXl + PNOb0 + Fy / w3YXaT6hbv4dWxwhIVVrr3mwTZvjwv2jibJ9K0Y + /aY3WYTP48Mlqnci7EAcxR2Wd9i7ajg4CRXezgBvZycSJKbWzG+wX7b4AwvxinWz6ZiLO5Q+cBcu+DoYy7k6KofJuRmGdpJ0yshhE+tgskiT0sMHPZ4nct3QljfYKwl8DzLK5xrdno3FunfoIzav8D8Q273caYZCJcYXOH+Kz4iNgVHqMxT+Bt20DL9NZ584+WhYJqmpUchDJyipxUwz9l5bqzyHj8awa7hEJ5NUmoFO2iBoVqSrH2OcakRnClS2m3/Bzp9Mcby93z + XZZlX + uXq8 + pton9Kcs0XtiROg7 + BnYMUkljozdEAAAAAElFTkSuQmCC" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAV5JREFUOI3d1DFIlGEYwPGfcvBRhMi3xIENURJKndfQLSEJFUGLpp6LGBoViZEpDqIQxNFUS0sQJMQhLTfZoqtzBC25B9I3BO/W8C7RJB2HV3d6U// xeXl + PNOb0 + Fy / w3YXaT6hbv4dWxwhIVVrr3mwTZvjwv2jibJ9K0Y + /aY3WYTP48Mlqnci7EAcxR2Wd9i7ajg4CRXezgBvZycSJKbWzG+wX7b4AwvxinWz6ZiLO5Q+cBcu+DoYy7k6KofJuRmGdpJ0yshhE+tgskiT0sMHPZ4nct3QljfYKwl8DzLK5xrdno3FunfoIzav8D8Q273caYZCJcYXOH+Kz4iNgVHqMxT+Bt20DL9NZ584+WhYJqmpUchDJyipxUwz9l5bqzyHj8awa7hEJ5NUmoFO2iBoVqSrH2OcakRnClS2m3/Bzp9Mcby93z + XZZlX + uXq8 + pton9Kcs0XtiROg7 + BnYMUkljozdEAAAAAElFTkSuQmCC"><i>Peak Flow, Partial Record</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAYlJREFUOI3d1E0og3EcwPHv1lMPEnouWmHJJOLZJCuWzFtjDsPMRYQQkbd20FZKy4mLi1KU5uWygyhxcODARWolcl3kOajn5vA4yInWMjZ28j3+/v0+/U5 / gRQn / BtQbzEQDCv0A29 / Bu1GJuZ7qV / dZeQ4wvpfwRyXXex1mLW8uwcGjrfZAV5 + DXqqCAw1aDLAYCPy + Q3 + gzC + 34Jl3TZsWemkA+RkkOGuFVsOwtoa8Jg02FfHUlcNluhZj02znIQJ7F0ymCzommylRNCjix6KAsKAHfPJvVStqupVoqA47WDGaqL0q8cmmcpOWfVvntGREGgSmfN2UBTvdL0Opp0Ub57hAUI / gYZRN848ifx4IECFkTJvO8MrRxwCWlzQbiIw7kD + DvtozkVx6JSpiMbyl6AkSdYxp1qamUZWIqAhm8JxN83ze2wBz7Ggrq5AXeiuwZoI9tFEG + bQhei7jmizsWCfpRDr + W3SP1BueYHmeXo1bCiKchu9HFzcJ8h + ktxnCrEXpqSUg + 93zWK9ULsBDQAAAABJRU5ErkJggg==" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAYlJREFUOI3d1E0og3EcwPHv1lMPEnouWmHJJOLZJCuWzFtjDsPMRYQQkbd20FZKy4mLi1KU5uWygyhxcODARWolcl3kOajn5vA4yInWMjZ28j3+/v0+/U5 / gRQn / BtQbzEQDCv0A29 / Bu1GJuZ7qV / dZeQ4wvpfwRyXXex1mLW8uwcGjrfZAV5 + DXqqCAw1aDLAYCPy + Q3 + gzC + 34Jl3TZsWemkA+RkkOGuFVsOwtoa8Jg02FfHUlcNluhZj02znIQJ7F0ymCzommylRNCjix6KAsKAHfPJvVStqupVoqA47WDGaqL0q8cmmcpOWfVvntGREGgSmfN2UBTvdL0Opp0Ub57hAUI / gYZRN848ifx4IECFkTJvO8MrRxwCWlzQbiIw7kD + DvtozkVx6JSpiMbyl6AkSdYxp1qamUZWIqAhm8JxN83ze2wBz7Ggrq5AXeiuwZoI9tFEG + bQhei7jmizsWCfpRDr + W3SP1BueYHmeXo1bCiKchu9HFzcJ8h + ktxnCrEXpqSUg + 93zWK9ULsBDQAAAABJRU5ErkJggg=="><i>Peak and Low Flow, Partial Record</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAXZJREFUOI3d1E8ow2EYwPHvmF5j/vRLbT/ZlmxpykayjJjkT0iUXIgoTko4buWynNyVctDIxUEpNwcXLi4rrRxclHqVvBc5vA5yoVjGxk6+ x + ft + fScXit5zvpvwAJMEkhmgJc / g4aHxbJJIo / 7LKgbtv4KVoouMeUM6prnW2bZZQ94+j3YQtzRowMARoSAuiSmk0R / CzaYYTqEDRuA3U6Jq130XSf1JnCbMyg6WXeHafo4qwjrJiNJXJ0zlys46h2gnkIsnxaKsJZ1E + TKaFVKXWQLCjHAst2L / 6tHZyPNdwEV45Sx7EDBqn+Uuoy3W8A7iC91ygRw8BNoesYZEgaujCBg99BgDjMvjzkCdGbQS7yqn8B32HuOEXzyhCU0G1 + ChmGExJDyW4spzwYUldSa4 / TKfXaA + 3TQ8uRWa742Qtlg71X3E1RnIqpv9Eo6OF1aS+ghlfMP5NBuPWE + m9tSytTH5YQ6JKEOc + TekkjSL8xLeQdfAVOiXI3dacB + AAAAAElFTkSuQmCC" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAXZJREFUOI3d1E8ow2EYwPHvmF5j/vRLbT/ZlmxpykayjJjkT0iUXIgoTko4buWynNyVctDIxUEpNwcXLi4rrRxclHqVvBc5vA5yoVjGxk6+ x + ft + fScXit5zvpvwAJMEkhmgJc / g4aHxbJJIo / 7LKgbtv4KVoouMeUM6prnW2bZZQ94+j3YQtzRowMARoSAuiSmk0R / CzaYYTqEDRuA3U6Jq130XSf1JnCbMyg6WXeHafo4qwjrJiNJXJ0zlys46h2gnkIsnxaKsJZ1E + TKaFVKXWQLCjHAst2L / 6tHZyPNdwEV45Sx7EDBqn+Uuoy3W8A7iC91ygRw8BNoesYZEgaujCBg99BgDjMvjzkCdGbQS7yqn8B32HuOEXzyhCU0G1 + ChmGExJDyW4spzwYUldSa4 / TKfXaA + 3TQ8uRWa742Qtlg71X3E1RnIqpv9Eo6OF1aS+ghlfMP5NBuPWE + m9tSytTH5YQ6JKEOc + TekkjSL8xLeQdfAVOiXI3dacB + AAAAAElFTkSuQmCC"><i>Stage Only</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAYVJREFUOI3d1E8og3Ecx/H3mB6Tfz0XTWwtln/t2YQnjz+ b / A2J0i5EFCclHCmX5eSulINGLg5KOXEQcdFqJeWAWqmnqN / N4ecgBxQyNhzkc / nW99v31ff0tfLLsf4bMEXFHhaYw8DDj0EV50Q3A4EDNsZjxJZ / CubWKP7BUuktuOF6JMbaOnD3bbCEqpAumzWAagLaJadzF0RnvwuWaxj16dhsABlkZniVurYLGV0CrpMGK2hc8GD4Xvc80vCdEw2dcTyaLNjbQEdJKqmW18000qzVNHlN9bxGCHGSKKhU0THloLjso6EbT6VLaHOC / b6EQAVlpoXeoninW7BQS6c7wn4Q2PwKtPvp78pBLYwHAuTjLK + je + yYnW1AxgWdFIcM2rXPsJcE6HFH2JuUyMUPQVVVdV10lSmkZycCZpLr8tPfusvGKnD7HrRkCce8h1o9EewlBu3eiHI0K2Rs + j045MClX3GW7AfKs0tHULHfr5im + WY5fMhW + JCtJL3nmE / l7z / YR0W7YFxuKhm3AAAAAElFTkSuQmCC" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAYVJREFUOI3d1E8og3Ecx/H3mB6Tfz0XTWwtln/t2YQnjz+ b / A2J0i5EFCclHCmX5eSulINGLg5KOXEQcdFqJeWAWqmnqN / N4ecgBxQyNhzkc / nW99v31ff0tfLLsf4bMEXFHhaYw8DDj0EV50Q3A4EDNsZjxJZ / CubWKP7BUuktuOF6JMbaOnD3bbCEqpAumzWAagLaJadzF0RnvwuWaxj16dhsABlkZniVurYLGV0CrpMGK2hc8GD4Xvc80vCdEw2dcTyaLNjbQEdJKqmW18000qzVNHlN9bxGCHGSKKhU0THloLjso6EbT6VLaHOC / b6EQAVlpoXeoninW7BQS6c7wn4Q2PwKtPvp78pBLYwHAuTjLK + je + yYnW1AxgWdFIcM2rXPsJcE6HFH2JuUyMUPQVVVdV10lSmkZycCZpLr8tPfusvGKnD7HrRkCce8h1o9EewlBu3eiHI0K2Rs + j045MClX3GW7AfKs0tHULHfr5im + WY5fMhW + JCtJL3nmE / l7z / YR0W7YFxuKhm3AAAAAElFTkSuQmCC"><i>Low Flow, Partial Record, Stage</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAZtJREFUOI1jYaAyYBk2BjKpCBksuvPuQhwDA8M/ig00FnLIzrOvsJ9zcGLq4XfbZ1JqoICXtn+0vbK7zJ031xIOH96+hIGB4SvZBrrLhzaH6yXpMTAwMIToJeodvXOwet/zjVXkGqjlpxNizcPJx8nAwMDAzynA5aMX7Lrv+ cZpDAwMT0g20F8 + ttVdLcgAWcxHI8xg / 90dzZvvLEsk1UD/ROscdRZmFkZkQTZWdpZQ/QT9o+ 92mL579+40sQayJxjkFxhImWlik7SRdzZ0Ew2sXvFubgBRBkqyqxRlmJUo43I6ExMTQ4JZvuqKm3NDGRgYVhMyUDLBOM1Lgk9GFpeBDAwMDBriulopBiUpcy70bGJgYPiJ00BzeYfmGKNMPXyGwUCaZZHq4uur837+fNiN1UAhISGzWJ0MTW4OHj5iDBTjllQsMst0aT9csYCBgeE1uoGMBuy2dZ7qIWbEGAYDMfrZ + tuvrq668O5sIbqBsTpSBmYnHx4ktQQSVxbSCX3J / mzO8 + fPryJrXjTpbOOiSWdJNA4NDP4CFgA3c3Kc0o9KfgAAAABJRU5ErkJggg == " src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAZtJREFUOI1jYaAyYBk2BjKpCBksuvPuQhwDA8M/ig00FnLIzrOvsJ9zcGLq4XfbZ1JqoICXtn+0vbK7zJ031xIOH96+hIGB4SvZBrrLhzaH6yXpMTAwMIToJeodvXOwet/zjVXkGqjlpxNizcPJx8nAwMDAzynA5aMX7Lrv+ cZpDAwMT0g20F8 + ttVdLcgAWcxHI8xg / 90dzZvvLEsk1UD/ROscdRZmFkZkQTZWdpZQ/QT9o+ 92mL579+40sQayJxjkFxhImWlik7SRdzZ0Ew2sXvFubgBRBkqyqxRlmJUo43I6ExMTQ4JZvuqKm3NDGRgYVhMyUDLBOM1Lgk9GFpeBDAwMDBriulopBiUpcy70bGJgYPiJ00BzeYfmGKNMPXyGwUCaZZHq4uur837+fNiN1UAhISGzWJ0MTW4OHj5iDBTjllQsMst0aT9csYCBgeE1uoGMBuy2dZ7qIWbEGAYDMfrZ + tuvrq668O5sIbqBsTpSBmYnHx4ktQQSVxbSCX3J / mzO8 + fPryJrXjTpbOOiSWdJNA4NDP4CFgA3c3Kc0o9KfgAAAABJRU5ErkJggg == "><i>Miscellaneous Record</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAARVJREFUOI3d1L8rhVEYB/APqROD9C66xSBJDH4MLAYLi4XFJKKYlDBSlpvJrpRBstn8G2b/gXoHdTbDs8jgKt38eF138q1T55yn59MznE6XNqfr34CduMYGXtoB7mIeO7j4K9iXUlqLiAFs4gbPfwHrETHR2E/ gGEetguOYQ3fj3JNSWoyIczy2Ap5i6uNFREyhjq3fgssYRccnPZNFUczknO + rggn7GPuiPp1zPsZKVfAQw1 / U3jOCVdz + BNawhMEfwHFs4w7xHVj39jyqZAR7OPsULIpiNuc8ht6K4BAWcIWnZrAj53yC2YrYeyZTSkcRcdAMrjew3 / 5A/RGxWqvVLsuyfPjYfN1YLaUsS80TtiVtB18BHWxAwwk6imsAAAAASUVORK5CYII=" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAARVJREFUOI3d1L8rhVEYB/APqROD9C66xSBJDH4MLAYLi4XFJKKYlDBSlpvJrpRBstn8G2b/gXoHdTbDs8jgKt38eF138q1T55yn59MznE6XNqfr34CduMYGXtoB7mIeO7j4K9iXUlqLiAFs4gbPfwHrETHR2E/ gGEetguOYQ3fj3JNSWoyIczy2Ap5i6uNFREyhjq3fgssYRccnPZNFUczknO + rggn7GPuiPp1zPsZKVfAQw1 / U3jOCVdz + BNawhMEfwHFs4w7xHVj39jyqZAR7OPsULIpiNuc8ht6K4BAWcIWnZrAj53yC2YrYeyZTSkcRcdAMrjew3 / 5A/RGxWqvVLsuyfPjYfN1YLaUsS80TtiVtB18BHWxAwwk6imsAAAAASUVORK5CYII="><i>Unknown</i></div>\x3c!----\x3e</div>\x3c!----\x3e</div>',i.appendChild(o),e.gageLegendFix=!0}}},500)},o.prototype.updateRegion=function(){var e=this.$locationService.search().region;this.setBoundsByRegion(e)},o.prototype.setBoundsByRegion=function(e){e&&this.regionServices.loadRegionListByRegion(e)&&(this.regionServices.selectedRegion=this.regionServices.regionList[0],this.bounds=this.leafletBoundsHelperService.createBoundsFromArray(this.regionServices.selectedRegion.Bounds))},o.prototype.toggleImageryLayer=function(){var e=document.getElementsByClassName("wimLegend-basemap-item");for(var t in e){var a,r=e[t].childNodes;for(var n in r)if("rdo"==r[n].className)for(var i in(a=r[n]).childNodes)"Imagery"==a.childNodes[i].innerHTML&&a.click()}this.imageryToggled=!0},o.prototype.addRegionOverlayLayers=function(e){var t=this;if(!(this.regionServices.regionMapLayerList.length<1)){var a=[],r=[],n=this;this.regionServices.regionMapLayerList.map(function(e){a.push(e[1]),n.regionServices.selectedRegion.Applications.indexOf("StormDrain")>-1&&"StreamGrid"==e[0]?r.push(!1):r.push(!0)});a.forEach(function(a,n){t.layers.overlays[e+"_region"+a]={name:String(a),group:e+" Map layers",url:configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers,type:"agsDynamic",visible:r[n],layerOptions:{opacity:1,layers:[a],format:"png8",f:"image"}}}),this.leafletData.getLayers("mainMap").then(function(t){a.forEach(function(a){t.overlays[e+"_region"+a].bringToBack()}),t.overlays.SSLayer.bringToFront()});var i=this.regionServices.selectedRegion.Layers;if(void 0!=i)for(var o in i)this.layers.overlays[o+"_region"]=i[o]}},o.prototype.removeOverlayLayers=function(e,t){var a=this;void 0===t&&(t=!1),this.getLayerIdsByID(e,this.layers.overlays,t).forEach(function(e){delete a.layers.overlays[e]})},o.prototype.removeMarkerLayers=function(e,t){var a=this;void 0===t&&(t=!1),this.getLayerIdsByID(e,this.markers,t).forEach(function(e){delete a.markers[e]})},o.prototype.removeGeoJsonLayers=function(e,t){var a=this;void 0===t&&(t=!1),this.getLayerIdsByID(e,this.geojson,t).forEach(function(e){delete a.geojson[e]})},o.prototype.getLayerIdsByName=function(e,t,a){var r=[];for(var n in t)t[n].hasOwnProperty("name")&&(a?t[n].name.indexOf(e)>-1:t[n].name===e)&&r.push(n);return r},o.prototype.getLayerIdsByID=function(e,t,a){var r=[];for(var n in t)(a?n.indexOf(e)>-1:n===e)&&r.push(n);return r},o.prototype.queryExcludePolygons=function(e,t,a){var r={region:e,points:[{lat:t,long:a}]},n=configuration.baseurls.PourPointServices+configuration.queryparams.PourPointServicesExcludePolygon,i=new WiM.Services.Helpers.RequestInfo(n,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(r));return this.Execute(i).then(function(e){return e},function(e){return e}).finally(function(){})},o.prototype.startDelineate=function(t,a,r){var n=new e.Models.StudyArea(this.regionServices.selectedRegion.RegionID,new WiM.Models.Point(t.lat,t.lng,"4326"));this.studyArea.AddStudyArea(n),this.studyArea.loadStudyBoundary(),a&&r&&(this.studyArea.selectedStudyArea.Disclaimers.isInExclusionArea="The delineation point is in an exclusion area. "+r)},o.$inject=["$scope","$compile","toaster","$location","$stateParams","leafletBoundsHelpers","leafletData","WiM.Services.SearchAPIService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ExplorationService","StreamStats.Services.ProsperService","WiM.Event.EventManager","StreamStats.Services.ModalService","$modalStack","$http"],o}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.MapController",o)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(t){"use strinct";var a,r=function(){function t(t,r,n,i,o,s,l,g,c){var u=this;this.EventManager=c,this.SSServicesVersion="1.2.22",this.dateRange={dates:{startDate:new Date,endDate:new Date},minDate:new Date(1900,1,1),maxDate:new Date},t.vm=this,this.init(),this.toaster=r,this.sideBarCollapsed=!1,this.selectedProcedure=a.INIT,this.regionService=n,this.nssService=o,this.studyAreaService=i,this.modalService=s,this.leafletData=l,this.multipleParameterSelectorAdd=!0,this.explorationService=g,this.environment=configuration.environment,o.onSelectedStatisticsGroupChanged.subscribe(this._onSelectedStatisticsGroupChangedHandler),t.$watch(function(){return u.regionService.selectedRegion},function(e,t){null==e?u.setProcedureType(1):u.setProcedureType(2)}),t.$watch(function(){return u.studyAreaService.regressionRegionQueryComplete},function(e,t){e!=t&&(null==e?u.setProcedureType(2):u.regionService.selectedRegion.ScenariosAvailable?u.setProcedureType(3):u.setProcedureType(2))}),t.$watchCollection(function(){return u.studyAreaService.selectedStudyAreaExtensions},function(e,t){e!=t&&(u.scenarioHasExtensions=u.studyAreaService.selectedStudyAreaExtensions.length>0)}),t.$watchCollection(function(){return u.studyAreaService.extensionsConfigured},function(e,t){if(e!=t)if(e){var a=!0;u.studyAreaService.selectedStudyAreaExtensions.forEach(function(e){e.parameters.forEach(function(e){e.hasOwnProperty("value")&&void 0!=e.value||(a=!1)})}),a&&(u.extensionsConfigured=!0)}else u.extensionsConfigured=e}),c.SubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,new WiM.Event.EventHandler(function(e,t){u.parametersLoaded=t.parameterLoaded,u.parametersLoaded?u.setProcedureType(4):u.setProcedureType(3)}))}return Object.defineProperty(t.prototype,"ParameterValuesMissing",{get:function(){if(!this.studyAreaService.studyAreaParameterList||this.studyAreaService.studyAreaParameterList.length<1)return!0;for(var e=0;e<this.studyAreaService.studyAreaParameterList.length;e++){var t=this.studyAreaService.studyAreaParameterList[e];if(!t.value||t.value<0)return!0}return!1},enumerable:!1,configurable:!0}),t.prototype.setProcedureType=function(e){this.selectedProcedure!=e&&this.canUpdateProcedure(e)?this.selectedProcedure=e:2!=this.selectedProcedure||3!=e&&4!=e||this.toaster.pop("warning","Warning","Make sure you have delineated a basin and clicked continue",5e3)},t.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},t.prototype.onAOISelect=function(e){this.EventManager.RaiseEvent(WiM.Services.onSelectedAreaOfInterestChanged,this,new WiM.Services.SearchAPIEventArgs(e))},t.prototype.zoomRegion=function(e){angular.fromJson(e)},t.prototype.setRegion=function(e){gtag("event","SetRegion",{Region:e.RegionID}),void 0!=this.regionService.selectedRegion&&this.regionService.selectedRegion.RegionID===e.RegionID||(this.regionService.selectedRegion=e),this.setProcedureType(2),this.regionService.loadParametersByRegion()},t.prototype.openStatePage=function(t,a){t.stopPropagation(),t.preventDefault(),this.modalService.openModal(e.Services.SSModalType.e_about,{tabName:"regionInfo",regionID:a})},t.prototype.resetWorkSpace=function(){this.regionService.clearSelectedParameters(),this.studyAreaService.clearStudyArea(),this.studyAreaService.zoomLevel15=!0,this.nssService.clearNSSdata(),this.multipleParameterSelectorAdd=!1},t.prototype.startSearch=function(e){e.stopPropagation(),e.preventDefault(),$("#searchBox").trigger($.Event("keyup",{keyCode:13}))},t.prototype.startDelineate=function(){var e=this;this.leafletData.getMap("mainMap").then(function(t){t.getZoom()<15?e.toaster.pop("error","Delineate","You must be at or above zoom level 15 to delineate."):(e.toaster.pop("success","Delineate","Click on a blue stream cell to start delineation"),e.studyAreaService.doDelineateFlag=!e.studyAreaService.doDelineateFlag)})},t.prototype.setStatisticsGroup=function(t){var a=this.checkArrayForObj(this.nssService.selectedStatisticsGroupList,t);if(-1!=a){var r=!1;if("number"!=typeof t.id&&t.id.indexOf("fdctm")){var n=this.studyAreaService.selectedStudyAreaExtensions.filter(function(e){return"QPPQ"==e.code})[0],i=this.studyAreaService.selectedStudyAreaExtensions.indexOf(n);this.studyAreaService.selectedStudyAreaExtensions.splice(i,1),this.EventManager.RaiseEvent(e.Services.onScenarioExtensionChanged,this,new e.Services.NSSEventArgs(this.studyAreaService.selectedStudyAreaExtensions))}this.nssService.selectedStatisticsGroupList.filter(function(e){return"Flow-Duration Curve Transfer Method"==e.name}).length>0&&"Flow-Duration Statistics"==t.name&&(r=!0),r||(this.nssService.selectedStatisticsGroupList.splice(a,1),0==this.nssService.selectedStatisticsGroupList.length&&(this.studyAreaService.studyAreaParameterList=[],this.regionService.parameterList.forEach(function(e){e.checked=!1,e.toggleable=!0})))}else{if(this.nssService.selectedStatisticsGroupList.push(t),"number"!=typeof t.id&&t.id.indexOf("fdctm")){var o=this.nssService.statisticsGroupList.filter(function(e){return"Flow-Duration Statistics"==e.name})[0];-1==this.checkArrayForObj(this.nssService.selectedStatisticsGroupList,o)&&this.nssService.selectedStatisticsGroupList.push(o)}if(null!=this.studyAreaService.selectedStudyArea.CoordinatedReach&&"PFS"==t.code.toUpperCase())return this.addParameterToStudyAreaList("DRNAREA"),void(this.nssService.showFlowsTable=!0);this.nssService.loadParametersByStatisticsGroup(this.regionService.selectedRegion.RegionID,t.id,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","),this.studyAreaService.selectedStudyArea.RegressionRegions)}},t.prototype.multipleParameterSelector=function(){var e=this;this.regionService.parameterList.forEach(function(t){var a=e.checkArrayForObj(e.studyAreaService.studyAreaParameterList,t);e.multipleParameterSelectorAdd?(-1==a&&e.studyAreaService.studyAreaParameterList.push(t),t.checked=!0):a>-1&&t.toggleable&&(e.studyAreaService.studyAreaParameterList.splice(a,1),t.checked=!1)}),this.multipleParameterSelectorAdd=!this.multipleParameterSelectorAdd},t.prototype.updateStudyAreaParameterList=function(e){if(0==e.toggleable)return this.toaster.pop("warning",e.code+" is required by one of the selected scenarios","It cannot be unselected"),void(e.checked=!0);var t=this.studyAreaService.studyAreaParameterList.indexOf(e);!e.checked&&t>-1?this.studyAreaService.studyAreaParameterList.splice(t,1):e.checked&&-1==t&&this.studyAreaService.studyAreaParameterList.push(e),this.checkParameters()},t.prototype.checkParameters=function(){for(var e=!0,t=0,a=this.regionService.parameterList;t<a.length;t++){a[t].checked||(e=!1)}this.multipleParameterSelectorAdd=!e},t.prototype.calculateParameters=function(){gtag("event","Calculate",{Category:"Parameters",Location:this.regionService.selectedRegion.Name,Value:this.studyAreaService.studyAreaParameterList.map(function(e){return e.code}).join(",")}),this.studyAreaService.loadParameters(),this.scenarioHasExtensions&&1==this.nssService.selectedStatisticsGroupList.length&&(this.nssService.showBasinCharacteristicsTable=!1)},t.prototype.configureExtensions=function(t){"FDCTM"==t?this.modalService.openModal(e.Services.SSModalType.e_extensionsupport):"FLA"==t&&(this.modalService.openModal(e.Services.SSModalType.e_flowanywhere),this.addParameterToStudyAreaList("DRNAREA"))},t.prototype.submitBasinEdits=function(){var e=this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+","+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5);gtag("event","BasinEditor",{Type:"SubmitEdits",Location:e}),this.studyAreaService.showEditToolbar=!1,this.toaster.pop("wait","Submitting edited basin","Please wait...",0),this.studyAreaService.selectedStudyArea.Disclaimers.isEdited&&(this.nssService.clearNSSdata(),this.studyAreaService.loadEditedStudyBoundary())},t.prototype.selectScenarios=function(){this.setProcedureType(3)},t.prototype.refreshWindow=function(){window.location.reload()},t.prototype.generateReport=function(){var t=this;if(this.toaster.pop("wait","Opening Report","Please wait...",5e3),gtag("event","Calculate",{Category:"Flows",Location:this.regionService.selectedRegion.Name,Value:this.nssService.selectedStatisticsGroupList.map(function(e){return e.name}).join(",")}),this.studyAreaService.extensionResultsChanged=0,-1!=this.regionService.selectedRegion.Applications.indexOf("FLA")&&this.studyAreaService.flowAnywhereData&&this.studyAreaService.flowAnywhereData.selectedGage&&this.studyAreaService.flowAnywhereData.dateRange&&this.studyAreaService.computeFlowAnywhereResults(),this.nssService.selectedStatisticsGroupList.length>0&&this.nssService.showFlowsTable){var a=[];if(null!=this.studyAreaService.selectedStudyArea.CoordinatedReach)for(var r=0;r<this.nssService.selectedStatisticsGroupList.length;r++){var n=this.nssService.selectedStatisticsGroupList[r];if("PFS"===n.code.toUpperCase()){n.citations=[{author:"Indiana DNR,",title:"Coordinated Discharges of Selected Streams in Indiana.",citationURL:"http://www.in.gov/dnr/water/4898.htm"}],n.regressionRegions=[];var i=this.studyAreaService.selectedStudyArea.CoordinatedReach.Execute(this.studyAreaService.studyAreaParameterList.filter(function(e){return"DRNAREA"===e.code}));n.regressionRegions.push(i),a.push(n),this.nssService.selectedStatisticsGroupList.splice(r,1);break}}this.nssService.estimateFlows(this.studyAreaService.studyAreaParameterList,"value",this.regionService.selectedRegion.RegionID),-1!=this.regionService.selectedRegion.Applications.indexOf("RegulationFlows")&&setTimeout(function(){t.nssService.estimateFlows(t.studyAreaService.studyAreaParameterList,"unRegulatedValue",t.regionService.selectedRegion.RegionID,!0)},500),null!=n&&"PFS"===n.code.toUpperCase()&&(this.nssService.selectedStatisticsGroupList.push(n),1==this.nssService.selectedStatisticsGroupList.length&&(this.toaster.clear(),this.modalService.openModal(e.Services.SSModalType.e_report),this.nssService.reportGenerated=!0))}else this.toaster.clear(),this.modalService.openModal(e.Services.SSModalType.e_report),this.nssService.reportGenerated=!0;this.leafletData.getMap("mainMap").then(function(e){t.leafletData.getLayers("mainMap").then(function(a){for(var r in a.baselayers)e.hasLayer(a.baselayers[r])&&(t.studyAreaService.baseMap={},t.studyAreaService.baseMap[r]=configuration.basemaps[r])})})},t.prototype.checkRegulation=function(){gtag("event","AdditionalFunctionality",{Category:"Regulation"}),this.studyAreaService.upstreamRegulation()},t.prototype.queryRegressionRegions=function(){if(!this.regionService.selectedRegion.ScenariosAvailable)return this.studyAreaService.regressionRegionQueryComplete=!0,void this.setProcedureType(a.SELECT);this.nssService.queriedRegions=!0,-1!=this.regionService.selectedRegion.Applications.indexOf("CoordinatedReach")&&this.studyAreaService.queryCoordinatedReach(),this.studyAreaService.selectedStudyArea.RegressionRegions?this.setProcedureType(3):this.studyAreaService.queryRegressionRegions()},t.prototype.queryStatisticsGroupTypes=function(){this.nssService.loadStatisticsGroupTypes(this.regionService.selectedRegion.RegionID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","))},t.prototype.updateParameterValue=function(e){},t.prototype.onSelectedStatisticsGroupChanged=function(){var e=this;this.nssService.selectedStatisticsGroupList.length>0?this.nssService.showFlowsTable=!0:this.nssService.showFlowsTable=!1,this.nssService.selectedStatisticsGroupList.forEach(function(t){t.regressionRegions&&t.regressionRegions.forEach(function(t){t.parameters.forEach(function(t){for(var a=!1,r=0;r<e.regionService.parameterList.length;r++){var n=e.regionService.parameterList[r];if(n.code.toLowerCase()==t.code.toLowerCase()){e.addParameterToStudyAreaList(n.code),a=!0;break}}if(!a){e.toaster.pop("warning","Missing Parameter: "+t.code,"The selected scenario requires a parameter not available in this State/Region.  The value for this parameter will need to be entered manually.",0);var i={name:t.name,description:t.description,code:t.code,unit:t.unitType.unit,value:null,regulatedValue:null,unRegulatedValue:null,loaded:null,checked:!1,toggleable:!0};e.regionService.parameterList.push(i),e.addParameterToStudyAreaList(t.code)}})})})},t.prototype.OpenWateruse=function(){gtag("event","AdditionalFunctionality",{Category:"WaterUse"}),this.modalService.openModal(e.Services.SSModalType.e_wateruse)},t.prototype.OpenStormRunoff=function(){gtag("event","AdditionalFunctionality",{Category:"StormRunoff"}),this.modalService.openModal(e.Services.SSModalType.e_stormrunnoff)},t.prototype.OpenSCStormRunoff=function(){this.modalService.openModal(e.Services.SSModalType.e_scstormrunnoff)},t.prototype.OpenNearestGages=function(){gtag("event","AdditionalFunctionality",{Category:"NearestGages"}),this.modalService.openModal(e.Services.SSModalType.e_nearestgages)},t.prototype.downloadGeoJSON=function(){gtag("event","Download",{Category:"Basin",Type:"Geojson"});var e=angular.toJson(this.studyAreaService.selectedStudyArea.FeatureCollection),t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"data.geojson");else{var a=document.createElement("a"),r=URL.createObjectURL(t);void 0!==a.download?(a.setAttribute("href",r),a.setAttribute("download","data.geojson"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(r)}},t.prototype.downloadKML=function(){gtag("event","Download",{Category:"Basin",Type:"KML"});var e=JSON.parse(angular.toJson(this.studyAreaService.selectedStudyArea.FeatureCollection)),t=tokml(e),a=new Blob([t],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,"data.kml");else{var r=document.createElement("a"),n=URL.createObjectURL(a);void 0!==r.download?(r.setAttribute("href",n),r.setAttribute("download","data.kml"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(n)}},t.prototype.downloadShapeFile=function(){gtag("event","Download",{Category:"Basin",Type:"Shapefile"});try{var e=null;this.nssService.showFlowsTable&&(e=this.nssService.getflattenNSSTable(this.studyAreaService.selectedStudyArea.WorkspaceID));var t=this.studyAreaService.getflattenStudyArea(),a="Application Version: "+configuration.version;this.SSServicesVersion&&(a+="\nStreamStats Services Version: "+this.SSServicesVersion),shpwrite.download(t,e,"USGS Data Disclaimer: Unless otherwise stated, all data, metadata and related materials are considered to satisfy the quality standards relative to the purpose for which the data were collected. Although these data and associated metadata have been reviewed for accuracy and completeness and approved for release by the U.S. Geological Survey (USGS), no warranty expressed or implied is made regarding the display or utility of the data for other purposes, nor on all computer systems, nor shall the act of distribution constitute any such warranty.\nUSGS Software Disclaimer: This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the functionality of the software and related material nor shall the fact of release constitute any such warranty. Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held liable for any damages resulting from its authorized or unauthorized use.\nUSGS Product Names Disclaimer: Any use of trade, firm, or product names is for descriptive purposes only and does not imply endorsement by the U.S. Government.\n\n"+a)}catch(e){console.log(e)}},t.prototype.init=function(){var e=this;this._onSelectedStatisticsGroupChangedHandler=new WiM.Event.EventHandler(function(){e.onSelectedStatisticsGroupChanged()})},t.prototype.checkArrayForObj=function(e,t){for(var a=0;a<e.length;a++)if(angular.equals(e[a],t))return a;return-1},t.prototype.addParameterToStudyAreaList=function(e){try{for(var t=0;t<this.regionService.parameterList.length;t++){var a=this.regionService.parameterList[t];if(a.code.toUpperCase()===e.toUpperCase()&&-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,a)){this.studyAreaService.studyAreaParameterList.push(a),a.checked=!0,a.toggleable=!1;break}}}catch(e){return!1}},t.prototype.canUpdateProcedure=function(e){try{switch(e){case a.INIT:return!0;case a.IDENTIFY:return null!=this.regionService.selectedRegion;case a.SELECT:return this.studyAreaService.regressionRegionQueryComplete;case a.BUILD:return this.studyAreaService.regressionRegionQueryComplete&&this.parametersLoaded;default:return!1}}catch(e){return!1}},t.prototype.sm=function(e){},t.$inject=["$scope","toaster","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ModalService","leafletData","StreamStats.Services.ExplorationService","WiM.Event.EventManager"],t}();!function(e){e[e.INIT=1]="INIT",e[e.IDENTIFY=2]="IDENTIFY",e[e.SELECT=3]="SELECT",e[e.BUILD=4]="BUILD"}(a||(a={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.SidebarController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(t){"use strict";var a=function(t){function a(e,a,r,n){var i=t.call(this,a,configuration.baseurls.StreamStats)||this;return e.vm=i,i.http=a,i.modalService=r,i.studyAreaService=n,i.environment=configuration.environment,i.AppVersion=configuration.version,i.cloud=configuration.cloud,i.showBatchButton=configuration.showBPButton,i.checkURLParams(),configuration.showWarningModal&&i.openWarningMessage(),i}return __extends(a,t),a.prototype.checkURLParams=function(){var t=window.location.search,a=new URLSearchParams(t),r=a.get("BP"),n=a.get("gage");if(r){if("submitBatch"==r&&this.modalService.openModal(e.Services.SSModalType.e_batchprocessor,{tabName:"submitBatch"}),"batchStatus"==r){var i=a.get("email");i?this.modalService.openModal(e.Services.SSModalType.e_batchprocessor,{tabName:"batchStatus",urlParams:i}):this.modalService.openModal(e.Services.SSModalType.e_batchprocessor,{tabName:"batchStatus"})}"streamGrid"==r&&this.modalService.openModal(e.Services.SSModalType.e_batchprocessor,{tabName:"streamGrid"}),"manageQueue"==r&&this.modalService.openModal(e.Services.SSModalType.e_batchprocessor,{tabName:"manageQueue"})}else if(n){var o=a.get("tab");o&&"plots"==o?this.modalService.openModal(e.Services.SSModalType.e_gagepage,{siteid:n,tabName:"GageAnalysisPlots"}):this.modalService.openModal(e.Services.SSModalType.e_gagepage,{siteid:n,tabName:"GageInformation"})}},a.prototype.openBatchProcessor=function(){this.modalService.openModal(e.Services.SSModalType.e_batchprocessor)},a.prototype.openReport=function(){this.modalService.openModal(e.Services.SSModalType.e_report)},a.prototype.openAbout=function(){this.modalService.openModal(e.Services.SSModalType.e_about)},a.prototype.openHelp=function(){this.modalService.openModal(e.Services.SSModalType.e_help)},a.prototype.openWarningMessage=function(){this.modalService.openModal(e.Services.SSModalType.e_warningmessage)},a.prototype.readCookie=function(e){for(var t=e+"=",a=document.cookie.split(";"),r=0;r<a.length;r++){for(var n=a[r];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null},a.prototype.createCookie=function(e,t,a){if(a){var r=new Date;r.setTime(r.getTime()+24*a*60*60*1e3);var n="; expires="+r.toUTCString()}else n="";document.cookie=e+"="+t+n+"; path=/"},a.$inject=["$scope","$http","StreamStats.Services.ModalService","StreamStats.Services.StudyAreaService"],a}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavbarController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(t){"use strinct";var a=function(){return function(e,t,a){this.lat=e,this.lng=t,this.zoom=a}}(),r=function(){function t(t,a,r,n,i,o,s,l){var g=this;if(this.regionService=o,this.modal=s,this.disclaimer='"USGS Data Disclaimer: Unless otherwise stated, all data, metadata and related materials are considered to satisfy the quality standards relative to the purpose for which the data were collected. Although these data and associated metadata have been reviewed for accuracy and completeness and approved for release by the U.S. Geological Survey (USGS), no warranty expressed or implied is made regarding the display or utility of the data for other purposes, nor on all computer systems, nor shall the act of distribution constitute any such warranty."\n"USGS Software Disclaimer: This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the functionality of the software and related material nor shall the fact of release constitute any such warranty. Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held liable for any damages resulting from its authorized or unauthorized use."\n"USGS Product Names Disclaimer: Any use of trade, firm, or product names is for descriptive purposes only and does not imply endorsement by the U.S. Government."\n\n',this.markers=null,this.overlays=null,this.center=null,this.layers=null,this.geojson=null,this.isExceedanceTableOpen=!1,this.isFlowTableOpen=!1,this.isEstimatedFlowFLATableOpen=!1,this.SSServicesVersion="1.2.22",this._graphData={data:{},options:{}},t.vm=this,this.studyAreaService=r,this.nssService=n,this.leafletData=i,this.reportTitle="StreamStats Report",this.reportComments="Some comments here",this.AppVersion=configuration.version,this.extensions=this.ActiveExtensions,this.applications=this.ActiveApplications,this.environment=configuration.environment,this.sectionCollapsed=[],this.basinCharCollapsed=!1,this.collapsed=!1,this.selectedFDCTMTabName="",this.eventManager=l,this.extensions&&this.extensions[0].result&&this.extensions[0].result.length>1){this.extensions[0].result.forEach(function(e){e.name.toLowerCase().includes("multivar")&&(g.selectedFDCTMTabName=e.name)});var c=this.extensions[0].result.map(function(e){return e.name});this.extensions[0].result=this.extensions[0].result.filter(function(e,t){var a=e.name;return!c.includes(a,t+1)})}this.initMap(),this.eventManager.SubscribeToEvent(e.Services.onAdditionalFeaturesLoaded,new WiM.Event.EventHandler(function(){var e=g.studyAreaService.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"!==e.id});g.showFeatures(e)})),t.$on("leafletDirectiveMap.reportMap.load",function(e,t){g.showFeatures(g.studyAreaService.selectedStudyArea.FeatureCollection.features)}),this.close=function(){a.dismiss("cancel")},this.print=function(){gtag("event","Download",{Category:"Report",Type:"Print"}),window.print()},this.NSSServicesVersion=this.studyAreaService.NSSServicesVersion}return Object.defineProperty(t.prototype,"showReport",{get:function(){if(!this.studyAreaService.studyAreaParameterList)return!1;for(var e=0;e<this.studyAreaService.studyAreaParameterList.length;e++){var t=this.studyAreaService.studyAreaParameterList[e];if(t.value&&t.value>=0)return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canShowDisclaimers",{get:function(){return null!=this.studyAreaService.selectedStudyArea.Disclaimers&&Object.keys(this.studyAreaService.selectedStudyArea.Disclaimers).length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showRegulation",{get:function(){return this.regionService.selectedRegion.Applications.indexOf("RegulationFlows")>-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ActiveApplications",{get:function(){return this.regionService.selectedRegion.Applications&&this.regionService.selectedRegion.Applications.length>0?this.regionService.selectedRegion.Applications:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ActiveExtensions",{get:function(){return this.studyAreaService.selectedStudyArea.NSS_Extensions&&this.studyAreaService.selectedStudyArea.NSS_Extensions.length>0?this.studyAreaService.selectedStudyArea.NSS_Extensions:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GraphData",{get:function(){return this._graphData},enumerable:!1,configurable:!0}),t.prototype.setStream=function(e){this.studyAreaService.selectedStudyArea.NHDStream=e;var t=document.getElementById(e.GNIS_NAME);null!=t?t.checked=!0:setTimeout(function(){var t=document.getElementById(e.GNIS_NAME);null!=t&&(t.checked=!0)},1e3)},t.prototype.selectFDCTMTab=function(e){this.selectedFDCTMTabName!=e&&(this.selectedFDCTMTabName=e)},t.prototype.downloadCSV=function(){var e=this;gtag("event","Download",{Category:"Report",Type:"CSV"});var t,a="StreamStats Output Report\n\nState/Region ID,"+this.studyAreaService.selectedStudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.studyAreaService.selectedStudyArea.WorkspaceID+"\nLatitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString()+"\n";this.studyAreaService.selectedStudyArea.NHDStream.GNIS_ID&&(a+="\nNHD Stream GNIS ID,"+this.studyAreaService.selectedStudyArea.NHDStream.GNIS_ID),this.studyAreaService.selectedStudyArea.NHDStream.GNIS_NAME&&(a+="\nNHD Stream GNIS Name,"+this.studyAreaService.selectedStudyArea.NHDStream.GNIS_NAME),this.studyAreaService.selectedStudyArea.WBDHUC8.huc8&&(a+="\nHUC 8,"+this.studyAreaService.selectedStudyArea.WBDHUC8.huc8),this.studyAreaService.selectedStudyArea.WBDHUC8.name&&(a+=" ("+this.studyAreaService.selectedStudyArea.WBDHUC8.name+")"),a+="\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString()+"\n",a+=(this.studyAreaService.studyAreaParameterList,t="\nBasin Characteristics\n",(t+=e.tableToCSV($("#mainParamTable")))+"\n\n"),this.nssService.selectedStatisticsGroupList.forEach(function(t){a+=function(t){var a="\n";return t.regressionRegions.forEach(function(r){if("Area-Averaged"!=r.name){var n="";r.percentWeight&&(n=r.percentWeight.toFixed(1)+" Percent "),a+=t.name+" Parameters,"+n+r.name.split("_").join(" ")+"\r\n",a+=e.tableToCSV($(document.getElementById(e.camelize(t.name+r.name+"ScenarioParamTable"))))+"\n"}}),a+"\n"}(t),t.disclaimers&&(t.disclaimers.Warnings||t.disclaimers.Errors)&&(a+=function(e){var t="*** "+e.name+" Disclaimers ***\r\n";return angular.forEach(e.disclaimer,function(e,a){t+=a+","+e+"\r\n"}),t+"\r\n"}(t)),a+=function(t){var a="";return t.regressionRegions.forEach(function(r){if(r.results){var n="";r.percentWeight&&(n=r.percentWeight.toFixed(1)+" Percent "),a+=t.name+" Flow Report,"+n+r.name.split("_").join(" ")+"\r\n",r.results[0].intervalBounds&&r.results[0].errors&&r.results[0].errors.length>0&&(a+='"PIL: Lower 90% Prediction Interval, PIU: Upper 90% Prediction Interval, ASEp: Average Standard Error of Prediction, SE: Standard Error (other-- see report)"\r\n'),a+=e.tableToCSV($(document.getElementById(e.camelize(t.name+r.name+"ScenarioFlowTable"))))+"\n"}}),a+"\n"}(t)}),this.isExceedanceTableOpen=!0,this.isFlowTableOpen=!0,this.isEstimatedFlowFLATableOpen=!0;var r=this;setTimeout(function(){var e="";if(r.extensions)for(var t=0,n=r.extensions;t<n.length;t++){var i=n[t];if("QPPQ"==i.code){e+=i.name+=" (FDCTM)\n",e+="Regression Region:, "+r.selectedFDCTMTabName+"\n";for(var o=0,s=i.parameters;o<s.length;o++){var l=s[o];if(["sdate","edate"].indexOf(l.code)>-1){var g=new Date(l.value);e+=l.name+":, "+g.toLocaleDateString()+"\n"}}e+="\n",e+=r.tableToCSV($("#ReferenceGage")),e+="\n\nExceedance Probabilities\n",e+=r.tableToCSV($("#exceedanceTable")),e+="\n\nEstimated Flows\n",e+=r.tableToCSV($("#flowTable")),e+="\n\n"}}if(r.applications){-1!=r.applications.indexOf("FLA")&&(e+="Flow Anywhere Method",e+="\n\n",e+=r.tableToCSV($("#flowAnywhereReferenceGage")),e+="\n\n",e+=r.tableToCSV($("#flowAnywhereModelParameters")),e+="\n\nEstimated Flows\n",e+=r.tableToCSV($("#estimatedFlowFLATable")),e+="\n\n");var c=-1!=r.applications.indexOf("ChannelWidthWeighting"),u=!1;r.nssService.selectedStatisticsGroupList.forEach(function(e){"Peak-Flow Statistics"==e.name&&(u=!0)}),c&&u&&(e+="Channel-width Methods Weighting\n",document.getElementById("channelWidthWeightingTable")?(e+="PIL: Lower 90% Prediction Interval, PIU: Upper 90% Prediction Interval, ASEp: Average Standard Error of Prediction\n",r.nssService.equationWeightingDisclaimers&&r.nssService.equationWeightingDisclaimers.length>0&&(e+="Warning messages:,",r.nssService.equationWeightingDisclaimers.forEach(function(t){e+=t+". "}),e+="\n"),e+=r.tableToCSV($("#channelWidthWeightingTable"))):e+="No method weighting results returned.",e+="\n\n")}(a+=e,r.applications)&&(-1!=r.applications.indexOf("HydrologicFeatures")&&(e+="National Hydrography Dataset (NHD) Hydrologic Features\n",e+="Intersecting NHD Streams\n",r.studyAreaService.selectedStudyArea.NHDStreamIntersections.length>0?e+=r.tableToCSV($("#hydrologicFeaturesTable")):r.studyAreaService.selectedStudyArea.NHDStreamIntersections?0==r.studyAreaService.selectedStudyArea.NHDStreamIntersections.length&&(e+="No NHD streams intersect the delineated basin."):e+="No NHD streams were loaded.",a+=e+"\n\n"));a+=r.disclaimer+"Application Version: "+r.AppVersion,r.SSServicesVersion&&(a+="\nStreamStats Services Version: "+r.SSServicesVersion),r.NSSServicesVersion&&(a+="\nNSS Services Version: "+r.NSSServicesVersion);var d=new Blob([a],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(d,"data.csv");else{var A=document.createElement("a"),h=URL.createObjectURL(d);void 0!==A.download?(A.setAttribute("href",h),A.setAttribute("download","data.csv"),A.style.visibility="hidden",document.body.appendChild(A),A.click(),document.body.removeChild(A)):window.open(h)}this.isExceedanceTableOpen=!1,this.isFlowTableOpen=!1,this.isEstimatedFlowFLATableOpen=!1},300)},t.prototype.downloadGeoJSON=function(){var e=this;gtag("event","Download",{Category:"Report",Type:"Geojson"});var t=this.studyAreaService.selectedStudyArea.FeatureCollection;t.features.forEach(function(t){t.properties.Name=e.studyAreaService.selectedStudyArea.WorkspaceID,t.id&&"globalwatershed"==t.id&&(t.properties=[t.properties,e.studyAreaService.studyAreaParameterList.reduce(function(e,t){return e[t.code]=t.value,e},{})].reduce(function(e,t){return Object.keys(t).forEach(function(a){e[a]=t[a]}),e},{}),t.properties.FlowStatistics=e.nssService.selectedStatisticsGroupList)});var a=angular.toJson(t),r=new Blob([a],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,"data.geojson");else{var n=document.createElement("a"),i=URL.createObjectURL(r);void 0!==n.download?(n.setAttribute("href",i),n.setAttribute("download","data.geojson"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)):window.open(i)}},t.prototype.downloadKML=function(){var e=this;gtag("event","Download",{Category:"Report",Type:"KML"});var t=this.studyAreaService.selectedStudyArea.FeatureCollection;t.features.forEach(function(t){t.properties.Name=e.studyAreaService.selectedStudyArea.WorkspaceID,t.id&&"globalwatershed"==t.id&&(t.properties=[t.properties,e.studyAreaService.studyAreaParameterList.reduce(function(e,t){return e[t.code]=t.value,e},{})].reduce(function(e,t){return Object.keys(t).forEach(function(a){e[a]=t[a]}),e},{}),t.properties.FlowStatistics=e.nssService.selectedStatisticsGroupList)});var a=JSON.parse(angular.toJson(t)),r=tokml(a),n=new Blob([r],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(n,"data.kml");else{var i=document.createElement("a"),o=URL.createObjectURL(n);void 0!==i.download?(i.setAttribute("href",o),i.setAttribute("download","data.kml"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)):window.open(o)}},t.prototype.downloadShapeFile=function(){gtag("event","Download",{Category:"Report",Type:"Shapefile"});try{var e=null;this.nssService.showFlowsTable&&(e=this.nssService.getflattenNSSTable(this.studyAreaService.selectedStudyArea.WorkspaceID));var t=this.studyAreaService.getflattenStudyArea(),a="Application Version: "+this.AppVersion;this.SSServicesVersion&&(a+="\nStreamStats Services Version: "+this.SSServicesVersion),this.NSSServicesVersion&&(a+="\nNSS Services Version: "+this.NSSServicesVersion),shpwrite.download(t,e,this.disclaimer+a)}catch(e){console.log(e)}},t.prototype.downloadPNG=function(e){for(var t,a=document.getElementById(e).children,r=0;r<a.length;r++)"svg"===a[r].tagName&&(t=a[r]);saveSvgAsPng(t,e+".png")},t.prototype.downloadPDF=function(){var e=new jsPDF("p","pt","letter"),t=document.getElementById("printArea").innerHTML,a={top:80,bottom:60,left:40,width:522};e.fromHTML(t,a.left,a.top,{width:a.width,elementHandlers:{"#bypassme":function(e,t){return!0}}},function(t){e.save("Test.pdf")},a)},t.prototype.collapseSection=function(e,t,a){var r=e.currentTarget.nextElementSibling;"none"===r.style.display?(r.style.display="block","stats"===t&&(this.sectionCollapsed[a]=!1),"basin"===t&&(this.basinCharCollapsed=!1)):(r.style.display="none","stats"===t&&(this.sectionCollapsed[a]=!0),"basin"===t&&(this.basinCharCollapsed=!0))},t.prototype.expandAll=function(e){var t=this,a=document.querySelectorAll(".collapsible-content");"expand"===e?(a.forEach(function(e){e.style.display="block"}),this.basinCharCollapsed=!1,this.nssService.statisticsGroupList.forEach(function(e){t.sectionCollapsed[e.name]=!1}),this.collapsed=!1):(a.forEach(function(e){e.style.display="none"}),this.basinCharCollapsed=!0,this.nssService.statisticsGroupList.forEach(function(e){t.sectionCollapsed[e.name]=!0}),this.collapsed=!0)},t.prototype.ActivateGraphs=function(e){for(var t in e.graphdata={exceedance:{data:[{values:[],area:!0,color:"#7777ff"}],options:{chart:{type:"lineChart",height:450,margin:{top:20,right:30,bottom:60,left:100},x:function(e){return e.label},y:function(e){return e.value},showLegend:!1,valueFormat:function(e){return d3.format(",.3f")(e)},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Discharge (cfs)",tickFormat:function(e){return d3.format(",.0f")(e)},tickValues:[1,10,100,1e3,1e4,1e6]},yScale:d3.scale.log(),title:{enable:!0,text:"Flow Duration Curve Transfer Method (FDCTM) Model Estimated Exceedance Probabilities"}}}},flow:{data:[{key:"Observed",values:this.processData(e.referanceGage.discharge.observations)},{key:"Estimated",values:this.processData(e.estimatedFlow.observations)}],options:{chart:{type:"lineChart",height:450,margin:{top:20,right:30,bottom:60,left:100},x:function(e){return new Date(e.x).getTime()},y:function(e){return e.y},useInteractiveGuideline:!1,interactive:!0,tooltips:!0,xAxis:{tickFormat:function(e){return d3.time.format("%x")(new Date(e))},rotateLabels:-30,showMaxMin:!0},yAxis:{axisLabel:"Estimated Discharge (cfs)",tickFormat:function(e){return null!=e?e.toUSGSvalue():e},showMaxMin:!0},zoom:{enabled:!1}}}}},e.exceedanceProbabilities)e.graphdata.exceedance.data[0].values.push({label:t,value:e.exceedanceProbabilities[t]});e.exceedanceProbabilitiesArray=[],angular.forEach(e.exceedanceProbabilities,function(t,a){e.exceedanceProbabilitiesArray.push({exceedance:a,flowExceeded:t})})},t.prototype.initMap=function(){this.center=new a(39,-96,4),this.layers={baselayers:configuration.basemaps,overlays:{}},this.geojson={},L.Icon.Default.imagePath="images",this.defaults={scrollWheelZoom:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1}},t.prototype.GetRegressionRegionHeader=function(e){var t=e.name.split("_").join(" ");if(e.percentWeight&&e.percentWeight<100)for(var a=0;a<this.studyAreaService.selectedStudyArea.RegressionRegions.length;a++){var r=this.studyAreaService.selectedStudyArea.RegressionRegions[a];if(null!=e.code&&r.code.indexOf(e.code.toUpperCase())>-1){t="{0} Percent ({1} square miles) {2}".format(e.percentWeight.toFixed(1),r.area.toUSGSvalue(),t);break}}return"["+t+"]"},t.prototype.showFeatures=function(e){var t=this;if(this.studyAreaService.selectedStudyArea){if(this.overlays={},e.forEach(function(e){t.addGeoJSON(e.id,e)}),this.studyAreaService.selectedGage&&this.studyAreaService.selectedGage.hasOwnProperty("Latitude_DD")&&this.studyAreaService.selectedGage.hasOwnProperty("Longitude_DD")){var a={type:"Feature",geometry:{coordinates:[this.studyAreaService.selectedGage.Latitude_DD,this.studyAreaService.selectedGage.Longitude_DD],type:"Point"}};this.addGeoJSON("referenceGage",a)}var r=this.studyAreaService.selectedStudyArea.FeatureCollection.bbox;this.leafletData.getMap("reportMap").then(function(e){e.invalidateSize(),e.fitBounds([[r[1],r[0]],[r[3],r[2]]])})}},t.prototype.addGeoJSON=function(e,t){"globalwatershed"==e?this.layers.overlays[e]={name:"Basin Boundary",type:"geoJSONShape",data:this.studyAreaService.simplify(angular.fromJson(angular.toJson(t))),visible:!0,layerOptions:{style:{fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}}}:"globalwatershedpoint"==e?this.layers.overlays[e]={name:"Basin Clicked Point",type:"geoJSONShape",data:t,visible:!0}:"referenceGage"==e?this.geojson[e]={data:t,style:{displayName:"Index Gage"},onEachFeature:function(e,t){var a=L.icon({iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAaJJREFUOI3dzz1IW1EYxvF/TMqpFQsJCF4QOuhUpTpEVCw6RSsdQhFB6hfiF0IDFqkoOCqKEhxEqm0H20YUgpQoqOBWOkgjpQgXowREEC5SuVBE6QtFHXQwYjSJmXzgDO85hx/PayPJsd0TcD6sqM6ZBFqAk7uD4dCyqu3dkLnhRmD6bqB/ q5DwZrl4hv6rb2MWEfEDR4mD + q9ZSl + mAC75 + HOGxvwuYDAx8MNaK / +Os3mUfj5nP + tSSlsUMbKAvfhA / dSKb3qEqvrLtwUS0CeVW + sWkbfxgcsr4zx12rFe + ZJu75PMPK / jcKfQNM1gbKBPz2Az2EzJi + ten / B1LdUse9AGxAhu//ZTXPkwanurrRd3RyeBqRrAfzM48b2IvwfPcWRG9QC76nnvlMDUY2ABkOjgbshHxWvrTRqAYPGo/s9uGWh6A3ivBR3epTZTpeWQmnabB6CkqqFOjbbvi0gG8CcSXF1NMZdCw7zqjAW7iKWOT+sVqtX5TkR6IkGXqx4IMub5EYeIQAlQrmlarmEY+uWVv1ycRDJgGAaRDZOUpINnJ5KDtx5X6hkAAAAASUVORK5CYII=",iconSize:[15,16],iconAnchor:[7.5,8],popupAnchor:[0,-11]});t.setIcon(a)},layerArray:[{layerName:"Index Gage",legend:[{contentType:"image/png",imageData:"iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAaJJREFUOI3dzz1IW1EYxvF/TMqpFQsJCF4QOuhUpTpEVCw6RSsdQhFB6hfiF0IDFqkoOCqKEhxEqm0H20YUgpQoqOBWOkgjpQgXowREEC5SuVBE6QtFHXQwYjSJmXzgDO85hx/PayPJsd0TcD6sqM6ZBFqAk7uD4dCyqu3dkLnhRmD6bqB/ q5DwZrl4hv6rb2MWEfEDR4mD + q9ZSl + mAC75 + HOGxvwuYDAx8MNaK / +Os3mUfj5nP + tSSlsUMbKAvfhA / dSKb3qEqvrLtwUS0CeVW + sWkbfxgcsr4zx12rFe + ZJu75PMPK / jcKfQNM1gbKBPz2Az2EzJi + ten / B1LdUse9AGxAhu//ZTXPkwanurrRd3RyeBqRrAfzM48b2IvwfPcWRG9QC76nnvlMDUY2ABkOjgbshHxWvrTRqAYPGo/s9uGWh6A3ivBR3epTZTpeWQmnabB6CkqqFOjbbvi0gG8CcSXF1NMZdCw7zqjAW7iKWOT+sVqtX5TkR6IkGXqx4IMub5EYeIQAlQrmlarmEY+uWVv1ycRDJgGAaRDZOUpINnJ5KDtx5X6hkAAAAASUVORK5CYII=",label:"Index Gage"}]}]}:this.layers.overlays[e]="regulatedwatershed"==e?{name:"Basin Boundary (Regulated Area)",type:"geoJSONShape",data:t,visible:!0,layerOptions:{style:{fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}}}:{name:e,type:"geoJSONShape",data:t,visible:!1,layerOptions:{style:{fillColor:"red",color:"red"}}}},t.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),a=e.find("tr:has(td)"),r=String.fromCharCode(11),n=String.fromCharCode(0),i='","',o='"\r\n"',s='"';return s+=l(t.map(g)),s+=o,s+=l(a.map(g))+'"';function l(e){return e.get().join(n).split(n).join(o).split(r).join(i)}function g(e,t){var a=$(t),n=a.find("td");return n.length||(n=a.find("th")),n.map(c).get().join(r)}function c(e,t){return $(t).text().replace('"','""')}},t.prototype.camelize=function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")},t.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modal.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},t.prototype.getEstimatedFlow=function(e,t){var a=t.filter(function(t){return t.date==e.date})[0];return a&&a.hasOwnProperty("value")?"number"==typeof a.value?a.value.toUSGSvalue():a.value:"N/A"},t.prototype.processData=function(e){for(var t=[],a=new Date(Math.min.apply(null,e.map(function(e){return new Date(e.date)}))),r=new Date(Math.max.apply(null,e.map(function(e){return new Date(e.date)}))),n=a;n<=r;n.setDate(n.getDate()+1)){var i=e.filter(function(e){return new Date(e.date).getTime()==n.getTime()})[0];void 0==i?t.push({x:n.getTime(),y:null}):t.push({x:n.getTime(),y:i.hasOwnProperty("value")?"number"==typeof i.value?i.value.toUSGSvalue():i.value:null})}return t},t.$inject=["$scope","$modalInstance","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","leafletData","StreamStats.Services.RegionService","StreamStats.Services.ModalService","WiM.Event.EventManager"],t}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ReportController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(e){"use strict";var t,a,r=function(){return function(){this.Annual={Graph:{},Table:{}},this.Monthly={Graph:{withdrawals:null,returns:null},Table:{}}}}(),n=function(e){function n(t,a,r,n,i,o,s){var l=e.call(this,a,configuration.baseurls.WaterUseServices)||this;return l.$timeout=i,l.eventManager=o,l.permits_sw={name:"Temporary water-use registrations (surface water)",aveReturn:"",aveWithdrawal:"---"},l.permits_gw={name:"Temporary water-use registrations (ground water)",aveReturn:"",aveWithdrawal:"---"},l.AnnualTotalWithdrawals=0,l.AnnualTotalReturns=0,l.AnnualAveWithdrawals=0,l.AnnualAveReturns=0,t.vm=l,l.modalInstance=n,l.StudyArea=r.selectedStudyArea,l.StudyAreaService=r,l.NSSService=s,l.init(),l}return __extends(n,e),Object.defineProperty(n.prototype,"StartYear",{get:function(){return this._startYear},set:function(e){this.spanYear||(this.EndYear=e),e<=this.EndYear&&e>=this.YearRange.floor&&(this._startYear=e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"EndYear",{get:function(){return this._endYear},set:function(e){e>=this.StartYear&&e<=this.YearRange.ceil&&(this._endYear=e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"YearRange",{get:function(){return this._yearRange},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"IndexWOReg",{get:function(){return this._indexWOReg},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"IndexWReg",{get:function(){return this._indexWReg},enumerable:!1,configurable:!0}),n.prototype.GetWaterUse=function(){var e=this;this.CanContinue=!1,this.GetWaterUseLabel=!0;var a=configuration.queryparams.Wateruse.format(this.StartYear,this.EndYear,this.includePermits,this.computeReturns,this.computeDomesticWU),r=this.StudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry,n=new WiM.Services.Helpers.RequestInfo(a,!1,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(r));this.Execute(n).then(function(a){e.showResults=!0,e.result=a.data,"Wateruse not available at specified site."!==e.result.Messages&&(a.data.hasOwnProperty("withdrawal")||a.data.hasOwnProperty("return"))||alert("Wateruse not available at specified site."),e.ReportData.Monthly.Graph=e.loadGraphData(t.Monthly),e.ReportData.Annual.Graph=e.loadGraphData(t.Annual),e.ReportData.Monthly.Table=e.GetTableData(t.Monthly),e.ReportData.Annual.Table=e.GetTableData(t.Annual)},function(e){}).finally(function(){e.setIndexes(),e.CanContinue=!0})},n.prototype.Close=function(){this.modalInstance.dismiss("cancel")},n.prototype.Reset=function(){this.init()},n.prototype.Print=function(){window.print()},n.prototype.setIndexes=function(){null!=this.Q10&&null!=this.AnnualTotalReturns&&null!=this.AnnualTotalWithdrawals&&null!=this.permits_gw.aveWithdrawal&&null!=this.permits_sw.aveWithdrawal?(this._indexWOReg=((+this.AnnualAveWithdrawals-+this.AnnualAveReturns)/+this.Q10).toFixed(3),this._indexWReg=((+this.permits_gw.aveWithdrawal+ +this.permits_sw.aveWithdrawal+(+this.AnnualAveWithdrawals-+this.AnnualAveReturns))/+this.Q10).toFixed(3)):(this._indexWOReg="---",this._indexWReg="---")},n.prototype.loadGraphData=function(e){try{var a={returns:[],withdrawals:[]};switch(e){case t.Monthly:new Array(12);if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var r in this.result.withdrawal.monthly){var n=this.result.withdrawal.monthly[r].code;for(var i in n){for(var o=-1,s=0;s<a.withdrawals.length;s++){if(a.withdrawals[s].key==n[i].name){o=s;break}}if(o<0){var l=[];for(s=1;s<=12;s++)l.push({label:this.getMonth(s),stack:"withdrawal",value:0});o=a.withdrawals.push({key:n[i].name,values:l,color:this.generateColorShade(190,350)})-1}a.withdrawals[o].values[+r-1].value=n[i].value}}if(this.result.hasOwnProperty("return")){var g=[];for(var r in this.result.return.monthly)g.push({label:this.getMonth(+r),stack:"withdrawal",value:this.Sum(this.result.return.monthly[r].month,"value")});a.returns.push({key:"returns",color:this.generateColorShade(0,170),values:g})}return a;case t.Annual:if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("annual"))for(var c in this.result.withdrawal.annual){var u=this.result.withdrawal.annual[c];a.withdrawals.push({name:u.name,value:u.value,color:this.generateColorShade(190,350)})}if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("annual"))for(var c in this.result.return.annual){u=this.result.return.annual[c];a.returns.push({name:u.name,value:u.value,color:this.generateColorShade(0,170)})}return a}}catch(e){}},n.prototype.GetTableData=function(e){var a=[],r=[];try{switch(e){case t.Monthly:for(var n=1;n<=12;n++)r.push({month:this.getMonth(n),returns:{name:"return",SW:"---",GW:"---"},withdrawals:{SW:"---",GW:"---",code:[]}});if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var i in this.result.return.monthly)r[+i-1].returns.GW=this.result.return.monthly[i].month.hasOwnProperty("GW")?this.result.return.monthly[i].month.GW.value.toFixed(3):"---",r[+i-1].returns.SW=this.result.return.monthly[i].month.hasOwnProperty("SW")?this.result.return.monthly[i].month.SW.value.toFixed(3):"---",this.AnnualTotalReturns+=("---"==r[+i-1].returns.GW?0:+r[+i-1].returns.GW)+("---"==r[+i-1].returns.SW?0:+r[+i-1].returns.SW);if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var o in this.result.withdrawal.monthly)if(r[+o-1].withdrawals.GW=this.result.withdrawal.monthly[o].month.hasOwnProperty("GW")?this.result.withdrawal.monthly[o].month.GW.value.toFixed(3):"---",r[+o-1].withdrawals.SW=this.result.withdrawal.monthly[o].month.hasOwnProperty("SW")?this.result.withdrawal.monthly[o].month.SW.value.toFixed(3):"---",this.AnnualTotalWithdrawals+=("---"==r[+o-1].withdrawals.GW?0:+r[+o-1].withdrawals.GW)+("---"==r[+o-1].withdrawals.SW?0:+r[+o-1].withdrawals.SW),this.result.withdrawal.monthly[o].hasOwnProperty("code")){var s=this.result.withdrawal.monthly[o].code;for(var l in s){var g=-1;for(n=0;n<a.length;n++){if(a[n]==s[l].name){g=n;break}}g<0&&(g=a.push(s[l].name)-1,r.forEach(function(e){e.withdrawals.code.push({name:s[l].name,value:"---"})})),r[+o-1].withdrawals.code[g].value=s[l].value.toFixed(3)}}break;case t.Annual:a=["","Average Return","Average Withdrawal"];var c={name:"Surface Water",aveReturn:"---",aveWithdrawal:"---",unit:"MGD"},u={name:"Groundwater",aveReturn:"---",aveWithdrawal:"---",unit:"MGD"};if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("annual")){var d=this.result.withdrawal.annual;d.hasOwnProperty("SW")&&(c.aveWithdrawal=d.SW.value.toFixed(3)),d.hasOwnProperty("GW")&&(u.aveWithdrawal=d.GW.value.toFixed(3))}if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("annual")){var A=this.result.return.annual;A.hasOwnProperty("SW")&&(c.aveReturn=A.SW.value.toFixed(3)),A.hasOwnProperty("GW")&&(u.aveReturn=A.GW.value.toFixed(3))}if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("permitted")){var h=this.result.withdrawal.permitted;h.hasOwnProperty("Intake")&&(this.permits_sw.aveWithdrawal=h.Intake.value),h.hasOwnProperty("Well")&&(this.permits_gw.aveWithdrawal=h.Well.value)}this.AnnualAveReturns=+u.aveReturn+ +c.aveReturn,this.AnnualAveWithdrawals=+u.aveWithdrawal+ +c.aveWithdrawal,r.push(c),r.push(u),r.push({name:"Total",aveReturn:isNaN(+c.aveReturn)&&isNaN(+u.aveReturn)?"---":((isNaN(+c.aveReturn)?0:+c.aveReturn)+(isNaN(+u.aveReturn)?0:+u.aveReturn)).toFixed(3),aveWithdrawal:isNaN(+c.aveWithdrawal)&&isNaN(+u.aveWithdrawal)?"---":((isNaN(+c.aveWithdrawal)?0:+c.aveWithdrawal)+(isNaN(+u.aveWithdrawal)?0:+u.aveWithdrawal)).toFixed(3)}),r.push({name:"",aveReturn:"",aveWithdrawal:""}),r.push(this.permits_sw),r.push(this.permits_gw),r.push({name:"Temporary water-use registrations (total)",aveReturn:"",aveWithdrawal:isNaN(+this.permits_sw.aveWithdrawal)&&isNaN(+this.permits_gw.aveWithdrawal)?"---":(isNaN(+this.permits_sw.aveWithdrawal)?0:+this.permits_sw.aveWithdrawal)+(isNaN(+this.permits_gw.aveWithdrawal)?0:+this.permits_gw.aveWithdrawal)}),r.push({name:"",aveReturn:"",aveWithdrawal:""})}return{values:r,Fields:a}}catch(e){return{values:[],Fields:[]}}},n.prototype.Reduce=function(e){return e.reduce(function(e,t){return isNaN(+e)&&isNaN(+t)?"---":((isNaN(+e)?0:+e)+(isNaN(+t)?0:+t)).toFixed(3)},0)},n.prototype.Sum=function(e,t){var a=0;for(var r in e)a+=e[r][t];return a},n.prototype.Add=function(e,t){return isNaN(+e)&&isNaN(+t)?"---":((isNaN(+e)?0:+e)+(isNaN(+t)?0:+t)).toFixed(3)},n.prototype.DownloadCSV=function(){var e,t=this,a="StreamStats Water Use Report\nState/Region ID,"+this.StudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.StudyArea.WorkspaceID+"\nLatitude,"+this.StudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.StudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime:,"+this.result.processDate.toLocaleString()+"\nStart Year:,"+this.StartYear+"\nEnd Year:,"+this.EndYear+"\r\n";a+=(e=t.StartYear+"-"+t.EndYear+" Average Annual Water Use reported in million gallons/day\n",(e+=t.tableToCSV($("#AnnualWaterUseTable")))+"\r\n"),a+=function(){var e=t.StartYear+"-"+t.EndYear+" Average Water Use by Month reported in million gallons/day\n";return(e+=t.tableToCSV($("#MonthlyWaterUseTable")))+"\r\n"}();var r=new Blob([a],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,"wateruseSummary.csv");else{var n=document.createElement("a"),i=URL.createObjectURL(r);void 0!==n.download?(n.setAttribute("href",i),n.setAttribute("download","wateruseSummary.csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)):window.open(i)}},n.prototype.DownloadCSVBySource=function(){var e=this,t=configuration.queryparams.WateruseSourceCSV.format(this.StartYear,this.EndYear,this.includePermits,this.computeReturns,this.computeDomesticWU),a=this.StudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry,r=new WiM.Services.Helpers.RequestInfo(t,!1,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(a),{Accept:"text/csv",Authorization:"Basic dGVzdE1hbmFnZXI6RG9nMQ=="});this.Execute(r).then(function(e){var t="wateruseSummaryBySource.csv",a=new Blob([e.data],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,t);else{var n=document.createElement("a"),i=URL.createObjectURL(a);void 0!==n.download?(n.setAttribute("href",i),n.setAttribute("download",t),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)):window.open(i)}},function(e){}).finally(function(){e.CanContinue=!0})},n.prototype.init=function(){var e=this;"OH"==this.StudyArea.RegionID&&this.StudyAreaService.computeRegressionEquation("Q10");var n=configuration.queryparams.WateruseConfig.format(this.StudyArea.RegionID),i=new WiM.Services.Helpers.RequestInfo(n);this.Execute(i).then(function(t){var a=t.data;e.spanYear=a.minYear!=a.maxYear,e._startYear=a.minYear,e._endYear=a.maxYear,e.includePermits=a.hasPermits,e.computeReturns=a.canComputeReturns,e.computeDomesticWU="oh"==e.StudyArea.RegionID.toLowerCase(),e._yearRange={floor:a.minYear,draggableRange:!0,noSwitching:!0,showTicks:!1,ceil:a.maxYear}},function(t){e._startYear=2005,e._endYear=2012,e._yearRange={floor:2005,draggableRange:!0,noSwitching:!0,showTicks:!1,ceil:2012}}).finally(function(){e.StudyAreaService.onQ10Loaded.subscribe(new WiM.Event.EventHandler(function(t,a){e.Q10=.646316889697*+e.StudyAreaService.selectedStudyArea.wateruseQ10,e.CanContinue=!0,e.StudyAreaService.onQ10Loaded.unsubscribe(new WiM.Event.EventHandler(function(e,t){}))})),"OH"!=e.StudyArea.RegionID&&(e.CanContinue=!0)}),this.showResults=!1,this.SelectedTab=a.Graph,this.SelectedWaterUseType=t.Annual,this.ReportData=new r,this.MonthlyReportOptions={chart:{type:"multiBarHorizontalChart",height:450,visible:!0,stacked:!0,showControls:!1,margin:{top:60,right:30,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},dispatch:{stateChange:function(){e.$timeout(function(){e.loadGraphLabels(0)},500)},renderEnd:function(){e.$timeout(function(){e.loadGraphLabels(0)},500)},resize:function(){console.log("resize"),e.$timeout(function(){e.loadGraphLabels(0)},500)}},showValues:!0,valueFormat:function(e){return d3.format(",.4f")(e)},tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Values in million gallons/day",tickFormat:function(e){return d3.format(",.3f")(e)}},refreshDataOnly:!0,legend:{margin:{top:5,right:40,left:40,bottom:50}}}},this.MonthlyReturnReportOptions={chart:{type:"multiBarHorizontalChart",height:450,visible:!0,stacked:!0,showControls:!1,margin:{top:20,right:30,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format(",.3f")(e)},tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Values in million gallons/day",tickFormat:function(e){return d3.format(",.3f")(e)}}}},this.AnnualReportOptions={chart:{type:"pieChart",height:400,margin:{top:1},x:function(e){return e.name},y:function(e){return e.value},showLabels:!0,tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},duration:500,labelThreshold:.01,labelSunbeamLayout:!1,showLegend:!1},title:{text:"Withdrawals"}},$(window).resize(function(){e.$timeout(function(){e.loadGraphLabels(0)},500)})},n.prototype.getMonth=function(e){switch(e){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec"}},n.prototype.getWUText=function(e){switch(e.toUpperCase()){case"AQ":return"Aquaculture";case"CO":return"Commercial";case"DO":return"Domestic";case"PH":return"Hydro Electric";case"IN":return"Industrial";case"IR":return"Irrigation";case"LV":return"Livestock";case"MI":return"Mining";case"RM":return"Remediation";case"TE":return"Thermoelectric";case"ST":return"Waste Water Treatment";case"WS":return"Public Supply";case"MF":return"Hydrofracturing";case"CW":return"Wetland augmentation";case"PC":return"Thermoelectric (closed cycle)";case"PO":return"Thermoelectric (once through)"}return e.toUpperCase()},n.prototype.loadGraphLabels=function(e){var t=d3.selectAll(".nv-multibarHorizontal .nv-group"),a=t.map(function(e){return e.length-2});t.filter(function(e,t){return t==a[0]});t.each(function(e,t){var r=d3.select(this);r.selectAll("text").remove(),r.selectAll(".nv-bar").each(function(e){var n=d3.select(this),i=n.node().getBBox().width;n.node().getBBox().height;r.append("text").attr("transform",n.attr("transform")).text(function(){if(t>=a[0])return e.y<.001?0:d3.format(",.3f")((Number(e.y)+Number(e.y0)).toFixed(3))}).attr("dy","1.5em").attr("x",function(){var e=this.getBBox().width;return i-e/2}).attr("class","bar-values")})})},n.prototype.generateColorShade=function(e,t){try{return"hsla("+this.rand(e,e)+","+this.rand(30,100)+"%,"+this.rand(30,70)+"%,1)"}catch(e){return null}},n.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),a=e.find("tr:has(td)"),r=String.fromCharCode(11),n=String.fromCharCode(0),i='","',o='"\r\n"',s='"';return s+=l(t.map(g)),s+=o,s+=l(a.map(g))+'"';function l(e){return e.get().join(n).split(n).join(o).split(r).join(i)}function g(e,t){var a=$(t),n=a.find("td");return n.length||(n=a.find("th")),n.map(c).get().join(r)}function c(e,t){return $(t).text().replace('"','""')}},n.prototype.HSLtoRGB=function(e,t,a){var r,n,i;if(0==t)r=n=i=a;else{var o=function(e,t,a){return a<0&&(a+=1),a>1&&(a-=1),a<1/6?e+6*(t-e)*a:a<.5?t:a<2/3?e+(t-e)*(2/3-a)*6:e},s=a<.5?a*(1+t):a+t-a*t,l=2*a-s;r=o(l,s,e+1/3),n=o(l,s,e),i=o(l,s,e-1/3)}return{r:Math.round(255*r),g:Math.round(255*n),b:Math.round(255*i)}},n.prototype.RGBtoHEX=function(e,t,a){return this.ToHex(e)+this.ToHex(t)+this.ToHex(a)},n.prototype.ToHex=function(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t},n.prototype.rand=function(e,t){return parseInt(Math.random()*(t-e+1),10)+e},n.$inject=["$scope","$http","StreamStats.Services.StudyAreaService","$modalInstance","$timeout","WiM.Event.EventManager","StreamStats.Services.nssService"],n}(WiM.Services.HTTPServiceBase);!function(e){e[e.Annual=1]="Annual",e[e.Monthly=2]="Monthly"}(t||(t={})),function(e){e[e.Graph=1]="Graph",e[e.Table=2]="Table"}(a||(a={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.WateruseController",n)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(t){"use strict";var a,r=function(){return function(){this.TR55={Graph:{},Table:{},PeakQ:{},Infiltration:{},ExcessPrecip:{}},this.RationalMethod={Graph:{},Table:{},PeakQ:{},Infiltration:{},ExcessPrecip:{}}}}(),n=function(t){function n(e,a,r,n,i,o,s,l,g){var c=t.call(this,r,configuration.baseurls.StormRunoffServices)||this;return c.$timeout=l,c.EventManager=g,c.regionParameters=[],c.PrecipOptions=[],c.SelectedParameterList=[],c.GraphLabels=[],c.GraphXValues=[],c.padY=0,c.padY2=0,c.domainY=[],c.domainY2=[],e.vm=c,c.toaster=a,c.modalInstance=s,c.StudyArea=n.selectedStudyArea,c.nssService=i,c.studyAreaService=n,c.regionParameters=o.parameterList,c.BrowserIE=c.detectIE(),c.AppVersion=configuration.version,c.parameterloadedEventHandler=new WiM.Event.EventHandler(function(e,t){t.parameterLoaded&&c.loadParameters()}),c.init(),c.print=function(){gtag("event","Download",{Category:"StormRunoff",Type:"Print"}),window.print()},c}return __extends(n,t),Object.defineProperty(n.prototype,"SelectedPrecip",{get:function(){return this._selectedPrecip},set:function(e){this._selectedPrecip=e,this.PIntensity=null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"SelectedTab",{get:function(){return this._selectedTab},set:function(e){this._selectedTab!=e&&(this._selectedTab=e,this.selectRunoffType())},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"SelectedParametersAreValid",{get:function(){for(var e=0;e<this.SelectedParameterList.length;e++){var t=this.SelectedParameterList[e];if(isNaN(t.value))return!1}return!0},enumerable:!1,configurable:!0}),n.prototype.GetStormRunoffResults=function(){var e=this;try{this.CanContinue=!1;if(1==this.SelectedTab){a.TR55;var t=configuration.queryparams.StormRunoffTR55.format(this.SelectedParameterList[0].value,this.SelectedPrecip.value,this.SelectedParameterList[1].value,this.SelectedPrecip.code)}else if(2==this.SelectedTab)a.RationalMethod,t=configuration.queryparams.StormRunoffRationalMethod.format(this.DrnAreaAcres,this.PIntensity,this.SelectedParameterList[1].value,this.SelectedPrecip.code);var r=new WiM.Services.Helpers.RequestInfo(t);this.Execute(r).then(function(t){e.showResults=!0,e.result=t.data,1==e.SelectedTab?(e.ReportData.TR55.Graph=e.loadGraphData(),e.ReportData.TR55.Table=e.GetTableData(),e.setGraphOptions()):2==e.SelectedTab&&e.setPeakQ(e.result.q)},function(t){e.toaster.clear(),e.toaster.pop("error","There was an error retrieving temporal distribution data","HTTP request error",0)}).finally(function(){e.CanContinue=!0,e.hideAlerts=!0})}catch(e){console.log("oops GetStormRunoffResults failed to load ",e)}},n.prototype.validateForm=function(e){return e.$valid?(this.CheckDASize(),!0):(this.CheckDASize(),this.showResults=!1,this.hideAlerts=!1,!1)},n.prototype.ClearResults=function(){for(var e in this.studyAreaService.studyAreaParameterList)this.studyAreaService.studyAreaParameterList[e].value=null;this.SelectedPrecip=this.PrecipOptions[0],this.SelectedPrecip.value=null,this.DrnAreaAcres=null,this.PIntensity=null,this.showResults=!1},n.prototype.CalculateParameters=function(){var t=this;try{this.CanContinue=!1,this.EventManager.SubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,this.parameterloadedEventHandler);var a=configuration.baseurls.ScienceBase+configuration.queryparams.SSURGOexCOMS+configuration.queryparams.SSURGOexCO.format(this.studyAreaService.selectedStudyArea.FeatureCollection.bbox),r=new WiM.Services.Helpers.RequestInfo(a,!0);this.Execute(r).then(function(e){t.showResults=!0,t.excludearea=e.data,t.excludearea.count>0&&alert("The selected basin may have inadequate SSURGO data to properly compute the runoff curve number.")},function(e){}).finally(function(){t.CanContinue=!0,t.hideAlerts=!0});for(var n=0;n<this.SelectedParameterList.length;n++){var i=this.SelectedParameterList[n];-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,i)&&this.studyAreaService.studyAreaParameterList.push(i)}null!=this.SelectedPrecip&&-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,this.SelectedPrecip)&&this.studyAreaService.studyAreaParameterList.push(this.SelectedPrecip),this.studyAreaService.loadParameters()}catch(e){console.log("oops CalculateParams failed to load ",e)}},n.prototype.CheckDASize=function(){switch(this._selectedTab){case a.TR55:return void(this.SelectedParameterList[0].value>25?this.DASizeAlert="Value is greater than recommended maximum threshold of 25 square miles":this.DASizeAlert=null);default:return void(this.DrnAreaAcres>200?this.DASizeAlert="Value is greater than recommended maximum threshold of 200 acres":this.DASizeAlert=null)}},n.prototype.Close=function(){this.modalInstance.dismiss("cancel")},n.prototype.Reset=function(){this.init()},n.prototype.downloadCSV=function(){var e=this;gtag("event","Download",{Category:"StormRunoff",Type:"CSV"});var t="StreamStats Output Report\n\nState/Region ID,"+this.studyAreaService.selectedStudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.studyAreaService.selectedStudyArea.WorkspaceID+"\nLatitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString()+"\n\n";1==this.SelectedTab?t+=function(t){var a="Peak Runoff from "+e.SelectedPrecip.name+" (TR55)\n";a+=e.tableToCSV($("#TR55ParameterTable")),a+="\n"+e.tableToCSV($("#TR55SummaryTable")),a+="\n\n"+e.tableToCSV($("#TR55TabularHydrograph"));var r="";if(e.SelectedParameterList){var n;for(var i in n=Object.keys(e.ReportData.TR55.Table.values[0]))parseInt(i)<14&&"time"!=n[i]&&("span"==n[i]?r+="#,Time,Time (HH:MM)\n":r+="#,"+e.getHeading(n[i])+","+e.getTitle(n[i])+"\n")}return r+"\n"+a+"\r\n"}(this.studyAreaService.studyAreaParameterList):2==this.SelectedTab&&(t+=function(t){var a="Peak Runoff from "+e.SelectedPrecip.name+" (Rational Method)\n";a+=e.tableToCSV($("#RMParameterTable")),a+="\n"+e.tableToCSV($("#RMSummaryTable"));var r="";if(e.SelectedParameterList){var n;for(var i in n=Object.keys(e.ReportData.TR55.Table.values[0]))parseInt(i)<14&&"time"!=n[i]&&("span"==n[i]?r+="#,Time,Time (HH:MM)\n":r+="#,"+e.getHeading(n[i])+","+e.getTitle(n[i])+"\n")}return r+"\n"+a+"\r\n"}(this.studyAreaService.studyAreaParameterList));var a=new Blob([t],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,"data.csv");else{var r=document.createElement("a"),n=URL.createObjectURL(a);void 0!==r.download?(r.setAttribute("href",n),r.setAttribute("download","data.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(n)}},n.prototype.generateColorShade=function(e,t){try{return"hsla("+this.rand(e,e)+","+this.rand(30,100)+"%,"+this.rand(30,70)+"%,1)"}catch(e){return null}},n.prototype.update=function(e){console.log(e)},n.prototype.loadGraphData=function(){try{var e,t=[],a=[],r=[];this.GraphXValues.length=0;for(var n in this.result){var i,o=this.result[n].duration,s=parseFloat(n);this.duration=o,i=this.computeTime(s,o),a.push({x:i,y:this.result[n].q}),r.push({x:i,y:this.result[n].p})}for(var l in a.sort(function(e,t){return e.x-t.x}),r.sort(function(e,t){return e.x-t.x}),e=a[0].x,a)a[l].label=this.getTimeSpan(e,a[l].x),r[l].label=this.getTimeSpan(e,r[l].x);for(var g in a)a[g].hours=this.computeHours(e,a[g].x),r[g].hours=this.computeHours(e,a[g].x);return this.loadGraphLabels(a),this.loadGraphXValues(a),this.loadPadY(a),this.loadDomainY(a),this.loadPadY2(r),this.loadDomainY2(r),t.push({values:a,key:"Discharge (ft/s)",color:" #009900",type:"line",yAxis:1}),t.push({values:r,key:"Cum. precipitation (in)",color:"#0033ff",type:"line",yAxis:2}),t}catch(e){}},n.prototype.GetTableData=function(){this.ReportData.TR55.PeakQ=0,this.ReportData.TR55.Infiltration=0,this.ReportData.TR55.ExcessPrecip=0;var e=[],t=[];try{for(var a in this.result){var r,n,i=this.result[a].duration,o=parseFloat(a);if(r=this.computeTime(o,i),this.result[a].time=r,t.push(this.result[a]),0==e.length)for(var s in this.result[a])e.push(s);this.setPeakQ(this.result[a].q),this.setInfiltration(this.result[a].pl),this.setExcessPrecip(this.result[a].dPe)}for(var l in t.sort(function(e,t){return e.time-t.time}),n=t[0].time,t)t[l].span=this.getTimeSpan(n,t[l].time);return{values:t,Fields:e}}catch(e){}},n.prototype.setPeakQ=function(e){try{if(1==this.SelectedTab){var t=e;this.ReportData.TR55.PeakQ<t&&(this.ReportData.TR55.PeakQ=t)}else this.ReportData.RationalMethod.PeakQ=e}catch(e){}},n.prototype.setInfiltration=function(e){try{this.ReportData.TR55.Infiltration=this.ReportData.TR55.Infiltration+e}catch(e){}},n.prototype.setExcessPrecip=function(e){try{this.ReportData.TR55.ExcessPrecip=this.ReportData.TR55.ExcessPrecip+e}catch(e){}},n.prototype.getPrecipTitle=function(){return 2==this.SelectedTab?"Precipitation intensity is computed by dividing the "+this.SelectedPrecip.name+" by "+this.SelectedPrecip.name.substr(0,2):void 0},n.prototype.getTitle=function(e){try{switch(e){case"q":return"Discharge (cubic feet per second)";case"drnarea":return"Drainage area (square miles)";case"p":return"Cumulative precipitation (inches)";case"rcn":return"Runoff curve number (unitless)";case"duration":return"Duration of storm (hours)";case"ia":return"Initial abstraction (inches)";case"s":return"Total maximum retention (inches)";case"dP":return"Incremental precipitation (inches)";case"pIa":return"Cumulative precipitation minus initial abstraction (inches)";case"pl":return"Precipitation loss (inches)";case"pe":return"Cumulative precipitation excess (inches)";case"dPe":return"Incremental precipitation excess (inches)"}}catch(e){}},n.prototype.getHeading=function(e){try{switch(e){case"q":return"Q";case"drnarea":return"DRNAREA";case"p":return"P";case"rcn":return"RCN";case"duration":return"Duration";case"ia":return"Ia";case"s":return"S";case"dP":return"dP";case"pIa":return"P-Ia";case"pl":return"Pl";case"pe":return"Pe";case"dPe":return"dPe"}}catch(e){}},n.prototype.setGraphOptions=function(){this.ReportOptions={chart:{type:"multiChart",height:275,width:650,margin:{top:10,right:80,bottom:80,left:90},x:function(e){return e.hours},y:function(e){return e.y},legend:{align:!1,padding:50,width:500},dispatch:{stateChange:function(e){console.log("stateChange")},changeState:function(e){console.log("changeState")},tooltipShow:function(e){console.log("tooltipShow")},tooltipHide:function(e){console.log("tooltipHide")}},useInteractiveGuideline:!0,interactiveLayer:{tooltip:{contentGenerator:function(e){var t=60*e.value%60,a=Math.trunc(e.value),r=(a<10?"0"+a:a)+":"+(t<10?"0"+t:t),n="";for(var i in e.series){var o,s,l=parseFloat(e.series[i].value);l>1e6&&l<1e7&&(s=1e4),l>1e5&&l<1e6&&(s=1e3),l>1e4&&l<1e5&&(s=100),l>1e3&&l<1e4&&(s=10),l>100&&l<1e3&&(s=1),o=parseInt(((l+.5*s)/s).toString())*s,l<100&&(o=Number(l.toPrecision(3))),n+="<tr><td class='legend-color-guide' style='width: 1em;'><div style='background-color: "+e.series[i].color+";'></div></td><td class='key'>"+e.series[i].key+":</td><td><strong>"+o+"</strong></td></tr>"}return"<table>"+("<thead><tr><td colspan='3'><b>"+r+"</b> (HH:mm)</td></tr></thead>")+"<tbody>"+n+"</tbody></table>"}}},xAxis:{showMaxMin:!1,tickValues:this.GraphXValues,axisLabel:"Time (HH:mm)",tickFormat:function(e){var t=Math.trunc(e),a=60*e%60;return(t<10?"0"+t:t)+":"+(a<10?"0"+a:a)},rotateLabels:"45"},yAxis1:{axisLabel:"Discharge (Q), in ft/s",axisLabelDistance:this.padY,tickFormat:function(e){return d3.format(",.0f")(e)},showMaxMin:!1},yAxis2:{axisLabel:"Cum. precipitation (P), in inches",axisLabelDistance:this.padY2,tickFormat:function(e){return d3.format(",.0f")(e)},showMaxMin:!1},yDomain1:this.domainY,yDomain2:this.domainY2},title:{enable:!0,text:"Runoff hydrograph from "+this.SelectedPrecip.name,css:{"font-size":"10pt","font-weight":"bold"}}}},n.prototype.BrowserAlert=function(){this.BrowserIE&&alert("The Storm Runoff Modeling tool is best viewed with the following browsers\n\n\tChrome\n\tFirefox\n\tEdge")},n.prototype.detectIE=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10),!0;if(e.indexOf("Trident/")>0){var a=e.indexOf("rv:");return parseInt(e.substring(a+3,e.indexOf(".",a)),10),!0}return-1!=navigator.userAgent.indexOf("Chrome")&&(this.BrowserChrome=!0),!1},n.prototype.init=function(){this.SelectedTab=a.TR55,this.showResults=!1,this.hideAlerts=!1,this.CanContinue=!0,this.showPrint=!1,this.ReportData=new r},n.prototype.loadParameters=function(){this.EventManager.UnSubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,this.parameterloadedEventHandler),this.DrnAreaAcres=(640*this.SelectedParameterList[0].value).toUSGSvalue();var t=parseInt(this.SelectedPrecip.name.substr(0,2));this.PIntensity=(this.SelectedPrecip.value/t).toUSGSvalue(),this.CanContinue=!0},n.prototype.selectRunoffType=function(){switch(this._selectedTab){case a.TR55:this.SelectedParameterList=this.regionParameters.filter(function(e){return-1!=["DRNAREA","RCN"].indexOf(e.code)}),this.SelectedParameterList.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.showResults=!1;break;default:this.SelectedParameterList=this.regionParameters.filter(function(e){return-1!=["DRNAREA","RUNCO_CO"].indexOf(e.code)}),this.SelectedParameterList.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.showResults=!1}this.PrecipOptions=this.regionParameters.filter(function(e){return-1!=["I6H2Y","I6H100Y","I24H2Y","I24H100Y"].indexOf(e.code)}),this.PrecipOptions.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.SelectedPrecip||(this.SelectedPrecip=this.PrecipOptions[0])},n.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),a=e.find("tr:has(td)"),r=String.fromCharCode(11),n=String.fromCharCode(0),i='","',o='"\r\n"',s='"';return s+=l(t.map(g)),s+=o,s+=l(a.map(g))+'"';function l(e){return e.get().join(n).split(n).join(o).split(r).join(i)}function g(e,t){var a=$(t),n=a.find("td");return n.length||(n=a.find("th")),n.map(c).get().join(r)}function c(e,t){return $(t).text().replace('"','""')}},n.prototype.checkArrayForObj=function(e,t){for(var a=0;a<e.length;a++)if(angular.equals(e[a],t))return a;return-1},n.prototype.rand=function(e,t){return parseInt(Math.random()*(t-e+1),10)+e},n.prototype.computeTime=function(e,t){var a=new Date("January 1, 2018 00:00:00"),r=60*e;return a.setMinutes(r),a},n.prototype.computeHours=function(e,t){return(t-e)/36e5},n.prototype.getTimeSpan=function(e,t){var a=t-e,r=a/6e4%60,n=Math.trunc(a/36e5);return(n<10?"0"+n:n)+":"+(r<10?"0"+r:r)},n.prototype.loadGraphLabels=function(e){for(var t in e)this.GraphLabels[t]=e[t].span},n.prototype.loadGraphXValues=function(e){var t=0;if(24==this.duration)for(var a in e)++t%2!=0&&this.GraphXValues.push(e[a].hours);else for(var a in e)this.GraphXValues[a]=e[a].hours},n.prototype.loadPadY=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));t<1e3?this.padY=-10:t>=1e3&&t<1e4?this.padY2=0:t>=1e4&&t<1e6?this.padY=20:t>=1e6&&t<1e8&&(this.padY=30)},n.prototype.loadDomainY=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));this.domainY=[0,10*Math.round((t+.18*t)/10)]},n.prototype.loadDomainY2=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));this.domainY2=[0,t+.18*t]},n.prototype.loadPadY2=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));t<1e3?this.padY2=-30:t>=1e3&&(this.padY2=-10)},n.prototype.sortByKey=function(e,t){return e.sort(function(e,a){var r=e[t],n=a[t];return r<n?-1:r>n?1:0})},n.$inject=["$scope","toaster","$http","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.RegionService","$modalInstance","$timeout","WiM.Event.EventManager"],n}(WiM.Services.HTTPServiceBase);!function(e){e[e.TR55=1]="TR55",e[e.RationalMethod=2]="RationalMethod"}(a||(a={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.StormRunoffController",n)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();var __spreadArray=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var r,n=0,i=t.length;n<i;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))};!function(e){!function(e){"use strict";var t,a=function(){return function(){this.SyntheticUrbanHydrograph={Graph:{},WeightedRunoff:null},this.BohmanRural1989={Graph:{},WeightedRunoff:null},this.BohmanUrban1992={Graph:{},WeightedRunoff:null}}}(),r=function(e){function r(t,a,r,n,i,o,s){var l=e.call(this,r,configuration.baseurls.StormRunoffServices)||this;return l.$timeout=o,l.EventManager=s,l.region3Percent=0,l.region4Percent=0,l.isSyntheticUHOpen=!1,l.AEPOptions=[{name:"50%",value:50},{name:"20%",value:20},{name:"10%",value:10},{name:"4%",value:4},{name:"2%",value:2},{name:"1%",value:1},{name:".5%",value:.5},{name:".2%",value:.2}],l.prfForm={landUse:null,prfValue:null,area:null},l.AEPOptionsSynthetic=[{name:"10% AEP / 10 Year Return Period",value:10},{name:"4% AEP / 25 Year Return Period",value:4},{name:"2% AEP / 50 Year Return Period",value:2},{name:"1% AEP / 100 Year Return Period",value:1}],l.StandardCurveOptions=[{name:"Area-Weighted Curve Number",value:1,endpointValue:"area"},{name:"Runoff-Weighted Curve Number",value:2,endpointValue:"runoff"}],l.CNModificationOptions=[{name:"McCuen",value:1},{name:"Merkel",value:2}],l.TimeOfConcentrationOptions=[{name:"Travel Time Method",value:1,endpointValue:"traveltime"},{name:"Lag Time Equation",value:2,endpointValue:"lagtime"}],l.RainfallDistributionOptions=[{name:"Type II",value:2},{name:"Type III",value:3},{name:"NOAA A",value:4},{name:"NOAA B",value:5},{name:"NOAA C",value:6},{name:"NOAA D",value:7}],l.greaterThanZero=/^([0-9]*[1-9][0-9]*(\.[0-9]+)?|[0]+\.[0-9]*[1-9][0-9]*)$/,l.gTZInvalidMessage="Value must be greater than 0",l.greaterThanOrEqualToZero=/0+|^([0-9]*[1-9][0-9]*(\.[0-9]+)?|[0]+\.[0-9]*[1-9][0-9]*)$/,l.gTOETZInvalidMessage="Value must be greater than or equal to 0",l.betweenZeroOneHundred=/^(\d{0,2}(\.\d{1,2})?|100(\.00?)?)$/,l.prfTypes=[{name:"Open Space - Poor Condition (grass cover < 50%)",value:250},{name:"Open Space - Fair Condition (grass cover 50-75%)",value:250},{name:"Open Space - Good Condition (grass cover > 75%)",value:250},{name:"Impervious Areas (paved parking lots, roofs, etc.)\t",value:550},{name:"Streets and Roads - Paved with curbs and storm sewers",value:550},{name:"Streets and Roads - Paved with open ditches",value:500},{name:"Streets and Roads - Gravel",value:450},{name:"Streets and Roads - Dirt",value:350},{name:"Urban Land Use - Commercial and Business",value:550},{name:"Urban Land Use - Industrial",value:550},{name:"Urban Land Use - 1/8 Acre",value:400},{name:"Urban Land Use - 1/4 Acre",value:375},{name:"Urban Land Use - 1/3 Acre",value:350},{name:"Urban Land Use - 1/2 Acre",value:350},{name:"Urban Land Use - 1 Acre",value:325},{name:"Urban Land Use - 2 Acre",value:300},{name:"Developing urban areas, newly graded, no grass cover",value:400},{name:"Pasture - Poor",value:200},{name:"Pasture - Fair",value:190},{name:"Pasture - Good",value:180},{name:"Woods - Poor",value:200},{name:"Woods - Fair",value:190},{name:"Woods - Good",value:180},{name:"Row Crop - Straight Row",value:300},{name:"Row Crop - Contoured",value:275},{name:"Row Crop - Contoured and Terraced",value:250}],l._defaultFlowTypes=[{id:"sheetFlow",displayName:"Sheet Flow",accordionOpen:!1,questions:[{id:"surface",label:"Surface",type:"select",value:null,options:{"Smooth asphalt":.011,"Smooth concrete":.012,"Fallow (no residue)":.05,"Short grass prairie":.15,"Dense grasses":.24,"Bermuda grass":.41,"Light underbrush":.4,"Dense underbrush":.8,"Cultivated Soil with Residue cover <=20%":.06,"Cultivated Soil with Residue cover >=20%":.17,"Natural Range":.13}},{id:"length",label:"Length (ft)",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage},{id:"overland",label:"Overland Slope (%)",type:"number",value:null,pattern:"greaterThanOrEqualToZero",invalidMessage:l.gTOETZInvalidMessage}]},{id:"excessSheetFlow",displayName:"Excess Sheet Flow",accordionOpen:!1,questions:[{id:"surface",label:"Surface",type:"select",value:null,options:{"Pavement and small upland gullies":1,"Grassed waterways":2,"Nearly bare and untilled (overland flow)":3,"Cultivated straight row crops":4,"Short-grass pasture":5,"Minimum cultivation, contour or strip-cropped, and woodlands":6,"Forest with heavy ground litter and hay meadows":7}},{id:"slope",label:"Slope (%)",type:"number",value:null,pattern:"greaterThanOrEqualToZero",invalidMessage:l.gTOETZInvalidMessage}]},{id:"shallowConcentratedFlow",displayName:"Shallow Concentrated Flow",accordionOpen:!1,questions:[{id:"shallowFlowType",label:"Shallow Flow Type",type:"select",value:null,options:{"Pavement and small upland gullies":1,"Grassed waterways":2,"Nearly bare and untilled (overland flow)":3,"Cultivated straight row crops":4,"Short-grass pasture":5,"Minimum cultivation, contour or strip-cropped, and woodlands":6,"Forest with heavy ground litter and hay meadows":7}},{id:"length",label:"Length (ft)",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage},{id:"slope",label:"Slope (%)",type:"number",value:null,pattern:"greaterThanOrEqualToZero",invalidMessage:l.gTOETZInvalidMessage}]},{id:"channelizedFlowOpen",displayName:"Channelized Flow - Open Channel",accordionOpen:!1,questions:[{id:"baseWidth",label:"Base Width",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage},{id:"frontSlope",label:"Front Slope (Z hor:1 vert)",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage},{id:"backSlope",label:"Back Slope (Z hor:1 vert)",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage},{id:"channelDepth",label:"Channel Depth (ft)",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage},{id:"length",label:"Length (ft)",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage},{id:"channelBedSlope",label:"Channel Bed Slope (%)",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage},{id:"manningNValue",label:"Manning n-value",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage}]},{id:"channelizedFlowStorm",displayName:"Channelized Flow - Storm Sewer",accordionOpen:!1,questions:[{id:"pipeMaterial",label:"Pipe Material",type:"select",value:null,options:{Aluminum:1,CMP:2,Concrete:3,"Corrugated HDPE":4,PVC:5,Steel:6}},{id:"diameter",label:"Diameter (in)",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage},{id:"length",label:"Length (ft)",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage},{id:"slope",label:"Slope (%)",type:"number",value:null,pattern:"greaterThanOrEqualToZero",invalidMessage:l.gTOETZInvalidMessage}]},{id:"channelizedFlowUserInput",displayName:"Channelized Flow - User Input",accordionOpen:!1,questions:[{id:"length",label:"Length (ft)",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage},{id:"velocity",label:"Velocity (fps)",type:"number",value:null,pattern:"greaterThanZero",invalidMessage:l.gTZInvalidMessage}]}],l._defaultFlowSegments={sheetFlow:[],excessSheetFlow:[],shallowConcentratedFlow:[],channelizedFlowOpen:[],channelizedFlowStorm:[],channelizedFlowUserInput:[]},l.TravelTimeFlowTypes=l._defaultFlowTypes.slice(),l.TravelTimeFlowSegments=JSON.parse(JSON.stringify(l._defaultFlowSegments)),l.prfSegments=[],l.addFlowSegmentOpen=!1,l.DHourStormOptions=[{name:"1-Hour",value:1,maxTimeMinutes:500},{name:"2-Hour",value:2,maxTimeMinutes:500},{name:"3-Hour",value:3,maxTimeMinutes:600},{name:"6-Hour",value:6,maxTimeMinutes:800},{name:"12-Hour",value:12,maxTimeMinutes:1e3},{name:"24-Hour",value:24,maxTimeMinutes:1800}],l._selectedDHourStorm={name:"1-Hour",value:1,maxTimeMinutes:500},t.vm=l,t.greaterThanZero=l.greaterThanZero,t.greaterThanOrEqualToZero=l.greaterThanOrEqualToZero,t.betweenZeroOneHundred=l.betweenZeroOneHundred,l.AppVersion=configuration.version,l.toaster=a,l.modalInstance=i,l.StudyArea=n.selectedStudyArea,l.studyAreaService=n,l.init(),l.print=function(){3==this.SelectedTab&&(this.isSyntheticUHOpen=!0),setTimeout(function(){window.print()},300)},l}return __extends(r,e),Object.defineProperty(r.prototype,"SelectedTab",{get:function(){return this._selectedTab},set:function(e){this._selectedTab!=e&&(this._selectedTab=e,this.selectRunoffType())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"SelectedAEP",{get:function(){return this._selectedAEP},set:function(e){this._selectedAEP=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"SelectedAEPSynthetic",{get:function(){return this._selectedAEPSynthetic},set:function(e){this._selectedAEPSynthetic=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"SelectedStandardCurve",{get:function(){return this._selectedStandardCurve},set:function(e){this._selectedStandardCurve=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"SelectedCNModification",{get:function(){return this._selectedCNModification},set:function(e){this._selectedCNModification=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"SelectedTimeOfConcentration",{get:function(){return this._selectedTimeOfConcentration},set:function(e){this._selectedTimeOfConcentration=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"SelectedRainfallDistribution",{get:function(){return this._selectedRainfallDistribution},set:function(e){this._selectedRainfallDistribution=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"chosenFlowTypeIndex",{get:function(){return this._chosenFlowType},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"SelectedDHourStorm",{get:function(){return this._selectedDHourStorm},set:function(e){this._selectedDHourStorm=e},enumerable:!1,configurable:!0}),r.prototype.estimateFlows=function(e){var t=this,a=[{id:31,name:"Urban Peak-Flow Statistics",code:"UPFS",defType:"FS",statisticGroupName:"Urban Peak-Flow Statistics",statisticGroupID:"31",regressionRegions:e[0].regressionRegions}],r=configuration.baseurls.NSS+configuration.queryparams.estimateFlows.format("SC"),n=new WiM.Services.Helpers.RequestInfo(r,!0,1,"json",JSON.stringify(a));this.Execute(n).then(function(e){if(e.data[0].regressionRegions.length>0&&e.data[0].regressionRegions[0].results&&e.data[0].regressionRegions[0].results.length>0){var a=0;e.data[0].regressionRegions.forEach(function(e){"GC1583"!=e.code&&"GC1584"!=e.code&&"GC1585"!=e.code&&"GC1586"!=e.code||e.results.forEach(function(r){-1!==r.name.indexOf(t.SelectedAEP.value)&&(a+=r.value*(e.percentWeight/100))})});var r={lat:t.studyAreaService.selectedStudyArea.Pourpoint.Latitude,lon:t.studyAreaService.selectedStudyArea.Pourpoint.Longitude,region3PercentArea:t.region3Percent,region4PercentArea:t.region4Percent,Qp:a,A:t.drainageArea,L:t.mainChannelLength,S:t.mainChannelSlope,TIA:t.totalImperviousArea};t.getStormRunoffResults(r)}else t.toaster.clear(),t.toaster.pop("error","There was an error Estimating Flows","No results were returned",0)},function(e){t.toaster.clear(),t.toaster.pop("error","There was an error Estimating Flows","HTTP request error",0)}).finally(function(){})},r.prototype.getStormRunoffResults=function(e){var t=this,a=configuration.baseurls.SCStormRunoffServices+configuration.queryparams.SCStormRunoffBohman1992,r=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",JSON.stringify(e),{"Content-Type":"application/json","X-warning":!0});this.Execute(r).then(function(e){t.reportData=e.data,t.ReportData.BohmanUrban1992.Graph=t.loadGraphData(),t.ReportData.BohmanUrban1992.WeightedRunoff=t.reportData.weighted_runoff_volume,t.setGraphOptions(),t.showResults=!0,e.headers()["x-warning"]&&(t.warningMessages=e.headers()["x-warning"])},function(e){t.toaster.pop("error","Error",e.data.detail,0)}).finally(function(){t.canContinue=!0})},r.prototype.addParameterValues=function(e){var t=this,a=[];e[0].regressionRegions.forEach(function(e){e.parameters.forEach(function(e){a.push(e.code)})}),a=a.filter(function(e,t){return t===a.indexOf(e)});try{var r=this.studyAreaService.selectedStudyArea.WorkspaceID,n=this.studyAreaService.selectedStudyArea.RegionID,i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(n,r,a.join(",")),o=new WiM.Services.Helpers.RequestInfo(i,!0);o.withCredentials=!0,this.Execute(o).then(function(a){if(a.data.parameters&&a.data.parameters.length>0){t.toaster.clear();var r=!1;angular.forEach(a.data.parameters,function(e){e.hasOwnProperty("value")&&-999!=e.value?e.loaded=!0:(r=!0,console.error("Parameter failed to compute: ",e.code),e.loaded=!1)}),r&&t.toaster.pop("error","Error","Parameter failed to compute",0),e[0].regressionRegions.forEach(function(e){e.parameters.forEach(function(e){a.data.parameters.forEach(function(t){e.code.toLowerCase()==t.code.toLowerCase()&&(e.value=t.value)})})}),t.estimateFlows(e)}},function(e){t.toaster.clear(),t.toaster.pop("error","There was an HTTP error calculating parameters","Please retry",0)}).finally(function(){t.canContinue=!0,t.hideAlerts=!0})}catch(e){this.toaster.pop("error","There was an error calculating parameters","",0)}},r.prototype.loadParametersByStatisticsGroup=function(e,t){var a=this,r=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupParameterLookup;r=r.format("SC",31,e);var n=new WiM.Services.Helpers.RequestInfo(r,!0);this.Execute(n).then(function(e){e.data[0].regressionRegions[0].parameters&&e.data[0].regressionRegions[0].parameters.length>0&&(e.data[0].regressionRegions.forEach(function(e){t.length>0&&t.forEach(function(t){t.code.indexOf(e.code.toUpperCase())>-1&&(e.percentWeight=t.percentWeight)})}),a.addParameterValues(e.data))},function(e){a.toaster.clear(),a.toaster.pop("error","There was an error Loading Parameters by Statistics Group","Please retry",0)}).finally(function(){})},r.prototype.loadGraphData=function(){var e,t=this,a=[];return e=this.reportData.time_coordinates.map(function(e,a){return[e,t.reportData.discharge_coordinates[a]]}).map(function(e){return{x:e[0],y:e[1]}}),a.push({values:e,key:"Discharge (ft/s)",color:" #009900",type:"line",yAxis:1}),a},r.prototype.setGraphOptions=function(){this.ReportOptions={chart:{type:"multiChart",height:275,width:650,margin:{top:10,right:80,bottom:80,left:90},xAxis:{axisLabel:"Time, in hours",tickFormat:function(e){return e.toUSGSvalue()}},yAxis1:{axisLabel:"Discharge (Q), in ft/s",tickFormat:function(e){return e.toUSGSvalue()}}},title:{enable:!0,text:"USGS SC Flood Hydrograph for Urban Watersheds using "+this.SelectedAEP.name+" AEP",css:{"font-size":"10pt","font-weight":"bold"}}}},r.prototype.queryRegressionRegions=function(){var e=this;this.canContinue=!1;var t=configuration.baseurls.NSS+configuration.queryparams.RegressionRegionQueryService,a=this.studyAreaService.simplify(angular.fromJson(angular.toJson(this.studyAreaService.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0]))).geometry,r=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(a),{"Content-Type":"application/json","X-Is-StreamStats":!0});this.Execute(r).then(function(t){t.data.error&&e.toaster.pop("error","There was an error querying regression regions",t.data.error.message,0),0==t.data.length&&e.toaster.pop("error","No regression regions were returned","Regression based scenario computation not allowed",0),t.data.length>0&&(t.data.forEach(function(t){"GC1585"==t.code?e.region3Percent=t.percentWeight:"GC1586"==t.code&&(e.region4Percent=t.percentWeight)}),e.loadParametersByStatisticsGroup(t.data.map(function(e){return e.code}).join(","),t.data))},function(t){e.toaster.pop("error","There was an HTTP error querying Regression Regions","Please retry",0)}).finally(function(){})},r.prototype.calculateParameters=function(e){var t=this;try{this.toaster.pop("wait","Calculating Missing Parameters","Please wait...",0),this.parameters=e,this.canContinue=!1;var a=this.studyAreaService.selectedStudyArea.WorkspaceID,r=this.studyAreaService.selectedStudyArea.RegionID,n=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(r,a,e),i=new WiM.Services.Helpers.RequestInfo(n,!0);i.withCredentials=!0,this.Execute(i).then(function(e){if(e.data.parameters&&e.data.parameters.length>0){t.toaster.clear();var a=!1;angular.forEach(e.data.parameters,function(e){e.hasOwnProperty("value")&&-999!=e.value?e.loaded=!0:(a=!0,console.error("Parameter failed to compute: ",e.code),e.loaded=!1)}),a&&t.toaster.pop("error","Error","Parameter failed to compute",0),e.data.parameters.forEach(function(e){"drnarea"==e.code.toLowerCase()&&(t.drainageArea=e.value),"csl10_85fm"==e.code.toLowerCase()&&(t.mainChannelSlope=e.value),"lc06imp"==e.code.toLowerCase()&&(t.totalImperviousArea=e.value),"lfplength"==e.code.toLowerCase()&&(t.mainChannelLength=e.value)})}},function(e){t.toaster.clear(),t.toaster.pop("error","There was an HTTP error calculating parameters","Please retry",0)}).finally(function(){t.canContinue=!0,t.hideAlerts=!0})}catch(e){this.toaster.pop("error","There was an error calculating parameters","",0)}},r.prototype.getFormattedFlowSegments=function(){for(var e={sheetFlow:[],excessSheetFlow:[],shallowConcentratedFlow:[],channelizedFlowOpen:[],channelizedFlowStorm:[],channelizedFlowUserInput:[]},t=0,a=Object.keys(this.TravelTimeFlowSegments);t<a.length;t++){for(var r=a[t],n=[],i=0,o=this.TravelTimeFlowSegments[r];i<o.length;i++){for(var s={},l=0,g=o[i];l<g.length;l++){var c=g[l],u=c.value;if(c.options)for(var d=0,A=Object.keys(c.options);d<A.length;d++){var h=A[d];if(u==c.options[h]){u=h;break}}s[c.label.split(" (")[0]]=u}n.push(s)}e[r]=n}return e},r.prototype.queryRegressionRegionsSynthetic=function(){var e=this;this.canContinueSynthetic=!1;var t=configuration.baseurls.SCStormRunoffServices+configuration.queryparams.SCStormRunoffSyntheticUnitComputerGraphResults,a={lat:this.studyAreaService.selectedStudyArea.Pourpoint.Latitude,lon:this.studyAreaService.selectedStudyArea.Pourpoint.Longitude,AEP:this._selectedAEPSynthetic.value,CNModificationMethod:this._selectedCNModification.name,Area:this.drainageAreaSynthetic,Tc:this.timeOfConcentrationMin,RainfallDistributionCurve:this._selectedRainfallDistribution.name.split(" ")[1],PRF:this.peakRateFactor,CN:this.standardCurveNumber,S:this.watershedRetention,Ia:this.initialAbstraction},r=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(a),{"Content-Type":"application/json","X-Is-StreamStats":!0});this.Execute(r).then(function(t){t.data?t.data.hydrograph_ordinates_table&&t.data.runoff_results_table&&t.data.unit_hydrograph_data&&t.data.watershed_data?(e.syntheticResponseData=t.data,e.DHourStormChange(),e.showResultsSynthetic=!0,e.canContinueSynthetic=!0):e.toaster.pop("error","One or more of the expected data responses came back null.","Please retry",0):e.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",0)},function(t){e.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",0)}).finally(function(){})},r.prototype.loadSyntheticGraphData=function(){for(var e,t=this,a=[],r="flow_"+this._selectedDHourStorm.value+"_hour",n=[],i=0,o=this.syntheticResponseData.hydrograph_ordinates_table.time;i<o.length;i++){var s=o[i];if(n.push(s),Math.abs(s-this._selectedDHourStorm.maxTimeMinutes)<6)break}return e=n.map(function(e,a){return[e,t.syntheticResponseData.hydrograph_ordinates_table[r][a]]}).map(function(e){return{x:e[0],y:e[1]}}),a.push({values:e,key:"Flow (ft/s)",color:" #009900",type:"line",yAxis:1}),a},r.prototype.setSyntheticGraphOptions=function(){this.ReportOptionsSynthetic={chart:{type:"multiChart",height:275,width:650,margin:{top:10,right:80,bottom:80,left:90},xAxis:{axisLabel:"Time, in minutes",tickFormat:function(e){return e.toUSGSvalue()}},yAxis1:{axisLabel:"Flow, ft/s",tickFormat:function(e){return e.toUSGSvalue()}}},title:{enable:!0,text:this._selectedDHourStorm.value+" Hour Storm Hydrograph",css:{"font-size":"10pt","font-weight":"bold"}}}},r.prototype.DHourStormChange=function(){this.ReportData.SyntheticUrbanHydrograph.Graph=this.loadSyntheticGraphData(),this.ReportData.SyntheticUrbanHydrograph.WeightedRunoff=this.syntheticResponseData.runoff_results_table,this.setSyntheticGraphOptions()},r.prototype.isMaxRunoffVolume=function(e){var t=this.syntheticResponseData.runoff_results_table.max_runoff_volume_storm_duration;return this.DHourStormOptions[e].value==t},r.prototype.isMaxPeakRunoff=function(e){var t=this.syntheticResponseData.runoff_results_table.max_peak_runoff_storm_duration;return this.DHourStormOptions[e].value==t},r.prototype.calculateSyntheticParameters=function(e){var t=this;try{this.toaster.pop("wait","Calculating Missing Parameters","Please wait...",0),this.parameters=e,this.canContinueSynthetic=!1;var a=this.studyAreaService.selectedStudyArea.WorkspaceID,r=this.studyAreaService.selectedStudyArea.RegionID,n=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(r,a,e),i=new WiM.Services.Helpers.RequestInfo(n,!0);i.withCredentials=!0,this.Execute(i).then(function(e){var a,r,n,i,o,s,l,g,c,u;if(e.data.parameters&&e.data.parameters.length>0){var d=!1;angular.forEach(e.data.parameters,function(e){e.hasOwnProperty("value")&&-999!=e.value?e.loaded=!0:(d=!0,console.error("Parameter failed to compute: ",e.code),e.loaded=!1)}),d&&t.toaster.pop("error","Error","Parameter failed to compute",0),e.data.parameters.forEach(function(e){var a,r;"drnarea"!=e.code.toLowerCase()||t.drainageAreaSynthetic||(t.drainageAreaSynthetic=e.value),"csl10_85fm"!=e.code.toLowerCase()||2!=(null===(a=t._selectedTimeOfConcentration)||void 0===a?void 0:a.value)||t.lagTimeLength||(t.lagTimeLength=e.value),"lfplength"!=e.code.toLowerCase()||2!=(null===(r=t._selectedTimeOfConcentration)||void 0===r?void 0:r.value)||t.lagTimeSlope||(t.lagTimeSlope=e.value)});var A,h,p=t.getFormattedFlowSegments(),C=__spreadArray([],t.studyAreaService.selectedStudyArea.FeatureCollection.features,!0),f=__spreadArray(__spreadArray([],C.slice(1,2),!0),C.slice(2),!0);A={lat:t.studyAreaService.selectedStudyArea.Pourpoint.Latitude,lon:t.studyAreaService.selectedStudyArea.Pourpoint.Longitude,watershedFeatures:f,prfData:t.prfSegments,AEP:null===(a=t._selectedAEPSynthetic)||void 0===a?void 0:a.value,curveNumberMethod:null===(r=t._selectedStandardCurve)||void 0===r?void 0:r.endpointValue,TcMethod:t._selectedTimeOfConcentration.endpointValue,length:2==(null===(n=t._selectedTimeOfConcentration)||void 0===n?void 0:n.value)?t.lagTimeLength:null,slope:2==(null===(i=t._selectedTimeOfConcentration)||void 0===i?void 0:i.value)?t.lagTimeSlope:null,dataSheetFlow:1==(null===(o=t._selectedTimeOfConcentration)||void 0===o?void 0:o.value)?p.sheetFlow:null,dataExcessSheetFlow:1==(null===(s=t._selectedTimeOfConcentration)||void 0===s?void 0:s.value)?p.excessSheetFlow:null,dataShallowConcentratedFlow:1==(null===(l=t._selectedTimeOfConcentration)||void 0===l?void 0:l.value)?p.shallowConcentratedFlow:null,dataChannelizedFlowOpenChannel:1==(null===(g=t._selectedTimeOfConcentration)||void 0===g?void 0:g.value)?p.channelizedFlowOpen:null,dataChannelizedFlowStormSewer:1==(null===(c=t._selectedTimeOfConcentration)||void 0===c?void 0:c.value)?p.channelizedFlowStorm:null,dataChannelizedFlowStormSewerOrOpenChannelUserInputVelocity:1==(null===(u=t._selectedTimeOfConcentration)||void 0===u?void 0:u.value)?p.channelizedFlowUserInput:null},h=configuration.baseurls.SCStormRunoffServices+configuration.queryparams.SCStormRunoffSyntheticUnitHydrograph;var I=new WiM.Services.Helpers.RequestInfo(h,!0,WiM.Services.Helpers.methodType.POST,"json",JSON.stringify(A),{"Content-Type":"application/json","X-warning":!0});t.Execute(I).then(function(e){for(var a=e.data,r=0,n=Object.keys(a);r<n.length;r++){var i=n[r];if("Ia"!=i||t.initialAbstraction||(t.initialAbstraction=e.data.Ia.toUSGSvalue()),"S"!=i||t.watershedRetention||(t.watershedRetention=e.data.S.toUSGSvalue()),"curve_number"!=i||t.standardCurveNumber||(t.standardCurveNumber=e.data.curve_number.toUSGSvalue()),"peak_rate_factor"!=i||t.peakRateFactor||(t.peakRateFactor=e.data.peak_rate_factor.toUSGSvalue()),"rainfall_distribution_curve_letter"==i&&!t._selectedRainfallDistribution)for(var o=0,s=t.RainfallDistributionOptions;o<s.length;o++){var l=s[o];if(-1!=l.name.indexOf(e.data.rainfall_distribution_curve_letter)){t._selectedRainfallDistribution=l;break}}"time_of_concentration"!=i||t.timeOfConcentrationMin||(t.timeOfConcentrationMin=e.data.time_of_concentration.value.toUSGSvalue())}var g=!1,c=[];t.initialAbstraction||(g=!0,c.push("Initial Abstraction")),t.watershedRetention||(g=!0,c.push("Watershed Retention")),t.standardCurveNumber||(g=!0,c.push("Standard Curve Number")),t.peakRateFactor||(g=!0,c.push("Peak Rate Factor")),t._selectedRainfallDistribution||(g=!0,c.push("Rainfall Distribution")),t.timeOfConcentrationMin||(g=!0,c.push("Time of Concentration")),g?(t.toaster.clear(),t.toaster.pop("error","Error","Parameter(s) failed to compute: "+c.join(", "),0)):t.toaster.clear()}).catch(function(e){t.toaster.clear(),t.toaster.pop("error","There was an HTTP error calculating parameters","Please retry",0)})}},function(e){t.toaster.clear(),t.toaster.pop("error","There was an HTTP error calculating parameters","Please retry",0)}).finally(function(){t.canContinueSynthetic=!0,t.hideAlerts=!0})}catch(e){this.toaster.pop("error","There was an error calculating parameters","",0)}},r.prototype.openAddFlowSegment=function(e){this.addFlowSegmentOpen=!0,this._chosenFlowType=e},r.prototype.closeAddFlowSegment=function(){this.addFlowSegmentOpen=!1,this._chosenFlowType=null,this.TravelTimeFlowTypes=this._defaultFlowTypes.slice()},r.prototype.addFlowSegment=function(e){if("PRF"==this._chosenFlowType){var t={};t={landUse:this.prfForm.landUse.name,PRF:this.prfForm.prfValue,Area:this.prfForm.area},this.prfSegments.push(t),this.prfForm={landUse:null,prfValue:null,area:null}}else{t=[];for(var a=0,r=this.TravelTimeFlowTypes[e].questions;a<r.length;a++){var n=r[a];t.push(JSON.parse(JSON.stringify(n))),n.value=null}this.TravelTimeFlowSegments[this.TravelTimeFlowTypes[e].id].push(t)}this._chosenFlowType=null,this.addFlowSegmentOpen=!1},r.prototype.removeFlowSegment=function(e,t){var a=null;(a="PRF"==e?this.prfSegments:this.TravelTimeFlowSegments[e])?a.splice(t,1):console.error("Unable to remove flow segment: improper flow type ID. This is a bug!")},r.prototype.setPRF=function(e){this.prfForm.prfValue=e.value},r.prototype.calculatePRF=function(){var e=this;if(0==this.prfSegments.length)this.toaster.pop("error","No PRF information was added, cannot calculate.","",500),this.peakRateFactor=0;else{var t={prfData:this.prfSegments},a=configuration.baseurls.SCStormRunoffServices+configuration.queryparams.SCStormRunoffPRF,r=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",JSON.stringify(t));this.Execute(r).then(function(t){e.peakRateFactor=t.data.PRF},function(t){e.toaster.clear(),e.toaster.pop("error","There was an HTTP error calculating prf","Please retry",0)}).finally(function(){})}},r.prototype.calculateSyntheticParamsDisabled=function(){var e;if(1==(null===(e=this._selectedTimeOfConcentration)||void 0===e?void 0:e.value)){var t=this.completedFlowSegments();if(!this._selectedAEPSynthetic||!this._selectedStandardCurve)return 2;if(t<1)return 3}return this._selectedAEPSynthetic&&this._selectedStandardCurve&&this._selectedTimeOfConcentration&&0!=this.prfSegments.length?0:1},r.prototype.completedFlowSegments=function(){var e,t=0;if(1==(null===(e=this._selectedTimeOfConcentration)||void 0===e?void 0:e.value))for(var a=0,r=Object.keys(this.TravelTimeFlowSegments);a<r.length;a++){var n=r[a];this.TravelTimeFlowSegments[n].length&&t++}return t},r.prototype.validateForm=function(e){var t;if("SyntheticUrbanHydrograph"==e.$name&&1==(null===(t=this._selectedTimeOfConcentration)||void 0===t?void 0:t.value)){for(var a=!1,r=0,n=Object.keys(this.TravelTimeFlowSegments);r<n.length;r++){var i=n[r];if(this.TravelTimeFlowSegments[i].length){a=!0;break}}if(!a)return this.showResults=!1,this.hideAlerts=!1,!1}return!!e.$valid||(this.showResults=!1,this.hideAlerts=!1,!1)},r.prototype.clearResults=function(e){"BohmanUrbanForm"==e?(this.drainageArea=null,this.timeOfConcentrationMin=null,this.peakRateFactor=null,this.standardCurveNumber=null,this.watershedRetention=null,this.initialAbstraction=null,this.lagTimeLength=null,this.lagTimeSlope=null,this._chosenFlowType=null,this.mainChannelLength=null,this.mainChannelSlope=null,this.totalImperviousArea=null,this.SelectedAEP=null,this.SelectedAEPSynthetic=null,this.showResults=!1,this.warningMessages=null):"SyntheticUrbanHydrograph"==e&&(this._selectedAEPSynthetic=null,this._selectedStandardCurve=null,this._selectedCNModification=null,this._selectedTimeOfConcentration=null,this._selectedRainfallDistribution=null,this.TravelTimeFlowTypes=this._defaultFlowTypes.slice(),this.TravelTimeFlowSegments=JSON.parse(JSON.stringify(this._defaultFlowSegments)),this.drainageAreaSynthetic=null,this.timeOfConcentrationMin=null,this.peakRateFactor=null,this.standardCurveNumber=null,this.watershedRetention=null,this.initialAbstraction=null,this.lagTimeLength=null,this.lagTimeSlope=null,this._selectedCNModification=null,this.showResultsSynthetic=!1,this.stormHydrographOrdinatesAccordionOpen=!1,this.warningMessagesSynthetic=null,this._selectedDHourStorm={name:"1-Hour",value:1,maxTimeMinutes:500},this.prfSegments=[])},r.prototype.Close=function(){this.modalInstance.dismiss("cancel")},r.prototype.Reset=function(){this.init()},r.prototype.downloadCSV=function(){var e=this;3==this.SelectedTab?(this.isSyntheticUHOpen=!0,setTimeout(function(){e.formatCSV()},300)):this.formatCSV()},r.prototype.formatCSV=function(){var e=this;this.angulartics.eventTrack("Download",{category:"Report",label:"CSV"});var t,a="StreamStats Output Report\n\nState/Region ID,"+this.studyAreaService.selectedStudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.studyAreaService.selectedStudyArea.WorkspaceID+"\nLatitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString()+"\n\n";1==this.SelectedTab?a+=void 0:2==this.SelectedTab?a+=(t="USGS SC Flood Hydrograph for Urban Watersheds using "+e.SelectedAEP.name+" AEP\n",t+="\nWarning Messages:,"+e.warningMessages+"\n",t+=e.tableToCSV($("#BohmanUrbanParameterTable")),t+="\n"+e.tableToCSV($("#BohmanUrbanSummaryTable")),(t+="\n\n"+e.tableToCSV($("#BohmanUrbanHydrograph")))+"\r\n"):3==this.SelectedTab&&(a+=function(){var t=e.warningMessagesSynthetic?e.warningMessagesSynthetic:null,a="USGS SC Synthetic Unit Hydrograph using "+e.SelectedAEPSynthetic.name+"\n";t&&(a+="\nWarning Messages:,"+t+"\n"),a+="\nWatershed Data"+e.tableToCSV($("#WatershedDataTable")).slice(3),a+="\n\nUnit Hydrograph Data"+e.tableToCSV($("#UnitHydrographTable")).slice(3),a+="\n\nRunoff Results\n"+e.tableToCSV($("#SyntheticUnitHydrographRunoffTable")),a+="\n\nCritical Durations\n"+e.tableToCSV($("#SyntheticUnitHydrographCriticalDurationsTable")),a+="\n\nD-Hour Storm Hydrograph Ordinates\n"+e.tableToCSV($("#SyntheticUnitHydrographDataTable")),a+="\n\n"+e.tableToCSV($("#SyntheticUnitHydrographDisclaimerReport"));var r=document.getElementById("SyntheticUnitHydrographDisclaimerReport").textContent.replace(/\s+/g," ").trim();return(a+="\n\n"+(r=(r=r.replace(/,/g," ")).replace(/(?=\(\d\))/g,"\n")))+"\r\n"}());var r=new Blob([a],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,"data.csv");else{var n=document.createElement("a"),i=URL.createObjectURL(r);void 0!==n.download?(n.setAttribute("href",i),n.setAttribute("download","data.csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)):window.open(i)}},r.prototype.init=function(){this.ReportData=new a,this.SelectedTab=t.BohmanRural1989,this.showResults=!1,this.hideAlerts=!1,this.canContinue=!0,this.canContinueSynthetic=!0,this._chosenFlowType=null,this.stormHydrographOrdinatesAccordionOpen=!1},r.prototype.selectRunoffType=function(){switch(this._selectedTab){case t.BohmanRural1989:case t.BohmanUrban1992:}},r.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),a=e.find("tr:has(td)"),r=String.fromCharCode(11),n=String.fromCharCode(0),i='","',o='"\r\n"',s='"';return s+=l(t.map(g)),s+=o,s+=l(a.map(g))+'"';function l(e){return e.get().join(n).split(n).join(o).split(r).join(i)}function g(e,t){var a=$(t),n=a.find("td");return n.length||(n=a.find("th")),n.map(c).get().join(r)}function c(e,t){return $(t).text().replace('"','""')}},r.$inject=["$scope","toaster","$http","StreamStats.Services.StudyAreaService","$modalInstance","$timeout","WiM.Event.EventManager"],r}(WiM.Services.HTTPServiceBase);!function(e){e[e.BohmanRural1989=1]="BohmanRural1989",e[e.BohmanUrban1992=2]="BohmanUrban1992",e[e.SyntheticUrbanHydrograph=3]="SyntheticUrbanHydrograph"}(t||(t={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.SCStormRunoffController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(e){"use string";var t=function(){return function(){}}(),a=function(e){function a(a,r,n,i,o,s,l){var g=e.call(this,r,"")||this;return g.currentDate=new Date,a.vm=g,g.StudyArea=i.selectedStudyArea,g.Upload=s,g.http=r,g.sce=n,g.modalService=l,g.modalInstance=o,g.StudyAreaService=i,g.StudyArea=i.selectedStudyArea,g.ticketData=new t,g.selectedHelpTabName="help",g.showSuccessAlert=!1,g.submittingSupportTicket=!1,g.init(),g}return __extends(a,e),a.prototype.Close=function(){this.showSuccessAlert=!1,this.modalInstance.dismiss("cancel")},a.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},a.prototype.selectHelpTab=function(e){this.selectedHelpTabName!=e&&(this.selectedHelpTabName=e)},a.prototype.init=function(){this.AppVersion=configuration.version,this.StudyArea&&this.StudyArea.WorkspaceID?this.WorkspaceID=this.StudyArea.WorkspaceID:this.WorkspaceID="None",this.StudyArea&&this.StudyArea.RegionID?this.RegionID=this.StudyArea.RegionID:this.RegionID="None",this.StudyArea&&this.StudyArea.Server?this.Server=this.StudyArea.Server:this.Server="NA",this.modalService.modalOptions&&this.modalService.modalOptions.tabName&&this.selectHelpTab(this.modalService.modalOptions.tabName)},a.$inject=["$scope","$http","$sce","StreamStats.Services.StudyAreaService","$modalInstance","Upload","StreamStats.Services.ModalService"],a}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.HelpController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(t){"use string";var a=function(t){function a(e,a,r,n,i,o,s){var l=t.call(this,a,configuration.baseurls.StreamStats)||this;return e.vm=l,l.sce=r,l.modalInstance=s,l.modalService=n,l.StudyArea=o.selectedStudyArea,l.StudyAreaService=o,l.regionService=i,l.selectedAboutTabName="about",l.selectedRegion=null,l.init(),l}return __extends(a,t),a.prototype.Close=function(){this.modalInstance.dismiss("cancel")},a.prototype.selectAboutTab=function(e){this.selectedAboutTabName!=e&&(this.selectedAboutTabName=e)},a.prototype.getRegionHelpArticle=function(){var e,t=this;this.modalService.modalOptions&&(this.modalService.modalOptions.tabName&&this.selectAboutTab(this.modalService.modalOptions.tabName),e=this.modalService.modalOptions.regionID),this.regionService.selectedRegion&&(e=this.regionService.selectedRegion.Name),e&&configuration.regions.forEach(function(a){a.Name===e&&(t.selectedRegion=a)})},a.prototype.openSubmitSupport=function(t){this.Close(),t.stopPropagation(),t.preventDefault(),this.modalService.openModal(e.Services.SSModalType.e_help,{tabName:"submitTicket"})},a.prototype.init=function(){this.AppVersion=configuration.version,this.getRegionHelpArticle()},a.$inject=["$scope","$http","$sce","StreamStats.Services.ModalService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","$modalInstance"],a}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.AboutController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use string";var t=function(){function e(e,t,a,r){e.vm=this,this.sce=t,this.modalInstance=a,this.pagecontent=r.modalOptions.placeholder}return e.prototype.Close=function(){this.modalInstance.dismiss("cancel")},e.prototype.convertUnsafe=function(e){return console.log("converting..."),this.sce.trustAsHtml(e)},e.prototype.replaceAll=function(e,t,a){return e.replace(new RegExp(t,"g"),a)},e.prototype.getOldGWWpage=function(){this.pagecontent=""},e.$inject=["$scope","$sce","$modalInstance","StreamStats.Services.ModalService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavigationReportModalController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use string";var t=function(){function e(e,t,a,r,n,i){e.vm=this,this.sce=t,this.modalInstance=a,this.explorationService=n,this.studyAreaService=i,this.DEMresolutionList=["FINEST","10m","30m","90m","1000m"],this.explorationService.selectedMethod.navigationInfo.configuration&&(this.selectExclusiveOption("downstream","Direction"),this.selectOption("flowline","Query Source"),this.checkWorkspaceID()),this.print=function(){gtag("event","Download",{Category:"ElevationProfile",Type:"Print"}),window.print()}}return e.prototype.close=function(){this.explorationService.showElevationChart=!1,this.explorationService.setMethod(0,{}),this.modalInstance.dismiss("cancel")},e.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},e.prototype.selectElevationPoints=function(){this.modalInstance.dismiss("cancel"),this.explorationService.selectElevationPoints=!0},e.prototype.addExplorationPointFromMapt=function(e){this.modalInstance.dismiss("cancel"),this.explorationService.explorationPointType=e},e.prototype.addExplorationPointFromPourpoint=function(e,t,a,r){this.explorationService.selectedMethod.addLocation(e,new WiM.Models.Point(t,a,r))},e.prototype.downloadCSV=function(){gtag("event","Download",{Category:"ElevationProfile",Type:"CSV"});var e="lat,long,elevation(feet),distance(mi)\r\n";this.explorationService.coordinateList.forEach(function(t){e+=t.join(",")+"\r\n"});var t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"elevation-profile.csv");else{var a=document.createElement("a"),r=URL.createObjectURL(t);void 0!==a.download?(a.setAttribute("href",r),a.setAttribute("download","elevation-profile.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(r)}},e.prototype.addLimit=function(e){var t=this;this.selectedLimit=e,this.deleteConfig("Limit"),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(e,a){if("Limit"==e.name){var r=JSON.parse(JSON.stringify(e));r.value=t.selectedLimit,t.explorationService.selectedMethod.navigationConfiguration.push(r)}})},e.prototype.selectExclusiveOption=function(e,t){var a=this;this.selectedDirection=e,this.deleteConfig(t),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(r,n){if(r.name==t){var i=JSON.parse(JSON.stringify(r));i.value=e,a.explorationService.selectedMethod.navigationConfiguration.push(i)}})},e.prototype.selectOption=function(e,t){var a=this;this.selectedQuerySourceList||(this.selectedQuerySourceList=[]);var r=this.selectedQuerySourceList.indexOf(e);r>-1?this.selectedQuerySourceList.splice(r,1):this.selectedQuerySourceList.push(e),this.deleteConfig(t),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(e,r){if(e.name==t){var n=JSON.parse(JSON.stringify(e));n.value=a.selectedQuerySourceList,a.explorationService.selectedMethod.navigationConfiguration.push(n)}})},e.prototype.checkWorkspaceID=function(){var e=this;this.studyAreaService.selectedStudyArea&&""!==this.studyAreaService.selectedStudyArea.WorkspaceID&&this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(t,a){"Limit"==t.name&&t.value.forEach(function(t,a){"Polygon geometry"==t.name&&(t.name="Polygon geometry from delineated watershed",t.value=e.studyAreaService.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry)})})},e.prototype.ExecuteNav=function(){if(this.explorationService.selectedMethod.navigationPointCount==this.explorationService.selectedMethod.minLocations){this.explorationService.explorationMethodBusy=!0,this.explorationService.ExecuteSelectedModel()}},e.prototype.deleteConfig=function(e){var t=this;this.explorationService.selectedMethod.navigationConfiguration.forEach(function(a,r){a.name==e&&t.explorationService.selectedMethod.navigationConfiguration.splice(r,1)})},e.$inject=["$scope","$sce","$modalInstance","StreamStats.Services.ModalService","StreamStats.Services.ExplorationService","StreamStats.Services.StudyAreaService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ExplorationToolsModalController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use strict";var t=function(){function e(e,t,a,r){e.vm=this,this.sce=a,this.modalInstance=t,this._prosperServices=r,this.init()}return Object.defineProperty(e.prototype,"Location",{get:function(){return this._results.point},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Date",{get:function(){return this._results.date},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Table",{get:function(){return this._table},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ResultsAvailable",{get:function(){return this._resultsAvailable},enumerable:!1,configurable:!0}),e.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},Object.defineProperty(e.prototype,"Description",{get:function(){return this.sce.trustAsHtml("The PRObability of Streamflow PERmanence (PROSPER) model provides annual (2004-2016) streamflow permanence probabilities (SPPs; probabilistic predictions) and streamflow permanence classes (SPCs; categorical wet/ dry with an associated confidence level). Probabilities are of a stream channel having year- round flow at a 30- m spatial resolution. Model methods, output, and appropriate uses are detailed in Jaeger et al. (2018). Interpretation of a pixel as wet or dry will be based on combined consideration of the SPP, the sign of the SPC (negative for dry, positive for wet), and the associated confidence (1 - 5 representing 50% - 95 %). For example, predictions with a negative (positive) sign, high confidence level indicated by an SPC of - 5(5), and an SPP of less than (greater than) 0.5 will be the most reliable.<a href = 'https://doi.org/10.1016/j.hydroa.2018.100005' target = '_blank' > Click here for more information.</a><br><br><b>Contact information:</b><br>Roy Sando<br>U.S. Geological Survey, Wyoming-Montana Water Science Center<br>Email: <a href='mailto:tsando@usgs.gov' target='_blank'>tsando@usgs.gov</a> <br>Phone: 406-457-5953")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"AvailablePredictions",{get:function(){return this._prosperServices.AvailablePredictions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"DisplayedPredictionLayer",{get:function(){return this._prosperServices.DisplayedPrediction},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"SelectedPredictions",{get:function(){return this._prosperServices.SelectedPredictions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Graph",{get:function(){return this._graph},enumerable:!1,configurable:!0}),e.prototype.Close=function(){this.modalInstance.dismiss("cancel")},e.prototype.Reset=function(){this._prosperServices.ResetSelectedPredictions(),this.init()},e.prototype.Print=function(){gtag("event","Download",{Category:"Prosper",Type:"Print"}),window.print()},e.prototype.DownloadCSV=function(){gtag("event","Download",{Category:"Prosper",Type:"CSV"});var e="StreamStats PROSPER Report\n\n\nLatitude,"+this.Location.lat.toFixed(5)+"\nLongitude,"+this.Location.lng.toFixed(5)+"\nTime,"+this.Date.toLocaleString()+"\n\n";e+=this.Description+"\n\n",e+=this.tableToCSV($("#prosperResults"));var t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"prosper.csv");else{var a=document.createElement("a"),r=URL.createObjectURL(t);void 0!==a.download?(a.setAttribute("href",r),a.setAttribute("download","prosper.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(r)}},e.prototype.Query=function(){gtag("event","ExplorationTools",{Category:"QueryProsper"}),this._prosperServices.CanQuery=!0,this.modalInstance.dismiss()},e.prototype.ChangeDisplayedLayer=function(e){this.DisplayedPredictionLayer!=e&&(this._prosperServices.DisplayedPrediction=e)},e.prototype.init=function(){null==this._prosperServices.Result?(this._resultsAvailable=!1,this._results=null,this._graph=null):(this._resultsAvailable=!0,this.setResults(this._prosperServices.Result),this._graph={data:this.getGraphData(),options:{chart:{showLegend:!1,height:450,type:"scatterChart",showValues:!1,pointShape:function(e){return"square"},pointSize:10,pointDomain:[0,10],transitionDuration:350,rotateLabels:45,yDomain:[-5,5],margin:{top:20,right:50,bottom:100,left:60},yAxis:{axisLabel:"Streamflow Permanence Class",tickValues:[-5,-4,-3,-2,-1,0,1,2,3,4,5]},xAxis:{tickValues:this._xValues,showMaxMin:!1,rotateLabels:45},scatter:{onlyCircles:!1}}}})},e.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),a=e.find("tr:has(td)"),r=String.fromCharCode(11),n=String.fromCharCode(0),i='","',o='"\r\n"',s='"';return s+=l(t.map(g)),s+=o,s+=l(a.map(g))+'"';function l(e){return e.get().join(n).split(n).join(o).split(r).join(i)}function g(e,t){var a=$(t),n=a.find("td");return n.length||(n=a.find("th")),n.map(c).get().join(r)}function c(e,t){return $(t).text().replace('"','""')}},e.prototype.setResults=function(e){for(var t in this._results=e,this._table={},this._xValues=[],this._results.data)for(var a=0;a<this._results.data[t].length;a++){var r=this._results.data[t][a];"2"==r.name.charAt(0)&&this._xValues.push(r.name),r.name in this._table||(this._table[r.name]={}),this._table[r.name][t]=r.value}this._prosperServices.ResetResults()},e.prototype.getGraphData=function(){var e=this,t=[];return this._results.data.SPC.map(function(e){return e.value}).filter(function(e,t,a){return a.indexOf(e)===t}).forEach(function(a){t.push({key:a,color:e.getDefinedColor(a),values:e._results.data.SPC.filter(function(e){return e.value===a&&"mean"!=e.name.toLowerCase()}).map(function(e){return{x:parseInt(e.name),y:parseInt(e.value)}})})}),t},e.prototype.getDefinedColor=function(e){switch(e){case"-5":return"rgb(255,102,102)";case"-4":return"rgb(255,164,102)";case"-3":return"rgb(255,202,102)";case"-2":return"rgb(255,242,102)";case"-1":return"rgb(241,255,146)";case"0":return"rgb(211,255,188)";case"1":return"rgb(169,255,228)";case"2":return"rgb(122,239,255)";case"3":return"rgb(137,196,255)";case"4":return"rgb(134,155,255)";case"5":return"rgb(109,109,255)";default:return"rgb(64,0,64)"}},e.$inject=["$scope","$modalInstance","$sce","StreamStats.Services.ProsperService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ProsperController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(t){"use string";var a=function(t){function a(e,a,r,n,i,o,s){var l=t.call(this,o,configuration.baseurls.StreamStats)||this;return l.events=i,l.isBusy=!1,l.selectedReferenceGage=null,l.queryBy="Nearest",l.getNearest=!1,l.distance=10,l.stationNumber="",e.vm=l,l.modalInstance=a,l.studyAreaService=n,l.modalService=r,l.eventManager=i,l.toaster=s,l.dateRangeOptions={locale:{format:"MM/DD/YYYY"},eventHandlers:{"hide.daterangepicker":function(e){return l.SetExtensionDate(e)}}},l.studyAreaService.doSelectMapGage=!1,l.init(),l.load(),e.$watch(function(){return l.dateRange.dates},function(e,t){l.studyAreaService.selectedStudyAreaExtensions.forEach(function(e){e.parameters.forEach(function(e){"sdate"==e.code&&(e.value=l.dateRange.dates.startDate),"edate"==e.code&&(e.value=l.dateRange.dates.endDate)})}),e!=t&&l.getNWISDailyValues()}),e.$watch(function(){return l.studyAreaService.allIndexGages},function(e){void 0==e?l.isBusy=!0:(l.referenceGageListAll=e,l.isBusy=!1)}),l}return __extends(a,t),a.prototype.close=function(){this.modalInstance.dismiss("cancel")},a.prototype.ok=function(){this.verifyExtensionCanContinue()&&this.close()},a.prototype.setReferenceGageFromMap=function(e){this.isBusy=!0,this.studyAreaService.doSelectMapGage=!0,this.modalInstance.dismiss("cancel")},a.prototype.setBestCorrelatedReferenceGage=function(){var e=this;this.isBusy=!0,this.studyAreaService.onStudyAreaServiceBusyChanged.subscribe(new WiM.Event.EventHandler(function(){e.onStudyServiceBusyChanged()})),this.studyAreaService.GetKriggedReferenceGages()},a.prototype.SetExtensionDate=function(e){var t=this;this.getExtensionParameters(["sdate","edate"]).forEach(function(e){"sdate"===e.code&&(e.value=t.dateRange.dates.startDate),"edate"===e.code&&(e.value=t.dateRange.dates.endDate)}),this.studyAreaService.extensionDateRange=this.dateRange},a.prototype.init=function(){if(this.selectedReferenceGage=null,null!=this.studyAreaService.selectedStudyAreaExtensions){this.title=this.studyAreaService.selectedStudyAreaExtensions.map(function(e){return e.name}).join(", ");var t=this.getExtensionParameters(),a=t.map(function(e){return e.code});["sid"].some(function(e){return a.indexOf(e)>-1})&&(this.selectedReferenceGage=new e.Models.ReferenceGage("","")),["sdate","edate"].every(function(e){return a.indexOf(e)>-1})&&(void 0!=this.studyAreaService.extensionDateRange?this.dateRange=this.studyAreaService.extensionDateRange:this.dateRange={dates:{startDate:this.addDay(new Date,-30),endDate:this.addDay(new Date,-1)},minDate:new Date(1900,1,1),maxDate:this.addDay(new Date,-1)},t[a.indexOf("sdate")].value=this.dateRange.dates.startDate,t[a.indexOf("edate")].value=this.dateRange.dates.endDate)}},a.prototype.load=function(){var e=this.getExtensionParameters(),t=function(){var t=e.pop();a.selectedReferenceGage&&["sid"].indexOf(t.code)>-1&&("string"!=typeof t.value?a.selectedReferenceGage=t.value:"object"==typeof t.options&&(a.selectedReferenceGage=t.options.filter(function(e){return e.StationID==t.value})[0]),a.referenceGageList=t.options),a.dateRange&&["sdate","edate"].indexOf(t.code)>-1&&("sdate"==t.code&&(a.dateRange.dates.startDate=t.value),"edate"==t.code&&(a.dateRange.dates.endDate=t.value))},a=this;do{t()}while(e.length>0);this.studyAreaService.selectedGage&&(this.studyAreaService.selectedGage=this.selectedReferenceGage),void 0==this.referenceGageList&&""==this.selectedReferenceGage.StationID||(this.getGageInfo(),this.getNWISDailyValues()),"N/A"!=this.getDrainageArea()||this.studyAreaService.loadingDrainageArea||this.studyAreaService.loadDrainageArea(),void 0==this.studyAreaService.allIndexGages&&this.studyAreaService.loadAllIndexGages()},a.prototype.verifyExtensionCanContinue=function(){var e=this;return(!this.dateRange||(this.dateRange.dates.startDate<=this.dateRange.maxDate||this.dateRange.dates.endDate<=this.dateRange.maxDate)&&(this.dateRange.dates.startDate>=this.dateRange.minDate||this.dateRange.dates.endDate>=this.dateRange.minDate)&&this.dateRange.dates.startDate<=this.dateRange.dates.endDate)&&((!this.selectedReferenceGage||""!=this.selectedReferenceGage.StationID)&&(this.studyAreaService.selectedStudyAreaExtensions.forEach(function(t){t.parameters.forEach(function(t){"sid"==t.code&&"string"!=typeof t.value&&(void 0!=t.options&&0!=t.options.length||(t.options=[e.selectedReferenceGage]),t.value=e.selectedReferenceGage.StationID),"sdate"==t.code&&(t.value=e.dateRange.dates.startDate),"edate"==t.code&&(t.value=e.dateRange.dates.endDate)})}),this.studyAreaService.updateExtensions(),this.studyAreaService.extensionsConfigured=!0,!0))},a.prototype.addDay=function(e,t){try{return new Date(e.getTime()+864e5*t)}catch(t){return e}},a.prototype.getExtensionParameters=function(e){void 0===e&&(e=null);var t=this.studyAreaService.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]);return e&&(t=t.filter(function(t){return e.indexOf(t.code)>-1})),t},a.prototype.onStudyServiceBusyChanged=function(){var e=this;this.studyAreaService.onStudyAreaServiceBusyChanged.unsubscribe(new WiM.Event.EventHandler(function(){e.onStudyServiceBusyChanged()})),this.load(),this.isBusy=!1},a.prototype.updateReferenceGage=function(e){this.selectedReferenceGage=e,this.studyAreaService.selectedGage=e},a.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modalService.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},a.prototype.getGageInfo=function(){this.toaster.pop("wait","Querying gage information","Please wait...",0),this.isBusy=!0;var e=!1;if(this.referenceGageList)for(var t=this.referenceGageList.length-1;t>=0;t--){var a=this.referenceGageList[t];this.selectedReferenceGage&&this.selectedReferenceGage.StationID&&a.StationID==this.selectedReferenceGage.StationID&&(e=!0),this.getGageStatsStationInfo(a)}this.selectedReferenceGage&&""!=this.selectedReferenceGage.StationID&&!e&&this.getGageStatsStationInfo(this.selectedReferenceGage)},a.prototype.getGageStatsStationInfo=function(e,t){var a=this;void 0===t&&(t=!1);var r=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStations+e.StationID,n=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(n).then(function(r){var n=r.data;if(n.stationType&&"GS"!=n.stationType.code)t?(a.toaster.clear(),a.toaster.pop("error","Invalid gage","Gage is not continuous record",0),a.isBusy=!1):(a.removeItem(e),0==a.referenceGageList.length?a.toaster.pop("warning","No valid gages returned","Gages without continuous record removed from response",0):(a.toaster.clear(),a.toaster.pop("error","Invalid gage","Gage is not continuous record",0),a.isBusy=!1));else{if(n.hasOwnProperty("isRegulated")&&(e.isRegulated=n.isRegulated),n.hasOwnProperty("stationType")&&(e.stationType=n.stationType),n.hasOwnProperty("statistics")){var i=!1;n.statistics.forEach(function(e){"FDS"==e.statisticGroupType.code&&e.isPreferred&&(i=!0)}),e.HasFlowDurationStats=i}if(n.hasOwnProperty("characteristics")&&n.characteristics.forEach(function(t){"DRNAREA"==t.variableType.code&&(e.DrainageArea=t.value)}),n.hasOwnProperty("name")&&(e.Name=n.name),t&&(a.referenceGageList||(a.referenceGageList=[]),0!=a.referenceGageList.length&&a.referenceGageList.some(function(t){return t.StationID==e.StationID})||a.referenceGageList.unshift(e)),n.hasOwnProperty("location")){var o=a.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),s=a.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),l=turf.point(n.location.coordinates),g=turf.point([s,o]),c=turf.distance(l,g,{units:"miles"});e.distanceFromClick=c.toFixed(2)}a.getNWISPeriodOfRecord(e)}},function(t){if(a.toaster.clear(),a.isBusy=!1,console.log(t),t.headers()["x-usgswim-messages"]){var r=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(r).forEach(function(e){r[e].forEach(function(t){a.toaster.pop(e,e,t)})})}a.removeItem(e)}).finally(function(){})},a.prototype.removeItem=function(e){var t=this.referenceGageList.indexOf(this.referenceGageList.filter(function(t){return t.StationID==e.StationID})[0]);t&&this.referenceGageList.splice(t,1)},a.prototype.getNearestGages=function(){var e=this;this.isBusy=!0,this.toaster.pop("wait","Searching for gages","Please wait...",0);var t=this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),a=this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),r=configuration.baseurls.GageStatsServices;"Nearest"==this.queryBy&&(r+=configuration.queryparams.GageStatsServicesNearest.format(t,a,(1.60934*this.distance).toFixed(0))),"Network"==this.queryBy&&(r+=configuration.queryparams.GageStatsServicesNetwork.format(t,a,(1.60934*this.distance).toFixed(0)));var n=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",{"X-Is-Streamstats":!0});this.referenceGageList=[],this.selectedReferenceGage.StationID="",this.Execute(n).then(function(t){if(e.toaster.clear(),e.isBusy=!1,"string"==typeof t.data)e.toaster.pop("warning","Warning",t.data,0);else if(t.data&&0==t.data.length)e.toaster.pop("warning","Warning","No stations located within search distance");else if(t.data&&t.data.length>0){for(var a=t.data.length-1;a>=0;a--){var r=t.data[a];if("GS"!=r.stationType.code)t.data.splice(a,1),0==t.data.length&&e.toaster.pop("warning","No valid gages returned","Gages without continuous record removed from response",0);else{if(r.hasOwnProperty("statistics")){var n=!1;r.statistics.forEach(function(e){"FDS"==e.statisticGroupType.code&&e.isPreferred&&(n=!0)}),r.HasFlowDurationStats=n}if(r.hasOwnProperty("characteristics")&&r.characteristics.forEach(function(e){"DRNAREA"==e.variableType.code&&(r.DrainageArea=e.value)}),r.hasOwnProperty("name")&&(r.Name=r.name),r.hasOwnProperty("code")&&(r.StationID=r.code),r.hasOwnProperty("location")){var i=e.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),o=e.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),s=turf.point(r.location.coordinates),l=turf.point([o,i]),g=turf.distance(s,l,{units:"miles"});r.distanceFromClick=g.toFixed(2)}e.getNWISPeriodOfRecord(r)}}e.referenceGageList=t.data,e.getNWISDailyValues()}if(t.headers()["x-usgswim-messages"]){var c=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(c).forEach(function(t){c[t].forEach(function(a){e.toaster.pop(t,t,a)})})}},function(t){if(e.toaster.clear(),e.isBusy=!1,console.log(t),t.headers()["x-usgswim-messages"]){var a=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(a).forEach(function(t){a[t].forEach(function(a){e.toaster.pop(t,t,a)})})}else e.toaster.pop("error","There was an error finding nearby gages.","Please retry",0)})},a.prototype.selectGage=function(t){var a=this.studyAreaService.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()}),r=new e.Models.ReferenceGage(t.StationID,t.Name);t.geometry&&(r.Latitude_DD=t.geometry.coordinates[0],r.Longitude_DD=t.geometry.coordinates[1]),a[0].options=this.referenceGageList,a[0].value=r,this.selectedReferenceGage=r,this.studyAreaService.selectedGage=r},a.prototype.getStyling=function(e){return e.StationID==this.selectedReferenceGage.StationID?{"background-color":"#ebf0f5"}:{"background-color":"unset"}},a.prototype.getNWISPeriodOfRecord=function(e){var t=this;if(e.StationID){var a=configuration.baseurls.NWISurl+configuration.queryparams.NWISperiodOfRecord+e.StationID,r=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"TEXT");this.Execute(r).then(function(a){var r=a.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e}),n=r.shift().split("\t");r.shift();do{var i=r.shift().split("\t");if("00060"==i[n.indexOf("parm_cd")]){if(void 0==e.StartDate)e.StartDate=new Date(i[n.indexOf("begin_date")]);else{var o=new Date(i[n.indexOf("begin_date")]);o<e.StartDate&&(e.StartDate=o)}if(void 0==e.EndDate)e.EndDate=new Date(i[n.indexOf("end_date")]);else{var s=new Date(i[n.indexOf("end_date")]);s>e.EndDate&&(e.EndDate=s)}}}while(r.length>0);t.toaster.clear(),t.isBusy=!1},function(e){t.toaster.clear(),t.isBusy=!1,t.toaster.pop("error","Error","NWIS period of record not found",0)}).finally(function(){})}},a.prototype.checkPeriodOfRecord=function(e){return!this.dateRange.dates&&e.hasOwnProperty("SelectEnabled")?e.SelectEnabled:(this.dateRange.dates.startDate>=this.addDay(e.StartDate,1)&&this.addDay(e.EndDate,1)>=this.dateRange.dates.endDate?e.SelectEnabled=!0:e.SelectEnabled=!1,e.SelectEnabled)},a.prototype.checkCorrelationMatrix=function(e){return!this.dateRange.dates&&e.hasOwnProperty("SelectEnabled")?e.SelectEnabled:(-1!==this.referenceGageListAll.map(function(e){return e.id}).indexOf(e.StationID)?e.SelectEnabled=!0:e.SelectEnabled=!1,e.SelectEnabled)},a.prototype.getNWISDailyValues=function(){var e=this;if(this.referenceGageList){var t=this.dateRange.dates.startDate.toISOString();t=t.substr(0,t.indexOf("T"));var a=this.dateRange.dates.endDate.toISOString();a=a.substr(0,a.indexOf("T")),this.referenceGageList.forEach(function(r){r.HasZeroFlows="N/A";var n=configuration.baseurls.NWISurl+configuration.queryparams.NWISdailyValues.format(r.StationID,t,a),i=new WiM.Services.Helpers.RequestInfo(n,!0,WiM.Services.Helpers.methodType.GET,"TEXT");e.Execute(i).then(function(e){var t=e.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e});t.shift(),r.HasZeroFlows=!1,t.length<=2&&(r.HasZeroFlows="N/A");do{var a=t.shift().split("\t"),n=parseInt(a[3]);"number"==typeof n&&0==n&&(r.HasZeroFlows="true")}while(t.length>0)},function(e){r.HasZeroFlows="N/A"})})}},a.prototype.checkCorrelation=function(){return!!this.referenceGageList&&this.referenceGageList.some(function(e){return e.hasOwnProperty("correlation")})},a.prototype.getDrainageArea=function(){var e=this.studyAreaService.studyAreaParameterList.filter(function(e){return"drnarea"==e.code.toLowerCase()})[0];return e&&e.hasOwnProperty("value")?e.value:"N/A"},a.prototype.queryGage=function(){this.toaster.pop("wait","Querying gage information","Please wait...",0),this.isBusy=!0;var t=new e.Models.ReferenceGage(this.stationNumber,"");this.getGageStatsStationInfo(t,!0)},a.$inject=["$scope","$modalInstance","StreamStats.Services.ModalService","StreamStats.Services.StudyAreaService","WiM.Event.EventManager","$http","toaster"],a}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ExtensionModalController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){var t;e.Controllers||(e.Controllers={}),t=function(t){function a(e,a,r,n,i,o,s){var l=t.call(this,o,configuration.baseurls.StreamStats)||this;return l.events=i,l.isBusy=!1,l.selectedReferenceGage=null,e.vm=l,l.modalInstance=a,l.studyAreaService=n,l.modalService=r,l.eventManager=i,l.toaster=s,l.init(),l.load(),l}return __extends(a,t),a.prototype.close=function(){this.modalInstance.dismiss("cancel")},a.prototype.ok=function(){var e=this.verifyExtensionCanContinue();e?this.toaster.pop("error","Error",e,0):(this.close(),this.studyAreaService.flowAnywhereData={},this.studyAreaService.flowAnywhereData.dateRange=this.dateRange,this.studyAreaService.flowAnywhereData.selectedGage=this.selectedReferenceGage,this.toaster.pop("success","Flow Anywhere Method was successfully configured","Please continue",5e3))},a.prototype.init=function(){var t=this;this.isBusy=!0,this.referenceGageList=null;var a=this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),r=this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),n=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.FlowAnywhereGages.format(r,a),i=new WiM.Services.Helpers.RequestInfo(n,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(i).then(function(a){a.data.features?(t.referenceGageList=[],a.data.features.forEach(function(a){t.gage=new e.Models.ReferenceGage(a.attributes["reference_gages.site_id"],a.attributes["reference_gages.site_name"]),t.gage.DrainageArea_sqMI=a.attributes["reference_gages.da_pub_mi2"],t.gage.Latitude_DD=a.attributes["reference_gages.lat_dd_nad"],t.gage.Longitude_DD=a.attributes["reference_gages.long_dd_na"],t.gage.AggregatedRegion=a.attributes["regions_local.Region_Agg"],t.getNWISPeriodOfRecord(t.gage),t.referenceGageList.push(t.gage)})):400==a.error.code&&(t.referenceGageList=null),t.isBusy=!1},function(e){t.toaster.clear(),t.isBusy=!1,t.toaster.pop("error","Error","Error accessing Flow Anywhere gages",0)}).finally(function(){}),this.dateRange={dates:{startDate:this.addDay(new Date,-32),endDate:this.addDay(new Date,-2)},minDate:new Date(1900,1,1),maxDate:this.addDay(new Date,-1)}},a.prototype.load=function(){"N/A"!=this.getDrainageArea()||this.studyAreaService.loadingDrainageArea||this.studyAreaService.loadDrainageArea(),this.studyAreaService.flowAnywhereData&&(this.studyAreaService.flowAnywhereData.selectedGage&&(this.selectedReferenceGage=this.studyAreaService.flowAnywhereData.selectedGage),this.studyAreaService.flowAnywhereData.dateRange&&(this.dateRange=this.studyAreaService.flowAnywhereData.dateRange))},a.prototype.verifyExtensionCanContinue=function(){return this.selectedReferenceGage?""==this.selectedReferenceGage.StationID?"A reference gage must be selected.":!this.dateRange||(this.dateRange.dates.startDate<=this.dateRange.maxDate||this.dateRange.dates.endDate<=this.dateRange.maxDate)&&(this.dateRange.dates.startDate>=this.dateRange.minDate||this.dateRange.dates.endDate>=this.dateRange.minDate)&&this.dateRange.dates.startDate<=this.dateRange.dates.endDate?this.selectedReferenceGage.StartDate>this.dateRange.dates.startDate?"The selected start date is not valid for the selected reference gage.":this.selectedReferenceGage.EndDate<this.dateRange.dates.endDate?"The selected end date is not valid for the selected reference gage.":null:"Date range is not valid.":"A reference gage must be selected."},a.prototype.addDay=function(e,t){try{return new Date(e.getTime()+864e5*t)}catch(t){return e}},a.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modalService.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},a.prototype.selectGage=function(e){this.selectedReferenceGage=e},a.prototype.getStyling=function(e){return this.selectedReferenceGage&&e.StationID==this.selectedReferenceGage.StationID?{"background-color":"#FFF"}:{"background-color":"unset"}},a.prototype.getNWISPeriodOfRecord=function(e){var t=this;if(this.isBusy=!0,e.StationID){var a=configuration.baseurls.NWISurl+configuration.queryparams.NWISperiodOfRecord+e.StationID,r=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"TEXT");this.Execute(r).then(function(a){var r=a.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e}),n=r.shift().split("\t");r.shift();do{var i=r.shift().split("\t");if("00060"==i[n.indexOf("parm_cd")]){if(void 0==e.StartDate)e.StartDate=new Date(i[n.indexOf("begin_date")]);else{var o=new Date(i[n.indexOf("begin_date")]);o<e.StartDate&&(e.StartDate=o)}if(void 0==e.EndDate)e.EndDate=new Date(i[n.indexOf("end_date")]);else{var s=new Date(i[n.indexOf("end_date")]);s>e.EndDate&&(e.EndDate=s)}}}while(r.length>0);t.toaster.clear(),t.isBusy=!1},function(e){t.toaster.clear(),t.isBusy=!1,t.toaster.pop("error","Error","NWIS period of record not found",0)}).finally(function(){})}},a.prototype.getDrainageArea=function(){var e=this.studyAreaService.studyAreaParameterList.filter(function(e){return"drnarea"==e.code.toLowerCase()})[0];return e&&e.hasOwnProperty("value")?e.value:"N/A"},a.$inject=["$scope","$modalInstance","StreamStats.Services.ModalService","StreamStats.Services.StudyAreaService","WiM.Event.EventManager","$http","toaster"],a}(WiM.Services.HTTPServiceBase),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.FlowAnywhereController",t)}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(e){"use strict";var t,a=function(){return function(e){this.code=e}}(),r=(function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(e){function r(t,a,r,n,i){var o=e.call(this,a,configuration.baseurls.StreamStats)||this;return o.filteredStatGroupsChar=[],o.showPreferred=!1,o.multiselectOptions={displayProp:"name"},o.citationMultiselectOptions={displayProp:"id"},o.URLsToDisplay=[],o.dischargeObj=void 0,o.measuredObj=void 0,o.floodFreq=void 0,o.altFloodFreq=void 0,o.oneDayStats=void 0,o.sevenDayStats=void 0,o.fourteenDayStats=void 0,o.thirtyDayStats=void 0,o.contrOneDayStats=void 0,o.contrSevenDayStats=void 0,o.contrFourteenDayStats=void 0,o.contrThirtyDayStats=void 0,o.weightedOneDayStats=void 0,o.weightedSevenDayStats=void 0,o.weightedThirtyDayStats=void 0,o.weightedAEPstats=void 0,o.regulatedAEPstats=void 0,o.peakDates=void 0,o.estPeakDates=void 0,o.dailyFlow=void 0,o.instFlow=[],o.gageTimeZone=void 0,o.NWSforecast=void 0,o.meanPercentileStats=void 0,o.meanPercent=void 0,o.rawShaded=void 0,o.formattedP0to10=[],o.formattedP10to25=[],o.formattedP25to75=[],o.formattedP75to90=[],o.formattedP90to100=[],o.formattedFloodFreq=[],o.formattedAltFloodFreq=[],o.formattedOneDayStats=[],o.formattedSevenDayStats=[],o.formattedFourteenDayStats=[],o.formattedThirtyDayStats=[],o.formattedContrOneDayStats=[],o.formattedContrSevenDayStats=[],o.formattedContrFourteenDayStats=[],o.formattedContrThirtyDayStats=[],o.formattedWeightedOneDayStats=[],o.formattedWeightedSevenDayStats=[],o.formattedWeightedThirtyDayStats=[],o.formattedWeightedAEP=[],o.formattedRegulatedAEP=[],o.allFloodFreqStats=[],o.allYears=[],o.formattedPeakDates=[],o.formattedPeakDatesOnYear=[],o.formattedEstPeakDatesOnYear=[],o.formattedEstPeakDates=[],o.formattedDailyFlow=[],o.formattedInstFlow=[],o.dailyDatesOnly=[],o.startAndEnd=[],o.formattedDailyHeat=[],o.dailyValuesOnly=[],o.formattedDailyPlusAvg=[],o.formattedDischargePeakDates=[],o.USGSMeasuredAgeQualityData="age",o.plotlines=!0,o.showFloodStats=!0,o.logScale=!1,o.peaksOnYear=!0,o.logScaleDischarge=!1,t.vm=o,o.modalInstance=n,o.modalService=r,o.toaster=i,o.init(),o.selectedStatisticGroups=[],o.selectedCitations=[],o.selectedFloodFreqStats=[],o.selectedYear=[],o.selectedStatGroupsChar=[],o.selectedCitationsChar=[],o.statCitationList=[],o.charCitationList=[],o.showPreferred=!1,o.peakDataSourcesCollapsed=!0,o.dailyDataSourcesCollapsed=!0,o.stageDischargeDataSourcesCollapsed=!0,o.print=function(){gtag("event","Download",{Category:"GagePage",Type:"Print"}),window.print()},document.addEventListener("keydown",function(e){"Escape"===e.key&&t.vm.Close()}),o}return __extends(r,e),Object.defineProperty(r.prototype,"SelectedTab",{get:function(){return this._selectedTab},set:function(e){this._selectedTab!=e&&(this._selectedTab=e)},enumerable:!1,configurable:!0}),r.prototype.Close=function(){this.modalInstance.dismiss("cancel");var e=document.location.href;window.history.pushState({},"",e.split("?")[0])},r.prototype.selectGagePageTab=function(e){var a=new URLSearchParams(window.location.search);"GageInformation"==e?(a.set("tab","info"),this.SelectedTab=t.GageInformation):"GageAnalysisPlots"==e&&(a.set("tab","plots"),this.SelectedTab=t.GageAnalysisPlots),history.replaceState(null,null,"?"+a.toString())},r.prototype.getGagePage=function(){var e=this;this.gage=new a(this.modalService.modalOptions.siteid);var t=new URLSearchParams(window.location.search);t.set("gage",this.modalService.modalOptions.siteid),history.replaceState(null,null,"?"+t.toString());var r=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStations+this.gage.code,n=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(n).then(function(t){e.gage=t.data,e.gage.lat=t.data.location.coordinates[1],e.gage.lng=t.data.location.coordinates[0],e.gage.statisticsgroups=[],e.gage.citations=[],e.getStationCharacteristics(t.data.characteristics),e.getStationStatistics(t.data.statistics),e.getNWISInfo(),e.getNWISPeriodOfRecord(e.gage),e.additionalLinkCheck(e.gage.code)},function(t){e.Close(),e.toaster.pop("error","Gage page could not be opened: ",t.data.message,0)}).finally(function(){})},r.prototype.additionalLinkCheck=function(e){var t=this;this.URLsToDisplay=[];for(var a,r=[{url:"https://streamstats.usgs.gov/gagePages/NC/Sta_"+e+"_daily_discharge_percentiles_table_by-wateryears.txt",text:"Flow-Duration Statistics by Water Year",available:!1},{url:"https://streamstats.usgs.gov/gagePages/NC/Sta_"+e+"_daily_discharge_percentiles_table_by-day-month-seasonal.txt",text:"Flow-Duration Statistics by Period of Record, Calendar Day & Month, & Seasonal Periods",available:!1},{url:"https://streamstats.usgs.gov/gagePages/IA/"+e+"_stats.pdf",text:"Stream Flow Statistics",available:!1}],n=function(e){a=new WiM.Services.Helpers.RequestInfo(r[e].url,!0,WiM.Services.Helpers.methodType.GET,"json"),i.Execute(a).then(function(a){200==a.status&&(r[e].available=!0,t.URLsToDisplay.push(r[e]))},function(e){}).finally(function(){})},i=this,o=0;o<r.length;o++)n(o)},r.prototype.setPreferred=function(e){this.showPreferred=e},r.prototype.getStationCharacteristics=function(e){var t=this;e.forEach(function(e,a){if(e.hasOwnProperty("citation")&&e.citation.id&&(e.citation&&e.citation.citationURL&&(e.citation.citationURL=e.citation.citationURL.replace("#","")),t.checkForCitation(e.citation.id)||t.gage.citations.push(e.citation),t.checkForStatOrCharCitation(e.citation.id,t.charCitationList)||t.charCitationList.push(e.citation)),!t.checkForCharStatisticGroup(e.variableType.statisticGroupTypeID))if(e.hasOwnProperty("statisticGroupType")){var r=e.statisticGroupType;t.filteredStatGroupsChar.push(r)}else t.getCharStatGroup(e.variableType.statisticGroupTypeID)})},r.prototype.checkForCitation=function(e){return this.gage.citations.some(function(t){return t.id===e})},r.prototype.checkForStatOrCharCitation=function(e,t){return t.some(function(t){return t.id===e})},r.prototype.getStationStatistics=function(e){var t=this;e.forEach(function(e,a){if(e.hasOwnProperty("citation")&&e.citation.id&&(e.citation&&e.citation.citationURL&&(e.citation.citationURL=e.citation.citationURL.replace("#","")),t.checkForCitation(e.citation.id)||t.gage.citations.push(e.citation),t.checkForStatOrCharCitation(e.citation.id,t.statCitationList)||t.statCitationList.push(e.citation)),!t.checkForStatisticGroup(e.statisticGroupTypeID))if(e.hasOwnProperty("statisticGroupType")){var r=e.statisticGroupType;t.gage.statisticsgroups.push(r)}else t.getStatGroup(e.statisticGroupTypeID)})},r.prototype.getStatGroup=function(e){var t=this,a=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStatGroups+e,r=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(r).then(function(e){t.checkForStatisticGroup(e.data.id)||t.gage.statisticsgroups.push(e.data)})},r.prototype.getCharStatGroup=function(e){var t=this,a=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStatGroups+e,r=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(r).then(function(e){t.checkForCharStatisticGroup(e.data.id)||t.filteredStatGroupsChar.push(e.data)})},r.prototype.checkForStatisticGroup=function(e){return this.gage.statisticsgroups.some(function(t){return t.id===e})},r.prototype.checkForCharStatisticGroup=function(e){return this.filteredStatGroupsChar.some(function(t){return t.id===e})},r.prototype.checkForPredInt=function(e){return this.gage.statistics.some(function(t){return t.statisticGroupTypeID==e&&t.hasOwnProperty("predictionInterval")})},r.prototype.getNWISInfo=function(){var e=this,t=configuration.baseurls.NWISurl+configuration.queryparams.NWISsiteinfo+this.gage.code,a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(a).then(function(t){try{var a=t.data.split(e.gage.name)[1].match(/[+-]?((\d+(\.\d*)?)|(\.\d+))/g);e.NWISlat=a[0],e.NWISlng=a[1]}catch(a){var r=t.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e})[2].split("\t");e.NWISlat=r[4],e.NWISlng=r[5]}})},r.prototype.getNWISPeriodOfRecord=function(e){if(e.code){var t=configuration.baseurls.NWISurl+configuration.queryparams.NWISperiodOfRecord+e.code,a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"TEXT");this.Execute(a).then(function(t){var a=t.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e}),r=a.shift().split("\t");a.shift();do{var n=a.shift().split("\t");if("00060"==n[r.indexOf("parm_cd")]){if(void 0==e.StartDate)e.StartDate=new Date(n[r.indexOf("begin_date")]);else{var i=new Date(n[r.indexOf("begin_date")]);i<e.StartDate&&(e.StartDate=i)}if(void 0==e.EndDate)e.EndDate=new Date(n[r.indexOf("end_date")]);else{var o=new Date(n[r.indexOf("end_date")]);o>e.EndDate&&(e.EndDate=o)}}}while(a.length>0)},function(t){e.StartDate=void 0,e.EndDate=void 0}).finally(function(){})}},r.prototype.citationSelected=function(e,t){for(var a in t)if(t[a].id===e.citationID)return!0;return!1},r.prototype.downloadCSV=function(){gtag("event","Download",{Category:"GagePage",Type:"CSV"});var e=void 0!==this.gage.StartDate||void 0!==this.gage.EndDate?this.convertDateToString(this.gage.StartDate)+" - "+this.convertDateToString(this.gage.EndDate):"Undefined",t='\ufeffStreamStats Gage Page\n\nGage Information\nName,Value\nUSGS Station Number,"'+this.gage.code+'"\nStation Name,"'+this.gage.name+'"\nStation Type,"'+this.gage.stationType.name+'"\nLatitude,"'+this.gage.lat+'"\nLongitude,"'+this.gage.lng+'"\nNWIS Latitude,"'+this.NWISlat+'"\nNWIS Longitude,"'+this.NWISlng+'"\nIs regulated?,"'+this.gage.isRegulated+'"\nAgency,"'+this.gage.agency.name+'"\nNWIS Discharge Period of Record,"'+e+'"\n\n',a=this;this.gage.characteristics.length>0&&(t+="Physical Characteristics\n\n",this.filteredStatGroupsChar.forEach(function(e){(0==a.selectedStatGroupsChar.length||a.selectedStatGroupsChar.indexOf(e)>-1)&&(t+='"'+e.name+'"\n'+a.tableToCSV($("#physical-characteristics-table-"+e.id))+"\n\n")})),this.gage.statisticsgroups.length>0&&(t+="Streamflow Statistics\n\n",this.gage.statisticsgroups.forEach(function(e){(0==a.selectedStatisticGroups.length||a.selectedStatisticGroups.indexOf(e)>-1)&&(t+='"'+e.name+'"\n'+a.tableToCSV($("#streamflow-statistics-table-"+e.id))+"\n\n")})),this.gage.citations.length>0&&(t+="Citations\n"+this.tableToCSV($("#citations-table"))+"\n\n"),t+='"USGS Data Disclaimer: Unless otherwise stated, all data, metadata and related materials are considered to satisfy the quality standards relative to the purpose for which the data were collected. Although these data and associated metadata have been reviewed for accuracy and completeness and approved for release by the U.S. Geological Survey (USGS), no warranty expressed or implied is made regarding the display or utility of the data for other purposes, nor on all computer systems, nor shall the act of distribution constitute any such warranty."\n"USGS Software Disclaimer: This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the functionality of the software and related material nor shall the fact of release constitute any such warranty. Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held liable for any damages resulting from its authorized or unauthorized use."\n"USGS Product Names Disclaimer: Any use of trade, firm, or product names is for descriptive purposes only and does not imply endorsement by the U.S. Government."\n\n"Application Version:",'+this.AppVersion;var r=new Blob([t],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,"data.csv");else{var n=document.createElement("a"),i=URL.createObjectURL(r);void 0!==n.download?(n.setAttribute("href",i),n.setAttribute("download","data.csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)):window.open(i)}},r.prototype.getGagePlots=function(){this.getPeakInfo()},r.prototype.getPeakInfo=function(){var e=this,t="https://nwis.waterdata.usgs.gov/usa/nwis/peak/?format=rdb&site_no="+this.gage.code;this.peakFlowURL=t;var a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(a).then(function(t){var a=[],r=[],n=t.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e});n.shift().split("\t"),n.shift();do{var i=n.shift().split("\t"),o={agency_cd:i[0],site_no:i[1],peak_dt:i[2],peak_va:parseInt(i[4]),peak_stage:parseFloat(i[6])};a.push(o);var s={agency_cd:i[0],site_no:i[1],peak_dt:i[2].replaceAll("-00","-01"),peak_va:parseInt(i[4]),peak_stage:parseFloat(i[6])};o.peak_dt[8]+o.peak_dt[9]!=="00"&&o.peak_dt[5]+o.peak_dt[6]!=="00"||r.push(s)}while(n.length>0);var l=a.filter(function(e){return e.peak_dt[8]+e.peak_dt[9]!=="00"||e.peak_dt[8]+e.peak_dt[9]!=="00"});e.peakDates=l,e.estPeakDates=r},function(e){}).finally(function(){e.getFloodFreq()})},r.prototype.getFloodFreq=function(){var e=this,t=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStations+this.gage.code;this.floodStatsURL=t;var a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(a).then(function(t){var a=t.data,r=[9,852,8,4,7,3,6,1,501,5,2,500,851,1438,818],n=[2311,2312,2313,2314,2315,2316,2317,2318],i=[82,83,84,85,596,820,1737],o=[90,91,92,93,589,822,1165,1166,1167],s=[94,95,96,97,828,829],l=[98,99,100,101,657,830,1174,1175,1176],g=[1753,1773,1081,1744,1766,1712],c=[1082,1083,1992,2015,2039,2048],u=[1645,1652,1662,1669,1677,1683],d=[1084,1891,1085,1861,1882,1837],A=[1755,1775,1732,1746],h=[2025,2050,2001,2017,2041,2007],p=[1871,1893,1845,1863,1884,1854],C=[1065,20,513,512,21,22,23,24,25,26,27],f=[1328,517,516,518,519,520,521,522,523,524,525],I=[],m=[],v=[],y=[],S=[],b=[],w=[],D=[],T=[],P=[],x=[],E=[],R=[],M=[],F=[];do{for(var L=0,O=a.statistics;L<O.length;L++){var k=O[L];r.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&I.push(k),n.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&m.push(k),i.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&v.push(k),o.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&y.push(k),s.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&S.push(k),l.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&b.push(k),g.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&w.push(k),c.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&D.push(k),u.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&T.push(k),d.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&P.push(k),A.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&x.push(k),h.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&E.push(k),p.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&R.push(k),C.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&M.push(k),f.indexOf(k.regressionTypeID)>=0&&1==k.isPreferred&&F.push(k)}}while(a.length>0);e.floodFreq=I,e.altFloodFreq=m,e.oneDayStats=v,e.sevenDayStats=y,e.fourteenDayStats=S,e.thirtyDayStats=b,e.contrOneDayStats=w,e.contrSevenDayStats=D,e.contrFourteenDayStats=T,e.contrThirtyDayStats=P,e.weightedOneDayStats=x,e.weightedSevenDayStats=E,e.weightedThirtyDayStats=R,e.weightedAEPstats=M,e.regulatedAEPstats=F}).finally(function(){e.getInstantaneousFlow()})},r.prototype.getInstantaneousFlow=function(){var e=this,t=new Date,a=t.getTime();a-=1296e6,t.setTime(a);var r=new Date(t.getTime()-6e4*t.getTimezoneOffset()).toISOString().split("T")[0],n="https://nwis.waterservices.usgs.gov/nwis/iv/?format=json&sites="+this.gage.code+"&parameterCd=00060&startDT="+r;this.instFlowURL=n;var i=new WiM.Services.Helpers.RequestInfo(n,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(i).then(function(t){var a=t.data.value.timeSeries;if(0!==a.length){var r=a[0].values[0].value,n=a[0].sourceInfo.timeZoneInfo;e.gageTimeZone=n}else r=0;if(0!==r){var i=r.filter(function(e){return-999999!==parseFloat(e.value)});e.instFlow=i}e.getDailyFlow()})},r.prototype.getDailyFlow=function(){var e=this,t=new Date,a=t.getTime();a-=1296e6,t.setTime(a);var r,n=new Date(t.getTime()-6e4*t.getTimezoneOffset()).toISOString().split("T")[0],i=new Date,o=i.getUTCFullYear()+"-"+i.getUTCMonth()+"1-"+i.getUTCDate();r=this.instFlow.length>0?"https://nwis.waterservices.usgs.gov/nwis/dv/?format=json&sites="+this.gage.code+"&parameterCd=00060&statCd=00003&startDT=1900-01-01&endDT="+n:"https://nwis.waterservices.usgs.gov/nwis/dv/?format=json&sites="+this.gage.code+"&parameterCd=00060&statCd=00003&startDT=1900-01-01&endDT="+o,this.dailyFlowURL=r;var s=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(s).then(function(t){var a=t.data.value.timeSeries;if(0!==a.length){var r=a[0].values[0].value,n=a[0].sourceInfo.timeZoneInfo;e.gageTimeZone=n}else r=0;if(0!==r){var i=r.filter(function(e){return-999999!==parseFloat(e.value)});e.dailyFlow=i}e.getRatingCurve()})},r.prototype.getRatingCurve=function(){var e=this,t="https://waterdata.usgs.gov/nwisweb/get_ratings?site_no="+this.gage.code+"&file_type=exsa";this.ratingURL=t;var a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.dischargeObj=[],this.Execute(a).then(function(t){var a=t.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e});a.shift().split("\t"),a.shift(),a.forEach(function(t){var a=t.split("\t"),r={x:parseFloat(a[2]),y:parseFloat(a[0])};e.dischargeObj.push(r)})},function(e){}).finally(function(){e.getNWSForecast()})},r.prototype.curveLookup=function(e,t){for(var a,r,n,i,o,s=0;s<t.length;s++){var l=t[s];if(e===l.y){o=l.x;break}if(e<l.y){n=l.x,i=l.y,a=t[s-1].x,o=(e-(r=t[s-1].y))/(i-r)*(n-a)+a;break}}return o},r.prototype.getNWSForecast=function(){var e=this,t=this.gage.code;this.$http.get("./data/gageNumberCrossWalk.json").then(function(a){e.crossWalk=a.data;var r=e.crossWalk[t];if(void 0!==r){var n="https://water.weather.gov/ahps2/hydrograph_to_xml.php?output=xml&gage="+r;e.forecastURL=n;var i=new WiM.Services.Helpers.RequestInfo(n,!0,WiM.Services.Helpers.methodType.GET,"xml");e.Execute(i).then(function(t){var a=(new DOMParser).parseFromString(t.data,"text/xml");if(null===a.querySelector("message")){var r=a.querySelector("sigstages"),n=parseFloat(r.querySelector("action").textContent),i=parseFloat(r.querySelector("flood").textContent),o=parseFloat(r.querySelector("moderate").textContent),s=parseFloat(r.querySelector("major").textContent),l=parseFloat(r.querySelector("record").textContent),g=e.curveLookup(n,e.dischargeObj),c=e.curveLookup(i,e.dischargeObj),u=e.curveLookup(o,e.dischargeObj),d=e.curveLookup(s,e.dischargeObj),A=e.curveLookup(l,e.dischargeObj);e.stages=[{name:"action",x:g,y:n,color:"rgba(255,255,0,0.7)"},{name:"flood",x:c,y:i,color:"rgba(255,153,0,0.7)"},{name:"moderate",x:u,y:o,color:"rgba(255,0,0,0.7)"},{name:"major",x:d,y:s,color:"rgba(204,51,255,0.7)"},{name:"record",x:A,y:l,color:"rgba(102,178,255,0.7)"}]}var h=a.querySelectorAll("forecast");if(void 0!==h[0]){var p=h[0].childNodes,C=[];if(void 0!==e.dailyFlow){var f=e.gageTimeZone.defaultTimeZone.zoneOffset,I=parseFloat(f);p.forEach(function(t){if(void 0!==t.childNodes[0]){var a=new Date(t.childNodes[0].textContent);a.setUTCHours(a.getUTCHours()+I);var r={x:a,y:parseFloat(t.childNodes[2].textContent)};"kcfs"===p[2].childNodes[2].getAttribute("units")&&(r.y*=1e3),C.push(r),e.NWSforecast=C}})}}e.getShadedDailyStats()})}else e.getShadedDailyStats()})},r.prototype.getShadedDailyStats=function(){var e,t=this,a="https://waterservices.usgs.gov/nwis/stat/?format=rdb,1.0&indent=on&sites="+this.gage.code+"&statReportType=daily&statTypeCd=all&parameterCd=00060";if(this.percentileURL=a,void 0!==this.dailyFlow){var r=this.dailyFlow.length-1;e=new Date(this.dailyFlow[r].dateTime)}var n=this.instFlow.length-1;this.instFlow.length>0&&(e=new Date(this.instFlow[n].dateTime)),void 0!==this.NWSforecast&&(e=new Date(this.NWSforecast[0].x)),void 0==this.dailyFlow&&0==this.instFlow.length&&void 0==this.NWSforecast&&(e=new Date);var i=e.getUTCFullYear();this.defaultYear=i;var o=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(o).then(function(e){var a=[],r=[],n=e.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e});if(n.length>0){n.shift().split("\t"),n.shift();do{var o=n.shift().split("\t");r.push(o);var s={date:parseFloat(o[5])>9?new Date(parseFloat(o[5])+"/"+parseFloat(o[6])+"/"+(i-1)):new Date(parseFloat(o[5])+"/"+parseFloat(o[6])+"/"+i),begin_yr:parseFloat(o[7]),end_yr:parseFloat(o[8]),min_va:parseFloat(o[13]),p10_va:parseFloat(o[16]),p25_va:parseFloat(o[18]),p75_va:parseFloat(o[20]),p90_va:parseFloat(o[22]),max_va:parseFloat(o[11])};a.push(s)}while(n.length>0)}t.meanPercent=a,t.rawShaded=r,t.getUSGSMeasured()})},r.prototype.getUSGSMeasured=function(){var e=this,t="https://waterdata.usgs.gov/nwis/measurements?site_no="+this.gage.code+"&agency_cd=USGS&format=rdb_expanded";this.measuredURL=t;var a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.measuredObj=[],this.Execute(a).then(function(t){var a=t.data;if(e.error=a.includes("<title>USGS NwisWeb error message</title>"),0==e.error){var r=t.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e});r.shift().split("\t"),r.shift(),r.forEach(function(t){var a=t.split("\t"),r={dateTime:a[3],timeZone:a[4],quality:a[10],control:a[13],x:parseFloat(a[9]),y:parseFloat(a[8]),qualityColor:e.stageDischargeQualityColor(a[10]),color:e.stageDischargeAgeColor(new Date(a[3])),ageColor:e.stageDischargeAgeColor(new Date(a[3]))};e.measuredObj.push(r)})}},function(e){}).finally(function(){e.formatData(),e.updateChart(),e.getMinYear()})},r.prototype.getMinYear=function(){return Math.min.apply(null,this.measuredObj.map(function(e){return new Date(e.dateTime).getFullYear()}))},r.prototype.updateChart=function(){var e=this,t=$("#chart3").highcharts();if(t){t.series[2].update({data:[]});var a=structuredClone(this.measuredObj).filter(function(t){var a=new Date(t.dateTime),r=a.getMonth()+1,n=a.getFullYear();return r>=e.startMonth&&r<=e.endMonth&&n>=e.startYear&&n<=e.endYear});a.forEach(function(t){t.color="age"==e.USGSMeasuredAgeQualityData?t.ageColor:t.qualityColor}),t.series[2].update({data:a});this.floodStagesData=a}},r.prototype.formatData=function(){var e=this;(this.peakDates&&this.peakDates.forEach(function(t){if(!isNaN(t.peak_va)){var a=new Date(t.peak_dt).toISOString().split("T")[0];e.formattedPeakDates.push({x:new Date(a),y:t.peak_va}),e.formattedDischargePeakDates.push({x:t.peak_va,y:t.peak_stage,date:t.peak_dt})}}),this.estPeakDates&&this.estPeakDates.forEach(function(t){if(!isNaN(t.peak_va)){var a=new Date(t.peak_dt).toISOString().split("T")[0];e.formattedEstPeakDates.push({x:new Date(a),y:t.peak_va})}}),this.meanPercent&&this.meanPercent.forEach(function(t){e.formattedP0to10.push({x:t.date,low:t.min_va,high:t.p10_va}),e.formattedP10to25.push({x:t.date,low:t.p10_va,high:t.p25_va}),e.formattedP25to75.push({x:t.date,low:t.p25_va,high:t.p75_va}),e.formattedP75to90.push({x:t.date,low:t.p75_va,high:t.p90_va}),e.formattedP90to100.push({x:t.date,low:t.p90_va,high:t.max_va})}),this.formattedP0to10.sort(function(e,t){return e.x-t.x}),this.formattedP10to25.sort(function(e,t){return e.x-t.x}),this.formattedP25to75.sort(function(e,t){return e.x-t.x}),this.formattedP75to90.sort(function(e,t){return e.x-t.x}),this.formattedP90to100.sort(function(e,t){return e.x-t.x}),this.dailyFlow)&&(this.dailyFlow.forEach(function(t){if(-999999!==parseFloat(t.value)){var a=new Date(t.dateTime);a.setHours(12,0,0),e.formattedDailyFlow.push({x:a,y:parseFloat(t.value)}),e.dailyDatesOnly.push(new Date(t.dateTime))}}),this.dailyFlow.filter(function(e){if(e.dateTime[5]+e.dateTime[6]!=="02"||e.dateTime[8]+e.dateTime[9]!=="29")return e.dateTime}).forEach(function(t){var a=new Date(t.dateTime),r=new Date(t.dateTime).getUTCFullYear();var n=function(e){return(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())-Date.UTC(e.getFullYear(),0,0))/24/60/60/1e3}(a);-999999!==parseInt(t.value)&&(e.dailyValuesOnly.push(parseInt(t.value)),0==function(e){return e%400==0||e%100!=0&&e%4==0}(r)&&n>59&&(n+=1),n>274&&(r+=1),n<275&&(n+=366),n>425&&(n-=1),-999999!==parseInt(t.value)&&e.formattedDailyHeat.push({x:n,y:r,value:parseInt(t.value),length:1}))}));this.instFlow.length>0&&this.instFlow.forEach(function(t){if(-999999!==parseFloat(t.value)&&0!==e.formattedDailyFlow.length){var a=e.formattedDailyFlow.length-1,r=e.formattedDailyFlow[a].x,n=t.dateTime.split(".")[0],i=new Date(n);i>r&&e.formattedInstFlow.push({x:i,y:parseFloat(t.value)})}});var t=this.formattedDailyFlow.length-1;this.formattedDailyFlow.length>0&&(function(e,t){for(var a=[],r=0;r<e.length;r++)-1===t.indexOf(e[r])&&a.push(new Date(e[r]));return a}(function(e,t,a){void 0===a&&(a=1);for(var r=[],n=new Date(e);n<=new Date(t);)r.push(new Date(n)),n.setUTCDate(n.getUTCDate()+a);return r}(this.formattedDailyFlow[0].x,this.formattedDailyFlow[t].x).map(function(e){return e.getUTCMonth()+1+"/"+e.getUTCDate()+"/"+e.getUTCFullYear()}),this.dailyDatesOnly.map(function(e){return e.getUTCMonth()+1+"/"+e.getUTCDate()+"/"+e.getUTCFullYear()})).forEach(function(t){return e.formattedDailyFlow.push({x:t,y:null})}),this.formattedDailyFlow.sort(function(e,t){return e.x-t.x}));this.peakDates&&this.peakDates.forEach(function(t){var a=new Date(t.peak_dt);a.getUTCMonth()>8?a.setUTCFullYear(e.defaultYear-1):a.setUTCFullYear(e.defaultYear);var r=new Date(a.toUTCString()),n=new Date(t.peak_dt),i=n.getUTCFullYear();n.getUTCMonth()>8&&(i+=1),isNaN(t.peak_va)||e.formattedPeakDatesOnYear.push({x:r,y:t.peak_va,realDate:n,waterYear:i})}),this.estPeakDates&&this.estPeakDates.forEach(function(t){var a=new Date(t.peak_dt);a.getUTCMonth()>8?a.setUTCFullYear(e.defaultYear-1):a.setUTCFullYear(e.defaultYear);var r=new Date(a.toUTCString());e.formattedEstPeakDatesOnYear.push({x:r,y:t.peak_va,realDate:new Date(t.peak_dt)})});var a=new Date("January 1, 3000"),r=new Date("January 1, 1800");if(this.formattedPeakDates.length>0){this.formattedPeakDates[0].x<a&&(a=this.formattedPeakDates[0].x);var n=this.formattedPeakDates.length-1;this.formattedPeakDates[n].x>r&&(r=this.formattedPeakDates[n].x)}if(this.formattedDailyFlow.length>0){this.formattedDailyFlow[0].x<a&&(a=this.formattedDailyFlow[0].x);var i=this.formattedDailyFlow.length-1;this.formattedDailyFlow[i].x>r&&(r=this.formattedDailyFlow[i].x)}if(this.formattedEstPeakDates.length>0){this.formattedEstPeakDates[0].x<a&&(a=this.formattedEstPeakDates[0].x);var o=this.formattedEstPeakDates.length-1;this.formattedEstPeakDates[o].x>r&&(r=this.formattedEstPeakDates[o].x)}if(this.formattedPeakDatesOnYear.length>0){this.formattedPeakDatesOnYear.sort(function(e,t){return e.x-t.x}),this.formattedPeakDatesOnYear[0].x<a&&(a=this.formattedPeakDatesOnYear[0].x);var s=this.formattedPeakDatesOnYear.length-1;this.formattedPeakDatesOnYear[s].x>r&&(r=this.formattedPeakDatesOnYear[s].x)}this.startAndEnd.push(a,r);for(var l=this.defaultYear+1;l>=this.startAndEnd[0].getUTCFullYear();)this.allYears.push(l-=1);var g=new Date("9/30/"+this.defaultYear);if(this.oneDayStats){this.formattedOneDayStats=[];var c={82:"#e6194B",83:"#f58231",84:"#ffe119",85:"#bfef45",596:"#3cb44b",820:"#42d4f4",1737:"#911eb4"};this.oneDayStats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.replaceAll("_"," ");e.formattedOneDayStats.push({name:n,tooltip:{headerFormat:"<b>1-Day Low Flow Statistics",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:c[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x)return n}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"oneDay",number:10,marker:{symbol:"circle",radius:1}})})}if(this.sevenDayStats){this.formattedSevenDayStats=[];var u={90:"#9A6324",91:"#e6194B",92:"#f58231",93:"#ffe119",589:"#bfef45",822:"#3cb44b",1165:"#42d4f4",1166:"#911eb4",1167:"#dcbeff"};this.sevenDayStats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.replaceAll("_"," ");e.formattedSevenDayStats.push({name:n,tooltip:{headerFormat:"<b>7-Day Low Flow Statistics",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:u[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x)return n}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"sevenDay",number:11,marker:{symbol:"circle",radius:.1}})})}if(this.fourteenDayStats){this.formattedFourteenDayStats=[];var d={94:"#e6194B",95:"#f58231",96:"#ffe119",97:"#3cb44b",828:"#42d4f4",829:"#911eb4"};this.fourteenDayStats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.replaceAll("_"," ");e.formattedFourteenDayStats.push({name:n,tooltip:{headerFormat:"<b>14-Day Low Flow Statistics",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:d[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x)return n}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"fourteenDay",number:12,marker:{symbol:"circle",radius:.1}})})}if(this.thirtyDayStats){this.formattedThirtyDayStats=[];var A={98:"#9A6324",99:"#e6194B",100:"#f58231",101:"#ffe119",657:"#bfef45",830:"#3cb44b",1174:"#42d4f4",1175:"#911eb4",1176:"#dcbeff"};this.thirtyDayStats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.replaceAll("_"," ");e.formattedThirtyDayStats.push({name:n,tooltip:{headerFormat:"<b>30-Day Low Flow Statistics",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:A[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x)return n}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"thirtyDay",number:13,marker:{symbol:"circle",radius:.1}})})}if(this.contrOneDayStats){this.formattedContrOneDayStats=[];var h={1081:"#ffe119",1712:"#911eb4",1744:"#3cb44b",1753:"#e6194B",1766:"#42d4f4",1773:"#f58231"};this.contrOneDayStats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.replaceAll("_"," ");e.formattedContrOneDayStats.push({name:n,tooltip:{headerFormat:"<b>Controlled 1-Day Low Flow Statistics",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:h[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x)return n}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"contrOneDay",number:14,marker:{symbol:"circle",radius:.1}})})}if(this.contrSevenDayStats){this.formattedContrSevenDayStats=[];var p={1082:"#e6194B",1083:"#ffe119",1992:"#911eb4",2015:"#3cb44b",2039:"#42d4f4",2048:"#f58231"};this.contrSevenDayStats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.replaceAll("_"," ");e.formattedContrSevenDayStats.push({name:n,tooltip:{headerFormat:"<b>Controlled 7-Day Low Flow Statistics",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:p[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x)return n}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"contrSevenDay",number:16,marker:{symbol:"circle",radius:.1}})})}if(this.contrFourteenDayStats){this.formattedContrFourteenDayStats=[];var C={1645:"#911eb4",1652:"#ffe119",1662:"#3cb44b",1669:"#e6194B",1677:"#42d4f4",1683:"#f58231"};this.contrFourteenDayStats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.replaceAll("_"," ");e.formattedContrFourteenDayStats.push({name:n,tooltip:{headerFormat:"<b>Controlled 14-Day Low Flow Statistics",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:C[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x)return n}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"contrFourteenDay",number:17,marker:{symbol:"circle",radius:.1}})})}if(this.contrThirtyDayStats){this.formattedContrThirtyDayStats=[];var f={1084:"#e6194B",1085:"#ffe119",1837:"#911eb4",1861:"#3cb44b",1882:"#42d4f4",1891:"#f58231"};this.contrThirtyDayStats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.replaceAll("_"," ");e.formattedContrThirtyDayStats.push({name:n,tooltip:{headerFormat:"<b>Controlled 30-Day Low Flow Statistics",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:f[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x.getUTCFullYear()==g.getUTCFullYear())return n}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"contrThirtyDay",number:18,marker:{symbol:"circle",radius:.1}})})}if(this.weightedOneDayStats){this.formattedWeightedOneDayStats=[];var I={1755:"#e6194B",1775:"#ffe119",1732:"#3cb44b",1746:"#42d4f4"};this.weightedOneDayStats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.replaceAll("_"," ");e.formattedWeightedOneDayStats.push({name:n,tooltip:{headerFormat:"<b>Weighted 1-Day Low Flow Statistics",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:I[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x.getUTCFullYear()==g.getUTCFullYear())return n}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"weightedOneDay",number:19,marker:{symbol:"circle",radius:.1}})})}if(this.weightedSevenDayStats){this.formattedWeightedSevenDayStats=[];var m={2025:"#e6194B",2050:"#f58231",2001:"#ffe119",2017:"#3cb44b",2041:"#42d4f4",2007:"#911eb4"};this.weightedSevenDayStats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.replaceAll("_"," ");e.formattedWeightedSevenDayStats.push({name:n,tooltip:{headerFormat:"<b>Weighted 7-Day Low Flow Statistics",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:m[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x.getUTCFullYear()==g.getUTCFullYear())return n}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"weightedSevenDay",number:20,marker:{symbol:"circle",radius:.1}})})}if(this.weightedThirtyDayStats){this.formattedWeightedThirtyDayStats=[];var v={1871:"#e6194B",1893:"#f58231",1845:"#ffe119",1863:"#3cb44b",1884:"#42d4f4",1854:"#911eb4"};this.weightedThirtyDayStats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.replaceAll("_"," ");e.formattedWeightedThirtyDayStats.push({name:n,tooltip:{headerFormat:"<b>Weighted 30-Day Low Flow Statistics",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:v[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x.getUTCFullYear()==g.getUTCFullYear())return n}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"weightedThirtyDay",number:21,marker:{symbol:"circle",radius:.1}})})}if(this.altFloodFreq){this.formattedAltFloodFreq=[];var y={2311:"#f58231",2312:"#3cb44b",2313:"#e6194B",2314:"#bfef45",2315:"#911eb4",2316:"#9A6324",2317:"#ffe119",2318:"#42d4f4"};this.altFloodFreq.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.substring(0,t.regressionType.name.length-18);e.formattedAltFloodFreq.push({name:t.regressionType.name,tooltip:{headerFormat:"<b>Alternative Annual Exceedance Probability (AEP)",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>AEP: <b>"+n+"%</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:y[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x.getUTCFullYear()==g.getUTCFullYear())return n+"% AEP"}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"altAEP",number:15,marker:{symbol:"circle",radius:.1}})})}if(this.weightedAEPstats){this.formattedWeightedAEP=[];var S={27:"#9A6324",26:"#e6194B",25:"#f58231",24:"#ffe119",23:"#bfef45",22:"#3cb44b",21:"#42d4f4",512:"#4363d8",513:"#911eb4",20:"#dcbeff",1065:"#fabed4"};this.weightedAEPstats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.substring(0,t.regressionType.name.length-18);e.formattedWeightedAEP.push({name:t.regressionType.name,tooltip:{headerFormat:"<b>Weighted Annual Exceedance Probability (AEP)",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>AEP: <b>"+n+"%</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:S[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x.getUTCFullYear()==g.getUTCFullYear())return n+"% AEP"}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"weightedAEP",number:22,marker:{symbol:"circle",radius:.1}})})}if(this.regulatedAEPstats){this.formattedRegulatedAEP=[];var b={525:"#9A6324",524:"#e6194B",523:"#f58231",522:"#ffe119",521:"#bfef45",520:"#3cb44b",519:"#42d4f4",518:"#4363d8",516:"#911eb4",517:"#dcbeff",1328:"#fabed4"};this.regulatedAEPstats.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.substring(0,t.regressionType.name.length-18);e.formattedRegulatedAEP.push({name:t.regressionType.name,tooltip:{headerFormat:"<b>Regulated Annual Exceedance Probability (AEP)",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>AEP: <b>"+n+"%</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:b[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x.getUTCFullYear()==g.getUTCFullYear())return n+"% AEP"}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"regulatedAEP",number:23,marker:{symbol:"circle",radius:.1}})})}if(this.formattedDailyHeat.length>0){for(var w=this.formattedDailyHeat.filter(function(e){return null!=e.value}),D=w[0].y,T=0,P=0,x=[],E=0;E<w.length;E++){var R=w[E],M=R.y;D==M?(T+=R.value,P+=R.length):(x.push({x:650,y:M-1,value:T/P,sum:T,length:P},{x:651,y:M-1,value:T/P,sum:T,length:P},{x:652,y:M-1,value:T/P,sum:T,length:P},{x:653,y:M-1,value:T/P,sum:T,length:P},{x:654,y:M-1,value:T/P,sum:T,length:P},{x:655,y:M-1,value:T/P,sum:T,length:P},{x:656,y:M-1,value:T/P,sum:T,length:P},{x:657,y:M-1,value:T/P,sum:T,length:P},{x:658,y:M-1,value:T/P,sum:T,length:P}),T=R.value,P=R.length),E==w.length-1&&x.push({x:650,y:M,value:T/P,sum:T,length:P},{x:651,y:M,value:T/P,sum:T,length:P},{x:652,y:M,value:T/P,sum:T,length:P},{x:653,y:M,value:T/P,sum:T,length:P},{x:654,y:M,value:T/P,sum:T,length:P},{x:655,y:M,value:T/P,sum:T,length:P},{x:656,y:M,value:T/P,sum:T,length:P},{x:657,y:M,value:T/P,sum:T,length:P},{x:658,y:M,value:T/P,sum:T,length:P}),D=M}var F=this.formattedDailyHeat.concat(x);this.formattedDailyPlusAvg.push(F)}if(this.floodFreq){this.formattedFloodFreq=[];var L={9:"#9A6324",852:"#800000",8:"#e6194B",818:"#ffd8b1",7:"#f58231",6:"#ffe119",5:"#bfef45",4:"#3cb44b",3:"#42d4f4",1:"#4363d8",501:"#000075",2:"#911eb4",500:"#dcbeff",851:"#fabed4",1438:"#469990"};this.floodFreq.forEach(function(t){var r=t.regressionTypeID,n=t.regressionType.name.substring(0,t.regressionType.name.length-18);e.formattedFloodFreq.push({name:t.regressionType.name,tooltip:{headerFormat:"<b>Annual Exceedance Probability (AEP)",pointFormatter:function(){if(null!==this.formattedPeakDates)return"</b><br>AEP: <b>"+n+"%</b><br>Value: <b>"+t.value+" ft/s<br>"}},turboThreshold:0,type:"line",color:L[r],dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x.getUTCFullYear()==g.getUTCFullYear())return n+"% AEP"}},data:[{x:a,y:t.value},{x:g,y:t.value}],linkedTo:"dummyAEP",number:9,marker:{symbol:"circle",radius:.1}})}),this.allFloodFreqStats.push(this.formattedFloodFreq,this.formattedAltFloodFreq,this.formattedOneDayStats,this.formattedSevenDayStats,this.formattedFourteenDayStats,this.formattedThirtyDayStats,this.formattedContrOneDayStats,this.formattedContrSevenDayStats,this.formattedContrFourteenDayStats,this.formattedContrThirtyDayStats,this.formattedWeightedOneDayStats,this.formattedWeightedSevenDayStats,this.formattedWeightedThirtyDayStats,this.formattedWeightedAEP,this.formattedRegulatedAEP),this.allFloodFreqStats=this.allFloodFreqStats.filter(function(e){return e.length>0}),this.allFloodFreqStats.forEach(function(t,a){e.allFloodFreqStats[a]={name:t[0].tooltip.headerFormat.replace("<b>",""),statistics:t,seriesIndex:t[0].number}}),this.selectedFloodFreqStats=this.allFloodFreqStats[0],this.selectedYear=this.allYears[0],this.createAnnualFlowPlot(),this.createDailyRasterPlot(),this.createDischargePlot()}},r.prototype.createAnnualFlowPlot=function(){var e,t=this;this.formattedInstFlow.length>0&&("EST"!==(e=this.gageTimeZone.defaultTimeZone.zoneAbbreviation)&&"EDT"!==e&&"ET"!==e||"America/New_York","CST"!==e&&"CDT"!==e&&"CT"!==e||"America/Chicago","MST"!==e&&"MDT"!==e&&"MT"!==e||"America/Denver","PST"!==e&&"PDT"!==e&&"PT"!==e||"America/Los_Angeles"),void 0===e&&(e="");var a,r=this,n=this.allYears[0]-1;a=this.formattedPeakDatesOnYear.length>0?new Date("10/1/"+n).getTime():this.startAndEnd[0].getTime();var i=new Date("9/30/"+this.allYears[0]).getTime();this.chartConfig={chart:{height:550,width:800,zooming:{type:"xy"},panning:!0,panKey:"shift",events:{load:function(){}}},title:{text:"Annual Peak Streamflow: "+this.gage.code,align:"center"},time:{useUTC:!1,timezone:"America/New_York"},legend:{useHTML:!0,symbolPadding:10,symbolWidth:null,symbolHeight:null,squareSymbol:null,labelFormatter:function(){return this.name}},subtitle:{text:"Click and drag to zoom in. Hold down shift key to pan.<br>AEP = Annual Exceedance Probability",align:"center"},rangeSelector:{enabled:!1,inputPosition:{align:"left",x:0,y:0},buttons:[]},navigator:{enabled:!0},exporting:{buttons:{contextButton:{menuItems:["viewFullscreen"]}}},xAxis:{type:"datetime",events:{afterSetExtremes:function(){r.updateShadedStats(),r.updatePeaksAfterZoom(),r.updateFloodStats()}},gridLineWidth:0,min:a,max:i,title:{text:"Date "},custom:{allowNegativeLog:!0}},yAxis:{title:{text:"Discharge (Q), in ft/s"},gridLineWidth:1,custom:{allowNegativeLog:!0},plotLines:[{value:null,color:null,width:null,zIndex:null,label:{text:null},id:"plotlines"}]},series:[{name:"Annual Peak Streamflow",showInNavigator:!1,tooltip:{headerFormat:"<b>Annual Peak Streamflow</b><br> Plotted on Water Year: <b>"+this.selectedYear,pointFormatter:function(){if(null!==this.formattedPeakDatesOnYear){var e=this.realDate.getUTCFullYear();this.realDate.getUTCMonth()>8&&(e+=1);var t=this.realDate.getUTCDate(),a=this.realDate.getUTCFullYear(),r=this.realDate.getUTCMonth();return"</b><br>Date: <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}},turboThreshold:0,type:"scatter",color:"black",fillOpacity:null,lineWidth:null,data:this.formattedPeakDatesOnYear,linkedTo:null,visible:!0,id:null,zIndex:5,marker:{symbol:"circle",radius:3},showInLegend:this.formattedPeakDates.length>0},{name:"Annual Peak Streamflow (Date Estimated)",showInNavigator:!1,tooltip:{headerFormat:"<b>Annual Peak Streamflow</b><br> Plotted on Water Year: <b>"+this.selectedYear,pointFormatter:function(){if(null!==this.formattedEstPeakDatesOnYear){var e=this.realDate.getUTCFullYear();this.realDate.getUTCMonth()>8&&(e+=1);var t=this.realDate.getUTCDate(),a=this.realDate.getUTCFullYear(),r=this.realDate.getUTCMonth();return"</b><br>Date (estimated): <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}},turboThreshold:0,type:"scatter",color:"red",fillOpacity:null,lineWidth:null,data:this.formattedEstPeakDatesOnYear,linkedTo:null,visible:!0,id:null,zIndex:5,marker:{symbol:"square",radius:3},showInLegend:this.formattedEstPeakDates.length>0},{name:"Daily Percentile Streamflow",showInNavigator:!1,tooltip:{headerFormat:"<b>90-100% Streamflow</b>",pointFormatter:function(){var e=this.x.getUTCDate(),t=this.x.getUTCFullYear(),a=this.x.getUTCMonth();return"<br>Date: <b>"+((a+=1)+"/"+e+"/"+t)+"</b><br>90th percentile: <b>"+this.low+" ft/s</b><br>Max: <b>"+this.high+" ft/s"}},turboThreshold:0,type:"arearange",color:"#0000FF",fillOpacity:.2,lineWidth:0,data:this.formattedP90to100,linkedTo:null,visible:!0,id:null,zIndex:1,marker:{symbol:null,radius:null},showInLegend:this.formattedP90to100.length>0},{name:"P 0-10%",showInNavigator:!1,tooltip:{headerFormat:"<b>0-10% Streamflow</b>",pointFormatter:function(){var e=this.x.getUTCDate(),t=this.x.getUTCFullYear(),a=this.x.getUTCMonth();return"<br>Date: <b>"+((a+=1)+"/"+e+"/"+t)+"</b><br>Min: <b>"+this.low+" ft/s</b><br>10th percentile: <b>"+this.high+" ft/s"}},turboThreshold:0,type:"arearange",color:"#8B0000",fillOpacity:.2,lineWidth:0,data:this.formattedP0to10,linkedTo:":previous",visible:!0,id:null,zIndex:1,marker:{symbol:null,radius:null},showInLegend:!1},{name:"p 10-25 %",showInNavigator:!1,tooltip:{headerFormat:"<b>10-25% Streamflow</b>",pointFormatter:function(){var e=this.x.getUTCDate(),t=this.x.getUTCFullYear(),a=this.x.getUTCMonth();return"<br>Date: <b>"+((a+=1)+"/"+e+"/"+t)+"</b><br>10th percentile: <b>"+this.low+" ft/s</b><br>25th percentile: <b>"+this.high+" ft/s"}},turboThreshold:0,type:"arearange",color:"#B8860B",fillOpacity:.2,lineWidth:0,data:this.formattedP10to25,linkedTo:":previous",visible:!0,id:null,zIndex:1,marker:{symbol:null,radius:null},showInLegend:!1},{name:"p 25-75 %",showInNavigator:!1,tooltip:{headerFormat:"<b>25-75% Streamflow</b>",pointFormatter:function(){var e=this.x.getUTCDate(),t=this.x.getUTCFullYear(),a=this.x.getUTCMonth();return"<br>Date: <b>"+((a+=1)+"/"+e+"/"+t)+"</b><br>25th percentile: <b>"+this.low+" ft/s</b><br>75th percentile: <b>"+this.high+" ft/s"}},turboThreshold:0,type:"arearange",color:"#006400",fillOpacity:.2,lineWidth:0,data:this.formattedP25to75,linkedTo:":previous",visible:!0,id:null,zIndex:1,marker:{symbol:null,radius:null},showInLegend:!1},{name:"p 75-90 %",showInNavigator:!1,tooltip:{headerFormat:"<b>75-90% Streamflow</b>",pointFormatter:function(){var e=this.x.getUTCDate(),t=this.x.getUTCFullYear(),a=this.x.getUTCMonth();return"<br>Date: <b>"+((a+=1)+"/"+e+"/"+t)+"</b><br>75th percentile: <b>"+this.low+" ft/s</b><br>90th percentile: <b>"+this.high+" ft/s"}},turboThreshold:0,type:"arearange",color:"#008B8B",fillOpacity:.2,lineWidth:0,data:this.formattedP75to90,linkedTo:":previous",visible:!0,id:null,zIndex:1,marker:{symbol:null,radius:null},showInLegend:!1},{name:"Mean Daily Streamflow",showInNavigator:!0,tooltip:{headerFormat:"<b>Mean Daily Streamflow</b>",pointFormatter:function(){if(null!==this.formattedDailyFlow){var e=this.x.getUTCDate(),t=this.x.getUTCFullYear(),a=this.x.getUTCMonth();return"<br>Date: <b>"+((a+=1)+"/"+e+"/"+t)+"</b><br>Value: <b>"+this.y+" ft/s"}}},turboThreshold:0,type:"line",color:"#1434A4",fillOpacity:null,lineWidth:1.5,data:this.formattedDailyFlow,linkedTo:null,visible:!0,id:null,zIndex:4,marker:{symbol:"circle",radius:3},showInLegend:this.formattedDailyFlow.length>0},{name:"NWS Forecast",showInNavigator:!1,tooltip:{headerFormat:"<b>NWS Forecast</b>",pointFormatter:function(){if(null!==this.formattedPeakDates){var t=this.x.getHours();t<10&&(t="0"+t);var a=this.x.getMinutes();a<10&&(a="0"+a);var r=this.x.getDate(),n=this.x.getFullYear(),i=this.x.getMonth();return"<br>Date: <b>"+((i+=1)+"/"+r+"/"+n)+" ("+t+":"+a+" "+e+")</b><br>Value: <b>"+this.y+" ft/s"}}},turboThreshold:0,type:"line",color:"purple",fillOpacity:null,lineWidth:1.5,data:this.NWSforecast,linkedTo:null,visible:!0,id:null,zIndex:3,marker:{symbol:"",radius:3},showInLegend:void 0!==this.NWSforecast},{name:"Annual Exceedance Probability (AEP)",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!0,id:"dummyAEP",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"1-Day Low Flow Statistics",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"oneDay",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"7-Day Low Flow Statistics",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"sevenDay",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"14-Day Low Flow Statistics",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"fourteenDay",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"30-Day Low Flow Statistics",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"thirtyDay",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"Controlled 1-Day Low Flow Statistics",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"contrOneDay",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"Alternative Annual Exceedance Probability (AEP)",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:0===this.formattedFloodFreq.length,id:"altAEP",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"Controlled 7-Day Low Flow Statistics",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"contrSevenDay",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"Controlled 14-Day Low Flow Statistics",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"contrFourteenDay",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"Controlled 30-Day Low Flow Statistics",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"contrThirtyDay",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"Weighted 1-Day Low Flow Statistics",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"weightedOneDay",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"Weighted 7-Day Low Flow Statistics",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"weightedSevenDay",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"Weighted 30-Day Low Flow Statistics",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"weightedThirtyDay",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"Weighted Annual Exceedance Probability (AEP)",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"weightedAEP",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"Regulated Annual Exceedance Probability (AEP)",showInNavigator:!1,tooltip:{headerFormat:null,pointFormatter:function(){}},turboThreshold:0,type:null,color:"black",fillOpacity:null,lineWidth:null,data:null,linkedTo:null,visible:!1,id:"regulatedAEP",zIndex:2,marker:{symbol:"line",radius:.1},showInLegend:!1},{name:"Instantaneous Streamflow",showInNavigator:!0,tooltip:{headerFormat:"<b>Instantaneous Streamflow</b>",pointFormatter:function(){if(null!==this.formattedInstFlow){var t=this.x.getHours();t<10&&(t="0"+t);var a=this.x.getMinutes();a<10&&(a="0"+a);var r=this.x.getUTCDate(),n=this.x.getUTCFullYear(),i=this.x.getUTCMonth();return"<br>Date: <b>"+((i+=1)+"/"+r+"/"+n)+" ("+t+":"+a+" "+e+")</b><br>Value: <b>"+this.y+" ft/s"}}},turboThreshold:0,type:"line",color:"#008000",fillOpacity:null,lineWidth:1.5,data:this.formattedInstFlow,linkedTo:null,visible:!0,id:null,zIndex:4,marker:{symbol:"circle",radius:3},showInLegend:this.formattedInstFlow.length>0}]},this.formattedFloodFreq.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedOneDayStats.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedSevenDayStats.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedFourteenDayStats.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedThirtyDayStats.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedContrOneDayStats.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedAltFloodFreq.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedContrSevenDayStats.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedContrFourteenDayStats.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedContrThirtyDayStats.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedWeightedOneDayStats.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedWeightedSevenDayStats.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedWeightedThirtyDayStats.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedWeightedAEP.forEach(function(e){t.chartConfig.series.push(e)}),this.formattedRegulatedAEP.forEach(function(e){t.chartConfig.series.push(e)})},r.prototype.chooseFloodStats=function(){var e=this,t=$("#chart1").highcharts();t.showLoading("Loading..."),setTimeout(function(){var a=t.xAxis[0].getExtremes(),r=new Date(a.min),n=new Date(a.max),i={min:new Date(r.getTime()-6e4*r.getTimezoneOffset()).toISOString().split("T")[0],max:new Date(n.getTime()-6e4*r.getTimezoneOffset()).toISOString().split("T")[0]},o=t.series[e.selectedFloodFreqStats.seriesIndex];e.selectedFloodFreqStats.name==e.selectedFloodFreqStats.name&&(e.allFloodFreqStats.forEach(function(e){var a=e.seriesIndex;t.series[a].hide(),t.series[a].update({data:[{x:new Date(i.min),y:5e3},{x:new Date(i.max),y:5e3}]})}),o.show()),e.updateFloodStats(),t.hideLoading()},100)},r.prototype.choosePeakYear=function(){var e=this,t=$("#chart1").highcharts();t.showLoading("Loading..."),setTimeout(function(){var a=e.selectedYear-1,r=new Date("10/1/"+a).getTime(),n=new Date("9/30/"+e.selectedYear).getTime(),i=[],o=[];e.selectedYear==e.selectedYear&&(e.peakDates&&e.peakDates.forEach(function(t){var r=new Date(t.peak_dt);r.getUTCMonth()>8?r.setUTCFullYear(a):r.setUTCFullYear(e.selectedYear);var n=new Date(r.toUTCString());isNaN(t.peak_va)||i.push({x:n,y:t.peak_va,realDate:new Date(t.peak_dt)})}),e.estPeakDates&&e.estPeakDates.forEach(function(t){var r=new Date(t.peak_dt);r.getUTCMonth()>8?r.setUTCFullYear(a):r.setUTCFullYear(e.selectedYear);var n=new Date(r.toUTCString());o.push({x:n,y:t.peak_va,realDate:new Date(t.peak_dt)})}),i.sort(function(e,t){return e.x-t.x}),o.sort(function(e,t){return e.x-t.x}),t.series[0].update({data:i}),t.series[1].update({data:o}),t.yAxis[0].setExtremes(),t.xAxis[0].setExtremes(r,n),t.series[0].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b><br> Plotted on Water Year: <b>"+e.selectedYear,pointFormatter:function(){if(null!==this.formattedPeakDatesOnYear){var e=this.realDate.getUTCFullYear();this.realDate.getUTCMonth()>8&&(e+=1);var t=this.realDate.getUTCDate(),a=this.realDate.getUTCFullYear(),r=this.realDate.getUTCMonth();return"</b><br>Date: <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}}),t.series[1].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b><br> Plotted on Water Year: <b>"+e.selectedYear,pointFormatter:function(){if(null!==this.formattedEstPeakDatesOnYear){var e=this.realDate.getUTCFullYear();this.realDate.getUTCMonth()>8&&(e+=1);var t=this.realDate.getUTCDate(),a=this.realDate.getUTCFullYear(),r=this.realDate.getUTCMonth();return"</b><br>Date (estimated): <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}})),t.hideLoading()},100)},r.prototype.stageDischargeAgeColor=function(e){var t=((new Date).getTime()-new Date(e).getTime())/864e5;return t<=31?"red":t<=365?"orange":t<=730?"#0000cdcc":"#0000cd4d"},r.prototype.stageDischargeQualityColor=function(e){return"Good"===e?"#2ED017":"Fair"===e?"#E7F317":"#FFA200"},r.prototype.createDischargePlot=function(){var e=this;this.startMonth=1,this.endMonth=12,this.monthSliderOptions={floor:1,ceil:12,noSwitching:!0,showTicks:!1,draggableRange:!0,onChange:function(){e.updateChart()}};var t=this.getMinYear();this.startYear=t,this.endYear=(new Date).getFullYear(),this.yearSliderOptions={floor:this.startYear,ceil:this.endYear,draggableRange:!0,noSwitching:!0,showTicks:!1,onChange:function(){e.updateChart()}};var a=Math.max.apply(Math,this.measuredObj.filter(function(e){return"number"==typeof e.y&&!isNaN(e.y)}).map(function(e){return e.y})),r=Math.min.apply(Math,this.measuredObj.filter(function(e){return"number"==typeof e.y&&!isNaN(e.y)}).map(function(e){return e.y})),n=this;this.dischargeChartConfig={chart:{height:550,width:800,zooming:{type:"xy"},events:{load:function(){this.series.forEach(function(e){e.options.id&&e.options.id.startsWith("floodStageLine")&&e.options.events.show.call(e)})}}},title:{text:"Stage vs. Discharge: "+this.gage.code,align:"center"},subtitle:{text:"Click and drag in the plot area to zoom in",align:"center"},xAxis:{type:null,title:{text:"River Discharge (cfs)"},custom:{allowNegativeLog:!1},crosshair:{color:"red",dashStyle:"Solid"}},yAxis:{title:{text:"River Stage (ft)"},custom:{allowNegativeLog:!1},crosshair:{color:"red",dashStyle:"Solid"},tickPositioner:function(){if(!n.logScaleDischarge){for(var e=[],t=Math.max(this.min,r),i=Math.min(this.max,a),o=Math.floor(t)>0?Math.floor(t)-1:1,s=i+2,l=s-o>18?2:1;o-l<=s;o+=l)e.push(o);return e}}},series:[{name:"USGS Rating Curve",showInNavigator:!1,tooltip:{headerFormat:"<b>USGS Rating Curve</b>",pointFormatter:function(){if(null!==this.dischargeObj){var e=this.x;return"<br>Gage Height: <b>"+this.y+" ft</b><br>Discharge: <b>"+e+" cfs"}}},turboThreshold:0,type:"spline",color:"black ",data:this.dischargeObj,marker:{symbol:"square",radius:2.5},showInLegend:this.dischargeObj.length>5},{name:"Annual Peaks",showInNavigator:!1,tooltip:{headerFormat:"<b>Annual Peaks</b>",pointFormatter:function(){if(null!==this.formattedPeakDates){var e=this.getUTCDate,t=this.getUTCFullYear,a=this.getUTCMonth,r=(a+=1,this.x),n=this.y;return"<br>Date: <b>"+this.date+"</b></br>Peak: <b>"+r+" cfs</b></br>at stage <b>"+n+" ft</b></br>"}}},turboThreshold:0,type:"scatter",color:"black",data:this.formattedDischargePeakDates,marker:{symbol:"circle",radius:3},showInLegend:this.formattedDischargePeakDates.length>0,dataLabels:{enabled:!0,formatter:function(){return this.point.options.date.substring(0,4)},y:-3,style:{fontSize:"9px"},allowOverlap:!1}},{name:"USGS Measured",showInNavigator:!1,tooltip:{headerFormat:"<b>USGS Measured Discharge</b>",pointFormatter:function(){if(null!==this.measuredObj){var e=this.dateTime,t=this.timeZone,a=this.quality,r=this.control,n=this.x;return"<br> Date: <b>"+e+" "+t+"</b></br>Gage Height: <b>"+this.y+" ft</b></br>Discharge: <b>"+n+" cfs</b></br>Quality: <b>"+a+"</b></br>Control: <b>"+r+"</b></br>"}}},turboThreshold:0,type:"scatter",color:null,data:this.measuredObj,marker:{symbol:"diamond",radius:3},showInLegend:0==this.error}]},this.formattedStages=[],this.stages&&this.stages.forEach(function(t,a){if(void 0!=t.y){var r=t.name.charAt(0).toUpperCase()+t.name.slice(1),n=e.curveLookup(t.y,e.dischargeObj),i=void 0;i=void 0!==n?[[.1,t.y],[n,t.y],[n,1]]:[[.1,t.y],[e.dischargeObj[e.dischargeObj.length-1].x,t.y]],e.formattedStages.push({data:i,marker:{enabled:!1},lineWidth:2,linkedTo:0==a?null:":previous",showInLegend:0==a,name:"Flood Stages",events:{hide:function(){this.chart.yAxis[0].removePlotLine("floodStageLine"+t.name+"yPlotLine"),this.chart.xAxis[0].removePlotLine("floodStageLine"+t.name+"xPlotLine")},show:function(){this.chart.yAxis[0].removePlotLine("floodStageLine"+t.name+"yPlotLine"),this.chart.xAxis[0].removePlotLine("floodStageLine"+t.name+"xPlotLine"),this.chart.yAxis[0].addPlotLine({color:"black",width:0,zIndex:6,id:"floodStageLine"+t.name+"yPlotLine",value:t.y,label:{text:r+": "+t.y+" ft",textAlign:"left",x:12,y:-4,style:{fontSize:"9px"},zIndex:9999999}}),this.chart.xAxis[0].addPlotLine({color:"black",width:0,zIndex:6,id:"floodStageLine"+t.name+"xPlotLine",value:Math.round(t.x),label:{text:r+": "+Math.round(t.x)+" cfs",verticalAlign:"bottom",y:-110,x:2,style:{fontSize:"9px"},zIndex:9999999}})}},id:"floodStageLine"+t.name,color:t.color})}}),this.formattedStages.forEach(function(t){e.dischargeChartConfig.series.push(t)})},r.prototype.createDailyRasterPlot=function(){if(this.dailyValuesOnly.length>0)var e=this.dailyValuesOnly.sort(function(e,t){return e-t}),t=e[Math.floor(.05*e.length)],a=e[Math.floor(.95*e.length)];function r(e){return e%400==0||e%100!=0&&e%4==0}var n;this.heatChartConfig={chart:{height:550,width:800,zooming:{type:"xy"}},title:{text:"Daily Streamflow: "+this.gage.code,align:"center"},subtitle:{text:"Click and drag in the plot area to zoom in",align:"center"},xAxis:{type:null,min:275,max:665,tickPositions:[275,306,336,367,398,426,457,487,518,548,579,610,650],title:{text:"Day of Year"},threshold:273,labels:{formatter:function(){return this.value>366&&(this.value-=365),285==this.value?"Annual Average":moment("2015 "+this.value,"YYYY DDD").format("MMM")}}},yAxis:{title:{text:"Water Year"},custom:{allowNegativeLog:!0}},colorAxis:(n=this.dailyValuesOnly,n.some(function(e){return e<=0})?{type:"linear",min:t,max:a,stops:[[0,"#fde725"],[.3,"#7ad151"],[.5,"#22a884"],[.6,"#2a788e"],[.8,"#414487"],[1,"#440154"]],startOnTick:!1,endOnTick:!1,labels:{format:"{value} ft/s"},allowNegativeLog:!0}:n.some(function(e){return e>0})?{type:"logarithmic",min:null,max:null,stops:[[0,"#fde725"],[.3,"#7ad151"],[.5,"#22a884"],[.6,"#2a788e"],[.8,"#414487"],[1,"#440154"]],startOnTick:!1,endOnTick:!1,labels:{format:"{value} ft/s"},allowNegativeLog:!0}:void 0),series:[{name:"Daily Streamflow",pixelSpacing:null,borderWidth:0,borderColor:"white",type:"heatmap",data:this.formattedDailyPlusAvg[0],tooltip:{headerFormat:"<b>Daily Streamflow</b>",pointFormatter:function(){if(null!==this.formattedDailyPlusAvg){var e=this.y,t=this.x;t>366&&(t-=365),t>274&&(e-=1),0==r(e)&&(t-=1),1==r(e)&&t<274&&(t-=1),1==r(e)&&t>59&&t<274&&(t+=1);var a=new Date(e,0,t),n=a.getUTCDate(),i=a.getUTCMonth(),o=(i+=1)+"/"+n+"/"+e,s=e;if(i>9&&(s+=1),this.x>641)return"</b><br>Water Year: <b>"+s+"</b><br>Water Year Average Value: <b>"+this.value.toFixed(2)+" ft/s</b>";if(this.x<641)return"<br>Date: <b>"+o+"</b><br>Value: <b>"+this.value+" ft/s</b><br>Water Year: <b>"+s}}},turboThreshold:0}]}},r.prototype.togglePlotLines=function(){var e=$("#chart1").highcharts();this.plotlines&&this.chartConfig.yAxis.plotLines.forEach(function(t){e.yAxis[0].addPlotLine(t)})},r.prototype.toggleFloodStats=function(){var e=$("#chart1").highcharts().series[this.selectedFloodFreqStats.seriesIndex];this.showFloodStats?e.show():e.hide()},r.prototype.containsNegatives=function(){return!!this.dailyValuesOnly.some(function(e){return e<=0})||!this.dailyValuesOnly.some(function(e){return e>0})&&void 0},r.prototype.toggleLogLinear=function(){var e=$("#chart1").highcharts();this.logScale?e.yAxis[0].update({type:"logarithmic"}):e.yAxis[0].update({type:"linear"})},r.prototype.togglePeakYear=function(){var e=this,t=$("#chart1").highcharts();t.showLoading("Loading..."),setTimeout(function(){var a=e.selectedYear-1,r=e.startAndEnd[0].getTime(),n=new Date("10/1/"+a).getTime(),i=new Date("9/30/"+e.selectedYear).getTime(),o=new Date("9/30/"+e.startAndEnd[1].getFullYear()).getTime();e.peaksOnYear?(t.series[0].update({data:e.formattedPeakDatesOnYear}),t.series[1].update({data:e.formattedEstPeakDatesOnYear}),t.xAxis[0].setExtremes(n,i),t.series[0].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b><br> Plotted on Water Year: <b>"+e.selectedYear,pointFormatter:function(){if(null!==this.formattedPeakDatesOnYear){var e=this.realDate.getUTCFullYear();this.realDate.getUTCMonth()>8&&(e+=1);var t=this.realDate.getUTCDate(),a=this.realDate.getUTCFullYear(),r=this.realDate.getUTCMonth();return"</b><br>Date: <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}}),t.series[1].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b><br> Plotted on Water Year: <b>"+e.selectedYear,pointFormatter:function(){if(null!==this.formattedEstPeakDatesOnYear){var e=this.realDate.getUTCFullYear();this.realDate.getUTCMonth()>8&&(e+=1);var t=this.realDate.getUTCDate(),a=this.realDate.getUTCFullYear(),r=this.realDate.getUTCMonth();return"</b><br>Date (estimated): <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}})):(t.series[0].update({data:e.formattedPeakDates}),t.series[1].update({data:e.formattedEstPeakDates}),t.xAxis[0].setExtremes(r,o),t.series[0].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b>",pointFormatter:function(){if(null!==this.formattedPeakDates){var e=this.x.getUTCFullYear();this.x.getUTCMonth()>8&&(e+=1);var t=this.x.getUTCDate(),a=this.x.getUTCFullYear(),r=this.x.getUTCMonth();return"<br>Date: <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}}),t.series[1].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b>",pointFormatter:function(){if(null!==this.formattedEstPeakDates){var e=this.x.getUTCFullYear();this.x.getUTCMonth()>8&&(e+=1);var t=this.x.getUTCDate(),a=this.x.getUTCFullYear(),r=this.x.getUTCMonth();return"<br>Date (estimated): <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}})),t.hideLoading()},100)},r.prototype.destroyResetZoom=function(){var e=$("#chart1").highcharts();e.showResetZoom(),e.resetZoomButton.hide()},r.prototype.resetZoom=function(){var e=this,t=$("#chart1").highcharts();t.showLoading("Loading..."),setTimeout(function(){var a=e.startAndEnd[0].getTime(),r=e.defaultYear-1,n=new Date("9/30/"+e.startAndEnd[1].getFullYear()).getTime(),i=new Date("10/1/"+r).getTime(),o=new Date("9/30/"+e.defaultYear).getTime();e.peaksOnYear?(t.xAxis[0].setExtremes(i,o),t.yAxis[0].setExtremes(),e.selectedYear=e.allYears[0],t.series[0].update({data:e.formattedPeakDatesOnYear}),t.series[1].update({data:e.formattedEstPeakDatesOnYear}),t.series[0].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b><br> Plotted on Water Year: <b>"+e.selectedYear,pointFormatter:function(){if(null!==this.formattedPeakDatesOnYear){var e=this.realDate.getUTCFullYear();this.realDate.getUTCMonth()>8&&(e+=1);var t=this.realDate.getUTCDate(),a=this.realDate.getUTCFullYear(),r=this.realDate.getUTCMonth();return"</b><br>Date: <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}}),t.series[1].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b><br> Plotted on Water Year: <b>"+e.selectedYear,pointFormatter:function(){if(null!==this.formattedEstPeakDatesOnYear){var e=this.realDate.getUTCFullYear();this.realDate.getUTCMonth()>8&&(e+=1);var t=this.realDate.getUTCDate(),a=this.realDate.getUTCFullYear(),r=this.realDate.getUTCMonth();return"</b><br>Date (estimated): <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}})):(t.yAxis[0].setExtremes(),t.xAxis[0].setExtremes(a,n)),t.hideLoading()},100)},r.prototype.dateRangePicker=function(){var e=$("#chart1").highcharts();e.showLoading("Loading..."),setTimeout(function(){if(10===$("#dischargeStart").val().length&&10===$("#dischargeEnd").val().length){var t=Date.parse($("#dischargeStart").val()),a=Date.parse($("#dischargeEnd").val());e.yAxis[0].setExtremes(),e.xAxis[0].setExtremes(t,a)}e.hideLoading()},100)},r.prototype.updateShadedStats=function(){var e=this,t=$("#chart1").highcharts(),a=t.xAxis[0].getExtremes(),r=new Date(a.min),n=new Date(a.max),i={min:new Date(r.getTime()-6e4*r.getTimezoneOffset()).toISOString().split("T")[0],max:new Date(n.getTime()-6e4*r.getTimezoneOffset()).toISOString().split("T")[0]};this.extremes=i;var o,s,l,g,c,u=n.getFullYear(),d=r.getFullYear();if(s=n,l=(o=r).getFullYear(),g=s.getFullYear(),c=o.getMonth(),s.getMonth()+12*g-(c+12*l)<=60){t.series[3].show(),t.series[4].show();var A=[];(function(e,t){void 0===e&&(e=2e3);for(var a=t||(new Date).getFullYear(),r=[],n=e;n<=a;n++)r.push(e),e++;return r})(d,u).forEach(function(t){e.rawShaded.forEach(function(e){var a={date:new Date(parseFloat(e[5])+"/"+parseFloat(e[6])+"/"+t),begin_yr:parseFloat(e[7]),end_yr:parseFloat(e[8]),min_va:parseFloat(e[13]),p10_va:parseFloat(e[16]),p25_va:parseFloat(e[18]),p75_va:parseFloat(e[20]),p90_va:parseFloat(e[22]),max_va:parseFloat(e[11])};A.push(a)})});var h=[],p=[],C=[],f=[],I=[];A&&A.forEach(function(e){h.push({x:e.date,low:e.min_va,high:e.p10_va}),p.push({x:e.date,low:e.p10_va,high:e.p25_va}),C.push({x:e.date,low:e.p25_va,high:e.p75_va}),f.push({x:e.date,low:e.p75_va,high:e.p90_va}),I.push({x:e.date,low:e.p90_va,high:e.max_va})}),t.series[5].show(),t.series[6].show(),t.series[2].show(),t.series[3].update({data:h}),t.series[4].update({data:p}),t.series[5].update({data:C}),t.series[6].update({data:f}),t.series[2].update({data:I})}else t.series[3].hide(),t.series[4].hide(),t.series[5].hide(),t.series[6].hide(),t.series[2].hide()},r.prototype.updateFloodStats=function(){var e=this,t=$("#chart1").highcharts(),a=t.xAxis[0].getExtremes(),r=new Date(a.min),n=new Date(a.max),i=n.getUTCDate(),o=n.getUTCFullYear(),s=n.getUTCMonth(),l=new Date((s+=1)+"/"+i+"/"+o);t.series.forEach(function(t){if(t.name.includes("AEP flood")&&t.linkedParent.name===e.selectedFloodFreqStats.name){var a=t.name.substring(0,t.name.length-18);t.update({data:[{x:r,y:t.yData[0]},{x:l,y:t.yData[1]}]}),t.update({dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x.getUTCFullYear()==n.getUTCFullYear())return a+"% AEP"}}})}if(t.name.includes("Year Low Flow")&&t.linkedParent.name===e.selectedFloodFreqStats.name&&t.linkedParent.name===e.selectedFloodFreqStats.name){var i=t.name.replaceAll("_"," ");t.update({data:[{x:r,y:t.yData[0]},{x:l,y:t.yData[1]}]}),t.update({dataLabels:{enabled:!0,zIndex:3,pointFormatter:function(){if(this.x.getUTCFullYear()==n.getUTCFullYear())return i}}})}})},r.prototype.updatePeaksAfterZoom=function(){var e,t,a,r,n,i=this,o=$("#chart1").highcharts(),s=o.xAxis[0].getExtremes(),l=new Date(s.min),g=new Date(s.max),c={min:new Date(l.getTime()-6e4*l.getTimezoneOffset()).toISOString().split("T")[0],max:new Date(g.getTime()-6e4*l.getTimezoneOffset()).toISOString().split("T")[0]};if(this.extremes=c,t=g,a=(e=l).getFullYear(),r=t.getFullYear(),n=e.getMonth(),t.getMonth()+12*r-(n+12*a)>12)o.series[0].update({data:this.formattedPeakDates}),o.series[1].update({data:this.formattedEstPeakDates}),o.series[0].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b>",pointFormatter:function(){if(null!==this.formattedPeakDates){var e=this.x.getUTCFullYear();this.x.getUTCMonth()>8&&(e+=1);var t=this.x.getUTCDate(),a=this.x.getUTCFullYear(),r=this.x.getUTCMonth();return"<br>Date: <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}}),o.series[1].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b>",pointFormatter:function(){if(null!==this.formattedEstPeakDates){var e=this.x.getUTCFullYear();this.x.getUTCMonth()>8&&(e+=1);var t=this.x.getUTCDate(),a=this.x.getUTCFullYear(),r=this.x.getUTCMonth();return"<br>Date (estimated): <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}}),this.peaksOnYear=!1;else{this.peaksOnYear=!0,this.selectedYear=g.getUTCFullYear();var u=[],d=[];this.peakDates&&(this.peakDates.forEach(function(e){var t=i.selectedYear-1,a=new Date(e.peak_dt);a.getUTCMonth()>8?a.setUTCFullYear(t):a.setUTCFullYear(i.selectedYear);var r=new Date(a.toUTCString());isNaN(e.peak_va)||u.push({x:r,y:e.peak_va,realDate:new Date(e.peak_dt)})}),this.estPeakDates&&this.estPeakDates.forEach(function(e){var t=i.selectedYear-1,a=new Date(e.peak_dt);a.getUTCMonth()>8?a.setUTCFullYear(t):a.setUTCFullYear(i.selectedYear);var r=new Date(a.toUTCString());d.push({x:r,y:e.peak_va,realDate:new Date(e.peak_dt)})}),o.series[0].update({data:u}),o.series[1].update({data:d}),o.series[0].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b><br> Plotted on Water Year: <b>"+this.selectedYear,pointFormatter:function(){if(null!==this.formattedPeakDatesOnYear){var e=this.realDate.getUTCFullYear();this.realDate.getUTCMonth()>8&&(e+=1);var t=this.realDate.getUTCDate(),a=this.realDate.getUTCFullYear(),r=this.realDate.getUTCMonth();return"</b><br>Date: <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}}),o.series[1].update({tooltip:{headerFormat:"<b>Annual Peak Streamflow</b><br> Plotted on Water Year: <b>"+this.selectedYear,pointFormatter:function(){if(null!==this.formattedEstPeakDatesOnYear){var e=this.realDate.getUTCFullYear();this.realDate.getUTCMonth()>8&&(e+=1);var t=this.realDate.getUTCDate(),a=this.realDate.getUTCFullYear(),r=this.realDate.getUTCMonth();return"</b><br>Date (estimated): <b>"+((r+=1)+"/"+t+"/"+a)+"</b><br>Value: <b>"+this.y+" ft/s</b><br>Water Year: <b>"+e}}}}))}},r.prototype.toggleLogLinearDischarge=function(){var e=$("#chart3").highcharts();this.logScaleDischarge?(e.xAxis[0].update({type:"logarithmic"}),e.yAxis[0].update({type:"logarithmic"})):(e.xAxis[0].update({type:"linear"}),e.yAxis[0].update({type:"linear"}),this.peaksOnYear=!1)},r.prototype.toggleDischargeData=function(e){var t=$("#chart3").highcharts(),a=t.series[2].data;a.forEach(function(t){t.color="age"==e?t.ageColor:t.qualityColor}),t.series[2].update({data:a})},r.prototype.init=function(){this.AppVersion=configuration.version,this.getGagePage(),this.getGagePlots(),this.modalService.modalOptions&&this.modalService.modalOptions.tabName?"GageInformation"==this.modalService.modalOptions.tabName?this.selectGagePageTab("GageInformation"):"GageAnalysisPlots"==this.modalService.modalOptions.tabName&&this.selectGagePageTab("GageAnalysisPlots"):this.selectGagePageTab("GageInformation")},r.prototype.convertDateToString=function(e){var t=e.getFullYear().toString(),a=(e.getMonth()+1).toString(),r=e.getDate().toString(),n=a.split(""),i=r.split("");return t+"-"+(n[1]?a:"0"+n[0])+"-"+(i[1]?r:"0"+i[0])},r.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),a=e.find("tr:has(td)"),r=String.fromCharCode(11),n=String.fromCharCode(0),i='","',o='"\r\n"',s='"';return s+=l(t.map(g)),s+=o,s+=l(a.map(g))+'"';function l(e){return e.get().join(n).split(n).join(o).split(r).join(i)}function g(e,t){var a=$(t),n=a.find("td");return n.length||(n=a.find("th")),n.map(c).get().join(r)}function c(e,t){return $(t).text().replace('"','""')}},r.$inject=["$scope","$http","StreamStats.Services.ModalService","$modalInstance","toaster"],r}(WiM.Services.HTTPServiceBase));!function(e){e[e.GageInformation=1]="GageInformation",e[e.GageAnalysisPlots=2]="GageAnalysisPlots"}(t||(t={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.GagePageController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(t){"use strict";var a=function(t){function a(e,a,r,n,i,o){var s=t.call(this,r,configuration.baseurls.StreamStats)||this;return s.showPreferred=!1,s.multiselectOptions={displayProp:"name"},s.queryBy="Nearest",s.distance=10,s.nearbyGages=[],e.vm=s,s.modalInstance=i,s.modalService=n,s.init(),s.selectedStatisticGroups=[],s.showPreferred=!1,s.studyAreaService=o,s.toaster=a,s}return __extends(a,t),a.prototype.Close=function(){this.modalInstance.dismiss("cancel")},a.prototype.getNearestGages=function(){var e=this;this.toaster.pop("wait","Searching for gages","Please wait...",0);var t=this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),a=this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),r=configuration.baseurls.GageStatsServices;"Nearest"==this.queryBy&&(r+=configuration.queryparams.GageStatsServicesNearest.format(t,a,this.distance)),"Network"==this.queryBy&&(r+=configuration.queryparams.GageStatsServicesNetwork.format(t,a,this.distance));var n=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",{"X-Is-Streamstats":!0});this.nearbyGages=[],this.Execute(n).then(function(t){if(e.toaster.clear(),"string"==typeof t.data?e.toaster.pop("warning","Warning",t.data,0):t.data.hasOwnProperty("features")&&0==t.data.features.length?e.toaster.pop("warning","Warning","No stations located within search distance"):t.data.hasOwnProperty("features")&&t.data.features.length>0&&(t.data.features.forEach(function(e){if(e.properties.hasOwnProperty("Statistics")){var t=!1;e.properties.Statistics.forEach(function(e){"FDS"==e.statisticGroupType.code&&(t=!0)}),e.properties.HasFlowDurationStats=t}e.properties.hasOwnProperty("Characteristics")&&e.properties.Characteristics.forEach(function(t){"DRNAREA"==t.variableType.code&&(e.properties.DrainageArea=t.value)})}),e.nearbyGages=t.data.features),t.headers()["x-usgswim-messages"]){var a=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(a).forEach(function(t){a[t].forEach(function(a){e.toaster.pop(t,t,a)})})}},function(t){if(e.toaster.clear(),console.log(t),t.headers()["x-usgswim-messages"]){var a=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(a).forEach(function(t){a[t].forEach(function(a){e.toaster.pop(t,t,a)})})}else e.toaster.pop("error","There was an error finding nearby gages.","Please retry",0)})},a.prototype.selectGage=function(e){this.studyAreaService.doSelectNearestGage&&(this.Close(),this.studyAreaService.selectGage(e))},a.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modalService.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},a.prototype.init=function(){this.AppVersion=configuration.version},a.$inject=["$scope","toaster","$http","StreamStats.Services.ModalService","$modalInstance","StreamStats.Services.StudyAreaService"],a}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NearestGagesController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(e){"use string";var t=function(e){function t(t,a,r){var n=e.call(this,a,"")||this;return t.vm=n,n.modalInstance=r,n.init(),n}return __extends(t,e),t.prototype.Close=function(){this.modalInstance.dismiss("cancel")},t.prototype.init=function(){this.warningMessage=configuration.warningModalMessage},t.$inject=["$scope","$http","$modalInstance"],t}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.WarningMessageController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;__extends=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(t,a)};return function(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();!function(e){!function(e){"use string";var t=function(){return function(){this.ignoreExcludePolys=!1}}(),a=function(e){function a(a,r,n,i,o,s,l){var g=e.call(this,r,configuration.baseurls.StreamStats)||this;return g.displayError=!1,a.vm=g,g.sce=l,g.modalInstance=o,g.modalService=n,g.selectedBatchProcessorTabName="submitBatch",g.nssService=i,g.toaster=s,g.manageQueue=configuration.manageBPQueue,g.environment=configuration.environment,console.log(g.environment),g.cbFlowStats=!1,g.cbBasinChar=!1,g.selectedFlowStatsList=[],g.selectedParamList=[],g.flowStatsAllChecked=!0,g.parametersAllChecked=!0,g.showBasinCharacteristics=!1,g.submittingBatch=!1,g.submitBatchSuccessAlert=!1,g.submitBatchFailedAlert=!1,g.submitBatchData=new t,g.editingQueue=!1,g.reorderingQueue=!1,g.regionListSpinner=!0,g.flowStatsListSpinner=!1,g.parametersListSpinner=!1,g.batchStatusMessageList=[],g.streamGridList=[],g.retrievingStreamGrids=!1,g.batchStatusList=[],g.retrievingManageQueue=!1,g.flowStatIDs=[],g.submitBatchOver250=!1,g.queues=["Production Queue","Development Queue"],g.selectedQueue="Production Queue",g.isRefreshing=!1,g.isStartingNextBatch=!1,g.canReorder=!1,g.basinDelineationCollapsed=!1,g.basinCharCollapsed=!1,g.flowStatsCollapsed=!1,g.init(),g.displayWarning=configuration.showBPWarning,g}return __extends(a,e),a.prototype.Close=function(){var e=document.location.href;window.history.pushState({},"",e.split("?")[0]),this.submitBatchSuccessAlert=!1,this.modalInstance.dismiss("cancel")},a.prototype.selectBatchProcessorTab=function(e){if(this.selectedBatchProcessorTabName=e,(t=new URLSearchParams(window.location.search)).set("BP",e),"streamGrid"==e)this.retrievingStreamGrids=!0,this.loadStreamGrids(),t.delete("email");else if("manageQueue"==e)this.getManageQueueList(),this.retrievingManageQueue=!0,t.delete("email");else if("submitBatch"==e)t.delete("email");else if("batchStatus"==e){var t;if(this.batchStatusEmail)this.retrievingBatchStatus=!0,this.getBatchStatusList(this.batchStatusEmail),(t=new URLSearchParams(window.location.search)).set("email",this.batchStatusEmail)}history.replaceState(null,null,"?"+t.toString())},a.prototype.getRegions=function(){var e=this,t=configuration.baseurls.BatchProcessorServices+configuration.queryparams.Regions,a=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(a).then(function(t){e.regionList=t.data,e.regionListSpinner=!1},function(t){e.displayError=!0})},a.prototype.getFlowStatsAndParams=function(e){var t=this;this.submitBatchSuccessAlert=!1,0!=this.flowStatsListSpinner&&0!=this.parametersListSpinner||(this.flowStatsListSpinner=!0,this.parametersListSpinner=!0),this.flowStatsList&&this.flowStatsList.length>0&&(this.flowStatsList.length=0),this.availableParamList&&this.availableParamList.length>0&&(this.availableParamList.length=0),this.loadParametersByRegionBP(e).then(function(a){t.availableParamList=a;var r=t.availableParamList.map(function(e){return e.code.toUpperCase()});t.scenariosAvailable(e)?t.nssService.getFlowStatsList(e).then(function(e){t.flowStatsList=e,t.flowStatsListSpinner=!1,t.flowStatsList.forEach(function(e){e.regressionRegions.forEach(function(e){e.parameters.forEach(function(e){-1==r.indexOf(e.code.toUpperCase())&&(e.asterisk=!0,e.toggleable=!0,t.availableParamList.push(e),r.push(e.code))})})}),t.parametersListSpinner=!1}):(t.flowStatsList=[],t.flowStatsListSpinner=!1,t.parametersListSpinner=!1)})},a.prototype.scenariosAvailable=function(e){for(var t=configuration.regions,a=0;a<t.length;a++)if(t[a].Name.toUpperCase().trim()===e.toUpperCase().trim()||t[a].RegionID.toUpperCase().trim()===e.toUpperCase().trim())return t[a].ScenariosAvailable},a.prototype.setRegionStats=function(e,t){void 0===t&&(t=null);var a=this.checkArrayForObj(this.selectedFlowStatsList,e);null==t?(-1!=a?(this.selectedFlowStatsList.splice(a,1),0==this.selectedFlowStatsList.length&&(this.selectedParamList=[],this.availableParamList.forEach(function(e){e.checked=!1,e.toggleable=!0}))):(this.selectedFlowStatsList.push(e),this.setParamCheck(e.regressionRegions)),this.onSelectedStatisticsGroupChanged()):1==t?(-1==a&&(this.selectedFlowStatsList.push(e),this.setParamCheck(e.regressionRegions)),this.onSelectedStatisticsGroupChanged()):0==t&&(-1!=a&&this.selectedFlowStatsList.splice(a,1),this.onSelectedStatisticsGroupChanged(!1)),this.checkStats()},a.prototype.setParamCheck=function(e){var t=this;e.forEach(function(e){e.parameters.forEach(function(e){for(var a=e.code,r=0;r<t.availableParamList.length;r++){var n=t.availableParamList[r];if(n.code.toUpperCase()===a.toUpperCase()){n.checked=!0,n.toggleable=!1;break}}})})},a.prototype.onSelectedStatisticsGroupChanged=function(e){var t=this;void 0===e&&(e=null),0==e&&this.availableParamList.forEach(function(e){e.checked=!1,e.toggleable=!0}),this.selectedParamList=[],this.selectedFlowStatsList.forEach(function(e){e.checked=!0,e.regressionRegions&&e.regressionRegions.forEach(function(e){e.parameters.forEach(function(e){for(var a=!1,r=0;r<t.availableParamList.length;r++){if(t.availableParamList[r].code.toLowerCase()==e.code.toLowerCase()){t.addParameterToSelectedParamList(e.code),a=!0;break}}if(!a){var n={code:e.code,description:e.description,checked:!1,toggleable:!0,asterisk:!0};t.availableParamList.push(n),t.addParameterToSelectedParamList(e.code)}})})})},a.prototype.checkStats=function(){this.selectedFlowStatsList.length>0?this.showBasinCharacteristics=!0:this.showBasinCharacteristics=!1},a.prototype.updateSelectedParamList=function(e){if(0!=e.toggleable){var t=e.code,a=this.selectedParamList.indexOf(t);!e.checked&&a>-1?this.selectedParamList.splice(a,1):e.checked&&-1==a&&this.selectedParamList.push(t),this.checkParameters()}else e.checked=!0},a.prototype.checkParameters=function(){for(var e=!0,t=0,a=this.availableParamList;t<a.length;t++){a[t].checked||(e=!1)}this.parametersAllChecked=!e},a.prototype.toggleFlowStatisticsAllChecked=function(){var e=this;this.flowStatsAllChecked?(this.flowStatsAllChecked=!1,this.flowStatsList.forEach(function(t){t.checked=!0,e.setRegionStats(t,!0)})):(this.flowStatsAllChecked=!0,this.flowStatsList.forEach(function(t){t.checked=!1,e.setRegionStats(t,!1)}))},a.prototype.toggleParametersAllChecked=function(){var e=this;this.availableParamList.forEach(function(t){var a=e.selectedParamList.indexOf(t.code);e.parametersAllChecked?(-1==a&&e.selectedParamList.push(t.code),t.checked=!0):a>-1&&t.toggleable&&(e.selectedParamList.splice(a,1),t.checked=!1)}),this.parametersAllChecked=!this.parametersAllChecked},a.prototype.getBatchStatusList=function(e){var t=this,a=new URLSearchParams(window.location.search);a.set("email",e),history.replaceState(null,null,"?"+a.toString()),this.getBatchStatusByEmail(e).then(function(e){t.batchStatusList=e,t.retrievingBatchStatus=!1,t.isRefreshing=!1})},a.prototype.getManageQueueList=function(){var e=this;this.getBatchStatusByEmail().then(function(t){e.manageQueueList=t,e.retrievingManageQueue=!1,e.isRefreshing=!1,t.filter(function(e){return 1===e.status}).length>1?e.canReorder=!0:e.canReorder=!1})},a.prototype.refreshBatch=function(e){1==confirm("Are you sure you want to refresh Batch ID "+e+"? All results for this batch will be deleted.")&&this.refreshBatchResults(e)},a.prototype.startNextBatch=function(){this.startWorker()},a.prototype.trashBatch=function(e,t,a){1==confirm("Are you sure you want to delete Batch ID "+e+"?")&&this.deleteBatch(e,t,a)},a.prototype.submitBatch=function(e){var t=this;void 0===e&&(e=!1),this.toaster.pop("wait","Submitting Batch","Please wait...",0),void 0!=this.batchStatusEmail&&null!=this.batchStatusEmail||(this.batchStatusEmail=this.submitBatchData.email.toString()),this.flowStatIDs=[],this.addStatIDtoList();var a=new FormData;a.append("region",this.selectedRegion.toString()),a.append("basinCharacteristics",this.selectedParamList.toString()),a.append("flowStatistics",this.flowStatIDs.toString()),a.append("email",this.submitBatchData.email.toString()),a.append("IDField",this.submitBatchData.idField.toString()),a.append("geometryFile",this.submitBatchData.attachment,this.submitBatchData.attachment.name),a.append("ignoreExcludePolys",this.submitBatchData.ignoreExcludePolys.toString());var r={"Content-Type":void 0};this.submittingBatch=!0,1==e?(a.append("moreThan250Points",e.toString()),this.postBatchFormData(a,r).then(function(e){var a=e;if(200==a.status)t.submitBatchSuccessAlert=!0,t.toaster.clear(),t.toaster.pop("success","The batch was submitted successfully. You will be notified by email when results are available.","",5e3),gtag("event","BatchProcessor",{Category:"Submit Batch - successful"}),t.clearBatchForm(),t.getBatchStatusList(t.batchStatusEmail);else{var r=a.data.detail;t.toaster.clear(),t.toaster.pop("error","Batch submission failed: ",r,15e3),gtag("event","BatchProcessor",{Category:"Submit Batch - unsuccessful"})}}).finally(function(){t.submittingBatch=!1,t.submitBatchOver250=!1,t.submitBatchSuccessAlert=!0})):(this.toaster.pop("wait","Submitting Batch","Please wait...",0),this.postBatchFormData(a,r).then(function(e){var a=e;if(500==a.status&&a.data.detail.indexOf("250")>-1)t.submitBatchOver250Message="Batch contains more than 250 points. Only the first 250 points will be processed. Please select the 'Submit Batch Over 250 Points' button if you would like only the first 250 points to be processed.",t.submitBatchOver250=!0,t.toaster.clear(),t.toaster.pop("warning",t.submitBatchOver250Message,"",5e3);else if(200==a.status)t.submitBatchSuccessAlert=!0,t.toaster.clear(),t.toaster.pop("success","The batch was submitted successfully. You will be notified by email when results are available.","",5e3),gtag("event","BatchProcessor",{Category:"Submit Batch - successful"}),t.clearBatchForm(),t.getBatchStatusList(t.batchStatusEmail);else{var r=a.data.detail;t.toaster.clear(),t.toaster.pop("error","Batch submission failed: "+r,"",15e3),gtag("event","BatchProcessor",{Category:"Submit Batch - unsuccessful"})}}).finally(function(){t.submittingBatch=!1}))},a.prototype.reorderQueue=function(){var e=this;this.reorderingQueue=!0;var t={batchOrder:[]};this.manageQueueList.forEach(function(e){null!=e.order&&t.batchOrder.push({batchID:e.batchID,order:e.order})}),this.reorderBatches(t).then(function(t){var a=t;200==a.status?(e.getManageQueueList(),e.editingQueue=!1,e.retrievingManageQueue=!0,e.toaster.clear(),e.toaster.pop("success","Queue was successfully reordered","",5e3),gtag("event","BatchProcessor",{Category:"Reorder Queue - successful"})):(e.toaster.clear(),e.toaster.pop("error","Queue failed to reorder: ",a.data.detail,15e3),gtag("event","BatchProcessor",{Category:"Reorder Queue - unsuccessful"}))}).finally(function(){e.reorderingQueue=!1})},a.prototype.submitPauseBatch=function(e){var t=this;this.pauseBatch(e).then(function(a){var r=a;200==r.status?(t.getManageQueueList(),t.retrievingManageQueue=!0,t.toaster.clear(),t.toaster.pop("success","Batch ID "+e+" was paused.","",5e3)):(t.toaster.clear(),t.toaster.pop("error","Batch ID "+e+" could not be paused.",r.data.detail,15e3))}).finally(function(){})},a.prototype.submitUnpauseBatch=function(e){var t=this;this.unpauseBatch(e).then(function(a){var r=a;200==r.status?(t.getManageQueueList(),t.retrievingManageQueue=!0,t.toaster.clear(),t.toaster.pop("success","Batch ID "+e+" was unpaused.","",5e3)):(t.toaster.clear(),t.toaster.pop("error","Batch ID "+e+" could not be unpaused.",r.data.detail,15e3))}).finally(function(){})},a.prototype.loadStreamGrids=function(){var e=this;this.streamGridList=[];var t="https://dev.streamstats.usgs.gov/streamgrids/";"streamstats.usgs.gov"===window.location.host&&(t="https://streamstats.usgs.gov/streamgrids/"),setTimeout(function(){e.getStateMapServicesIDs().then(function(a){var r=a;e.regionList.forEach(function(a){e.getStreamGridLastModifiedDate(r[a.Code]).then(function(r){var n=r;e.streamGridList.push({region:a.Name,downloadURL:t+a.Code.toLowerCase()+"/"+a.Code.toLowerCase()+".zip",lastModified:n})})})}),e.retrievingStreamGrids=!1},1e3)},a.prototype.getStateMapServicesIDs=function(){var e=this,t=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers+"?f=json",a=new WiM.Services.Helpers.RequestInfo(t,!0);return this.Execute(a).then(function(t){var a=t.data.layers,r={},n=e.regionList.map(function(e){return e.Code});return a.forEach(function(e){if(-1!=n.indexOf(e.name)){var t=e.subLayerIds;r[e.name]=a.filter(function(e){return-1!=t.indexOf(e.id)&&"StreamGrid"==e.name})[0].id}}),r},function(e){}).finally(function(){})},a.prototype.getStreamGridLastModifiedDate=function(e){var t=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers+"/"+e+"/info/metadata?f=json",a=new WiM.Services.Helpers.RequestInfo(t,!0);return this.Execute(a).then(function(e){return e.data.description.split("Last Modified: ")[1]},function(e){}).finally(function(){})},a.prototype.loadParametersByRegionBP=function(e){if(e){var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSAvailableParams.format(e),a=new WiM.Services.Helpers.RequestInfo(t,!0);return this.Execute(a).then(function(e){if(e.data.parameters&&e.data.parameters.length>0){var t=[];e.data.parameters.forEach(function(e){try{var a={code:e.code,description:e.description,checked:!1,toggleable:!0,asterisk:!1};t.push(a)}catch(e){console.log(e)}})}return t},function(e){}).finally(function(){})}},a.prototype.postBatchFormData=function(e,t){var a=configuration.baseurls.BatchProcessorServices+configuration.queryparams.SSBatchProcessorSubmitBatch,r=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",e,t);return this.Execute(r).then(function(e){return e},function(e){return e}).finally(function(){})},a.prototype.retrieveBatchStatusMessages=function(){var e=configuration.baseurls.BatchProcessorServices+configuration.queryparams.SSBatchProcessorStatusMessages,t=new WiM.Services.Helpers.RequestInfo(e,!0);return this.Execute(t).then(function(e){var t=[];return e.data.forEach(function(e){try{var a={id:e.ID,message:e.Message,description:e.Description};t.push(a)}catch(e){console.log(e)}}),t},function(e){}).finally(function(){})},a.prototype.getBatchStatusByEmail=function(e){var t,a=this;void 0===e&&(e=null),e?t=configuration.baseurls.BatchProcessorServices+configuration.queryparams.SSBatchProcessorBatchStatus.format(e):"Production Queue"==this.selectedQueue?(t="https://streamstats.usgs.gov/batchprocessor"+configuration.queryparams.SSBatchProcessorGetBatch,this.queueURL="https://streamstats.usgs.gov/batchprocessor"):(t="https://dev.streamstats.usgs.gov/batchprocessor"+configuration.queryparams.SSBatchProcessorGetBatch,this.queueURL="https://dev.streamstats.usgs.gov/batchprocessor");var r=new WiM.Services.Helpers.RequestInfo(t,!0);return this.Execute(r).then(function(e){var t=[];return e.data.forEach(function(e){try{var r={batchID:e.ID,deleteCode:e.DeleteCode,emailAddress:e.EmailAddress,order:e.Order,queueList:null==e.QueueList?"":e.QueueList.join(", "),status:a.batchStatusMessageList.filter(function(t){return t.id==e.StatusID})[0].id,statusMessage:a.batchStatusMessageList.filter(function(t){return t.id==e.StatusID})[0].message,statusDescription:a.batchStatusMessageList.filter(function(t){return t.id==e.StatusID})[0].description,timeSubmitted:null==e.TimeSubmitted?null:new Date(new Date(e.TimeSubmitted+"Z").toString()),timeStarted:null==e.TimeStarted?null:new Date(new Date(e.TimeStarted+"Z").toString()),timeCompleted:null==e.TimeCompleted?null:new Date(new Date(e.TimeCompleted+"Z").toString()),resultsURL:e.ResultsURL,region:e.Region,pointsRequested:e.NumberPoints,pointsSuccessful:e.NumberPointsSuccessful,pointsPartiallySuccessful:e.NumberPointsPartiallySuccessful,pointsFailed:e.NumberPointsFailed,uploadFileName:e.GeometryFilename};t.push(r)}catch(e){console.log(e)}}),t},function(e){}).finally(function(){})},a.prototype.refreshBatchResults=function(e){var t=this,a=this.queueURL+configuration.queryparams.SSBatchProcessorRefreshBatch.format(e,"true"),r=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET);return this.Execute(r).then(function(a){alert("Batch ID "+e+" was refreshed."),t.isRefreshing=!0,t.getManageQueueList(),t.retrievingManageQueue=!0},function(t){alert("Error refreshing batch ID "+e+". Please try again later or click the Help menu button to submit a Support Request.")}).finally(function(){})},a.prototype.startWorker=function(){var e=this,t=this.queueURL+configuration.queryparams.SSBatchProcessorStartWorker,a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET);return this.Execute(a).then(function(t){alert("Worker was started on the server. The next batch will start running, if the server has capacity."),e.isRefreshing=!0,e.getManageQueueList(),e.retrievingManageQueue=!0,e.isStartingNextBatch=!1},function(e){alert("Error. Please try again later or click the Help menu button to submit a Support Request.")}).finally(function(){})},a.prototype.deleteBatch=function(e,t,a){var r,n=this;"manageQueue"==this.selectedBatchProcessorTabName?r=this.queueURL+configuration.queryparams.SSBatchProcessorDeleteBatch.format(t):"batchStatus"==this.selectedBatchProcessorTabName&&(r=configuration.baseurls.BatchProcessorServices+configuration.queryparams.SSBatchProcessorDeleteBatch.format(t));var i=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.DELETE);return this.Execute(i).then(function(t){alert("Batch ID "+e+" was deleted."),n.isRefreshing=!0,"manageQueue"==n.selectedBatchProcessorTabName?(n.getManageQueueList(),n.retrievingManageQueue=!0):"batchStatus"==n.selectedBatchProcessorTabName&&(n.getBatchStatusList(n.batchStatusEmail),n.retrievingBatchStatus=!0)},function(t){alert("Error deleting batch ID "+e+". Please try again later or click the Help menu button to submit a Support Request.")}).finally(function(){})},a.prototype.reorderBatches=function(e){var t=this.queueURL+configuration.queryparams.SSBatchProcessorReorderBatch,a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(e));return this.Execute(a).then(function(e){return e},function(e){return e}).finally(function(){})},a.prototype.pauseBatch=function(e){var t=this.queueURL+configuration.queryparams.SSBatchProcessorBatchPause.format(e),a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.POST);return this.Execute(a).then(function(e){return e},function(e){return e}).finally(function(){})},a.prototype.unpauseBatch=function(e){var t=this.queueURL+configuration.queryparams.SSBatchProcessorBatchUnpause.format(e),a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.POST);return this.Execute(a).then(function(e){return e},function(e){return e}).finally(function(){})},a.prototype.collapseSection=function(e,t){var a=e.currentTarget.nextElementSibling;"none"===a.style.display?(a.style.display="block","basinDelineation"===t&&(this.basinDelineationCollapsed=!1),"flowStatistics"===t&&(this.flowStatsCollapsed=!1),"basinCharacteristics"===t&&(this.basinCharCollapsed=!1)):(a.style.display="none","basinDelineation"===t&&(this.basinDelineationCollapsed=!0),"flowStatistics"===t&&(this.flowStatsCollapsed=!0),"basinCharacteristics"===t&&(this.basinCharCollapsed=!0))},a.prototype.init=function(){var e=this;this.getRegions(),this.manageQueue&&this.selectBatchProcessorTab("manageQueue"),this.modalService.modalOptions&&this.modalService.modalOptions.tabName?"batchStatus"==this.modalService.modalOptions.tabName?(this.modalService.modalOptions.urlParams&&(this.batchStatusEmail=this.modalService.modalOptions.urlParams,this.retrievingBatchStatus=!0),this.selectBatchProcessorTab("batchStatus")):"manageQueue"==this.modalService.modalOptions.tabName?this.selectBatchProcessorTab("submitBatch"):"streamGrid"==this.modalService.modalOptions.tabName&&this.selectBatchProcessorTab("streamGrid"):this.selectBatchProcessorTab(this.selectedBatchProcessorTabName),this.retrieveBatchStatusMessages().then(function(t){e.batchStatusMessageList=t}),configuration.showBPWarning&&(this.warningMessage=configuration.warningBPMessage);var t=this;document.addEventListener("keydown",function(e){"Escape"===e.key&&t.Close()})},a.prototype.checkArrayForObj=function(e,t){for(var a=0;a<e.length;a++)if(angular.equals(e[a],t))return a;return-1},a.prototype.validateZipFile=function(e){"application/x-zip-compressed"!=e[0].type&&"application/zip"!=e[0].type&&(this.toaster.pop("warning","Please upload a .zip file.","",5e3),this.submitBatchData.attachment=null)},a.prototype.addParameterToSelectedParamList=function(e){try{for(var t=0;t<this.availableParamList.length;t++){var a=this.availableParamList[t];if(a.code.toUpperCase()===e.toUpperCase()&&-1==this.checkArrayForObj(this.selectedParamList,a.code)){this.selectedParamList.push(a.code),a.checked=!0,a.toggleable=!1;break}}}catch(e){return!1}},a.prototype.addStatIDtoList=function(){var e=this;this.selectedFlowStatsList.forEach(function(t){e.flowStatIDs.push(t.statisticGroupID)})},a.prototype.clearBatchForm=function(){delete this.selectedRegion,delete this.submitBatchData.email,delete this.submitBatchData.idField,delete this.submitBatchData.attachment,this.cbFlowStats=!1,this.cbBasinChar=!1,this.selectedParamList.length=0,this.flowStatIDs.length=0,this.flowStatsList.length=0,this.availableParamList.length=0,this.selectedFlowStatsList.length=0,this.checkStats()},a.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},a.$inject=["$scope","$http","StreamStats.Services.ModalService","StreamStats.Services.nssService","$modalInstance","toaster","$sce"],a}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.BatchProcessorController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));