!function(e){var t=function(){function e(e,t,r,a,i){this.$stateProvider=e,this.$urlRouterProvider=t,this.$locationProvider=r,this.$logProvider=a,this.$compilerProvider=i,this.$stateProvider.state("main",{url:"/?rcode&workspaceID",template:"<ui-view/>",views:{map:{templateUrl:"Views/mapview.html",controller:"StreamStats.Controllers.MapController"},sidebar:{templateUrl:"Views/sidebarview.html",controller:"StreamStats.Controllers.SidebarController"},navbar:{templateUrl:"Views/navigationview.html",controller:"StreamStats.Controllers.NavbarController"},report:{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController"}}}),this.$urlRouterProvider.otherwise("/"),this.$locationProvider.html5Mode(!0),this.$logProvider.debugEnabled(!1),"production"==configuration.environment&&this.$compilerProvider.debugInfoEnabled(!1)}return e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$logProvider","$compileProvider"],e}();angular.module("StreamStats",["ui.router","ui.bootstrap","ui.checkbox","mobile-angular-ui","toaster","ngFileUpload","leaflet-directive","StreamStats.Services","StreamStats.Controllers","WiM.Services","WiM.Event","wim_angular","rzModule","nvd3","daterangepicker","angularjs-dropdown-multiselect","highcharts-ng"]).config(t)}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){return function(e,t){this.RegionID=e,this.Pourpoint=t,this.CoordinatedReach=null,this.ActiveExtension=[],this.NSS_Extensions=[]}}();e.StudyArea=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){return function(){this.append=[],this.remove=[]}}();e.WatershedEditDecisionList=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){var t=function(){function e(e,t){this.navigationID=e,this.navigationInfo=t,this.navigationInfo.configuration&&(this.minLocations=this.getCountByType(this.navigationInfo.configuration,"geojson point geometry")),this.navigationConfiguration=[],this.navigationPointCount=0,this._locations=[]}return Object.defineProperty(e.prototype,"locations",{get:function(){return this._locations},enumerable:!1,configurable:!0}),e.prototype.addLocation=function(e,t){var r=this;this._locations.push(t),this.navigationConfiguration.reverse().forEach(function(t,a){t.name==e&&(console.log("found this point already, deleting:",r.navigationConfiguration,a),r.navigationConfiguration.splice(a,1),r.navigationPointCount-=1)}),this.navigationPointCount+=1,this.navigationConfiguration.push({id:this.navigationPointCount,name:e,required:!0,description:"Specified lat/long/crs  navigation start location",valueType:"geojson point geometry",value:{type:"Point",coordinates:[t.Longitude,t.Latitude],crs:{properties:{name:"EPSG:"+t.crs},type:"name"}}}),this._locations.length>this.minLocations&&this._locations.shift()},e.prototype.getCountByType=function(e,t){return e.filter(function(e){return e.valueType.toLowerCase().indexOf(t)>=0}).length},e}();e.NetworkNav=t;var r=function(e){function t(){return e.call(this,2,2)||this}return __extends(t,e),t}(t);e.NetworkPath=r;var a=function(e){function t(){var t=e.call(this,1,1)||this;return t._workspaceID="",t}return __extends(t,e),Object.defineProperty(t.prototype,"workspaceID",{get:function(){return this._workspaceID},set:function(e){this._workspaceID=e},enumerable:!1,configurable:!0}),t}(t);e.FlowPath=a;var i=function(e){function t(){var t=e.call(this,3,1)||this;return t.layerOptions=[{name:"NHDFlowline",selected:!0},{name:"Gage",selected:!1},{name:"Dam",selected:!1}],t.DirectionOptions=["Upstream","Downstream"],t.selectedDirectionType=t.DirectionOptions[1],t}return __extends(t,e),t}(t);e.NetworkTrace=i}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){function e(e,t,r,a,i,n){this._label="Coordinated Reach - Stream ID: "+a+", Stream Name: "+r+", Basin Name: "+e+", Begin Drainage Area: "+i+" sq mi, End Drainage Area: "+n+" sq mi",this._basinName=e,this._eqID=t,this._streamName=r,this._streamID=a,this._begDrainageArea=i,this._endDrainageArea=n,this._flowCoefficients={}}return Object.defineProperty(e.prototype,"FlowCoefficients",{get:function(){return this._flowCoefficients},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"basinName",{get:function(){return this._basinName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"eqID",{get:function(){return this._eqID},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"streamID",{get:function(){return this._streamID},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"begDrainageArea",{get:function(){return this._begDrainageArea},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endDrainageArea",{get:function(){return this._endDrainageArea},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"streamName",{get:function(){return this._streamName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!1,configurable:!0}),e.prototype.AddFlowCoefficient=function(e,t,r){null!==this._flowCoefficients[e]&&(this._flowCoefficients[e]={CoefficientA:t,CoefficientB:r})},e.prototype.Execute=function(e){try{var t=[];for(var r in this.FlowCoefficients)if(this.FlowCoefficients.hasOwnProperty(r)){var a=this.FlowCoefficients[r];t.push({code:r,description:this.getDescription(r),name:this.getName(r),unit:{unit:"cubic feet per second",abbr:"ft^3/s"},value:this.getValue(a,e[0].value)})}var i=[];for(var r in i.push({code:e[0].code,value:e[0].value,name:e[0].name,unitType:{abbr:e[0].unit,unit:e[0].unit}}),this.FlowCoefficients)i.push({code:r+"CoeffA",value:Number(this.FlowCoefficients[r].CoefficientA).toFixed(3),name:r+" CoefficientA",unitType:{abbr:"dim",unit:"dimensionless"}}),i.push({code:r+"CoeffB",value:Number(this.FlowCoefficients[r].CoefficientB).toFixed(3),name:r+" CoefficientB",unitType:{abbr:"dim",unit:"dimensionless"}});return{id:0,name:this.label,code:this.eqID,parameters:i,results:t}}catch(e){return console.log(e),null}},e.prototype.getDescription=function(e){var t="";switch(e){case"PK10":t="10";break;case"PK25":t="25";break;case"PK50":t="50";break;case"PK100":t="100";break;case"PK200":t="200";break;case"PK500":t="500";break;default:t="undefined"}return"Maximum instantaneous flow that occurs on average once in {0} years".format(t)},e.prototype.getName=function(e){var t="";switch(e){case"PK10":t="10";break;case"PK25":t="25";break;case"PK50":t="50";break;case"PK100":t="100";break;case"PK200":t="200";break;case"PK500":t="500";break;default:t="undefined"}return"{0} year Peak Flood".format(t)},e.prototype.getValue=function(e,t){try{return e.CoefficientA||0===e.CoefficientA||e.CoefficientB||0===e.CoefficientB||t?e.CoefficientA*Math.pow(t,e.CoefficientB):null}catch(e){return null}},e}();e.CoordinatedReach=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(e){!function(e){var t=function(){return function(e,t){this.StationID=e,this.Name=t}}();e.ReferenceGage=t}(e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Services",[])}();__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use strict";var t=function(){return function(){}}();e.StatisticsGroup=t,e.onScenarioExtensionChanged="onScenarioExtensionChanged",e.onScenarioExtensionResultsChanged="onScenarioExtensionResultsChanged";var r=function(e){function t(t,r,a){void 0===t&&(t=null),void 0===r&&(r=null),void 0===a&&(a=null);var i=e.call(this)||this;return i.extensions=t,i.results=r,i.regressionRegionName=a,i}return __extends(t,e),t}(WiM.Event.EventArgs);e.NSSEventArgs=r;var a=function(t){function a(e,r,a,i,n,o){var s=t.call(this,e,configuration.baseurls.NSS)||this;return s.$q=r,s.regionservice=n,s.eventManager=o,s.equationWeightingResults=[],s.equationWeightingDisclaimers=[],s.toaster=a,s.modalService=i,s._onSelectedStatisticsGroupChanged=new WiM.Event.Delegate,s._onQ10Loaded=new WiM.Event.Delegate,s.clearNSSdata(),s}return __extends(a,t),Object.defineProperty(a.prototype,"onSelectedStatisticsGroupChanged",{get:function(){return this._onSelectedStatisticsGroupChanged},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"onQ10Loaded",{get:function(){return this._onQ10Loaded},enumerable:!1,configurable:!0}),a.prototype.clearNSSdata=function(){this.loadingParametersByStatisticsGroupCounter=0,this.estimateFlowsCounter=0,this.selectedStatisticsGroupList=[],this.statisticsGroupList=[],this.canUpdate=!0,this.queriedRegions=!1,this.isDone=!1,this.reportGenerated=!1},a.prototype.loadStatisticsGroupTypes=function(e,t){var r=this;if(this.toaster.pop("wait","Loading Available Scenarios","Please wait...",0),e||t){var a=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupLookup.format(e,t),i=new WiM.Services.Helpers.RequestInfo(a,!0);this.loadingStatisticsGroup=!0,this.statisticsGroupList=[],this.Execute(i).then(function(e){e.data.length>0&&(r.loadingStatisticsGroup=!1,angular.forEach(e.data,function(e,t){if(r.statisticsGroupList.push(e),r.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&5==e.id){var a=JSON.parse(JSON.stringify(e));a.id+="_fdctm",a.name="Flow-Duration Curve Transfer Method",r.statisticsGroupList.push(a)}})),r.toaster.clear()},function(e){r.toaster.clear(),r.toaster.pop("error","There was an error Loading Available Scenarios","Please retry",0)}).finally(function(){r.loadingStatisticsGroup=!1})}},a.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},a.prototype.loadParametersByStatisticsGroup=function(t,a,i,n,o){var s=this;if(0==this.loadingParametersByStatisticsGroupCounter&&this.toaster.pop("wait","Loading Parameters by Statistics Group","Please wait...",0),this.loadingParametersByStatisticsGroupCounter++,t||a||i){var g=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupParameterLookup;this.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&a.toString().indexOf("_fdctm")>-1&&(a=a.replace("_fdctm",""),g+="&extensions=QPPQ"),g=g.format(t,a,i),void 0!=o&&(g+="&regressiontypes="+o);var l=new WiM.Services.Helpers.RequestInfo(g,!0);this.Execute(l).then(function(t){if(t.data[0].regressionRegions[0].extensions&&t.data[0].regressionRegions[0].extensions.length>0){var a=t.data[0].regressionRegions[0].extensions;s.eventManager.RaiseEvent(e.onScenarioExtensionChanged,s,new r(a))}t.data[0].regressionRegions[0].parameters&&t.data[0].regressionRegions[0].parameters.length>0&&(0==s.selectedStatisticsGroupList.length&&s.selectedStatisticsGroupList.push({name:"",id:"7",code:"",regressionRegions:[],citations:null,disclaimers:""}),s.selectedStatisticsGroupList.forEach(function(e){(t.data[0].statisticGroupID==e.id||s.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&"string"==typeof e.id&&e.id.indexOf(t.data[0].statisticGroupID,0)>-1)&&(e.statisticGroupName=e.name,e.statisticGroupID=e.id.toString().replace("_fdctm",""),t.data[0].regressionRegions.forEach(function(e){n.length>0&&n.forEach(function(t){t.code.indexOf(e.code.toUpperCase())>-1&&(e.percentWeight=t.percentWeight)})}),e.regressionRegions=t.data[0].regressionRegions,s._onSelectedStatisticsGroupChanged.raise(null,WiM.Event.EventArgs.Empty))}))},function(e){s.toaster.clear(),s.toaster.pop("error","There was an error Loading Parameters by Statistics Group","Please retry",0)}).finally(function(){s.loadingParametersByStatisticsGroupCounter--,0==s.loadingParametersByStatisticsGroupCounter&&s.toaster.clear()})}},a.prototype.estimateFlows=function(t,a,i,n,o,s){var g=this;void 0===n&&(n=!1),void 0===s&&(s=!0),(this.canUpdate||n)&&this.selectedStatisticsGroupList.forEach(function(l){g.canUpdate=!1,0==g.estimateFlowsCounter&&g.toaster.pop("wait","Estimating Flows","Please wait...",0),g.estimateFlowsCounter++,g.cleanRegressionRegions(l.regressionRegions),l.regressionRegions.forEach(function(e){e.disclaimer&&(e.disclaimer=null),e.parameters.forEach(function(e){t.forEach(function(t){e.code.toLowerCase()==t.code.toLowerCase()&&(e.value=t[a])})})});var c=angular.fromJson(angular.toJson(l));c.regressionRegions.forEach(function(e){e.results&&delete e.results,e.extensions&&e.extensions.forEach(function(e){e.result&&delete e.result,e.parameters&&e.parameters.forEach(function(e){e.options&&delete e.options})})}),c=angular.toJson([c],null);var A=configuration.baseurls.NSS+configuration.queryparams.estimateFlows.format(i);g.regionservice.selectedRegion.Applications.indexOf("FDCTM")>-1&&"string"==typeof l.id&&l.id.indexOf("_fdctm")>-1&&(A+="&extensions=QPPQ"),""!=o&&void 0!=o&&(A+="&regressiontypes="+o);var u=new WiM.Services.Helpers.RequestInfo(A,!0,1,"json",c);l.citations=[],g.Execute(u).then(function(t){var i=t.data[0].links[0].href,o=i.split("regressionregions=")[1];if(!n&&o&&o.length>0&&g.getSelectedCitations(i,l),t.headers()["x-usgswim-messages"]){var s=t.headers()["x-usgswim-messages"].split(";");l.disclaimers={},s.forEach(function(e){var t=e.split(":");"warning"==t[0]&&(l.disclaimers.Warnings=t[1].trim()),"error"==t[0]&&(l.disclaimers.Error=t[1].trim())})}t.data[0].regressionRegions.length>0&&t.data[0].regressionRegions[0].results&&t.data[0].regressionRegions[0].results.length>0?n?l.regressionRegions.forEach(function(e){e.parameters.forEach(function(r){for(var i=t.data[0].regressionRegions,n=0;n<i.length;n++)if(i[n].id===e.id)for(var o=0;o<i[n].parameters.length;o++)i[n].Parameters[o].code==r.code&&(r[a]=i[n].parameters[o].value)}),e.results.forEach(function(r){for(var i=t.data[0].regressionRegions,n=0;n<i.length;n++)if(i[n].id===e.id)for(var o=0;o<i[n].results.length;o++)i[n].results[o].code==r.code&&(r[a]=i[n].results[o].value)})}):(t.data[0].regressionRegions.forEach(function(t){t.extensions&&(t.extensions.forEach(function(e){var r=l.regressionRegions.filter(function(e){return e.name==t.name})[0].extensions.filter(function(t){return t.code==e.code})[0];e.parameters.forEach(function(e){e.options=r.parameters.filter(function(t){return t.code==e.code})[0].options})}),g.eventManager.RaiseEvent(e.onScenarioExtensionResultsChanged,g,new r(null,t.extensions,t.name)))}),l.regressionRegions=[],l.regressionRegions=t.data[0].regressionRegions):(g.toaster.clear(),g.toaster.pop("error","There was an error Estimating Flows for "+l.name,"No results were returned",0))},function(e){g.toaster.clear(),g.toaster.pop("error","There was an error Estimating Flows","HTTP request error",0)}).finally(function(){-1!=g.regionservice.selectedRegion.Applications.indexOf("ChannelWidthWeighting")&&"Peak-Flow Statistics"==l.name&&g.queryEquationWeighting(),g.estimateFlowsCounter--,g.estimateFlowsCounter<1&&(g.toaster.clear(),g.estimateFlowsCounter=0,s&&-1!=g.regionservice.selectedRegion.Applications.indexOf("ChannelWidthWeighting")?setTimeout(function(){g.canUpdate=!0,g.modalService.openModal(e.SSModalType.e_report),g.reportGenerated=!0},1e3):s&&(g.canUpdate=!0,g.modalService.openModal(e.SSModalType.e_report),g.reportGenerated=!0)),g._onQ10Loaded.raise(null,WiM.Event.EventArgs.Empty)})})},a.prototype.queryEquationWeighting=function(){var e=null,t=[];this.equationWeightingResults=[],this.equationWeightingDisclaimers=[],this.selectedStatisticsGroupList.forEach(function(r){"Peak-Flow Statistics"==r.name&&r.regressionRegions.forEach(function(r,a){"Area-Averaged"!=r.name&&r.results&&(t[a]={name:null,inUse:!1,percentWeight:null,RegressionRegionName:null,code:null,values:[]},r.results.forEach(function(i,n){i.code.includes("ACPK")?(t[a].name="ACPK",t[a].RegressionRegionName=r.name.substring(0,r.name.indexOf("Region")+"Region".length),t[a].percentWeight=r.percentWeight,i.value>0?(t[a].code=r.code,t[a].inUse=!0,t[a].values[n]={value:i.value,SEP:i.sep?i.sep:null,code:i.code}):(t[a].code=null,t[a].inUse=!1,t[a].values[n]={value:null,SEP:null,code:i.code})):i.code.includes("BWPK")?(t[a].name="BFPK",t[a].RegressionRegionName=r.name.substring(0,r.name.indexOf("Region")+"Region".length),t[a].percentWeight=r.percentWeight,i.value>0?(t[a].code=r.code,t[a].inUse=!0,t[a].values[n]={value:i.value,SEP:i.sep?i.sep:null,code:i.code}):(t[a].code=null,t[a].inUse=!1,t[a].values[n]={value:null,SEP:null,code:i.code})):i.code.includes("RSPK")?(t[a].name="RSPK",t[a].RegressionRegionName=r.name.substring(0,r.name.indexOf("Region")+"Region".length),t[a].percentWeight=r.percentWeight,i.value>0?(t[a].code=r.code,t[a].inUse=!0,t[a].values[n]={value:i.value,SEP:i.sep?i.sep:null,code:i.code}):(t[a].code=null,t[a].inUse=!1,t[a].values[n]={value:null,SEP:null,code:i.code})):(t[a].name="BCPK",t[a].RegressionRegionName=r.name.substring(0,r.name.indexOf("Region")+"Region".length),t[a].percentWeight=r.percentWeight,i.value>0?(e=i.unit,t[a].inUse=!0,t[a].values[n]={value:i.value,SEP:i.sep?i.sep:null,code:i.code}):(t[a].inUse=!1,t[a].values[n]={value:null,SEP:null,code:i.code}))}))})});var r=t.filter(function(e){return"BCPK"==e.name}),a=t.filter(function(e){return 1==e.inUse}).length/r.length;t.sort(function(e,t){return e.name.localeCompare(t.name)});for(var i=0;i<t.length;i++)t[i].values.sort(function(e,t){return e.code.localeCompare(t.code)});if(a>=2)for(var n=configuration.baseurls.WeightingServices+"/weightest/",o={accept:"application/json","Content-Type":"application/json"},s=0;s<r.length;){this.equationWeightingResults[s]={RR:t[s].RegressionRegionName,Results:[]};var g=t[0].values.length-1;this.recursiveAreaWeightSubscription(t[0].values,g,t,n,o,e,r,s),s++}else this.toaster.pop("error","Cannot Weight Channel-width Methods, not enough values")},a.prototype.recursiveAreaWeightSubscription=function(e,t,r,a,i,n,o,s){var g=this;if(t>=0){var l,c;r[0*o.length+s].code&&(c=r[0*o.length+s].code),r[1*o.length+s].code&&(c=r[1*o.length+s].code),r[2*o.length+s].code&&(c=r[2*o.length+s].code),r[3*o.length+s].code&&(c=r[3*o.length+s].code),l={x1:r[0*o.length+s].values[t].value,x2:r[1*o.length+s].values[t].value,x3:r[2*o.length+s].values[t].value,x4:r[3*o.length+s].values[t].value,sep1:r[0*o.length+s].values[t].SEP,sep2:r[1*o.length+s].values[t].SEP,sep3:r[2*o.length+s].values[t].SEP,sep4:r[3*o.length+s].values[t].SEP,regressionRegionCode:c,code1:r[0*o.length+s].values[t].code,code2:r[1*o.length+s].values[t].code,code3:r[2*o.length+s].values[t].code,code4:r[3*o.length+s].values[t].code};var A=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",JSON.stringify(l),i);this.Execute(A).then(function(e){if(g.equationWeightingResults[s].Results[t]={Name:r[1*o.length+s].values[t].code,Z:e.data.Z,Unit:n,PIl:e.data.PIL,PIu:e.data.PIU,SEPZ:e.data.SEPZ},e.headers("x-usgswim-messages")){var a=JSON.parse(e.headers()["x-usgswim-messages"]);Object.keys(a).forEach(function(e){a[e].split(". ").forEach(function(e){g.equationWeightingDisclaimers.push(e)})})}g.equationWeightingDisclaimers=g.equationWeightingDisclaimers.filter(function(e,t){return g.equationWeightingDisclaimers.indexOf(e)===t}),g.equationWeightingDisclaimers=g.equationWeightingDisclaimers.filter(Boolean)},function(e){g.toaster.clear(),e.data&&e.data.detail?g.toaster.pop("error","Cannot Weight Channel-width Methods: "+e.data.detail,"HTTP request error",0):g.toaster.pop("error","Cannot Weight Channel-width Methods")}).finally(function(){t-=1,g.recursiveAreaWeightSubscription(e,t,r,a,i,n,o,s)})}else o.length==s+1&&(this.equationWeightingResults=this.equationWeightingResults.filter(function(e){return e.Results.length>0}),o.length>1&&this.equationWeightingResults.length>0&&setTimeout(function(){g.equationWeightingResults[s+1]={RR:"Area-Averaged",Results:[]};for(var e=new Array(r[0].values.length),t=new Array(r[0].values.length),a=new Array(r[0].values.length),i=new Array(r[0].values.length),l=0;l<r[0].values.length;++l)i[l]=0,a[l]=0,t[l]=0,e[l]=0;for(var c=0;c<g.equationWeightingResults.length-1;c++){for(var A=[],u=[],d=[],C=[],I=0;I<g.equationWeightingResults[c].Results.length;I++)A.push(g.equationWeightingResults[c].Results[I].Z),u.push(g.equationWeightingResults[c].Results[I].PIl),d.push(g.equationWeightingResults[c].Results[I].PIu),C.push(g.equationWeightingResults[c].Results[I].SEPZ);A=A.map(function(e){return e*(r[c].percentWeight/100)}),u=u.map(function(e){return e*(r[c].percentWeight/100)}),d=d.map(function(e){return e*(r[c].percentWeight/100)}),C=C.map(function(e){return e*(r[c].percentWeight/100)}),i=i.map(function(e,t){return e+A[t]}),e=e.map(function(e,t){return e+u[t]}),t=t.map(function(e,t){return e+d[t]}),a=a.map(function(e,t){return e+C[t]})}for(var h=0;h<r[0].values.length;++h)g.equationWeightingResults[g.equationWeightingResults.length-1].Results[h]={Name:r[1*o.length+s].values[h].code,Z:i[h],Unit:n,PIl:e[h],PIu:t[h],SEPZ:a[h]}},75))},a.prototype.getSelectedCitations=function(e,t){var r,a=this;r=-1==e.indexOf("https://")?"https://"+e:e;var i=new WiM.Services.Helpers.RequestInfo(r,!0,0,"json");this.Execute(i).then(function(e){e.data[0]&&e.data[0].id&&angular.forEach(e.data,function(e,r){t.citations.push(e)})},function(e){a.toaster.pop("error","There was an error getting selected Citations for "+t.name,"No results were returned",0)}).finally(function(){})},a.prototype.getflattenNSSTable=function(e){var t=[];try{this.selectedStatisticsGroupList.forEach(function(r){r.regressionRegions.forEach(function(r){r.results.forEach(function(a){t.push({Name:e,Region:r.percentWeight?r.percentWeight.toFixed(1)+"% "+r.name:r.name,Statistic:a.name,Code:a.code,Value:a.value.toUSGSvalue(),Unit:a.unit.unit,Disclaimers:r.disclaimer?r.disclaimer:void 0,Errors:a.errors&&a.errors.length>0?a.errors.map(function(e){return e.name+" : "+e.value}).join(", "):void 0,MaxLimit:a.intervalBounds&&a.intervalBounds.upper>0?a.intervalBounds.upper.toUSGSvalue():void 0,MinLimit:a.intervalBounds&&a.intervalBounds.lower>0?a.intervalBounds.lower.toUSGSvalue():void 0,EquivYears:a.equivalentYears?a.equivalentYears:void 0})})})})}catch(e){t.push({Disclaimers:"Failed to output flowstats to table. "})}return t},a.prototype.cleanRegressionRegions=function(e){for(var t=0;t<e.length;t++){"Area-Averaged"!==e[t].name?e.forEach(function(e){e.Results&&delete e.Results}):e.splice(t,1)}},a}(WiM.Services.HTTPServiceBase);function i(e,t,r,i,n,o){return new a(e,t,r,i,n,o)}i.$inject=["$http","$q","toaster","StreamStats.Services.ModalService","StreamStats.Services.RegionService","WiM.Event.EventManager"],angular.module("StreamStats.Services").factory("StreamStats.Services.nssService",i)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use strict";var t=function(){return function(){}}();e.Region=t;var r=function(){return function(){}}();e.Parameter=r,e.onSelectedRegionChanged="onSelectedRegionChanged";var a=function(t){function r(r,a,i,n){var o=t.call(this,r,configuration.baseurls.StreamStatsServices)||this;return o.$q=a,o.eventManager=n,o.toaster=i,o.regionList=[],o.parameterList=[],o.masterRegionList=configuration.regions,o.streamStatsAvailable=!1,o.eventManager.AddEvent(e.onSelectedRegionChanged),o}return __extends(r,t),Object.defineProperty(r.prototype,"selectedRegion",{get:function(){return this._selectedRegion},set:function(t){this._selectedRegion!=t&&(this._selectedRegion=t,this.eventManager.RaiseEvent(e.onSelectedRegionChanged,this,WiM.Event.EventArgs.Empty))},enumerable:!1,configurable:!0}),r.prototype.clearRegion=function(){this.regionList=[],this.parameterList=[],this.regionMapLayerList=[],this.selectedRegion=null,this.regionMapLayerListLoaded=!1,this.resetView=!1},r.prototype.clearSelectedParameters=function(){this.parameterList.forEach(function(e){e.checked=!1,delete e.value})},r.prototype.intersect=function(e,t){return Math.max(e.left,t.left)<Math.min(e.right,t.right)&&Math.min(e.top,t.top)>Math.max(e.bottom,t.bottom)},r.prototype.loadRegionListByExtent=function(e,t,r,a,i){var n=this;void 0===i&&(i=4326),this.regionList=[];var o={top:a,bottom:r,left:t,right:e};configuration.regions.forEach(function(e,t){var r={top:e.Bounds[1][0],bottom:e.Bounds[0][0],left:e.Bounds[0][1],right:e.Bounds[1][1]};n.intersect(o,r)&&n.regionList.push(e)})},r.prototype.loadRegionListByRegion=function(e){this.regionList.length=0;var t=this.getRegion(e);return null!=t&&(this.regionList.push(t),!0)},r.prototype.loadMapLayersByRegion=function(e){var t=this;this.regionMapLayerListLoaded=!1;var r=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers+"?f=pjson",a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.regionMapLayerList=[],this.Execute(a).then(function(r){r.data.layers?(r.data.layers.forEach(function(a,i){a.name==e&&a.subLayerIds.forEach(function(e,a){t.regionMapLayerList.push([r.data.layers[e].name,r.data.layers[e].id,!1])})}),t.regionMapLayerListLoaded=!0):t.toaster.pop("warning","No map layers available","",5e3)},function(e){return console.log("No region map layers found"),t.$q.reject(e.data)}).finally(function(){})},r.prototype.loadParametersByRegion=function(){var e=this;if(this.selectedRegion){var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSAvailableParams.format(this.selectedRegion.RegionID),r=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(r).then(function(t){t.data.parameters&&t.data.parameters.length>0?(e.streamStatsAvailable=!0,t.data.parameters.forEach(function(t){try{t.checked=!1,t.toggleable=!0,e.parameterList.push(t)}catch(e){alert(e)}}),e.parameterList.sort(function(e,t){return e.code>t.code?1:t.code>e.code?-1:0})):(e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3))},function(t){console.log("Bad response from the regression service"),e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3)}).finally(function(){})}},r.prototype.getRegion=function(e){var t=configuration.regions;try{for(var r=0;r<t.length;r++)if(t[r].Name.toUpperCase().trim()===e.toUpperCase().trim()||t[r].RegionID.toUpperCase().trim()===e.toUpperCase().trim())return t[r];return null}catch(e){return null}},r}(WiM.Services.HTTPServiceBase);function i(e,t,r,i){return new a(e,t,r,i)}i.$inject=["$http","$q","toaster","WiM.Event.EventManager"],angular.module("StreamStats.Services").factory("StreamStats.Services.RegionService",i)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use strict";t.onSelectedStudyAreaChanged="onSelectedStudyAreaChanged",t.onSelectedStudyParametersLoaded="onSelectedStudyParametersLoaded",t.onStudyAreaReset="onStudyAreaReset",t.onEditClick="onEditClick",t.onAdditionalFeaturesLoaded="onAdditionalFeaturesLoaded",t.onRegressionLoaded="onRegressionLoaded";var r=function(e){function t(t,r,a){void 0===t&&(t=null),void 0===r&&(r=!1),void 0===a&&(a=!1);var i=e.call(this)||this;return i.studyArea=t,i.studyAreaVisible=r,i.parameterLoaded=a,i}return __extends(t,e),t}(WiM.Event.EventArgs);t.StudyAreaEventArgs=r;var a=function(a){function i(e,r,i,n,o,s,g){var l=a.call(this,e,configuration.baseurls.StreamStatsServices)||this;return l.$http=e,l.$q=r,l.eventManager=i,l.nssService=s,l.regionService=g,l._onStudyAreaServiceFinishedChanged=new WiM.Event.Delegate,l.surfacecontributionsonly=!1,l.doSelectMapGage=!1,l.doSelectNearestGage=!1,l.NSSServicesVersion="",l.streamgagesVisible=!0,l.additionalFeaturesLoaded=!1,l.extensionDateRange=null,l.extensionsConfigured=!1,l.loadingDrainageArea=!1,l.extensionResultsChanged=0,l.flowAnywhereData=null,l.modalservices=o,i.AddEvent(t.onSelectedStudyParametersLoaded),i.AddEvent(t.onSelectedStudyAreaChanged),i.AddEvent(t.onStudyAreaReset),i.AddEvent(t.onAdditionalFeaturesLoaded),i.SubscribeToEvent(t.onSelectedStudyAreaChanged,new WiM.Event.EventHandler(function(e,t){l.onStudyAreaChanged(e,t)})),i.SubscribeToEvent(t.onScenarioExtensionChanged,new WiM.Event.EventHandler(function(e,t){l.onNSSExtensionChanged(e,t)})),i.SubscribeToEvent(t.onScenarioExtensionResultsChanged,new WiM.Event.EventHandler(function(e,t){l.onNSSExtensionResultsChanged(e,t)})),i.AddEvent(t.onEditClick),l._studyAreaList=[],l.toaster=n,l.clearStudyArea(),l.servicesURL=configuration.baseurls.StreamStatsServices,l._onQ10Loaded=new WiM.Event.Delegate,l.parameterloadedEventHandler=new WiM.Event.EventHandler(function(e,t){null!=t&&t.parameterLoaded&&(l.nssService.estimateFlows(l.studyAreaParameterList,"value",l.selectedStudyArea.RegionID,!1,l.regtype,!1),l.onQ10Available())}),l.statisticgroupEventHandler=new WiM.Event.EventHandler(function(){l.eventManager.SubscribeToEvent(t.onSelectedStudyParametersLoaded,l.parameterloadedEventHandler),l.loadParameters(),l.afterSelectedStatisticsGroupChanged()}),l.q10EventHandler=new WiM.Event.EventHandler(function(e,t){l.afterQ10Loaded()}),l}return __extends(i,a),Object.defineProperty(i.prototype,"onStudyAreaServiceBusyChanged",{get:function(){return this._onStudyAreaServiceFinishedChanged},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onQ10Loaded",{get:function(){return this._onQ10Loaded},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"StudyAreaList",{get:function(){return this._studyAreaList},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"selectedStudyArea",{get:function(){return this._selectedStudyArea},set:function(e){this.canUpdate&&this._selectedStudyArea!=e&&(this._selectedStudyArea=e,this.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,this,r.Empty))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"selectedStudyAreaExtensions",{get:function(){return null==this.selectedStudyArea?null:this.selectedStudyArea.NSS_Extensions},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"freshdeskCredentials",{get:function(){return this._freshdeskCreds},set:function(e){this._freshdeskCreds!=e&&(this._freshdeskCreds=e)},enumerable:!1,configurable:!0}),i.prototype.editBasin=function(e){this.selectedStudyArea.Disclaimers.isEdited=!0,this.drawControlOption=e,this.eventManager.RaiseEvent(t.onEditClick,this,WiM.Event.EventArgs.Empty)},i.prototype.undoEdit=function(){delete this.selectedStudyArea.Disclaimers.isEdited,this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,this,r.Empty)},i.prototype.AddStudyArea=function(e){this.clearStudyArea(),this.StudyAreaList.push(e),this.selectedStudyArea=e,this.selectedStudyArea.Disclaimers={}},i.prototype.RemoveStudyArea=function(){},i.prototype.clearStudyArea=function(){this.canUpdate=!0,this.regulationCheckComplete=!0,this.parametersLoading=!1,this.doDelineateFlag=!1,this.checkingDelineatedPoint=!1,this.studyAreaParameterList=[],this.regulationCheckResults=[],this.allIndexGages=void 0,this.selectedStudyArea&&(this.selectedStudyArea.Disclaimers={}),this.showEditToolbar=!1,this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this.selectedStudyArea=null,this.zoomLevel15=!0,this.regressionRegionQueryComplete=!1,this.regressionRegionQueryLoading=!1,this.eventManager.RaiseEvent(t.onStudyAreaReset,this,WiM.Event.EventArgs.Empty)},i.prototype.loadStudyBoundary=function(){var e=this;this.toaster.pop("wait","Delineating Basin","Please wait...",0),this.canUpdate=!1;var a=this.selectedStudyArea.RegionID,i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSdelineation.format("geojson",a,this.selectedStudyArea.Pourpoint.Longitude.toString(),this.selectedStudyArea.Pourpoint.Latitude.toString(),this.selectedStudyArea.Pourpoint.crs.toString());if(this.regionService.selectedRegion.Applications.indexOf("StormDrain")>-1)i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSstormwaterDelineation.format(a,this.selectedStudyArea.Pourpoint.Longitude.toString(),this.selectedStudyArea.Pourpoint.Latitude.toString(),this.surfacecontributionsonly);var n=new WiM.Services.Helpers.RequestInfo(i,!0);n.withCredentials=!0,this.Execute(n).then(function(a){if(e.regionService.selectedRegion.Applications.indexOf("StormDrain")>-1)if(a.data.layers&&a.data.layers.features&&a.data.layers.features[1].geometry.coordinates.length>0){e.selectedStudyArea.Disclaimers.isStormDrain=!0;var i=a.data.hasOwnProperty("layers")?a.data.layers:null;i&&i.features.forEach(function(e){return e.id=e.id.toString().toLowerCase()}),e.selectedStudyArea.FeatureCollection=i,e.selectedStudyArea.WorkspaceID=a.data.hasOwnProperty("workspaceID")?a.data.workspaceID:null,e.selectedStudyArea.Date=new Date,e.toaster.clear(),e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,r.Empty),e.canUpdate=!0}else e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","A watershed was not returned from the delineation request","Please retry",0);else a.data.hasOwnProperty("featurecollection")&&a.data.featurecollection[1]&&a.data.featurecollection[1].feature.features.length>0?(e.selectedStudyArea.Server=a.headers()["usgswim-hostname"].toLowerCase(),e.selectedStudyArea.WorkspaceID=a.data.hasOwnProperty("workspaceID")?a.data.workspaceID:null,e.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:e.reconfigureWatershedResponse(a.data.featurecollection),bbox:a.data.featurecollection.filter(function(e){return"globalwatershed"==e.name})[0].feature.features[0].bbox},e.snappedPourPoint=a.data.featurecollection.filter(function(e){return"globalwatershedpoint"==e.name})[0].feature.features[0].geometry.coordinates,e.selectedStudyArea.Date=new Date,e.toaster.clear(),e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,r.Empty),e.canUpdate=!0):(e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","A watershed was not returned from the delineation request","Please retry",0));e.selectedStudyArea.FeatureCollection.features.forEach(function(e){return e.properties={}})},function(t){e.clearStudyArea(),e.toaster.clear(),e.toaster.pop("error","There was an HTTP error with the delineation request","Please retry",0)}).finally(function(){})},i.prototype.loadWatershed=function(a,i){var n=this;try{this.toaster.pop("wait","Opening Basin","Please wait...",0);var o=new e.Models.StudyArea(a,null);this.AddStudyArea(o);var s=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSwatershedByWorkspace.format("geojson",a,i,4326,!1),g=new WiM.Services.Helpers.RequestInfo(s,!0);g.withCredentials=!0,this.Execute(g).then(function(e){n.selectedStudyArea.WorkspaceID=e.data.hasOwnProperty("workspaceID")?e.data.workspaceID:null,n.selectedStudyArea.Date=new Date,n.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:n.reconfigureWatershedResponse(e.data.featurecollection),bbox:e.data.featurecollection.filter(function(e){return"globalwatershed"==e.name})[0].feature.features[0].bbox};var t=e.data.featurecollection.filter(function(e){return"globalwatershedpoint"==e.name})[0].feature.features[0];n.selectedStudyArea.Pourpoint=new WiM.Models.Point(t.bbox[1],t.bbox[0],t.crs.properties.code)},function(e){n.toaster.clear(),n.toaster.pop("error","Error Delineating Basin","Please retry",0)}).finally(function(){n.canUpdate=!0,n.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,n,r.Empty),n.toaster.clear()})}catch(e){return}},i.prototype.loadEditedStudyBoundary=function(){var a=this;this.toaster.pop("wait","Loading Edited Basin","Please wait...",0),this.canUpdate=!1;var i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSeditBasin.format("geojson",this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,this.selectedStudyArea.Pourpoint.crs.toString()),n=new WiM.Services.Helpers.RequestInfo(i,!0,WiM.Services.Helpers.methodType.PUT,"json",angular.toJson(this.WatershedEditDecisionList),{});n.withCredentials=!0,this.Execute(n).then(function(t){a.AddStudyArea(new e.Models.StudyArea(a.selectedStudyArea.RegionID,a.selectedStudyArea.Pourpoint)),a.selectedStudyArea.FeatureCollection={type:"FeatureCollection",features:a.reconfigureWatershedResponse(t.data.featurecollection),bbox:t.data.featurecollection.filter(function(e){return"globalwatershed"==e.name.toLowerCase()})[0].feature.features[0].bbox},a.selectedStudyArea.WorkspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null,a.selectedStudyArea.Date=new Date,a.toaster.clear()},function(e){a.toaster.clear(),a.toaster.pop("error","Error Delineating Basin","Please retry",0)}).finally(function(){a.canUpdate=!0;var e=new r;e.studyArea=a.selectedStudyArea,a.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,a,e),a.selectedStudyArea.Disclaimers.isEdited=!0})},i.prototype.loadDrainageArea=function(){var e=this;this.loadingDrainageArea=!0,this.toaster.clear(),this.toaster.pop("wait","Calculating Drainage Area","Please wait...",0);var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,"drnarea"),r=new WiM.Services.Helpers.RequestInfo(t,!0);r.withCredentials=!0,this.Execute(r).then(function(t){if(t.data.parameters&&t.data.parameters.length>0){e.toaster.clear();var r=!1;angular.forEach(t.data.parameters,function(e,t){e.hasOwnProperty("value")&&-999!=e.value?e.loaded=!0:(r=!0,console.error("Parameter failed to compute: ",e.code),e.loaded=!1)}),r&&e.toaster.pop("error","Error","Drainage area failed to compute",0);var a=t.data.parameters;e.loadParameterResults(a),e.loadingDrainageArea=!1}},function(t){e.loadingDrainageArea=!1,e.toaster.clear(),e.toaster.pop("error","There was an HTTP error calculating drainage area","Please retry",0)}).finally(function(){})},i.prototype.loadAllIndexGages=function(){var e=this,t=configuration.baseurls.StreamStatsServices+configuration.queryparams.KrigService.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.Pourpoint.Longitude,this.selectedStudyArea.Pourpoint.Latitude,this.selectedStudyArea.Pourpoint.crs,"300"),r=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(r).then(function(t){e.allIndexGages=t.data},function(t){e.allIndexGages=[],e.toaster.clear(),e.toaster.pop("error","There was an HTTP error returning index gages.","Please retry",0)}).finally(function(){})},i.prototype.loadParameters=function(){var e=this;this.parametersLoading=!0;var a=[];if(this.toaster.clear(),this.toaster.pop("wait","Calculating Selected Basin Characteristics","Please wait...",0),this.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,this,r.Empty),this.selectedStudyArea&&this.selectedStudyArea.WorkspaceID&&this.selectedStudyArea.RegionID){if(0==(a=this.studyAreaParameterList.filter(function(e){return!e.value||e.value<0}).map(function(e){return e.code})).length&&this.regionService.selectedRegion.Applications.indexOf("FDCTM")>-1&&a.push("drnarea"),a.length<1){var i=new r;return i.parameterLoaded=!0,this.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,this,i),this.toaster.clear(),void(this.parametersLoading=!1)}var n=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,a.join(",")),o=new WiM.Services.Helpers.RequestInfo(n,!0);o.withCredentials=!0,this.Execute(o).then(function(a){if(a.data.parameters&&a.data.parameters.length>0){e.toaster.clear();var i=!1;angular.forEach(a.data.parameters,function(e,t){e.hasOwnProperty("value")&&-999!=e.value?e.loaded=!0:(i=!0,console.error("Parameter failed to compute: ",e.code),e.loaded=!1)}),i&&(e.showModifyBasinCharacterstics=!0,e.toaster.pop("error","One or more basin characteristics failed to compute","Click the 'Calculate Missing Parameters' button or manually enter parameter values to continue",0));var n=a.data.parameters;e.loadParameterResults(n),e.getAdditionalFeatureList(),e.selectedStudyArea.Disclaimers.isRegulated&&e.loadRegulatedParameterResults(e.regulationCheckResults.parameters);var o=new r;o.parameterLoaded=!0,e.eventManager.RaiseEvent(t.onSelectedStudyParametersLoaded,e,o)}},function(t){e.toaster.clear(),e.toaster.pop("error","There was an HTTP error calculating basin characteristics","Please retry",0)}).finally(function(){e.parametersLoading=!1})}else alert("No Study Area")},i.prototype.getAdditionalFeatureList=function(){var e=this,t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSavailableFeatures.format(this.selectedStudyArea.WorkspaceID),r=new WiM.Services.Helpers.RequestInfo(t,!0);r.withCredentials=!0,this.Execute(r).then(function(t){if(t.data.featurecollection&&t.data.featurecollection.length>0){e.additionalFeaturesLoaded=!1;var r=[];angular.forEach(t.data.featurecollection,function(t,a){-1===e.selectedStudyArea.FeatureCollection.features.map(function(e){return e.id}).indexOf(t.name)&&r.push(t.name)}),e.getAdditionalFeatures(r.join(","))}else e.additionalFeaturesLoaded=!0},function(t){e.toaster.clear(),e.additionalFeaturesLoaded=!0,e.toaster.pop("error","There was an HTTP error requesting additional feautres list","Please retry",0)}).finally(function(){})},i.prototype.getAdditionalFeatures=function(e){var r=this;if(e){this.toaster.pop("wait","Downloading additional features","Please wait...",0);var a=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSfeatures.format(this.selectedStudyArea.WorkspaceID,4326,e),i=new WiM.Services.Helpers.RequestInfo(a,!0);i.withCredentials=!0,this.Execute(i).then(function(e){if(e.data.featurecollection&&e.data.featurecollection.length>0){r.toaster.clear();var a=r.reconfigureWatershedResponse(e.data.featurecollection);angular.forEach(a,function(e,i){if(a.length<1){for(var n=0;n<r.selectedStudyArea.FeatureCollection.features.length;n++)if(r.selectedStudyArea.FeatureCollection.features[n].id.toLowerCase()===e.id.toLowerCase()){r.selectedStudyArea.FeatureCollection.features.splice(n,1);break}}else r.selectedStudyArea.FeatureCollection.features.push(e);!e||"longestflowpath3d"!=e.id&&"longestflowpath"!=e.id?r.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,r,new WiM.Directives.LegendLayerAddedEventArgs(e.id,"geojson",{displayName:e.id,imagesrc:null},!1)):r.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,r,new WiM.Directives.LegendLayerAddedEventArgs(e.id,"geojson",{displayName:e.id,imagesrc:null},!0)),r.eventManager.RaiseEvent(t.onAdditionalFeaturesLoaded,r,"")})}r.additionalFeaturesLoaded=!0},function(e){r.toaster.clear(),r.toaster.pop("error","There was an HTTP error getting additional features","Please retry",0),r.additionalFeaturesLoaded=!0}).finally(function(){})}else this.additionalFeaturesLoaded=!0},i.prototype.queryLandCover=function(){var e=this;this.toaster.pop("wait","Querying Land Cover Data with your Basin","Please wait...",0);var t='{"geometryType":"esriGeometryPolygon","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polygon", "rings":['+JSON.stringify(this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry.coordinates)+"]}}]}",r=configuration.baseurls.NationalMapRasterServices+configuration.queryparams.NLCDQueryService,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",{InputLineFeatures:t,returnZ:!0,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(t){e.toaster.clear(),t.data.length>0&&e.toaster.pop("success","Land Cover was succcessfully queried","Please continue",5e3)},function(t){return e.toaster.pop("error","There was an HTTP error querying Land Cover","Please retry",0),e.$q.reject(t.data)}).finally(function(){})},i.prototype.queryCoordinatedReach=function(){var t=this;this.toaster.pop("wait","Checking if study area is a coordinated reach.","Please wait...",0);var r=this.snappedPourPoint,a=turf.point([r[0],r[1]]),i=[];[-90,0,90,180].forEach(function(e,t){var r=turf.destination(a,.005,e);i[t]=r.geometry.coordinates[t%2==0?0:1]});var n=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.coordinatedReachQueryService.format(this.selectedStudyArea.RegionID.toLowerCase(),i[0],i[1],i[2],i[3],this.selectedStudyArea.Pourpoint.crs,"eqWithStrID.Stream_Name,eqWithStrID.StreamID_ID,eqWithStrID.BASIN_NAME,eqWithStrID.BEGIN_DA,eqWithStrID.END_DA,eqWithStrID.DVA_EQ_ID,eqWithStrID.a10,eqWithStrID.b10,eqWithStrID.a25,eqWithStrID.b25,eqWithStrID.a50,eqWithStrID.b50,eqWithStrID.a100,eqWithStrID.b100,eqWithStrID.a500,eqWithStrID.b500"),o=new WiM.Services.Helpers.RequestInfo(n,!0);this.Execute(o).then(function(r){if(r.data.error)t.toaster.pop("error","There was an error querying coordinated reach",r.data.error.message,0);else if(r.data.features.length>0){var a=r.data.features[0].attributes;t.selectedStudyArea.CoordinatedReach=new e.Models.CoordinatedReach(a["eqWithStrID.BASIN_NAME"],a["eqWithStrID.DVA_EQ_ID"],a["eqWithStrID.Stream_Name"],a["eqWithStrID.StreamID_ID"],a["eqWithStrID.BEGIN_DA"],a["eqWithStrID.END_DA"]),delete a["eqWithStrID.BASIN_NAME"],delete a["eqWithStrID.DVA_EQ_ID"];for(var i=Object.keys(a).map(function(e,t){return e.substr("eqWithStrID.".length+1)}).filter(function(e,t,r){return r.indexOf(e)===t}),n=0;n<i.length;n++){var o=i[n],s=a["eqWithStrID.a"+o],g=a["eqWithStrID.b"+o];null!=s&&null!=g&&t.selectedStudyArea.CoordinatedReach.AddFlowCoefficient("PK"+o,s,g)}t.toaster.pop("success","Selected reach is a coordinated reach","Please continue",5e3)}},function(e){t.toaster.pop("error","There was an HTTP error querying coordinated reach","Please retry",0)})},i.prototype.queryRegressionRegions=function(){var e=this;this.toaster.pop("wait","Querying regression regions with your Basin","Please wait...",0),this.regressionRegionQueryLoading=!0,this.regressionRegionQueryComplete=!1;var t=configuration.baseurls.NSS+configuration.queryparams.RegressionRegionQueryService,r=this.simplify(angular.fromJson(angular.toJson(this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0]))).geometry,a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(r),{"Content-Type":"application/json","X-Is-StreamStats":!0});this.Execute(a).then(function(t){if(e.NSSServicesVersion=t.headers()["x-version"],e.toaster.clear(),!t.data.error)return 0==t.data.length?(e.regressionRegionQueryComplete=!0,e.selectedStudyArea.RegressionRegions=t.data,void e.toaster.pop("error","No regression regions were returned","Regression based scenario computation not allowed",0)):void(t.data.length>0&&(e.regressionRegionQueryComplete=!0,t.data.forEach(function(e){e.code=e.code.toUpperCase().split(",")}),e.selectedStudyArea.RegressionRegions=t.data,e.toaster.pop("success","Regression regions were succcessfully queried","Please continue",5e3)));e.toaster.pop("error","There was an error querying regression regions",t.data.error.message,0)},function(t){return e.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",0),e.$q.reject(t.data)}).finally(function(){e.regressionRegionQueryLoading=!1})},i.prototype.queryKarst=function(e,t){var r,a=this;this.toaster.pop("wait","Querying for Karst Areas","Please wait...",0),t.forEach(function(e){"ExcludePolys"==e[0]&&(r=e[1])}),this.regressionRegionQueryLoading=!0,this.regressionRegionQueryComplete=!1;var i={where:"1=1",geometry:'{"rings":'+angular.toJson(this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry.coordinates,null)+',"spatialReference":{"wkid":4326}}',geometryType:"esriGeometryPolygon",inSR:4326,spatialRel:"esriSpatialRelIntersects",outFields:"*",returnGeometry:!1,outSR:4326,returnIdsOnly:!1,returnCountOnly:!1,returnZ:!1,returnM:!1,returnDistinctValues:!1,returnTrueCurves:!1,f:"json"},n=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers+"/"+r+"/query",o=new WiM.Services.Helpers.RequestInfo(n,!0,WiM.Services.Helpers.methodType.POST,"json",i,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(o).then(function(e){if(a.toaster.clear(),200==e.status){a.toaster.pop("success","Karst regions were succcessfully queried","Please continue",5e3);var t=!1;e.data.features.length>0&&(e.data.features.forEach(function(e){2==e.attributes.ExcludeCode&&(t=!0,a.toaster.pop("warning","Warning",e.attributes.ExcludeReason,0),a.selectedStudyArea.Disclaimers.hasKarst=e.attributes.ExcludeReason)}),t||a.toaster.pop("success","No Karst found","Please continue",5e3))}else a.toaster.pop("error","Error","Karst region query failed",0)},function(e){return a.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",0),a.$q.reject(e.data)}).finally(function(){a.regressionRegionQueryLoading=!1})},i.prototype.queryNWIS=function(r){var a=this;if(r&&r.lng&&r.lat&&this.selectedStudyAreaExtensions){var i=this.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()});if(!(i.length<0)){var n=r,o=new L.Circle([n.lat,n.lng],100).getBounds(),s=configuration.baseurls.NWISurl+configuration.queryparams.NWISsite.format(o.getWest().toFixed(7),o.getSouth().toFixed(7),o.getEast().toFixed(7),o.getNorth().toFixed(7)),g=new WiM.Services.Helpers.RequestInfo(s,!0);this.Execute(g).then(function(r){if(r.data.error)a.toaster.pop("error","There was an error querying NWIS",r.data.error.message,0);else if(r.data){var n=[],o=r.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e}),s=o.shift().split("\t");o.shift();do{var g=o.shift().split("\t");if("00060"==g[s.indexOf("parm_cd")]){console.log(g[s.indexOf("site_no")]);var l=new e.Models.ReferenceGage(g[s.indexOf("site_no")],g[s.indexOf("station_nm")]);l.Latitude_DD=g[s.indexOf("dec_lat_va")],l.Longitude_DD=g[s.indexOf("dec_long_va")],n.push(l)}}while(o.length>0);n.length>0&&(i[0].options=n,i[0].value=n[0],a.toaster.pop("success","Found USGS NWIS index gage","Please continue",5e3),a.modalservices.openModal(t.SSModalType.e_extensionsupport),a.doSelectMapGage=!1)}},function(e){a.toaster.pop("warning","No USGS NWIS index gage found at this location.","Try zooming in closer or a different location",5e3)})}}},i.prototype.selectGage=function(r){var a=this.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()}),i=[],n=new e.Models.ReferenceGage(r.properties.Code,r.properties.Name);n.Latitude_DD=r.geometry.coordinates[0],n.Longitude_DD=r.geometry.coordinates[1],n.properties=r.properties,i.push(n),i.length>0&&(a[0].options=i,a[0].value=new e.Models.ReferenceGage("",""),this.modalservices.openModal(t.SSModalType.e_extensionsupport),this.doSelectNearestGage=!1)},i.prototype.getStreamgages=function(e,t,r,a){var i=this,n=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesBounds.format(e,t,r,a),o=new WiM.Services.Helpers.RequestInfo(n,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(o).then(function(e){i.streamgageLayer=e.data,i.streamgagesVisible=!0},function(e){i.toaster.clear(),i.toaster.pop("error","Error querying streamgage layer")})},i.prototype.GetKriggedReferenceGages=function(){var t=this,r=configuration.queryparams.KrigService.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.Pourpoint.Longitude,this.selectedStudyArea.Pourpoint.Latitude,this.selectedStudyArea.Pourpoint.crs,"5");if(this.selectedStudyAreaExtensions){var a=this.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()});if(!(a.length<0)){var i=new WiM.Services.Helpers.RequestInfo(r);this.Execute(i).then(function(r){for(var i=[],n=r.data,o=0;o<n.length;o++){var s=new e.Models.ReferenceGage(n[o].id,n[o].name);s.DrainageArea_sqMI=n[o].drainageArea,s.correlation=n[o].correlation,i.push(s)}i.length>0&&(a[0].options=i,a[0].value=new e.Models.ReferenceGage("",""),t.toaster.pop("success","Found index gages","Please continue",5e3))},function(e){t.toaster.pop("warning","No index gage found at this location.","Please try again",5e3)}).finally(function(){t._onStudyAreaServiceFinishedChanged.raise(null,WiM.Event.EventArgs.Empty)})}}},i.prototype.upstreamRegulation=function(){var e=this;this.toaster.pop("wait","Checking for Upstream Regulation","Please wait...",0),this.regulationCheckComplete=!1;var a=angular.toJson({type:"FeatureCollection",crs:{type:"ESPG",properties:{code:4326}},features:this.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})},null),i=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.regulationService.format(this.selectedStudyArea.RegionID.toLowerCase()),n=new WiM.Services.Helpers.RequestInfo(i,!0,WiM.Services.Helpers.methodType.POST,"json",{watershed:a,outputcrs:4326,f:"geojson"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(n).then(function(a){if(e.selectedStudyArea.Disclaimers.regulationChecked=!0,a.data.percentarearegulated>0){e.toaster.clear(),e.toaster.pop("success","Map updated with Regulated Area","Continue to 'Modify Basin Characteristics' to see area-weighted basin characteristics",5e3);var i=e.reconfigureWatershedResponse(a.data.featurecollection);e.selectedStudyArea.FeatureCollection.features.push(i[0]),e.regulationCheckResults=a.data,e.selectedStudyArea.Disclaimers.isRegulated=!0,e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,r.Empty)}else e.selectedStudyArea.Disclaimers.isRegulated=!1,e.toaster.clear(),e.toaster.pop("warning","No regulation found","Please continue",5e3)},function(t){e.toaster.clear(),e.toaster.pop("error","Error Checking for Upstream Regulation","Please retry",0)}).finally(function(){e.regulationCheckComplete=!0})},i.prototype.getflattenStudyArea=function(){var e=this,t=null;try{(t=this.selectedStudyArea.FeatureCollection).features.forEach(function(t){t.properties.Name=e.selectedStudyArea.WorkspaceID,t.id&&"globalwatershed"==t.id&&(t.properties=[t.properties,e.studyAreaParameterList.reduce(function(e,t){return e[t.code]=t.value,e},{})].reduce(function(e,t){return Object.keys(t).forEach(function(r){e[r]=t[r]}),e},{}))})}catch(e){t=null,console.log("Failed to flatted shapefile.")}return t},i.prototype.simplify=function(e){var t=0;try{var r=e.geometry.coordinates.reduce(function(e,t){return e+t.length},0);return r<5e3?e:(t=r<1e4?1e-4:r<1e5?.001:.01,this.toaster.pop("warning","Displaying simplified Basin.","See FAQ for more information.",0),turf.simplify(e,{tolerance:t,highQuality:!1,mutate:!0}))}catch(e){}},i.prototype.computeRegressionEquation=function(e){this.regtype=e,this.onSelectedStatisticsGroupChanged(),this.nssService.loadParametersByStatisticsGroup(this.selectedStudyArea.RegionID,"","GC1449, GC1450",[],e)},i.prototype.reconfigureWatershedResponse=function(e){var t=[];return e.forEach(function(e){for(var r=0;r<e.feature.features.length;r++){var a={type:"Feature",geometry:e.feature.features[r].geometry,id:e.feature.features.length>1&&e.feature.features[r].properties&&e.feature.features[r].properties.Name?e.name+"_"+e.feature.features[r].properties.Name.toLowerCase():e.name.toLowerCase(),properties:e.feature.features[r].properties};t.push(a)}}),t},i.prototype.loadParameterResults=function(e){var t=this.studyAreaParameterList,r=this;e.map(function(e){angular.forEach(t,function(t,a){if(e.code.toUpperCase().trim()===t.code.toUpperCase().trim()){if(void 0!=e.value&&"DRNAREA"==e.code.toUpperCase().trim()&&t.value!=e.value){var i=r.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+","+r.selectedStudyArea.Pourpoint.Longitude.toFixed(5),n=e.value;"square kilometers"==e.unit.toLowerCase().trim()&&(n/=2.59),gtag("event","Calculate",{Category:"DraingeArea",Location:i,Value:n.toFixed(0)})}return t.value=e.value,void(t.loaded=e.loaded)}})})},i.prototype.loadRegulatedParameterResults=function(e){this.toaster.pop("wait","Loading Regulated Basin Characteristics","Please wait...");var t=this.studyAreaParameterList;e.map(function(r){angular.forEach(t,function(a,i){if(r.code.toUpperCase().trim()!==a.code.toUpperCase().trim());else{switch(r.operation){case"Sum":a.unRegulatedValue=a.value-r.value;break;case"WeightedAverage":var n,o,s;angular.forEach(t,function(e,t){e.code==r.operationField&&(n=e.value)}),angular.forEach(e,function(e,t){e.code==r.operationField&&(o=e.value)}),s=r.value;var g=(a.value-o*(s/n))*(n/(n-o));a.unRegulatedValue=g}a.regulatedValue=r.value}})})},i.prototype.computeFlowAnywhereResults=function(){var e,t=this;this.studyAreaParameterList.forEach(function(t){"DRNAREA"==t.code&&(e=t.value)});var r={startdate:this.flowAnywhereData.dateRange.dates.startDate,enddate:this.flowAnywhereData.dateRange.dates.endDate,nwis_station_id:this.flowAnywhereData.selectedGage.StationID,parameters:[{code:"drnarea",value:e}],region:Number(this.flowAnywhereData.selectedGage.AggregatedRegion)},a=configuration.baseurls.FlowAnywhereRegressionServices+configuration.queryparams.FlowAnywhereEstimates.format(this.regionService.selectedRegion.RegionID),i=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(r));this.Execute(i).then(function(e){e.data?(t.flowAnywhereData.results=e.data,t.flowAnywhereData.estimatedFlowsArray=[],t.flowAnywhereData.results.EstimatedFlow.Observations.forEach(function(e,r){t.flowAnywhereData.estimatedFlowsArray.push({date:e.Date,estimatedFlow:e.Value,observedFlow:t.flowAnywhereData.results.ReferanceGage.Discharge.Observations[r].Value})}),t.flowAnywhereData.graphData={data:[{key:"Observed",values:t.processData(t.flowAnywhereData.results.ReferanceGage.Discharge.Observations,0)},{key:"Estimated",values:t.processData(t.flowAnywhereData.results.EstimatedFlow.Observations,1)}],options:{chart:{type:"lineChart",height:450,margin:{top:20,right:20,bottom:50,left:80},x:function(e){return new Date(e.x).getTime()},y:function(e){return e.y},useInteractiveGuideline:!1,interactive:!0,tooltips:!0,xAxis:{tickFormat:function(e){return d3.time.format("%x")(new Date(e))},rotateLabels:-30,showMaxMin:!0},yAxis:{axisLabel:"Discharge (cfs)",tickFormat:function(e){return null!=e?e.toUSGSvalue():e}},zoom:{enabled:!1},forceY:0}}}):(t.toaster.clear(),t.toaster.pop("error","Error","Error computing Flow Anywhere results",0))},function(e){t.toaster.clear(),t.toaster.pop("error","Error","Error computing Flow Anywhere results",0)}).finally(function(){})},i.prototype.processData=function(e,t){for(var r=[],a=new Date(Math.min.apply(null,e.map(function(e){return new Date(e.Date)}))),i=new Date(Math.max.apply(null,e.map(function(e){return new Date(e.Date)}))),n=a;n<=i;n.setDate(n.getDate()+1)){var o=e.filter(function(e){return new Date(e.Date).getTime()==n.getTime()})[0];void 0==o?r.push({x:n.getTime(),y:null}):r.push({x:n.getTime(),y:o.hasOwnProperty("Value")?"number"==typeof o.Value?o.Value.toUSGSvalue():o.Value:null})}return r},i.prototype.onStudyAreaChanged=function(e,t){this.selectedStudyArea&&this.selectedStudyArea.FeatureCollection&&this.regressionRegionQueryComplete},i.prototype.onNSSExtensionChanged=function(e,t){var r=this;t.extensions.forEach(function(e){-1==r.checkArrayForObj(r.selectedStudyArea.NSS_Extensions,e)&&r.selectedStudyArea.NSS_Extensions.push(e)})},i.prototype.onNSSExtensionResultsChanged=function(e,t){var r=this;t.results.forEach(function(e){var a=r.selectedStudyArea.NSS_Extensions.filter(function(t){return t.code==e.code});a.length<1||(a[0].parameters=angular.copy(e.parameters),void 0===a[0].result&&(a[0].result=[]),0==r.extensionResultsChanged&&(a[0].result=[]),a[0].result[r.extensionResultsChanged]=angular.copy(e.result),a[0].result[r.extensionResultsChanged].name=t.regressionRegionName)}),this.extensionResultsChanged++},i.prototype.afterSelectedStatisticsGroupChanged=function(){this.nssService.onSelectedStatisticsGroupChanged.unsubscribe(this.statisticgroupEventHandler)},i.prototype.onSelectedStatisticsGroupChanged=function(){this.nssService.onSelectedStatisticsGroupChanged.subscribe(this.statisticgroupEventHandler)},i.prototype.onQ10Available=function(){this.nssService.onQ10Loaded.subscribe(this.q10EventHandler)},i.prototype.afterQ10Loaded=function(){this.selectedStudyArea.wateruseQ10=this.nssService.selectedStatisticsGroupList[0].regressionRegions[0].results[0].value,this._onQ10Loaded.raise(null,WiM.Event.EventArgs.Empty),this.eventManager.UnSubscribeToEvent(t.onSelectedStudyParametersLoaded,this.parameterloadedEventHandler),this.nssService.selectedStatisticsGroupList=[],this.nssService.onQ10Loaded.unsubscribe(this.q10EventHandler)},i.prototype.updateExtensions=function(){var e=this;this.nssService.statisticsGroupList.forEach(function(t){t.regressionRegions&&t.regressionRegions.forEach(function(t){t.extensions&&(t.extensions=e.selectedStudyAreaExtensions)})})},i.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},i}(WiM.Services.HTTPServiceBase);function i(e,t,r,i,n,o,s){return new a(e,t,r,i,n,o,s)}i.$inject=["$http","$q","WiM.Event.EventManager","toaster","StreamStats.Services.ModalService","StreamStats.Services.nssService","StreamStats.Services.RegionService"],angular.module("StreamStats.Services").factory("StreamStats.Services.StudyAreaService",i)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use strict";t.onSelectExplorationMethod="onSelectExplorationMethod",t.onSelectedMethodExecuteComplete="onSelectedMethodExecuteComplete";var r=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(WiM.Event.EventArgs);t.ExplorationServiceEventArgs=r;var a,i=function(i){function n(e,r,a,n,o){var s=i.call(this,e,configuration.baseurls.StreamStatsServices)||this;return s.$q=r,s.eventManager=n,s.regionservice=o,s.toaster=a,s.drawElevationProfile=!1,s.drawMeasurement=!1,s.showElevationChart=!1,s.measurementData="",s._selectedMethod=null,s.networkNavResults=[],n.AddEvent(t.onSelectedStudyAreaChanged),s.selectElevationPoints=!1,s.DEMresolution="30m",s}return __extends(n,i),Object.defineProperty(n.prototype,"selectedMethod",{get:function(){return this._selectedMethod},enumerable:!1,configurable:!0}),n.prototype.elevationProfile=function(e){var t=this,r={InputLineFeatures:e,returnZ:!0,DEMResolution:this.DEMresolution,f:"json",MaximumSampleDistance:null};this.samplingDistance&&(r.MaximumSampleDistance=this.samplingDistance);var a=new WiM.Services.Helpers.RequestInfo("https://elevation.arcgis.com/arcgis/rest/services/Tools/ElevationSync/GPServer/Profile/execute",!0,WiM.Services.Helpers.methodType.POST,"json",r,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(e){if(console.log("elevation profile response: ",e.data),e.data&&e.data.results){var r=e.data.results[0].value.features[0].geometry.paths[0];if(r.length>0){var a=angular.fromJson(angular.toJson(r));e.data.results[0].value.fields.forEach(function(e){"ProfileLength"==e.name&&"Length Meters"==e.alias&&"meters"}),"meters"&&(r=r.map(function(e){return[e[0],e[1],3.28084*e[2]]}));var i=0;t.coordinateList=[[r[0][1].toFixed(5),r[0][0].toFixed(5),r[0][2].toFixed(2),i.toFixed(2)]];for(var n=1;n<r.length;n++){var o=L.latLng(r[n-1][1],r[n-1][0]),s=L.latLng(r[n][1],r[n][0]);i+=o.distanceTo(s),t.coordinateList.push([r[n][1].toFixed(5),r[n][0].toFixed(5),r[n][2].toFixed(2),(621371e-9*i).toFixed(2)])}t.elevationProfileGeoJSON={name:"NewFeatureType",type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:a},properties:""}]}}}else console.error("There was a zero length response from the elevation service"),t.toaster.clear(),t.toaster.pop("error","Error","No elevation results are available here",0)},function(e){console.error("There was an error requestion the elevation service"),t.toaster.clear(),t.toaster.pop("error","Error processing request","Please try again",0)}).finally(function(){})},n.prototype.getNavigationEndPoints=function(){var e=this,a=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices,i=new WiM.Services.Helpers.RequestInfo(a,!0);this.Execute(i).then(function(t){var r=t.data;e.navigationResources=r},function(a){e.toaster.pop("error","Error processing request","Please try again",0),e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,r.Empty)}).finally(function(){})},n.prototype.getNavigationConfiguration=function(e){var a=this,i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices+"/"+e,n=new WiM.Services.Helpers.RequestInfo(i,!0);this.Execute(n).then(function(t){var r=t.data;console.log("navigation config:",r),a.setMethod(e,r)},function(e){a.toaster.pop("error","Error processing request","Please try again",0),a.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,a,r.Empty)}).finally(function(){})},n.prototype.getCountByType=function(e,t){return e.filter(function(e){return e.valueType.toLowerCase().indexOf(t)>=0}).length},n.prototype.setMethod=function(i,n){null!=this._selectedMethod&&i===this._selectedMethod.navigationID&&(i=a.undefined),this._selectedMethod=new e.Models.NetworkNav(i,n),this.eventManager.RaiseEvent(t.onSelectExplorationMethod,this,r.Empty)},n.prototype.ExecuteSelectedModel=function(){var e=this;console.log("selected method:",this.selectedMethod);var a=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSNavigationServices+"/"+this.selectedMethod.navigationInfo.code+"/route";console.log("url: ",a);var i=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(this.selectedMethod.navigationConfiguration));this.Execute(i).then(function(a){var i=a.data;console.log("successfull navigation request results:",i);var n={feature:{features:[],type:"FeatureCollection"},name:"netnavroute"},o={feature:{features:[],type:"FeatureCollection"},name:"netnavpoints"};i.features.forEach(function(e,t){"Point"==e.geometry.type?o.feature.features.push(e):n.feature.features.push(e)}),n.feature.features.length>0&&e.networkNavResults.push(n),o.feature.features.length>0&&e.networkNavResults.push(o);var s=new r;s.features="FeatureCollection"===i.type?i:null,s.report="Report"==i.type?i:null,e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,s)},function(a){e.toaster.pop("error","Error processing request","Please try again",0),e.eventManager.RaiseEvent(t.onSelectedMethodExecuteComplete,e,r.Empty)}).finally(function(){})},n}(WiM.Services.HTTPServiceBase);function n(e,t,r,a,n){return new i(e,t,r,a,n)}!function(e){e[e[void 0]=0]="undefined",e[e.FLOWPATH=1]="FLOWPATH",e[e.NETWORKPATH=2]="NETWORKPATH",e[e.NETWORKTRACE=3]="NETWORKTRACE"}(a=t.ExplorationMethodType||(t.ExplorationMethodType={})),n.$inject=["$http","$q","toaster","WiM.Event.EventManager","StreamStats.Services.RegionService"],angular.module("StreamStats.Services").factory("StreamStats.Services.ExplorationService",n)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use strict";var t,r=function(){function e(e){this.modal=e}return e.prototype.openModal=function(e,t){void 0===t&&(t=null),t&&(this.modalOptions=t),this.modal.open(this.getModalSettings(e))},e.prototype.getModalSettings=function(e){try{switch(e){case t.e_exploration:return{templateUrl:"Views/explorationview.html",controller:"StreamStats.Controllers.ExplorationToolsModalController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_report:return{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController",size:"lg",backdropClass:"backdropZ",windowClass:"windowZ"};case t.e_wateruse:return{templateUrl:"Views/wateruse.html",controller:"StreamStats.Controllers.WateruseController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_stormrunnoff:return{templateUrl:"Views/stormrunoff.html",controller:"StreamStats.Controllers.StormRunoffController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_about:return{templateUrl:"Views/about.html",controller:"StreamStats.Controllers.AboutController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_help:return{templateUrl:"Views/help.html",controller:"StreamStats.Controllers.HelpController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_navreport:return{templateUrl:"Views/navreportmodal.html",controller:"StreamStats.Controllers.NavigationReportModalController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_prosper:return{templateUrl:"Views/prosperview.html",controller:"StreamStats.Controllers.ProsperController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_extensionsupport:return{templateUrl:"Views/extensionview.html",controller:"StreamStats.Controllers.ExtensionModalController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case t.e_gagepage:return{templateUrl:"Views/gagepage.html",controller:"StreamStats.Controllers.GagePageController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ modal-xl"};case t.e_nearestgages:return{templateUrl:"Views/nearestgages.html",controller:"StreamStats.Controllers.NearestGagesController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ modal-xl"};case t.e_flowanywhere:return{templateUrl:"Views/flowanywhere.html",controller:"StreamStats.Controllers.FlowAnywhereController",size:"sm",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};default:return null}}catch(e){return null}},e}();function a(e){return new r(e)}!function(e){e[e.e_report=1]="e_report",e[e.e_wateruse=2]="e_wateruse",e[e.e_about=3]="e_about",e[e.e_help=4]="e_help",e[e.e_navreport=5]="e_navreport",e[e.e_exploration=6]="e_exploration",e[e.e_stormrunnoff=7]="e_stormrunnoff",e[e.e_prosper=8]="e_prosper",e[e.e_extensionsupport=9]="e_extensionsupport",e[e.e_gagepage=10]="e_gagepage",e[e.e_nearestgages=11]="e_nearestgages",e[e.e_flowanywhere=12]="e_flowanywhere"}(t=e.SSModalType||(e.SSModalType={})),a.$inject=["$modal"],angular.module("StreamStats.Services").factory("StreamStats.Services.ModalService",a)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use strict";var t=function(t){function r(e,r,a,i){var n=t.call(this,e,configuration.baseurls.ScienceBase)||this;return n.$q=r,n.projectExtent=[[41.96765920367816,-125.48583984375],[49.603590524348704,-110.54443359375]],n.toaster=a,n.modalservices=i,n.init(),n}return __extends(r,t),Object.defineProperty(r.prototype,"SelectedPredictions",{get:function(){return this.AvailablePredictions.filter(function(e){return e.selected})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"Result",{get:function(){return this._result},enumerable:!1,configurable:!0}),r.prototype.ResetSelectedPredictions=function(){this.ResetResults(),this.AvailablePredictions.length<1||this.AvailablePredictions.forEach(function(e){return e.selected=!1})},r.prototype.ResetResults=function(){this._result=null},r.prototype.GetPredictionValues=function(t,r){var a=this;this.toaster.pop("wait","Querying prosper grids","Please wait...",0),this._result=null;var i=this.getPointArray(t.latlng).join(),n=this.getDisplayImageArray(t.originalEvent.srcElement).join(),o=this.boundsToExtentArray(r).join(),s=this.SelectedPredictions.map(function(e){return e.id}).join(),g=this.SelectedPredictions.filter(function(e){return e.id<8}).map(function(e){return e.id}),l=this.SelectedPredictions.filter(function(e){return e.id>7}).map(function(e){return e.id-8}),c=configuration.queryparams.ProsperPredictions+configuration.queryparams.ProsperIdentify.format(s,n,o,i,4326),A=configuration.queryparams.ProsperSPPPredictions1+configuration.queryparams.ProsperIdentify.format(g,n,o,i,4326),u=configuration.queryparams.ProsperSPPPredictions2+configuration.queryparams.ProsperIdentify.format(l,n,o,i,4326);this.$q.all([this.queryExecute(c),this.queryExecute(A),this.queryExecute(u)]).then(function(r){a.toaster.clear(),a._result={date:new Date,point:t.latlng,data:{SPC:null,SPP:null}};for(var i=[],n=0;n<r.length;n++){if(0==n)a._result.data.SPC=r[n];else if(1==n&&g.length>0)i=r[n];else if(2==n&&l.length>0){i=i.concat(r[n]);for(n=0;n<i.length;n++)i[n].name=i[n].name.charAt(0).toUpperCase()+i[n].name.slice(1).toLowerCase(),i[n].value=Math.round(100*i[n].value)/100}a._result.data.SPP=i}a.toaster.pop("success","Finished","See results report.",5e3),a.modalservices.openModal(e.SSModalType.e_prosper)},function(e){a.toaster.clear(),a.toaster.pop("error","There was an error querying prosper grids","Please retry",0)})},r.prototype.init=function(){this.CanQuery=!1,this._result=null,this.AvailablePredictions=[],this.loadAvailablePredictions()},r.prototype.loadAvailablePredictions=function(){var e=this;try{this.toaster.pop("wait","Loading Available Prosper Predictions","Please wait...",0);var t=configuration.queryparams.ProsperPredictions+"/legend?f=pjson",r=new WiM.Services.Helpers.RequestInfo(t);this.Execute(r).then(function(t){if(t.data.error)e.toaster.pop("error","There was an error querying prosper predictions",t.data.error.message,0);else{e.AvailablePredictions.length=0;var r=t.data.layers;r.length>0&&(r.map(function(t){return{id:t.layerId,name:e.getCleanLabel(t.layerName),selected:!1}}).forEach(function(t){return e.AvailablePredictions.push(t)}),e.DisplayedPrediction=e.AvailablePredictions[0]),e.toaster.clear()}},function(t){e.CanQuery=!1,e.toaster.clear(),e.toaster.pop("error","There was an error requesting available prosper predictions.","Please retry",1e4)})}catch(e){console.log("There was an error requesting available prosper predictions."+e)}},r.prototype.boundsToExtentArray=function(e){return[e.southWest.lng,e.southWest.lat,e.northEast.lng,e.northEast.lat]},r.prototype.getDisplayImageArray=function(e){return[e.width,e.height,96]},r.prototype.getPointArray=function(e){return[e.lng,e.lat]},r.prototype.getCleanLabel=function(e){return e.replace(/[^_]*_|\.[^/.]+$/g,"")},r.prototype.queryExecute=function(e){var t=this;return this.Execute(new WiM.Services.Helpers.RequestInfo(e)).then(function(e){if(t.toaster.clear(),e.data.error)throw console.log("query error"),e.data.error;if(e.data.results.length>0)return e.data.results.map(function(e){return{name:t.getCleanLabel(e.layerName),value:e.attributes["Pixel Value"]}})},function(e){throw e})},r}(WiM.Services.HTTPServiceBase);function r(e,r,a,i){return new t(e,r,a,i)}r.$inject=["$http","$q","toaster","StreamStats.Services.ModalService"],angular.module("StreamStats.Services").factory("StreamStats.Services.ProsperService",r)}(e.Services||(e.Services={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Controllers",[])}(),function(e){!function(t){"use strict";var r=function(){return function(){this.lat=0,this.lng=0}}(),a=function(){return function(e,t,r){this.lat=e,this.lng=t,this.zoom=r}}(),i=function(){return function(e,t,r,a,i){void 0===i&&(i=void 0),this.name=e,this.url=t,this.type=r,this.visible=a,this.layerOptions=i}}(),n=function(){return function(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=!0),this.maxZoom=e,this.minZoom=t,this.zoomControl=r}}(),o=function(){function t(t,r,a,i,n,o,s,g,l,c,A,u,d,C,I,h,p){var f=this;this.$scope=t,this.$compile=r,this._prosperServices=d,this.modal=I,this.modalStack=h,this.center=null,this.layers=null,this.mapDefaults=null,this.mapPoint=null,this.bounds=null,this.markers=null,this.paths=null,this.geojson=null,this.events=null,this.layercontrol=null,this.regionLayer=null,this._prosperIsActive=!1,this.explorationToolsExpanded=!1,this.gageLegendFix=!1,this.regionLegendFix=!1,this.nonsimplifiedBasinStyle={displayName:"Non-Simplified Basin",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANkAAADJCAYAAACuaJftAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKsSURBVHhe7dwxbsJAEEBRkyPQU3L/A1HScwWCFEuRkEDB7I+t5L2Grei+lmEs7643E5D5mD+BiMggJjKIiQxiIoOYyCD2a3/hXw7H+QTbsz+f5tN4bjKIiQxiIoPYsJnMzMV/8soM5yaDmMggJjKILZ7JzGDw7dmM5iaDmMggJjKIiQxiIoOYyCAmMoj9eE9mLwaP2ZPBikQGMZFBzLOLMICZDFYkMoiJDGIig5jIICYyiIkMYvZksID3LsKGiAxiIoOYmQwG8OwirEhkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnEvOMDFvDeRdgQkUFMZBAzkz3wym9ueMZNBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQExnERAYxkUFMZBATGcREBjGRQUxkEBMZxEQGMZFBTGQQ211v5vNbLofjfPob9ufTfIL3uMkgJjKIiQxiIoOYyCAmMoiJDGLD9mT3Ru/N7vdW9ffDKG4yiIkMYiKDWDaTAV/cZBATGcREBjGRQUxkEBMZxEQGMZFBTGSQmqZPLJhZUkx8RY8AAAAASUVORK5CYII=",fillColor:"red",weight:2,opacity:1,color:"red",fillOpacity:.5},this.imageryToggled=!1,t.vm=this,this.toaster=a,this.searchService=g,this.$locationService=i,this.regionServices=l,this.leafletBoundsHelperService=o,this.leafletData=s,this.studyArea=c,this.nssService=A,this.explorationService=u,this.eventManager=C,this.cursorStyle="pointer",this.environment=configuration.environment,this.selectedExplorationTool=null,this.init(),this.eventManager.SubscribeToEvent(e.Services.onAdditionalFeaturesLoaded,new WiM.Event.EventHandler(function(){f.onAdditionalFeaturesLoaded()})),this.eventManager.SubscribeToEvent(e.Services.onSelectedStudyAreaChanged,new WiM.Event.EventHandler(function(){f.onSelectedStudyAreaChanged()})),this.eventManager.SubscribeToEvent(WiM.Directives.onLayerChanged,new WiM.Event.EventHandler(function(e,t){f.onLayerChanged(e,t)})),this.eventManager.SubscribeToEvent(WiM.Services.onSelectedAreaOfInterestChanged,new WiM.Event.EventHandler(function(e,t){f.onSelectedAreaOfInterestChanged(e,t)})),this.eventManager.SubscribeToEvent(e.Services.onSelectedRegionChanged,new WiM.Event.EventHandler(function(){f.onSelectedRegionChanged()})),this.eventManager.SubscribeToEvent(e.Services.onEditClick,new WiM.Event.EventHandler(function(e,t){f.basinEditor()})),this.eventManager.SubscribeToEvent(e.Services.onStudyAreaReset,new WiM.Event.EventHandler(function(){f.removeGeoJson()})),this.eventManager.SubscribeToEvent(e.Services.onSelectedMethodExecuteComplete,new WiM.Event.EventHandler(function(e,t){f.onExplorationMethodComplete(e,t)})),this.eventManager.SubscribeToEvent(e.Services.onSelectExplorationMethod,new WiM.Event.EventHandler(function(e,t){0!=e.selectedMethod.navigationID&&f.onSelectExplorationMethod(e,t),0==e.selectedMethod.navigationID&&(f.selectedExplorationTool=null)})),t.$on("leafletDirectiveMap.mainMap.zoomend",function(e,t){f.regionServices.selectedRegion&&f.center.zoom>8&&"ME"==f.regionServices.selectedRegion.RegionID&&f.updateLegendText("MeanAugustBaseflow")}),t.$on("leafletDirectiveMap.mainMap.mousemove",function(e,t){var r=t.leafletEvent.latlng;f.mapPoint.lat=r.lat,f.mapPoint.lng=r.lng,f.studyArea.doDelineateFlag&&(f.cursorStyle="crosshair")}),t.$on("leafletDirectiveMap.mainMap.drag",function(e,t){f.cursorStyle="grabbing"}),t.$on("leafletDirectiveMap.mainMap.dragend",function(e,t){f.cursorStyle="pointer"}),t.$on("leafletDirectiveMap.mainMap.click",function(t,r){if(f._prosperServices.CanQuery)f._prosperServices.GetPredictionValues(r.leafletEvent,f.bounds);else if(f.studyArea.doDelineateFlag)f.checkDelineatePoint(r.leafletEvent.latlng);else if(!f.studyArea.showEditToolbar&&!f.explorationService.drawMeasurement&&!f.explorationService.drawElevationProfile)if(f.studyArea.doSelectMapGage)f.studyArea.queryNWIS(r.leafletEvent.latlng);else if(null!=u.selectedMethod&&u.selectedMethod.locations.length<=u.selectedMethod.minLocations){console.log("in mapcontroller add point",u.selectedMethod.navigationPointCount,u.selectedMethod.locations.length),"Start point location"==u.explorationPointType&&u.selectedMethod.addLocation("Start point location",new WiM.Models.Point(r.leafletEvent.latlng.lat,r.leafletEvent.latlng.lng,"4326")),"End point location"==u.explorationPointType&&u.selectedMethod.addLocation("End point location",new WiM.Models.Point(r.leafletEvent.latlng.lat,r.leafletEvent.latlng.lng,"4326"));for(var a=0;a<u.selectedMethod.locations.length;a++){var i=u.selectedMethod.locations[a];f.markers["netnav_"+a]={lat:i.Latitude,lng:i.Longitude,message:u.selectedMethod.navigationName,focus:!0,draggable:!1}}f.modal.openModal(e.Services.SSModalType.e_exploration)}else f.queryPoints(r.leafletEvent)}),t.$watch(function(){return f.bounds},function(e,t){return f.mapBoundsChange(t,e)}),t.$watch(function(){return f.explorationService.elevationProfileGeoJSON},function(e,t){e&&f.displayElevationProfile()}),t.$watch(function(){return f.explorationService.drawElevationProfile},function(t,r){t&&f.modal.openModal(e.Services.SSModalType.e_exploration)}),t.$watch(function(){return f.explorationService.selectElevationPoints},function(e,t){e&&f.elevationProfile()}),t.$watch(function(){return f.explorationService.drawMeasurement},function(e,t){e&&f.measurement()}),t.$watch(function(){return f.regionServices.regionMapLayerListLoaded},function(e,t){e&&f.addRegionOverlayLayers(f.regionServices.selectedRegion.RegionID)}),t.$watch(function(){return f._prosperServices.DisplayedPrediction},function(e,t){e&&f.ProsperIsActive&&(f.removeOverlayLayers("prosper",!0),f.AddProsperLayer(e.id))}),t.$on("$locationChangeStart",function(){return f.updateRegion()}),n.rcode&&(this.regionServices.loadParametersByRegion(),this.setBoundsByRegion(n.rcode)),n.rcode&&n.workspaceID&&(this.regionServices.loadParametersByRegion(),this.studyArea.loadWatershed(n.rcode,n.workspaceID)),t.$watch(function(){return f.studyArea.regressionRegionQueryComplete},function(e,t){e&&f.studyArea.selectedStudyArea.RegressionRegions&&f.nssService.loadStatisticsGroupTypes(f.regionServices.selectedRegion.RegionID,f.studyArea.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","))}),t.$watch(function(){return f.studyArea.streamgageLayer},function(e,t){e!=t&&f.addGeoJSON("streamgages",e)})}return Object.defineProperty(t.prototype,"selectedExplorationMethodType",{get:function(){return null==this.explorationService.selectedMethod?0:this.explorationService.selectedMethod.navigationID},set:function(e){this.explorationService.setMethod(e,{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ProsperIsActive",{get:function(){return this._prosperIsActive},enumerable:!1,configurable:!0}),t.prototype.setExplorationMethodType=function(e){this.removeGeoJsonLayers("netnav_",!0),this.explorationService.getNavigationConfiguration(e)},t.prototype.ExecuteNav=function(){if(this.explorationService.selectedMethod.locations.length==this.explorationService.selectedMethod.minLocations){this.explorationService.explorationMethodBusy=!0,this.explorationService.ExecuteSelectedModel()}else this.toaster.pop("warning","Warning","You must select at least "+this.explorationService.selectedMethod.minLocations+" points.",1e4)},t.prototype.ToggleProsper=function(){this._prosperIsActive?(this._prosperIsActive=!1,this._prosperServices.CanQuery=!1,this.removeOverlayLayers("prosper",!0)):(this._prosperIsActive=!0,this.AddProsperLayer(this._prosperServices.DisplayedPrediction.id),this.ConfigureProsper())},t.prototype.ConfigureProsper=function(){this.modal.openModal(e.Services.SSModalType.e_prosper)},t.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modal.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},t.prototype.init=function(){this.setupMap(),this.explorationService.getNavigationEndPoints()},t.prototype.setupMap=function(){this.center=new a(39,-100,4),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers},this.mapDefaults=new n(null,3,!0),this.markers={},this.paths={},this.geojson={},this.regionLayer={};var e=600;$(window).width()<768&&(e=.7*$(window).width()),this.controls={scale:!0,draw:{draw:{polygon:!1,polyline:!1,rectangle:!1,circle:!1,circlemarker:!1,marker:!1}},custom:new Array(L.control.locate({follow:!1,locateOptions:{maxZoom:15}}),L.control.elevation({imperial:!0,width:e}))},this.events={map:{enable:["mousemove"]}},this.mapPoint=new r,L.Icon.Default.imagePath="images"},t.prototype.scaleLookup=function(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}},t.prototype.queryPoints=function(e){var t=this;this.toaster.pop("wait","Information","Querying Points...",0),this.cursorStyle="wait",this.markers={},this.leafletData.getMap("mainMap").then(function(r){t.leafletData.getLayers("mainMap").then(function(a){if(r.getZoom()<=8)return t.cursorStyle="pointer",t.toaster.clear(),void t.toaster.pop("warning","Warning","You must be at Zoom Level 9 or greater to query points",5e3);t.queryContent={requestCount:0,Content:$("<div>").attr("id","popupContent"),responseCount:0};var i,n=function(n){if(!a.overlays.hasOwnProperty(n))return"continue";if(["MaskLayer","draw"].indexOf(n)>-1)return"continue";if(!r.hasLayer(a.overlays[n]))return"continue";switch(t.layers.overlays[n].type){case"agsFeature":a.overlays[n].query().nearby(e.latlng,4).returnGeometry(!1).run(function(a,i){return t.handleQueryResult(n,a,i,r,e.latlng)});break;default:i=n,a.overlays[n].identify().on(r).at(e.latlng).returnGeometry(!1).tolerance(5).run(function(a,n){return t.handleQueryResult(i,a,n,r,e.latlng)})}t.queryContent.requestCount++};for(var o in a.overlays)n(o)})})},t.prototype.handleQueryResult=function(e,t,r,a,i){var n=this,o=$("<div>").attr("id",e).appendTo(this.queryContent.Content);if(this.queryContent.requestCount--,r.features.forEach(function(t){n.layers.overlays[e].hasOwnProperty("layerArray")&&n.layers.overlays[e].layerArray.forEach(function(r){if(r.layerId===t.layerId&&!(["StreamGrid","ExcludePolys","Region","Subregion","Basin","Subbasin","Watershed","Subwatershed"].indexOf(r.layerName)>-1))if(o.append("<h5>"+r.layerName+"</h5>"),n.queryContent.responseCount++,gtag("event","ExplorationTools",{Category:"QueryPoints"}),n.layers.overlays[e].hasOwnProperty("queryProperties")&&n.layers.overlays[e].queryProperties.hasOwnProperty(r.layerName)){var a=n.layers.overlays[e].queryProperties[r.layerName];Object.keys(a).map(function(e){if("Streamgages"==r.layerName&&"FeatureURL"==e){var i='</br><br><button ng-click="'+("vm.openGagePage('"+t.properties[e].split("site_no=")[1]+"')")+'" type="button" class="btn-blue fullwidth">Open StreamStats Gage Page</button>';o.append(i),gtag("event","ExplorationTools",{Category:"QueryStreamgage"})}else"Mean August Baseflow"==r.layerName?("Drainage Area out-of-bounds"!=a[e]&&"Mean July Precip out-of-bounds"!=a[e]&&"% Aquifer Area out-of-bounds"!=a[e]&&"Regulated stream/river"!=a[e]||(0==t.properties[e]?t.properties[e]="No":1==t.properties[e]&&(t.properties[e]="Yes")),o.append("<strong>"+a[e]+": </strong>"+t.properties[e]+"</br>")):o.append("<strong>"+a[e]+": </strong>"+t.properties[e]+"</br>")})}else angular.forEach(t.properties,function(e,t){o.append("<strong>"+t+": </strong>"+e+"</br>")})})}),this.queryContent.requestCount<1)if(this.toaster.clear(),this.cursorStyle="pointer",this.queryContent.responseCount>0){var s=this.queryContent.Content.html(),g=this.$compile(s)(this.$scope),l=0;g.toArray().forEach(function(e,t){e.innerHTML.length>0&&(l=t)}),a.openPopup(g[l],[i.lat,i.lng],{maxHeight:200})}else this.toaster.pop("warning","Information","No points were found at this location",5e3)},t.prototype.elevationProfile=function(){var e,t=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.measurementData="",this.explorationService.showElevationChart=!0,this.controls.custom.forEach(function(t){t._container.className.indexOf("elevation")>-1&&(e=t)}),gtag("event","ExplorationTools",{Category:"ElevationProfile"}),this.leafletData.getMap("mainMap").then(function(r){t.leafletData.getLayers("mainMap").then(function(a){a.overlays.draw.clearLayers(),t.drawController({metric:!1},!0),delete t.geojson.elevationProfileLine3D,r.on("draw:drawstart",function(t){e.clear()}),r.on("draw:created",function(e){r.removeEventListener("draw:created");var a=e.layer.toGeoJSON(),i='{"geometryType":"esriGeometryPolyline","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polyline", "paths":['+JSON.stringify(a.geometry.coordinates)+"]}}]}";t.toaster.pop("wait","Information","Querying the elevation service...",0),t.explorationService.elevationProfile(i),t.explorationService.drawElevationProfile=!1,r.panBy([0,1])})})})},t.prototype.drawController=function(e,t){var r=this;if(!t)return this.drawControl.disable(),void(this.drawControl=void 0);this.leafletData.getMap("mainMap").then(function(t){r.drawControl=new L.Draw.Polyline(t,e),r.drawControl.enable()})},t.prototype.displayElevationProfile=function(){var t,r=this;this.controls.custom.forEach(function(e){e._container&&e._container.className.indexOf("elevation")>-1&&(t=e)}),this.geojson.elevationProfileLine3D={data:this.explorationService.elevationProfileGeoJSON,style:{color:"#ff7800",weight:5,opacity:.65},onEachFeature:t.addData.bind(t)},this.leafletData.getMap("mainMap").then(function(a){var i=t.onAdd(a);r.explorationService.elevationProfileHTML=i.innerHTML,r.modal.openModal(e.Services.SSModalType.e_exploration),delete r.geojson.elevationProfileLine3D}),this.toaster.clear(),this.cursorStyle="pointer",this.selectedExplorationTool=null},t.prototype.showLocation=function(){var e,t=this;gtag("event","ExplorationTools",{Category:"ShowLocation"}),this.controls.custom.forEach(function(t){t._container.className.indexOf("leaflet-control-locate")>-1&&(e=t)}),e.start(),this.leafletData.getMap("mainMap").then(function(e){e.on("locationfound",function(){t.selectedExplorationTool=null})})},t.prototype.resetExplorationTools=function(){var e=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.elevationProfileHTML="",this.drawControl&&this.drawController({},!1),this.explorationService.measurementData="",this.explorationService.drawElevationProfile=!1,this.explorationService.drawMeasurement=!1,this.explorationService.selectElevationPoints=!1,delete this.geojson.elevationProfileLine3D,this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(r){r.overlays.draw.clearLayers(),e.measurestart&&t.off("click",e.measurestart),e.measuremove&&t.off("mousemove",e.measuremove),e.measurestop&&t.off("draw:created",e.measurestop)})}),this.explorationService.networkNavResults=[],this.selectedExplorationMethodType=0,this.removeMarkerLayers("netnav_",!0),this.removeGeoJsonLayers("netnavpoints",!0),this.removeGeoJsonLayers("netnavroute",!0),this.selectedExplorationTool=null,this.explorationService.explorationPointType=null},t.prototype.measurement=function(){var e=this;this.explorationService.measurementData="Click the map to begin\nDouble click to end the Drawing",gtag("event","ExplorationTools",{Category:"Measurement"}),this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(r){var a=!1;e.drawController({shapeOptions:{color:"blue"},metric:!1},!0);var i=r.overlays.draw;i.clearLayers(),e.measuremove=function(){e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString()},e.measurestart=function(){0==a&&(a=!0,e.explorationService.measurementData="Total Length: ",t.on("mousemove",e.measuremove))},e.measurestop=function(r){var a=r.layer;i.addLayer(a),i.addTo(t);var n=null,o=0;$.each(r.layer._latlngs,function(e,t){null!=n?(o+=n.distanceTo(t),n=t):n=t}),e.explorationService.measurementData="Total length: "+(3.28084*o).toFixed(0)+" ft",t.off("click",e.measurestart),t.off("mousemove",e.measuremove),t.off("draw:created",e.measurestop),e.drawControl.disable(),e.explorationService.drawMeasurement=!1,e.selectedExplorationTool=null},t.on("click",e.measurestart),t.on("draw:created",e.measurestop)})})},t.prototype.checkDelineatePoint=function(e){var t=this;this.leafletData.getMap("mainMap").then(function(r){t.leafletData.getLayers("mainMap").then(function(a){if(r.getZoom()<15)t.toaster.pop("error","Delineation not allowed at this zoom level","Please zoom in to level 15 or greater",5e3);else{t.toaster.clear(),t.studyArea.checkingDelineatedPoint=!0,t.toaster.pop("info","Information","Validating your clicked point...",!0,0),t.cursorStyle="wait",t.markers={},t.markers.pourpoint={lat:e.lat,lng:e.lng,message:"Your clicked point</br></br><strong>Latitude: </strong>"+e.lat.toFixed(5)+"</br><strong>Longitude: </strong>"+e.lng.toFixed(5),focus:!0,draggable:!0},t.studyArea.doDelineateFlag=!1;var i="visible:";t.regionServices.regionMapLayerList.forEach(function(e){"ExcludePolys"==e[0]&&(i+=e[1])}),gtag("event","DelineationClick",{Region:t.regionServices.selectedRegion.Name,Location:e}),r.invalidateSize();var n;t.regionServices.selectedRegion.RegionID;if("visible:"===i)return t.toaster.clear(),t.toaster.pop("warning","Selected State/Region does not have exlusion areas defined","Delineating with no exclude polygon layer...",!0,0),t.startDelineate(e,!0),gtag("event","ValidatePoint",{Label:"Not advised (no point query)"}),void(t.cursorStyle="pointer");for(var o in a.overlays)for(var s in t.layers.overlays)s===o&&void 0!==t.layers.overlays[s].layerArray&&"ExcludePolys"===t.layers.overlays[s].layerArray[0].layerName&&(n=o);a.overlays[n].identify().on(r).at(e).returnGeometry(!1).layers(i).run(function(r,a){if(t.toaster.clear(),0==a.features.length)gtag("event","ValidatePoint",{Label:"Valid"}),t.toaster.pop("success","Your clicked point is valid","Delineating your basin now...",5e3),t.studyArea.checkingDelineatedPoint=!1,t.startDelineate(e,!1);else{t.studyArea.checkingDelineatedPoint=!1;var i=a.features[0].properties.ExcludeCod,n=a.features[0].properties.ExcludeRea;1==i?(t.toaster.pop("error","Delineation and flow statistic computation not allowed here",n,0),gtag("event","ValidatePoint",{Label:"Not allowed"})):(t.toaster.pop("warning","Delineation and flow statistic computation possible but not advised",n,!0,0),t.startDelineate(e,!0,n),gtag("event","ValidatePoint",{Label:"Not advised"}))}t.cursorStyle="pointer"})}})})},t.prototype.basinEditor=function(){var e=this;this.leafletData.getMap("mainMap").then(function(t){e.leafletData.getLayers("mainMap").then(function(r){var a=r.overlays.draw;a.clearLayers(),new L.Draw.Polygon(t,a).enable(),t.on("draw:created",function(r){t.removeEventListener("draw:created");var i=r.layer;a.addLayer(i);var n=i.toGeoJSON();"add"==e.studyArea.drawControlOption&&(e.checkEditIntersects("adds",n)?e.toaster.pop("warning","Warning","Overlapping add and remove edit areas are not allowed",5e3):(e.addGeoJSON("adds",n),gtag("event","BasinEditor",{Type:"Add Area"}),e.studyArea.WatershedEditDecisionList.append.push(n))),"remove"==e.studyArea.drawControlOption&&(e.checkEditIntersects("removes",n)?e.toaster.pop("warning","Warning","Overlapping add and remove edit areas are not allowed",5e3):(e.addGeoJSON("removes",n),gtag("event","BasinEditor",{Type:"Remove Area"}),e.studyArea.WatershedEditDecisionList.remove.push(n))),a.clearLayers()})})})},t.prototype.checkEditIntersects=function(e,t){var r,a=!1;return r="adds"===e?"removes":"adds",this.geojson.hasOwnProperty(r)&&this.geojson[r].data.features.forEach(function(e){void 0!=turf.intersect(t,e)&&(a=!0)}),a},t.prototype.canSelectExplorationTool=function(t){switch(t){case e.Services.ExplorationMethodType.NETWORKPATH:case e.Services.ExplorationMethodType.FLOWPATH:case e.Services.ExplorationMethodType.NETWORKTRACE:break;default:return!1}return!0},t.prototype.onExplorationMethodComplete=function(t,r){var a=this;gtag("event","ExplorationTools",{Category:"networknav-"+this.explorationService.selectedMethod.navigationInfo.code}),this.explorationService.explorationMethodBusy=!1,null!=r.features&&r.features.features.length>0&&(this.removeMarkerLayers("netnav_",!0),this.explorationService.networkNavResults.forEach(function(e,t){a.addGeoJSON(e.name,e.feature),"netnavroute"==e.name&&a.leafletData.getMap("mainMap").then(function(t){var r=L.geoJson(e.feature);t.fitBounds(r.getBounds())}),a.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,a,new WiM.Directives.LegendLayerAddedEventArgs(e.name,"geojson",a.geojson[e.name].style))}),this.selectedExplorationMethodType=0,this.selectedExplorationTool=null,this.modalStack.dismissAll()),null!=r.report&&""!=r.report&&this.modal.openModal(e.Services.SSModalType.e_navreport,{placeholder:r.report})},t.prototype.onSelectExplorationMethod=function(t,r){this.modal.openModal(e.Services.SSModalType.e_exploration)},t.prototype.onSelectedAreaOfInterestChanged=function(e,t){gtag("event","Search",{}),this.paths={};var r=t.selectedAreaOfInterest;this.paths.AOI={type:"circleMarker",radius:15,color:"#ff0000",fillOpacity:.6,stroke:!1,latlngs:{lat:r.properties.Lat,lng:r.properties.Lon}},this.leafletData.getMap("mainMap").then(function(e){e.fitBounds([[r.properties.LatMin,r.properties.LonMin],[r.properties.LatMax,r.properties.LonMax]]),setTimeout(function(){e.getZoom()<8&&e.setZoom(8)},500),e.openPopup($.map(Object.keys(r.properties),function(e){if(-1!=["Label","ElevFt","Lat","Lon","Source"].indexOf(e))return"<b>"+e+": </b>"+r.properties[e]}).join("<br/>"),[r.properties.Lat,r.properties.Lon])})},t.prototype.onSelectedRegionChanged=function(){this.regionServices.selectedRegion&&(this.removeOverlayLayers("_region",!0),this.studyArea.zoomLevel15&&!this.imageryToggled&&this.regionServices.selectedRegion.Applications.some(function(e){return["StormDrain","Localres"].indexOf(e)>-1})&&this.toggleImageryLayer(),this.regionServices.loadMapLayersByRegion(this.regionServices.selectedRegion.RegionID))},t.prototype.onAdditionalFeaturesLoaded=function(){var e=this;this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.FeatureCollection&&(this.studyArea.selectedStudyArea.FeatureCollection.features.forEach(function(t){var r=angular.fromJson(angular.toJson(t));"longestflowpath3d"!==r.id&&"longestflowpath"!==r.id||e.addGeoJSON(r.id,r.geometry)}),this.toaster.pop("success","Additional features have been downloaded","Please continue",5e3))},t.prototype.onSelectedStudyAreaChanged=function(){var e,t=this;if(this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.FeatureCollection&&(this.markers={},this.removeOverlayLayers("globalwatershed",!0),this.studyArea.selectedStudyArea.FeatureCollection.features.forEach(function(e){var r=angular.fromJson(angular.toJson(e)),a=r.id.toLowerCase();t.addGeoJSON(a,r),t.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,t,new WiM.Directives.LegendLayerAddedEventArgs(a,"geojson",t.geojson[a].style))}),this.studyArea.selectedStudyArea.FeatureCollection.bbox&&(e=this.studyArea.selectedStudyArea.FeatureCollection.bbox,this.leafletData.getMap("mainMap").then(function(t){t.fitBounds([[e[1],e[0]],[e[3],e[2]]],{})})),this.regionServices.selectedRegion.Applications.indexOf("KarstCheck")>-1&&this.studyArea.queryKarst(this.regionServices.selectedRegion.RegionID,this.regionServices.regionMapLayerList),!this.nssService.queriedRegions)){if(!this.regionServices.selectedRegion.ScenariosAvailable)return void(this.studyArea.regressionRegionQueryComplete=!0);this.nssService.queriedRegions=!0}},t.prototype.AddProsperLayer=function(e){this.layers.overlays["prosper"+e]=new i("Prosper Layer",configuration.baseurls.ScienceBase+configuration.queryparams.ProsperPredictions,"agsDynamic",!0,{opacity:1,layers:[e],format:"png8",f:"image"})},t.prototype.removeGeoJson=function(e){for(var t in void 0===e&&(e=""),void 0==this.geojson.nonsimplifiedbasin&&void 0!=this.nonsimplifiedBasin&&(this.eventManager.RaiseEvent(WiM.Directives.onLayerRemoved,this,new WiM.Directives.LegendLayerRemovedEventArgs("nonsimplifiedbasin","geojson")),this.nonsimplifiedBasin=void 0),this.geojson)"function"==typeof this.geojson[t]||"streamgages"==t&&t!=e||(delete this.geojson[t],this.eventManager.RaiseEvent(WiM.Directives.onLayerRemoved,this,new WiM.Directives.LegendLayerRemovedEventArgs(t,"geojson")))},t.prototype.addGeoJSON=function(e,t){if("globalwatershed"==e){var r=t.geometry.coordinates.reduce(function(e,t){return e+t.length},0),a=this.studyArea.simplify(angular.copy(t)),i=a.geometry.coordinates.reduce(function(e,t){return e+t.length},0);this.geojson[e]={data:a,style:{displayName:"Basin Boundary",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADCCAYAAAC/i6XiAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKOSURBVHhe7dxBjoJAEEBRcO/9D+oBlElYTEwmE7XlI763kS2Ln0qlsefrYgIyp/UXiIgQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGL7+GztMq8PEDi3CZiEEBMhxEQIsW12QjsfRzJ4hzQJISZCiIkQYu/ZCe2AfJMXd0STEGIihJgIISZCiIkQYiKEmAghNuac0Lkg38w5IXw2EUJMhBATIcRECDERQkyEEBMhxEQIMRFCTIQQ8+0oPMq9o3AsIoSYCCFmJ4RX+T8hfDYRQkyEEBMhxEQIMRFCTIQQEyHERAgxEUJMhBATIcRECDERQkyEEBMhxEQIMRFCTIQQc8cMPMq9o3AsIoSYCCFmJ4R7g3e+/5iEEBMhxEQIMTvhj413APjNJISYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIiRBiIoSYCCEmQoiJEGIihJgIISZCiIkQYiKEmAghJkKIzdfF+jzOZV4fduo8/pXhWSYhxEQIMRFCTIQQEyHERAgxEULsPeeE9+pzQ+eC7JhJCDERQkyEENtmJwT+ZBJCTISQmqYb05tLRBeJJLsAAAAASUVORK5CYII=",fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}},r!=i&&(this.nonsimplifiedBasin=t,this.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,this,new WiM.Directives.LegendLayerAddedEventArgs("nonsimplifiedbasin","geojson",this.nonsimplifiedBasinStyle,!1)))}else if("nonsimplifiedbasin"==e)this.geojson[e]={data:t,style:this.nonsimplifiedBasinStyle};else if("globalwatershedpoint"==e){var n=this.studyArea.selectedStudyArea.Pourpoint.Latitude,o=this.studyArea.selectedStudyArea.Pourpoint.Longitude,s=this.studyArea.selectedStudyArea.RegionID,g=this.studyArea.selectedStudyArea.WorkspaceID;this.geojson[e]={data:t,onEachFeature:function(e,t){var r="<strong>Latitude: </strong>"+n+"</br><strong>Longitude: </strong>"+o+"</br><strong>Region: </strong>"+s+"</br><strong>WorkspaceID: </strong>"+g+"</br>";angular.forEach(e.properties,function(e,t){r+="<strong>"+t+": </strong>"+e+"</br>"}),t.bindPopup(r)},style:{displayName:"Basin Clicked Point",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==",visible:!0}}}else if("regulatedwatershed"==e)this.geojson[e]={data:t,style:{displayName:"Basin Boundary (Regulated Area)",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAWCAYAAAArdgcFAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAUlJREFUeNrs1L9LAnEYx/H7pxyEghpyFmqov+E2raFbbpKoqYamDISSBqeWuCEUdLEyIgwJU+HwR2V4ZufpHZ73bvAIgsqKu6aGD8+X75fntTw8X8GSAvgV4R//U9yMh/3Bh/EwTu/Qe9zcCTF+igP57+OmHMSMzUyqHPzwvZ9cxqztAmdAeTo+2Jyjn1zBSEfRugc8PO7Rzq7RUUQ0RUTLrtMqbNCq7DN4PgWnBHYNSwoIX+LDrXmwUkAWuASu3VwBBffuBigDFaAB4zaWFBCm4kZiCcgBRRjfwUgFWwVUoArUJmdHBbsJ1v0bPBXXT0Tg4l3DT/IpbsZm6edloOg9PtxeoNc7Akp+4CF0PQXceo8biUX0l2Og6j2uKSL2KAfUvcc76Qi2fQ60/MEdxydcS0fcLWz6gGei7po3vMe7mVX3H/n9QF8HAGNo54Dt7QOyAAAAAElFTkSuQmCC",fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}};else if(-1!=e.indexOf("netnavpoints"))this.geojson[e]={data:t,onEachFeature:function(e,t){var r="<strong>Network navigation start/end point</strong></br>";angular.forEach(e.properties,function(e,t){r+="<strong>"+t+": </strong>"+e+"</br>"}),t.bindPopup(r)},pointToLayer:function(e,t){var r="wmm-pin wmm-mutedblue wmm-icon-noicon wmm-icon-black wmm-size-25";"ss_gages"==e.properties.source&&(r="wmm-pin wmm-blue wmm-icon-triangle wmm-icon-black wmm-size-25"),"WQP"==e.properties.source&&(r="wmm-pin wmm-sky wmm-icon-square wmm-icon-black wmm-size-25");var a=L.divIcon({className:r});return L.marker(t,{icon:a})},style:{displayName:"Network navigation point",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAlCAYAAAC+uuLPAAAACXBIWXMAAA7EAAAOxAGVKw4bAAA57GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoV2luZG93cyk8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMTgtMDEtMzBUMTU6NTk6NDgtMDU6MDA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxOC0wMS0zMVQxMTowMDoyMC0wNTowMDwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXA6TWV0YWRhdGFEYXRlPjIwMTgtMDEtMzFUMTE6MDA6MjAtMDU6MDA8L3htcDpNZXRhZGF0YURhdGU+CiAgICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2UvcG5nPC9kYzpmb3JtYXQ+CiAgICAgICAgIDxwaG90b3Nob3A6Q29sb3JNb2RlPjM8L3Bob3Rvc2hvcDpDb2xvck1vZGU+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnhtcC5paWQ6M2FkNDgxMTctYjA3Mi05NjQ4LTk5MmYtZmIyZTgzNTcwOTkxPC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD5hZG9iZTpkb2NpZDpwaG90b3Nob3A6ZDZiMzhiZmUtMDY5Zi0xMWU4LTk2OTAtOGIzNWZmM2I1YzJjPC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06T3JpZ2luYWxEb2N1bWVudElEPnhtcC5kaWQ6NDQ0OTVjNjYtY2JjZS04ZDQyLWFhYmUtYjJmZTM4MjRmYWI3PC94bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpIaXN0b3J5PgogICAgICAgICAgICA8cmRmOlNlcT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y3JlYXRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOjQ0NDk1YzY2LWNiY2UtOGQ0Mi1hYWJlLWIyZmUzODI0ZmFiNzwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxOC0wMS0zMFQxNTo1OTo0OC0wNTowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDozYWQ0ODExNy1iMDcyLTk2NDgtOTkyZi1mYjJlODM1NzA5OTE8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTgtMDEtMzFUMTE6MDA6MjAtMDU6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE3IChXaW5kb3dzKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpYUmVzb2x1dGlvbj45NjAwMDAvMTAwMDA8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjk2MDAwMC8xMDAwMDwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MjwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPGV4aWY6Q29sb3JTcGFjZT42NTUzNTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+Mjk8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+Mzc8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pj4hpkQAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2xJREFUeNrs181rI3Ucx/H3b2YyD8mkMZslSZOsaVfsXpaFlYLg3jwvgl4XRVGPXZ8FRawXQQVXlD3pQegee+tfIQiFZV1auw9tau3zQ9KkM5OZyfw81JV1aZNMCiq43/Mwr9985/f9zG+ElJJ/uhT+hfr/oFq/F07PzMj7tWU2t7dwHBdVU0nbaYbzea6++YaIg4peG+n7qSk5e+sX6o0GrucRBAGdKEIIgaqq6IkESctiuJDnufFxXrp8WZwI/fSLL+XthQUOHIdei9M0jbSd4pnz5/lwYkIMhL4/OSkX7i/S9n2EomAPDZErFknZaSzbJooimvU6rUaDxu4OTrMJgGWajF+4wCfvvStioR9Mfibn7t0lCEIM06JYrVKqjmBYJqqqoagqSEkYhnQ6Ic5+k5XFe2yurBBFEaZh8OzFi3z8ztuiL/Tza9/In2Zn8YOAoewpqmPnyBUK6IYB4ujFR1FE23VYW66xfOcOvueRtCyev3SJiSM22d9G5sb0tPz55k38ICBp25RGRsmXy+imeSwIoCgKVsqmVB2lNDKKoig4rsut+fnec3p7fh7X89ASCU4XhymcqaBqfU8VhmWRL5XJ5vMArK6v89X167IrenepBoCdyZCvVDAMM9bQCyEYymYpVs6gmyZBGLK6vtH9SVsHBwAk7TSZ3OmuLT221apKKpPBzmQAqO83uqNSSrREAjOZRFXVgWMukdAxTAsAx3F7Z6+iqmha4kTZqmoaCV0HIOiEvVEpJVEUnTDS5V8JpiB6o6Hv0/bcE5GBH+D/eQ/d0LujQgiklATtNr7nDYy2PZeDZutwElKp7uhw4XC+9vf22FpbHQj0220aOzs4rcMszj2R7Y6OnX0KANc5YGPlNxq7O/HeZBSxt7XJ+nKNqNNhKG3z9NnR7uhHb10VpWIRGUXUt3dYq9VitblZr7O6tITTOmxttVLh9StXRF9fmRdffU06rotumpRHRqmOnTvM3y61v7fL4twc2+trdMKQJ8tlfrj2dX9fmQf1wsuvyLbv9wU/CpYKBX787lsR+2A2c2NKGLqO73n8vrRIbeHXI1sdF+x5GuwFDwL2dTA7rtWe6wwE9o0+CmdO5QDY3dyIDcZCH4YVVUUAnU4nNhgbfRgGBgIHQh/AuWx2IHBg9PFf22P0P4H+MQCyncndp+2ZGQAAAABJRU5ErkJggg==",visible:!0}};else if("netnavroute"==e)this.geojson[e]={data:t,visible:!0,style:{displayName:"Network navigation route",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA2CAYAAACMRWrdAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAVaSURBVGhDzZr5VxpXFMf7n7ZpkqZLmqbRaIxaEzWyzIjghhtuQBQNuKMii0vSnqZb2qZNm66iwfavuL33jVbEOzBvmBn44XOOHD3P+TD3vXu/MG95MsdQL3h38rDgjsLu9fvw9O07hll6MAb9Sz9eWKuuxGaCSch8+IC9eD1Stx7B4OK3l9aqGzHf+q+w2jYM++82sQIcB+80QNSfAF/yt0vr1Y1Y1B+H7I12vOCGSwJ6rLX0w+CT78CbPrq0Xl2IBR9/CVt3vHgHGlkBjtyNNpiYzIGS+ptds+ZivZt/QOLhBOxdvccK6DGvzEEfli+3JlFzsdmhtdMDw3gJbjaqMBz7Ckswz65J1FSM9keyySdVgntXm2FqdBvUrb/YNc+omZiSOoTFnlnYvdbCCugR75qEwPJP7JrF1EwsFMrCzsfdcCBRgvT3I5HPRSPn1iymJmL+lZ9h7f4A7F+5ywpwHFxphPDAqjhsuDVLcVyMes68GoPce62sgB4r2LwH4t+Dh+lZHI6LjYafwfZtt9SBkX2/Hcan98S+5NbkcFSsN/k7LHeM4tjUzAroMYd32Lf+ml1TD0fFwgMrkP3gM7xY4wfGRlMfDC18w45N5XBMbCj2NSSxscqU4O71FpicSIOyXb5ncTgiRhcW756CvWtyY9OiKwz+1VfsmpVwRGxqLAXpm514scZLkA4YGo6N9CwO28UCyy9h/V5AqmfR384Mb+DYZKxncdgqRhs+5n0Mu5I9a6njNOpLHhjF2Co2PrMPqU96RNLlBDjSHz2EsdmnWILGexaHbWIU9VfarYv6stgmJqI+TgxWRX1ZbBELzmHUb5CL+rQPaeLXi/qyWC6mbv0JiU75qB/zRKFv7Rd2TTNYLkafDdIBIBX1GxQYnn9eNurLYqnYQPwFbDT3YXYy3rMo6k+Pbok7za1pFsvEzEb9RGfIUNSXxTKx0CRG/VtyUZ/GrNHIs6p7FoclYv61Vxj1B6WjfqR/WWQ0bs1qsURsrndBfDLLCeix2jYkFfVlqVqMPjXa+tT+qC9LVWJORn1ZqhIzF/V9pqK+LKbF6OJMRf3xHVBNRH1ZTInRPPeke9rRqC+LKTF613duduHFGi/B7duuqqJ+Ke5TPJk3oGQ1vIg7ewyuzJG8mIj6GC9MRX2DH09XgoRcaeINvi6AmjsReHMFcKFYdzYvJ2Y26tPJWW3UL0aICXixLlmxMYz626ai/gEoFo9NWimSGJVhAcuwIH4m4UcypejbeI1RP1izqM+jiXlwbwkpUZ7H0IO/MywWCSzhxCDXs9ZbAjC4aE3UL8WLJSfAn8/3nAbdSUNiwbnnIgzWMuqXoqCUKsSOUCYPPfjmCSk8ULzpQmUxLeqHah71S1FQSM0eoVge99WZGJYkSqnpfyqLTY9sSkd9embD6qhfiiaWPxfD19rdOoHe9L/lxfoTP2DU98tHfXwzrI76FzlCsTyoyLkY7S08HfFulRWjSLHgjkg/iaZF/ZfsmtahiSkZaiGHQoz6F/U0pZIYPc5DT5ZJ9SyK+mF7ov5FcG9hmStp/D+Im8qQxLCXKRkS09ljFPVXWynqy/Qse6P+RbB9oJjYw8iZGDVpJYtTCO4zVsxU1G+lqP/CsrGpIvh/NDGUotdiCCYxumtMHxuJfoFR3yPVsyjqT0zt2tazWETPopNQa8hi+vifksmDHg6hx1DpZOME9HAi6hejzYnnU8bZaEXl6Mbe5i4dgrUn0TrwYo0fGMm7veKLc7ujfjFnA7AGDb/aACxkUcyVKxITUR8vUqYEaRqh75ediPrFaGIF5ARfY1zBacOLzVmI4UHSkzuE/wDtg18mgH26LgAAAABJRU5ErkJggg==",color:"red"}};else if("adds"==e)this.geojson.hasOwnProperty(e)?this.geojson[e].data.features.push(t):this.geojson[e]={data:{type:"FeatureCollection",features:[t]},visible:!0,style:{displayName:e,fillColor:"green",color:"green"}};else if("removes"==e)this.geojson.hasOwnProperty(e)?this.geojson[e].data.features.push(t):this.geojson[e]={data:{type:"FeatureCollection",features:[t]},visible:!0,style:{displayName:e,fillColor:"red",color:"red"}};else if("streamgages"==e){var l=this;this.geojson.streamgages={name:"Streamgages",type:"geoJSONShape",data:t,visible:!0,style:{displayName:"Streamgages"},onEachFeature:function(e,t){var r=e.properties.Code,a=L.DomUtil.create("div","innerDiv");a.innerHTML="<strong>Station ID: </strong>"+r+"</br><strong>Station Name: </strong>"+e.properties.Name+"</br><strong>Latitude: </strong>"+e.geometry.coordinates[1]+"</br><strong>Longitude: </strong>"+e.geometry.coordinates[0]+"</br><strong>Station Type</strong>: "+e.properties.StationType.name+'</br><br><button id="gagePageLink" type="button" class="btn-blue fullwidth">Open StreamStats Gage Page</button>',t.bindPopup(a);var i=configuration.streamgageSymbology.filter(function(t){return t.label.toLowerCase()==e.properties.StationType.name.toLowerCase()})[0];void 0==i&&(i=configuration.streamgageSymbology.filter(function(e){return"Unknown"==e.label})[0]);var n=L.icon({iconUrl:"data:image/png;base64,"+i.imageData,iconSize:[15,16],iconAnchor:[7.5,8],popupAnchor:[0,-11]});t.setIcon(n),L.DomEvent.on(a,"click",function(e){"gagePageLink"===e.target.id&&l.openGagePage(r)}),t.on("mouseover",function(e){l.studyArea.doSelectMapGage&&this.openPopup()}),t.on("click",function(t){gtag("event","ExplorationTools",{Category:"QueryStreamgage"}),l.studyArea.doSelectMapGage?(l.studyArea.selectGage(e),l.studyArea.doSelectMapGage=!1):this.openPopup()})}},this.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,this,new WiM.Directives.LegendLayerAddedEventArgs("streamgages","geojson",this.geojson.streamgages.style)),this.updateLegend()}else this.geojson[e]={data:t,visible:!0,style:{displayName:e,fillColor:"blue",color:"blue"}}},t.prototype.onLayerChanged=function(e,t){var r=this;if("visible"===t.PropertyName)if(t.Value){if(this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.FeatureCollection.features.length>0&&this.studyArea.selectedStudyArea.FeatureCollection.features.forEach(function(e){if(e.id==t.LayerName){var a=angular.fromJson(angular.toJson(e)),i=a.id;r.addGeoJSON(i,a)}}),"nonsimplifiedbasin"==t.LayerName&&this.addGeoJSON("nonsimplifiedbasin",this.nonsimplifiedBasin),this.explorationService.networkNavResults)for(var a=0;a<this.explorationService.networkNavResults.length;a++){var i=angular.fromJson(angular.toJson(this.explorationService.networkNavResults[a]));i.name==t.LayerName&&this.addGeoJSON(t.LayerName,i.feature)}"streamgages"==t.LayerName&&this.center.zoom>=8?this.studyArea.getStreamgages(this.bounds.southWest.lng,this.bounds.northEast.lng,this.bounds.southWest.lat,this.bounds.northEast.lat):"streamgages"==t.LayerName&&this.center.zoom<8&&(this.studyArea.streamgagesVisible=!0)}else delete this.geojson[t.LayerName],"streamgages"===t.LayerName&&(this.studyArea.streamgagesVisible=!1)},t.prototype.mapBoundsChange=function(e,t){this.nomnimalZoomLevel=this.scaleLookup(this.center.zoom),this.center.zoom>=8&&e!==t&&(this.regionServices.loadRegionListByExtent(this.bounds.northEast.lng,this.bounds.southWest.lng,this.bounds.southWest.lat,this.bounds.northEast.lat),this.regionServices.selectedRegion||this.toaster.pop("info","Information","User input is needed to continue",5e3),this.studyArea.streamgagesVisible&&this.studyArea.getStreamgages(this.bounds.southWest.lng,this.bounds.northEast.lng,this.bounds.southWest.lat,this.bounds.northEast.lat)),this.center.zoom<8&&e!==t&&(this.regionServices.regionList=[],this.removeGeoJsonLayers("streamgages")),this.center.zoom>=15?(!this.imageryToggled&&this.regionServices.selectedRegion&&this.regionServices.selectedRegion.Applications.some(function(e){return["StormDrain","Localres"].indexOf(e)>-1})&&this.toggleImageryLayer(),this.studyArea.zoomLevel15=!0):this.studyArea.zoomLevel15=!1},t.prototype.updateLegendText=function(e){var t=this;"MeanAugustBaseflow"==e&&this.leafletData.getLayers("mainMap").then(function(e){9==t.center.zoom||10==t.center.zoom||11==t.center.zoom?(t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[0].label="0.60 - 1.34 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[1].label="0.45 - 0.60 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[2].label="0.30 - 0.45 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[3].label="0.09 - 0.30 cfs/mi^2"):12==t.center.zoom||13==t.center.zoom||14==t.center.zoom?(t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[0].label="0.50 - 1.34 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[1].label="0.40 - 0.50 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[2].label="0.20 - 0.44 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[3].label="0.09 - 0.20 cfs/mi^2"):15!=t.center.zoom&&16!=t.center.zoom||(t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[0].label="0.35 - 1.34 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[1].label="0.25 - 0.35 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[2].label="0.15 - 0.25 cfs/mi^2",t.layers.overlays.MeanAugustBaseflow_region.layerArray[0].legend[3].label="0.09 - 0.15 cfs/mi^2")})},t.prototype.updateLegend=function(){var e=this;this.gageLegendFix||setTimeout(function(){var t=document.getElementsByClassName("wimLegend-application-group");for(var r in t)if(t[r].innerHTML&&t[r].innerHTML.indexOf("Application Layers")>-1){var a=t[r].children[1].children;for(var i in a)if(a[i].innerHTML&&a[i].innerHTML.indexOf("Streamgages")>-1&&!e.gageLegendFix){var n=a[i].children[0],o=document.createElement("div");o.innerHTML='<div class="legendGroup">\x3c!----\x3e<div ng-repeat="lyr in layer.layerArray ">\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAaJJREFUOI3dzz1IW1EYxvF/TMqpFQsJCF4QOuhUpTpEVCw6RSsdQhFB6hfiF0IDFqkoOCqKEhxEqm0H20YUgpQoqOBWOkgjpQgXowREEC5SuVBE6QtFHXQwYjSJmXzgDO85hx/PayPJsd0TcD6sqM6ZBFqAk7uD4dCyqu3dkLnhRmD6bqB/ q5DwZrl4hv6rb2MWEfEDR4mD + q9ZSl + mAC75 + HOGxvwuYDAx8MNaK / +Os3mUfj5nP + tSSlsUMbKAvfhA / dSKb3qEqvrLtwUS0CeVW + sWkbfxgcsr4zx12rFe + ZJu75PMPK / jcKfQNM1gbKBPz2Az2EzJi + ten / B1LdUse9AGxAhu//ZTXPkwanurrRd3RyeBqRrAfzM48b2IvwfPcWRG9QC76nnvlMDUY2ABkOjgbshHxWvrTRqAYPGo/s9uGWh6A3ivBR3epTZTpeWQmnabB6CkqqFOjbbvi0gG8CcSXF1NMZdCw7zqjAW7iKWOT+sVqtX5TkR6IkGXqx4IMub5EYeIQAlQrmlarmEY+uWVv1ycRDJgGAaRDZOUpINnJ5KDtx5X6hkAAAAASUVORK5CYII=" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAaJJREFUOI3dzz1IW1EYxvF/TMqpFQsJCF4QOuhUpTpEVCw6RSsdQhFB6hfiF0IDFqkoOCqKEhxEqm0H20YUgpQoqOBWOkgjpQgXowREEC5SuVBE6QtFHXQwYjSJmXzgDO85hx/PayPJsd0TcD6sqM6ZBFqAk7uD4dCyqu3dkLnhRmD6bqB/ q5DwZrl4hv6rb2MWEfEDR4mD + q9ZSl + mAC75 + HOGxvwuYDAx8MNaK / +Os3mUfj5nP + tSSlsUMbKAvfhA / dSKb3qEqvrLtwUS0CeVW + sWkbfxgcsr4zx12rFe + ZJu75PMPK / jcKfQNM1gbKBPz2Az2EzJi + ten / B1LdUse9AGxAhu//ZTXPkwanurrRd3RyeBqRrAfzM48b2IvwfPcWRG9QC76nnvlMDUY2ABkOjgbshHxWvrTRqAYPGo/s9uGWh6A3ivBR3epTZTpeWQmnabB6CkqqFOjbbvi0gG8CcSXF1NMZdCw7zqjAW7iKWOT+sVqtX5TkR6IkGXqx4IMub5EYeIQAlQrmlarmEY+uWVv1ycRDJgGAaRDZOUpINnJ5KDtx5X6hkAAAAASUVORK5CYII="><i>Gaging Station, Continuous Record</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAZxJREFUOI1jYaAyYBk2BjIZGAgtunDhXRwDA8M/ig10cBDKrqiwt5848WDq9u3vZlJqoIC/v3a0u7uyzLVrbxK2bz+ 8hIGB4SvZBoaGyjcnJenpMTAwMCQm6ukdPHineuPG51XkGqgVEqJjzcfHycnAwMAgIMDJFRys57px4/NpDAwMT0g2MDZWvjUoSM0AWSwsTMNgx467zcuW3Ukk1UD/nBxrdRYWZkZkQXZ2VpaEBH39HTvemb579+ 40sQay5+cbFJiZSWlik3R2ljcMDBStnjv3XQBRBqqosBeVlJgp43I6ExMTQ36 + mercuTdDGRgYVhMyUDItzdhLRoZPFpeBDAwMDLq64lolJQYpPT0XNjEwMPzEaaCDg3xzZqaRHj7DYKCoyFJ19erreQ8f / uzGaqCQkJBZRoaOJg8PBx8xBkpKcitmZpq5VFQcXsDAwPAa3UBGW1v2upAQdTNiDIOB7Gx9 / dWrr1adPfuuEN3AWAMDKbODBx + SWgKJ6 + gIhT57xj7n + fPnV5E1L2psPLuIgeEsieahgsFfwAIAW21yjgzG0zwAAAAASUVORK5CYII=" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAZxJREFUOI1jYaAyYBk2BjIZGAgtunDhXRwDA8M/ig10cBDKrqiwt5848WDq9u3vZlJqoIC/v3a0u7uyzLVrbxK2bz+ 8hIGB4SvZBoaGyjcnJenpMTAwMCQm6ukdPHineuPG51XkGqgVEqJjzcfHycnAwMAgIMDJFRys57px4/NpDAwMT0g2MDZWvjUoSM0AWSwsTMNgx467zcuW3Ukk1UD/nBxrdRYWZkZkQXZ2VpaEBH39HTvemb579+ 40sQay5+cbFJiZSWlik3R2ljcMDBStnjv3XQBRBqqosBeVlJgp43I6ExMTQ36 + mercuTdDGRgYVhMyUDItzdhLRoZPFpeBDAwMDLq64lolJQYpPT0XNjEwMPzEaaCDg3xzZqaRHj7DYKCoyFJ19erreQ8f / uzGaqCQkJBZRoaOJg8PBx8xBkpKcitmZpq5VFQcXsDAwPAa3UBGW1v2upAQdTNiDIOB7Gx9 / dWrr1adPfuuEN3AWAMDKbODBx + SWgKJ6 + gIhT57xj7n + fPnV5E1L2psPLuIgeEsieahgsFfwAIAW21yjgzG0zwAAAAASUVORK5CYII="><i>Low Flow, Partial Record</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAV5JREFUOI3d1DFIlGEYwPGfcvBRhMi3xIENURJKndfQLSEJFUGLpp6LGBoViZEpDqIQxNFUS0sQJMQhLTfZoqtzBC25B9I3BO/W8C7RJB2HV3d6U// xeXl + PNOb0 + Fy / w3YXaT6hbv4dWxwhIVVrr3mwTZvjwv2jibJ9K0Y + /aY3WYTP48Mlqnci7EAcxR2Wd9i7ajg4CRXezgBvZycSJKbWzG+wX7b4AwvxinWz6ZiLO5Q+cBcu+DoYy7k6KofJuRmGdpJ0yshhE+tgskiT0sMHPZ4nct3QljfYKwl8DzLK5xrdno3FunfoIzav8D8Q273caYZCJcYXOH+Kz4iNgVHqMxT+Bt20DL9NZ584+WhYJqmpUchDJyipxUwz9l5bqzyHj8awa7hEJ5NUmoFO2iBoVqSrH2OcakRnClS2m3/Bzp9Mcby93z + XZZlX + uXq8 + pton9Kcs0XtiROg7 + BnYMUkljozdEAAAAAElFTkSuQmCC" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAV5JREFUOI3d1DFIlGEYwPGfcvBRhMi3xIENURJKndfQLSEJFUGLpp6LGBoViZEpDqIQxNFUS0sQJMQhLTfZoqtzBC25B9I3BO/W8C7RJB2HV3d6U// xeXl + PNOb0 + Fy / w3YXaT6hbv4dWxwhIVVrr3mwTZvjwv2jibJ9K0Y + /aY3WYTP48Mlqnci7EAcxR2Wd9i7ajg4CRXezgBvZycSJKbWzG+wX7b4AwvxinWz6ZiLO5Q+cBcu+DoYy7k6KofJuRmGdpJ0yshhE+tgskiT0sMHPZ4nct3QljfYKwl8DzLK5xrdno3FunfoIzav8D8Q273caYZCJcYXOH+Kz4iNgVHqMxT+Bt20DL9NZ584+WhYJqmpUchDJyipxUwz9l5bqzyHj8awa7hEJ5NUmoFO2iBoVqSrH2OcakRnClS2m3/Bzp9Mcby93z + XZZlX + uXq8 + pton9Kcs0XtiROg7 + BnYMUkljozdEAAAAAElFTkSuQmCC"><i>Peak Flow, Partial Record</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAYlJREFUOI3d1E0og3EcwPHv1lMPEnouWmHJJOLZJCuWzFtjDsPMRYQQkbd20FZKy4mLi1KU5uWygyhxcODARWolcl3kOajn5vA4yInWMjZ28j3+/v0+/U5 / gRQn / BtQbzEQDCv0A29 / Bu1GJuZ7qV / dZeQ4wvpfwRyXXex1mLW8uwcGjrfZAV5 + DXqqCAw1aDLAYCPy + Q3 + gzC + 34Jl3TZsWemkA+RkkOGuFVsOwtoa8Jg02FfHUlcNluhZj02znIQJ7F0ymCzommylRNCjix6KAsKAHfPJvVStqupVoqA47WDGaqL0q8cmmcpOWfVvntGREGgSmfN2UBTvdL0Opp0Ub57hAUI / gYZRN848ifx4IECFkTJvO8MrRxwCWlzQbiIw7kD + DvtozkVx6JSpiMbyl6AkSdYxp1qamUZWIqAhm8JxN83ze2wBz7Ggrq5AXeiuwZoI9tFEG + bQhei7jmizsWCfpRDr + W3SP1BueYHmeXo1bCiKchu9HFzcJ8h + ktxnCrEXpqSUg + 93zWK9ULsBDQAAAABJRU5ErkJggg==" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAYlJREFUOI3d1E0og3EcwPHv1lMPEnouWmHJJOLZJCuWzFtjDsPMRYQQkbd20FZKy4mLi1KU5uWygyhxcODARWolcl3kOajn5vA4yInWMjZ28j3+/v0+/U5 / gRQn / BtQbzEQDCv0A29 / Bu1GJuZ7qV / dZeQ4wvpfwRyXXex1mLW8uwcGjrfZAV5 + DXqqCAw1aDLAYCPy + Q3 + gzC + 34Jl3TZsWemkA+RkkOGuFVsOwtoa8Jg02FfHUlcNluhZj02znIQJ7F0ymCzommylRNCjix6KAsKAHfPJvVStqupVoqA47WDGaqL0q8cmmcpOWfVvntGREGgSmfN2UBTvdL0Opp0Ub57hAUI / gYZRN848ifx4IECFkTJvO8MrRxwCWlzQbiIw7kD + DvtozkVx6JSpiMbyl6AkSdYxp1qamUZWIqAhm8JxN83ze2wBz7Ggrq5AXeiuwZoI9tFEG + bQhei7jmizsWCfpRDr + W3SP1BueYHmeXo1bCiKchu9HFzcJ8h + ktxnCrEXpqSUg + 93zWK9ULsBDQAAAABJRU5ErkJggg=="><i>Peak and Low Flow, Partial Record</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAXZJREFUOI3d1E8ow2EYwPHvmF5j/vRLbT/ZlmxpykayjJjkT0iUXIgoTko4buWynNyVctDIxUEpNwcXLi4rrRxclHqVvBc5vA5yoVjGxk6+ x + ft + fScXit5zvpvwAJMEkhmgJc / g4aHxbJJIo / 7LKgbtv4KVoouMeUM6prnW2bZZQ94+j3YQtzRowMARoSAuiSmk0R / CzaYYTqEDRuA3U6Jq130XSf1JnCbMyg6WXeHafo4qwjrJiNJXJ0zlys46h2gnkIsnxaKsJZ1E + TKaFVKXWQLCjHAst2L / 6tHZyPNdwEV45Sx7EDBqn+Uuoy3W8A7iC91ygRw8BNoesYZEgaujCBg99BgDjMvjzkCdGbQS7yqn8B32HuOEXzyhCU0G1 + ChmGExJDyW4spzwYUldSa4 / TKfXaA + 3TQ8uRWa742Qtlg71X3E1RnIqpv9Eo6OF1aS+ghlfMP5NBuPWE + m9tSytTH5YQ6JKEOc + TekkjSL8xLeQdfAVOiXI3dacB + AAAAAElFTkSuQmCC" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAXZJREFUOI3d1E8ow2EYwPHvmF5j/vRLbT/ZlmxpykayjJjkT0iUXIgoTko4buWynNyVctDIxUEpNwcXLi4rrRxclHqVvBc5vA5yoVjGxk6+ x + ft + fScXit5zvpvwAJMEkhmgJc / g4aHxbJJIo / 7LKgbtv4KVoouMeUM6prnW2bZZQ94+j3YQtzRowMARoSAuiSmk0R / CzaYYTqEDRuA3U6Jq130XSf1JnCbMyg6WXeHafo4qwjrJiNJXJ0zlys46h2gnkIsnxaKsJZ1E + TKaFVKXWQLCjHAst2L / 6tHZyPNdwEV45Sx7EDBqn+Uuoy3W8A7iC91ygRw8BNoesYZEgaujCBg99BgDjMvjzkCdGbQS7yqn8B32HuOEXzyhCU0G1 + ChmGExJDyW4spzwYUldSa4 / TKfXaA + 3TQ8uRWa742Qtlg71X3E1RnIqpv9Eo6OF1aS+ghlfMP5NBuPWE + m9tSytTH5YQ6JKEOc + TekkjSL8xLeQdfAVOiXI3dacB + AAAAAElFTkSuQmCC"><i>Stage Only</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAYVJREFUOI3d1E8og3Ecx/H3mB6Tfz0XTWwtln/t2YQnjz+ b / A2J0i5EFCclHCmX5eSulINGLg5KOXEQcdFqJeWAWqmnqN / N4ecgBxQyNhzkc / nW99v31ff0tfLLsf4bMEXFHhaYw8DDj0EV50Q3A4EDNsZjxJZ / CubWKP7BUuktuOF6JMbaOnD3bbCEqpAumzWAagLaJadzF0RnvwuWaxj16dhsABlkZniVurYLGV0CrpMGK2hc8GD4Xvc80vCdEw2dcTyaLNjbQEdJKqmW18000qzVNHlN9bxGCHGSKKhU0THloLjso6EbT6VLaHOC / b6EQAVlpoXeoninW7BQS6c7wn4Q2PwKtPvp78pBLYwHAuTjLK + je + yYnW1AxgWdFIcM2rXPsJcE6HFH2JuUyMUPQVVVdV10lSmkZycCZpLr8tPfusvGKnD7HrRkCce8h1o9EewlBu3eiHI0K2Rs + j045MClX3GW7AfKs0tHULHfr5im + WY5fMhW + JCtJL3nmE / l7z / YR0W7YFxuKhm3AAAAAElFTkSuQmCC" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAYVJREFUOI3d1E8og3Ecx/H3mB6Tfz0XTWwtln/t2YQnjz+ b / A2J0i5EFCclHCmX5eSulINGLg5KOXEQcdFqJeWAWqmnqN / N4ecgBxQyNhzkc / nW99v31ff0tfLLsf4bMEXFHhaYw8DDj0EV50Q3A4EDNsZjxJZ / CubWKP7BUuktuOF6JMbaOnD3bbCEqpAumzWAagLaJadzF0RnvwuWaxj16dhsABlkZniVurYLGV0CrpMGK2hc8GD4Xvc80vCdEw2dcTyaLNjbQEdJKqmW18000qzVNHlN9bxGCHGSKKhU0THloLjso6EbT6VLaHOC / b6EQAVlpoXeoninW7BQS6c7wn4Q2PwKtPvp78pBLYwHAuTjLK + je + yYnW1AxgWdFIcM2rXPsJcE6HFH2JuUyMUPQVVVdV10lSmkZycCZpLr8tPfusvGKnD7HrRkCce8h1o9EewlBu3eiHI0K2Rs + j045MClX3GW7AfKs0tHULHfr5im + WY5fMhW + JCtJL3nmE / l7z / YR0W7YFxuKhm3AAAAAElFTkSuQmCC"><i>Low Flow, Partial Record, Stage</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAZtJREFUOI1jYaAyYBk2BjKpCBksuvPuQhwDA8M/ig00FnLIzrOvsJ9zcGLq4XfbZ1JqoICXtn+0vbK7zJ031xIOH96+hIGB4SvZBrrLhzaH6yXpMTAwMIToJeodvXOwet/zjVXkGqjlpxNizcPJx8nAwMDAzynA5aMX7Lrv+ cZpDAwMT0g20F8 + ttVdLcgAWcxHI8xg / 90dzZvvLEsk1UD/ROscdRZmFkZkQTZWdpZQ/QT9o+ 92mL579+40sQayJxjkFxhImWlik7SRdzZ0Ew2sXvFubgBRBkqyqxRlmJUo43I6ExMTQ4JZvuqKm3NDGRgYVhMyUDLBOM1Lgk9GFpeBDAwMDBriulopBiUpcy70bGJgYPiJ00BzeYfmGKNMPXyGwUCaZZHq4uur837+fNiN1UAhISGzWJ0MTW4OHj5iDBTjllQsMst0aT9csYCBgeE1uoGMBuy2dZ7qIWbEGAYDMfrZ + tuvrq668O5sIbqBsTpSBmYnHx4ktQQSVxbSCX3J / mzO8 + fPryJrXjTpbOOiSWdJNA4NDP4CFgA3c3Kc0o9KfgAAAABJRU5ErkJggg == " src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAZtJREFUOI1jYaAyYBk2BjKpCBksuvPuQhwDA8M/ig00FnLIzrOvsJ9zcGLq4XfbZ1JqoICXtn+0vbK7zJ031xIOH96+hIGB4SvZBrrLhzaH6yXpMTAwMIToJeodvXOwet/zjVXkGqjlpxNizcPJx8nAwMDAzynA5aMX7Lrv+ cZpDAwMT0g20F8 + ttVdLcgAWcxHI8xg / 90dzZvvLEsk1UD/ROscdRZmFkZkQTZWdpZQ/QT9o+ 92mL579+40sQayJxjkFxhImWlik7SRdzZ0Ew2sXvFubgBRBkqyqxRlmJUo43I6ExMTQ4JZvuqKm3NDGRgYVhMyUDLBOM1Lgk9GFpeBDAwMDBriulopBiUpcy70bGJgYPiJ00BzeYfmGKNMPXyGwUCaZZHq4uur837+fNiN1UAhISGzWJ0MTW4OHj5iDBTjllQsMst0aT9csYCBgeE1uoGMBuy2dZ7qIWbEGAYDMfrZ + tuvrq668O5sIbqBsTpSBmYnHx4ktQQSVxbSCX3J / mzO8 + fPryJrXjTpbOOiSWdJNA4NDP4CFgA3c3Kc0o9KfgAAAABJRU5ErkJggg == "><i>Miscellaneous Record</i></div>\x3c!----\x3e<div ng-repeat="leg in lyr.legend "><img class="legendSwatch" alt="Embedded Image" ng-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAARVJREFUOI3d1L8rhVEYB/APqROD9C66xSBJDH4MLAYLi4XFJKKYlDBSlpvJrpRBstn8G2b/gXoHdTbDs8jgKt38eF138q1T55yn59MznE6XNqfr34CduMYGXtoB7mIeO7j4K9iXUlqLiAFs4gbPfwHrETHR2E/ gGEetguOYQ3fj3JNSWoyIczy2Ap5i6uNFREyhjq3fgssYRccnPZNFUczknO + rggn7GPuiPp1zPsZKVfAQw1 / U3jOCVdz + BNawhMEfwHFs4w7xHVj39jyqZAR7OPsULIpiNuc8ht6K4BAWcIWnZrAj53yC2YrYeyZTSkcRcdAMrjew3 / 5A/RGxWqvVLsuyfPjYfN1YLaUsS80TtiVtB18BHWxAwwk6imsAAAAASUVORK5CYII=" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAARVJREFUOI3d1L8rhVEYB/APqROD9C66xSBJDH4MLAYLi4XFJKKYlDBSlpvJrpRBstn8G2b/gXoHdTbDs8jgKt38eF138q1T55yn59MznE6XNqfr34CduMYGXtoB7mIeO7j4K9iXUlqLiAFs4gbPfwHrETHR2E/ gGEetguOYQ3fj3JNSWoyIczy2Ap5i6uNFREyhjq3fgssYRccnPZNFUczknO + rggn7GPuiPp1zPsZKVfAQw1 / U3jOCVdz + BNawhMEfwHFs4w7xHVj39jyqZAR7OPsULIpiNuc8ht6K4BAWcIWnZrAj53yC2YrYeyZTSkcRcdAMrjew3 / 5A/RGxWqvVLsuyfPjYfN1YLaUsS80TtiVtB18BHWxAwwk6imsAAAAASUVORK5CYII="><i>Unknown</i></div>\x3c!----\x3e</div>\x3c!----\x3e</div>',n.appendChild(o),e.gageLegendFix=!0}}},500)},t.prototype.updateRegion=function(){var e=this.$locationService.search().region;this.setBoundsByRegion(e)},t.prototype.setBoundsByRegion=function(e){e&&this.regionServices.loadRegionListByRegion(e)&&(this.regionServices.selectedRegion=this.regionServices.regionList[0],this.bounds=this.leafletBoundsHelperService.createBoundsFromArray(this.regionServices.selectedRegion.Bounds))},t.prototype.toggleImageryLayer=function(){var e=document.getElementsByClassName("wimLegend-basemap-item");for(var t in e){var r,a=e[t].childNodes;for(var i in a)if("rdo"==a[i].className)for(var n in(r=a[i]).childNodes)"Imagery"==r.childNodes[n].innerHTML&&r.click()}this.imageryToggled=!0},t.prototype.addRegionOverlayLayers=function(e){var t=this;if(!(this.regionServices.regionMapLayerList.length<1)){var r=[],a=[],i=this;this.regionServices.regionMapLayerList.map(function(e){r.push(e[1]),i.regionServices.selectedRegion.Applications.indexOf("StormDrain")>-1&&"StreamGrid"==e[0]?a.push(!1):a.push(!0)});r.forEach(function(r,i){t.layers.overlays[e+"_region"+r]={name:String(r),group:e+" Map layers",url:configuration.baseurls.StreamStatsMapServices+configuration.queryparams.SSStateLayers,type:"agsDynamic",visible:a[i],layerOptions:{opacity:1,layers:[r],format:"png8",f:"image"}}}),this.leafletData.getLayers("mainMap").then(function(t){r.forEach(function(r){t.overlays[e+"_region"+r].bringToBack()}),t.overlays.SSLayer.bringToFront()});var n=this.regionServices.selectedRegion.Layers;if(void 0!=n)for(var o in n)this.layers.overlays[o+"_region"]=n[o]}},t.prototype.removeOverlayLayers=function(e,t){var r=this;void 0===t&&(t=!1),this.getLayerIdsByID(e,this.layers.overlays,t).forEach(function(e){delete r.layers.overlays[e]})},t.prototype.removeMarkerLayers=function(e,t){var r=this;void 0===t&&(t=!1),this.getLayerIdsByID(e,this.markers,t).forEach(function(e){delete r.markers[e]})},t.prototype.removeGeoJsonLayers=function(e,t){var r=this;void 0===t&&(t=!1),this.getLayerIdsByID(e,this.geojson,t).forEach(function(e){delete r.geojson[e]})},t.prototype.getLayerIdsByName=function(e,t,r){var a=[];for(var i in t)t[i].hasOwnProperty("name")&&(r?t[i].name.indexOf(e)>-1:t[i].name===e)&&a.push(i);return a},t.prototype.getLayerIdsByID=function(e,t,r){var a=[];for(var i in t)(r?i.indexOf(e)>-1:i===e)&&a.push(i);return a},t.prototype.startDelineate=function(t,r,a){var i=new e.Models.StudyArea(this.regionServices.selectedRegion.RegionID,new WiM.Models.Point(t.lat,t.lng,"4326"));this.studyArea.AddStudyArea(i),this.studyArea.loadStudyBoundary(),r&&a&&(this.studyArea.selectedStudyArea.Disclaimers.isInExclusionArea="The delineation point is in an exclusion area. "+a)},t.$inject=["$scope","$compile","toaster","$location","$stateParams","leafletBoundsHelpers","leafletData","WiM.Services.SearchAPIService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ExplorationService","StreamStats.Services.ProsperService","WiM.Event.EventManager","StreamStats.Services.ModalService","$modalStack","$http"],t}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.MapController",o)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(t){"use strinct";var r,a=function(){function t(t,a,i,n,o,s,g,l,c){var A=this;this.EventManager=c,this.SSServicesVersion="1.2.22",this.dateRange={dates:{startDate:new Date,endDate:new Date},minDate:new Date(1900,1,1),maxDate:new Date},t.vm=this,this.init(),this.toaster=a,this.sideBarCollapsed=!1,this.selectedProcedure=r.INIT,this.regionService=i,this.nssService=o,this.studyAreaService=n,this.modalService=s,this.leafletData=g,this.multipleParameterSelectorAdd=!0,this.explorationService=l,o.onSelectedStatisticsGroupChanged.subscribe(this._onSelectedStatisticsGroupChangedHandler),t.$watch(function(){return A.regionService.selectedRegion},function(e,t){null==e?A.setProcedureType(1):A.setProcedureType(2)}),t.$watch(function(){return A.studyAreaService.regressionRegionQueryComplete},function(e,t){e!=t&&(null==e?A.setProcedureType(2):A.regionService.selectedRegion.ScenariosAvailable?A.setProcedureType(3):A.setProcedureType(2))}),t.$watchCollection(function(){return A.studyAreaService.selectedStudyAreaExtensions},function(e,t){e!=t&&(A.scenarioHasExtensions=A.studyAreaService.selectedStudyAreaExtensions.length>0)}),t.$watchCollection(function(){return A.studyAreaService.extensionsConfigured},function(e,t){if(e!=t)if(e){var r=!0;A.studyAreaService.selectedStudyAreaExtensions.forEach(function(e){e.parameters.forEach(function(e){e.hasOwnProperty("value")&&void 0!=e.value||(r=!1)})}),r&&(A.extensionsConfigured=!0)}else A.extensionsConfigured=e}),c.SubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,new WiM.Event.EventHandler(function(e,t){A.parametersLoaded=t.parameterLoaded,A.parametersLoaded?A.setProcedureType(4):A.setProcedureType(3)}))}return Object.defineProperty(t.prototype,"ParameterValuesMissing",{get:function(){if(!this.studyAreaService.studyAreaParameterList||this.studyAreaService.studyAreaParameterList.length<1)return!0;for(var e=0;e<this.studyAreaService.studyAreaParameterList.length;e++){var t=this.studyAreaService.studyAreaParameterList[e];if(!t.value||t.value<0)return!0}return!1},enumerable:!1,configurable:!0}),t.prototype.setProcedureType=function(e){this.selectedProcedure!=e&&this.canUpdateProcedure(e)?this.selectedProcedure=e:2!=this.selectedProcedure||3!=e&&4!=e||this.toaster.pop("warning","Warning","Make sure you have delineated a basin and clicked continue",5e3)},t.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},t.prototype.onAOISelect=function(e){this.EventManager.RaiseEvent(WiM.Services.onSelectedAreaOfInterestChanged,this,new WiM.Services.SearchAPIEventArgs(e))},t.prototype.zoomRegion=function(e){angular.fromJson(e)},t.prototype.setRegion=function(e){gtag("event","SetRegion",{Region:e.RegionID}),void 0!=this.regionService.selectedRegion&&this.regionService.selectedRegion.RegionID===e.RegionID||(this.regionService.selectedRegion=e),this.setProcedureType(2),this.regionService.loadParametersByRegion()},t.prototype.openStatePage=function(t,r){t.stopPropagation(),t.preventDefault(),this.modalService.openModal(e.Services.SSModalType.e_about,{tabName:"regionInfo",regionID:r})},t.prototype.resetWorkSpace=function(){this.regionService.clearSelectedParameters(),this.studyAreaService.clearStudyArea(),this.studyAreaService.zoomLevel15=!0,this.nssService.clearNSSdata(),this.multipleParameterSelectorAdd=!1},t.prototype.startSearch=function(e){e.stopPropagation(),e.preventDefault(),$("#searchBox").trigger($.Event("keyup",{keyCode:13}))},t.prototype.startDelineate=function(){var e=this;this.leafletData.getMap("mainMap").then(function(t){t.getZoom()<15?e.toaster.pop("error","Delineate","You must be at or above zoom level 15 to delineate."):(e.toaster.pop("success","Delineate","Click on a blue stream cell to start delineation"),e.studyAreaService.doDelineateFlag=!e.studyAreaService.doDelineateFlag)})},t.prototype.setStatisticsGroup=function(t){var r=this.checkArrayForObj(this.nssService.selectedStatisticsGroupList,t);if(-1!=r){var a=!1;if("number"!=typeof t.id&&t.id.indexOf("fdctm")){var i=this.studyAreaService.selectedStudyAreaExtensions.filter(function(e){return"QPPQ"==e.code})[0],n=this.studyAreaService.selectedStudyAreaExtensions.indexOf(i);this.studyAreaService.selectedStudyAreaExtensions.splice(n,1),this.EventManager.RaiseEvent(e.Services.onScenarioExtensionChanged,this,new e.Services.NSSEventArgs(this.studyAreaService.selectedStudyAreaExtensions))}this.nssService.selectedStatisticsGroupList.filter(function(e){return"Flow-Duration Curve Transfer Method"==e.name}).length>0&&"Flow-Duration Statistics"==t.name&&(a=!0),a||(this.nssService.selectedStatisticsGroupList.splice(r,1),0==this.nssService.selectedStatisticsGroupList.length&&(this.studyAreaService.studyAreaParameterList=[],this.regionService.parameterList.forEach(function(e){e.checked=!1,e.toggleable=!0})))}else{if(this.nssService.selectedStatisticsGroupList.push(t),"number"!=typeof t.id&&t.id.indexOf("fdctm")){var o=this.nssService.statisticsGroupList.filter(function(e){return"Flow-Duration Statistics"==e.name})[0];-1==this.checkArrayForObj(this.nssService.selectedStatisticsGroupList,o)&&this.nssService.selectedStatisticsGroupList.push(o)}if(null!=this.studyAreaService.selectedStudyArea.CoordinatedReach&&"PFS"==t.code.toUpperCase())return this.addParameterToStudyAreaList("DRNAREA"),void(this.nssService.showFlowsTable=!0);this.nssService.loadParametersByStatisticsGroup(this.regionService.selectedRegion.RegionID,t.id,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","),this.studyAreaService.selectedStudyArea.RegressionRegions)}},t.prototype.multipleParameterSelector=function(){var e=this;this.regionService.parameterList.forEach(function(t){var r=e.checkArrayForObj(e.studyAreaService.studyAreaParameterList,t);e.multipleParameterSelectorAdd?(-1==r&&e.studyAreaService.studyAreaParameterList.push(t),t.checked=!0):r>-1&&t.toggleable&&(e.studyAreaService.studyAreaParameterList.splice(r,1),t.checked=!1)}),this.multipleParameterSelectorAdd=!this.multipleParameterSelectorAdd},t.prototype.updateStudyAreaParameterList=function(e){if(0==e.toggleable)return this.toaster.pop("warning",e.code+" is required by one of the selected scenarios","It cannot be unselected"),void(e.checked=!0);var t=this.studyAreaService.studyAreaParameterList.indexOf(e);!e.checked&&t>-1?this.studyAreaService.studyAreaParameterList.splice(t,1):e.checked&&-1==t&&this.studyAreaService.studyAreaParameterList.push(e),this.checkParameters()},t.prototype.checkParameters=function(){for(var e=!0,t=0,r=this.regionService.parameterList;t<r.length;t++){r[t].checked||(e=!1)}this.multipleParameterSelectorAdd=!e},t.prototype.calculateParameters=function(){gtag("event","Calculate",{Category:"Parameters",Location:this.regionService.selectedRegion.Name,Value:this.studyAreaService.studyAreaParameterList.map(function(e){return e.code}).join(",")}),this.studyAreaService.loadParameters(),this.scenarioHasExtensions&&1==this.nssService.selectedStatisticsGroupList.length&&(this.nssService.showBasinCharacteristicsTable=!1)},t.prototype.configureExtensions=function(t){"FDCTM"==t?this.modalService.openModal(e.Services.SSModalType.e_extensionsupport):"FLA"==t&&(this.modalService.openModal(e.Services.SSModalType.e_flowanywhere),this.addParameterToStudyAreaList("DRNAREA"))},t.prototype.submitBasinEdits=function(){gtag("event","BasinEditor",{Type:"SubmitEdits"}),this.studyAreaService.showEditToolbar=!1,this.toaster.pop("wait","Submitting edited basin","Please wait...",0),this.studyAreaService.selectedStudyArea.Disclaimers.isEdited&&(this.nssService.clearNSSdata(),this.studyAreaService.loadEditedStudyBoundary())},t.prototype.selectScenarios=function(){this.setProcedureType(3)},t.prototype.refreshWindow=function(){window.location.reload()},t.prototype.generateReport=function(){var t=this;if(this.toaster.pop("wait","Opening Report","Please wait...",5e3),gtag("event","Calculate",{Category:"Flows",Location:this.regionService.selectedRegion.Name,Value:this.nssService.selectedStatisticsGroupList.map(function(e){return e.name}).join(",")}),this.studyAreaService.extensionResultsChanged=0,-1!=this.regionService.selectedRegion.Applications.indexOf("FLA")&&this.studyAreaService.flowAnywhereData&&this.studyAreaService.flowAnywhereData.selectedGage&&this.studyAreaService.flowAnywhereData.dateRange&&this.studyAreaService.computeFlowAnywhereResults(),this.nssService.selectedStatisticsGroupList.length>0&&this.nssService.showFlowsTable){var r=[];if(null!=this.studyAreaService.selectedStudyArea.CoordinatedReach)for(var a=0;a<this.nssService.selectedStatisticsGroupList.length;a++){var i=this.nssService.selectedStatisticsGroupList[a];if("PFS"===i.code.toUpperCase()){i.citations=[{author:"Indiana DNR,",title:"Coordinated Discharges of Selected Streams in Indiana.",citationURL:"http://www.in.gov/dnr/water/4898.htm"}],i.regressionRegions=[];var n=this.studyAreaService.selectedStudyArea.CoordinatedReach.Execute(this.studyAreaService.studyAreaParameterList.filter(function(e){return"DRNAREA"===e.code}));i.regressionRegions.push(n),r.push(i),this.nssService.selectedStatisticsGroupList.splice(a,1);break}}this.nssService.estimateFlows(this.studyAreaService.studyAreaParameterList,"value",this.regionService.selectedRegion.RegionID),-1!=this.regionService.selectedRegion.Applications.indexOf("RegulationFlows")&&setTimeout(function(){t.nssService.estimateFlows(t.studyAreaService.studyAreaParameterList,"unRegulatedValue",t.regionService.selectedRegion.RegionID,!0)},500),null!=i&&"PFS"===i.code.toUpperCase()&&(this.nssService.selectedStatisticsGroupList.push(i),1==this.nssService.selectedStatisticsGroupList.length&&(this.toaster.clear(),this.modalService.openModal(e.Services.SSModalType.e_report),this.nssService.reportGenerated=!0))}else this.toaster.clear(),this.modalService.openModal(e.Services.SSModalType.e_report),this.nssService.reportGenerated=!0;this.leafletData.getMap("mainMap").then(function(e){t.leafletData.getLayers("mainMap").then(function(r){for(var a in r.baselayers)e.hasLayer(r.baselayers[a])&&(t.studyAreaService.baseMap={},t.studyAreaService.baseMap[a]=configuration.basemaps[a])})})},t.prototype.checkRegulation=function(){gtag("event","AdditionalFunctionality",{Category:"Regulation"}),this.studyAreaService.upstreamRegulation()},t.prototype.queryRegressionRegions=function(){if(!this.regionService.selectedRegion.ScenariosAvailable)return this.studyAreaService.regressionRegionQueryComplete=!0,void this.setProcedureType(r.SELECT);this.nssService.queriedRegions=!0,-1!=this.regionService.selectedRegion.Applications.indexOf("CoordinatedReach")&&this.studyAreaService.queryCoordinatedReach(),this.studyAreaService.selectedStudyArea.RegressionRegions?this.setProcedureType(3):this.studyAreaService.queryRegressionRegions()},t.prototype.queryStatisticsGroupTypes=function(){this.nssService.loadStatisticsGroupTypes(this.regionService.selectedRegion.RegionID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","))},t.prototype.updateParameterValue=function(e){},t.prototype.onSelectedStatisticsGroupChanged=function(){var e=this;this.nssService.selectedStatisticsGroupList.length>0?this.nssService.showFlowsTable=!0:this.nssService.showFlowsTable=!1,this.nssService.selectedStatisticsGroupList.forEach(function(t){t.regressionRegions&&t.regressionRegions.forEach(function(t){t.parameters.forEach(function(t){for(var r=!1,a=0;a<e.regionService.parameterList.length;a++){var i=e.regionService.parameterList[a];if(i.code.toLowerCase()==t.code.toLowerCase()){e.addParameterToStudyAreaList(i.code),r=!0;break}}if(!r){e.toaster.pop("warning","Missing Parameter: "+t.code,"The selected scenario requires a parameter not available in this State/Region.  The value for this parameter will need to be entered manually.",0);var n={name:t.name,description:t.description,code:t.code,unit:t.unitType.unit,value:null,regulatedValue:null,unRegulatedValue:null,loaded:null,checked:!1,toggleable:!0};e.regionService.parameterList.push(n),e.addParameterToStudyAreaList(t.code)}})})})},t.prototype.OpenWateruse=function(){gtag("event","AdditionalFunctionality",{Category:"WaterUse"}),this.modalService.openModal(e.Services.SSModalType.e_wateruse)},t.prototype.OpenStormRunoff=function(){gtag("event","AdditionalFunctionality",{Category:"StormRunoff"}),this.modalService.openModal(e.Services.SSModalType.e_stormrunnoff)},t.prototype.OpenNearestGages=function(){gtag("event","AdditionalFunctionality",{Category:"NearestGages"}),this.modalService.openModal(e.Services.SSModalType.e_nearestgages)},t.prototype.downloadGeoJSON=function(){gtag("event","Download",{Category:"Basin",Type:"Geojson"});var e=angular.toJson(this.studyAreaService.selectedStudyArea.FeatureCollection),t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"data.geojson");else{var r=document.createElement("a"),a=URL.createObjectURL(t);void 0!==r.download?(r.setAttribute("href",a),r.setAttribute("download","data.geojson"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(a)}},t.prototype.downloadKML=function(){gtag("event","Download",{Category:"Basin",Type:"KML"});var e=JSON.parse(angular.toJson(this.studyAreaService.selectedStudyArea.FeatureCollection)),t=tokml(e),r=new Blob([t],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,"data.kml");else{var a=document.createElement("a"),i=URL.createObjectURL(r);void 0!==a.download?(a.setAttribute("href",i),a.setAttribute("download","data.kml"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(i)}},t.prototype.downloadShapeFile=function(){gtag("event","Download",{Category:"Basin",Type:"Shapefile"});try{var e=null;this.nssService.showFlowsTable&&(e=this.nssService.getflattenNSSTable(this.studyAreaService.selectedStudyArea.WorkspaceID));var t=this.studyAreaService.getflattenStudyArea(),r="Application Version: "+configuration.version;this.SSServicesVersion&&(r+="\nStreamStats Services Version: "+this.SSServicesVersion),shpwrite.download(t,e,"USGS Data Disclaimer: Unless otherwise stated, all data, metadata and related materials are considered to satisfy the quality standards relative to the purpose for which the data were collected. Although these data and associated metadata have been reviewed for accuracy and completeness and approved for release by the U.S. Geological Survey (USGS), no warranty expressed or implied is made regarding the display or utility of the data for other purposes, nor on all computer systems, nor shall the act of distribution constitute any such warranty.\nUSGS Software Disclaimer: This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the functionality of the software and related material nor shall the fact of release constitute any such warranty. Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held liable for any damages resulting from its authorized or unauthorized use.\nUSGS Product Names Disclaimer: Any use of trade, firm, or product names is for descriptive purposes only and does not imply endorsement by the U.S. Government.\n\n"+r)}catch(e){console.log(e)}},t.prototype.init=function(){var e=this;this._onSelectedStatisticsGroupChangedHandler=new WiM.Event.EventHandler(function(){e.onSelectedStatisticsGroupChanged()})},t.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},t.prototype.addParameterToStudyAreaList=function(e){try{for(var t=0;t<this.regionService.parameterList.length;t++){var r=this.regionService.parameterList[t];if(r.code.toUpperCase()===e.toUpperCase()&&-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,r)){this.studyAreaService.studyAreaParameterList.push(r),r.checked=!0,r.toggleable=!1;break}}}catch(e){return!1}},t.prototype.canUpdateProcedure=function(e){try{switch(e){case r.INIT:return!0;case r.IDENTIFY:return null!=this.regionService.selectedRegion;case r.SELECT:return this.studyAreaService.regressionRegionQueryComplete;case r.BUILD:return this.studyAreaService.regressionRegionQueryComplete&&this.parametersLoaded;default:return!1}}catch(e){return!1}},t.prototype.sm=function(e){},t.$inject=["$scope","toaster","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ModalService","leafletData","StreamStats.Services.ExplorationService","WiM.Event.EventManager"],t}();!function(e){e[e.INIT=1]="INIT",e[e.IDENTIFY=2]="IDENTIFY",e[e.SELECT=3]="SELECT",e[e.BUILD=4]="BUILD"}(r||(r={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.SidebarController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use strict";var r=function(t){function r(e,r,a,i){var n=t.call(this,r,configuration.baseurls.StreamStats)||this;return e.vm=n,n.http=r,n.modalService=a,n.getFreshdeskCreds(),n.studyAreaService=i,n.newArticleCount=0,n.environment=configuration.environment,n.AppVersion=configuration.version,n.cloud=configuration.cloud,n}return __extends(r,t),r.prototype.checkActiveNews=function(){var t=this;console.log("Checking for active news articles");var r={Authorization:"Basic "+btoa(this.freshdeskCreds.Token+":X")},a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.ActiveNewsFolder,i=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",r);this.Execute(i).then(function(r){console.log("Successfully retrieved active news articles page"),r.data.folder.articles.length>0&&(r.data.folder.articles.forEach(function(e){null==t.readCookie(e.id)&&(console.log("New news article found: ",e),t.newArticleCount+=1,t.createCookie(e.id,!0,30))}),t.newArticleCount>0&&t.modalService.openModal(e.Services.SSModalType.e_about,{tabName:"news",regionID:""}))},function(e){}).finally(function(){})},r.prototype.getFreshdeskCreds=function(){var e=this;this.http.get("./data/secrets.json").then(function(t){e.studyAreaService.freshdeskCredentials=t.data,e.freshdeskCreds=t.data,e.checkActiveNews()})},r.prototype.openReport=function(){this.modalService.openModal(e.Services.SSModalType.e_report)},r.prototype.openAbout=function(){this.modalService.openModal(e.Services.SSModalType.e_about)},r.prototype.openHelp=function(){this.modalService.openModal(e.Services.SSModalType.e_help)},r.prototype.readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var i=r[a];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null},r.prototype.createCookie=function(e,t,r){if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3);var i="; expires="+a.toUTCString()}else i="";document.cookie=e+"="+t+i+"; path=/"},r.$inject=["$scope","$http","StreamStats.Services.ModalService","StreamStats.Services.StudyAreaService"],r}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavbarController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(t){"use strinct";var r=function(){return function(e,t,r){this.lat=e,this.lng=t,this.zoom=r}}(),a=function(){function t(t,r,a,i,n,o,s,g){var l=this;if(this.regionService=o,this.modal=s,this.disclaimer='"USGS Data Disclaimer: Unless otherwise stated, all data, metadata and related materials are considered to satisfy the quality standards relative to the purpose for which the data were collected. Although these data and associated metadata have been reviewed for accuracy and completeness and approved for release by the U.S. Geological Survey (USGS), no warranty expressed or implied is made regarding the display or utility of the data for other purposes, nor on all computer systems, nor shall the act of distribution constitute any such warranty."\n"USGS Software Disclaimer: This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the functionality of the software and related material nor shall the fact of release constitute any such warranty. Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held liable for any damages resulting from its authorized or unauthorized use."\n"USGS Product Names Disclaimer: Any use of trade, firm, or product names is for descriptive purposes only and does not imply endorsement by the U.S. Government."\n\n',this.markers=null,this.overlays=null,this.center=null,this.layers=null,this.geojson=null,this.isExceedanceTableOpen=!1,this.isFlowTableOpen=!1,this.isEstimatedFlowFLATableOpen=!1,this.SSServicesVersion="1.2.22",this._graphData={data:{},options:{}},t.vm=this,this.studyAreaService=a,this.nssService=i,this.leafletData=n,this.reportTitle="StreamStats Report",this.reportComments="Some comments here",this.AppVersion=configuration.version,this.extensions=this.ActiveExtensions,this.applications=this.ActiveApplications,this.environment=configuration.environment,this.sectionCollapsed=[],this.basinCharCollapsed=!1,this.collapsed=!1,this.selectedFDCTMTabName="",this.eventManager=g,this.extensions&&this.extensions[0].result&&this.extensions[0].result.length>1){this.extensions[0].result.forEach(function(e){e.name.toLowerCase().includes("multivar")&&(l.selectedFDCTMTabName=e.name)});var c=this.extensions[0].result.map(function(e){return e.name});this.extensions[0].result=this.extensions[0].result.filter(function(e,t){var r=e.name;return!c.includes(r,t+1)})}this.initMap(),this.eventManager.SubscribeToEvent(e.Services.onAdditionalFeaturesLoaded,new WiM.Event.EventHandler(function(){var e=l.studyAreaService.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"!==e.id});l.showFeatures(e)})),t.$on("leafletDirectiveMap.reportMap.load",function(e,t){l.showFeatures(l.studyAreaService.selectedStudyArea.FeatureCollection.features)}),this.close=function(){r.dismiss("cancel")},this.print=function(){gtag("event","Download",{Category:"Report",Type:"Print"}),window.print()},this.NSSServicesVersion=this.studyAreaService.NSSServicesVersion}return Object.defineProperty(t.prototype,"showReport",{get:function(){if(!this.studyAreaService.studyAreaParameterList)return!1;for(var e=0;e<this.studyAreaService.studyAreaParameterList.length;e++){var t=this.studyAreaService.studyAreaParameterList[e];if(t.value&&t.value>=0)return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canShowDisclaimers",{get:function(){return null!=this.studyAreaService.selectedStudyArea.Disclaimers&&Object.keys(this.studyAreaService.selectedStudyArea.Disclaimers).length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showRegulation",{get:function(){return this.regionService.selectedRegion.Applications.indexOf("RegulationFlows")>-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ActiveApplications",{get:function(){return this.regionService.selectedRegion.Applications&&this.regionService.selectedRegion.Applications.length>0?this.regionService.selectedRegion.Applications:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ActiveExtensions",{get:function(){return this.studyAreaService.selectedStudyArea.NSS_Extensions&&this.studyAreaService.selectedStudyArea.NSS_Extensions.length>0?this.studyAreaService.selectedStudyArea.NSS_Extensions:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"GraphData",{get:function(){return this._graphData},enumerable:!1,configurable:!0}),t.prototype.selectFDCTMTab=function(e){this.selectedFDCTMTabName!=e&&(this.selectedFDCTMTabName=e)},t.prototype.downloadCSV=function(){var e=this;gtag("event","Download",{Category:"Report",Type:"CSV"});var t,r="StreamStats Output Report\n\nState/Region ID,"+this.studyAreaService.selectedStudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.studyAreaService.selectedStudyArea.WorkspaceID+"\nLatitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString()+"\n";r+=(this.studyAreaService.studyAreaParameterList,t="\nBasin Characteristics\n",(t+=e.tableToCSV($("#mainParamTable")))+"\n\n"),this.nssService.selectedStatisticsGroupList.forEach(function(t){r+=function(t){var r="\n";return t.regressionRegions.forEach(function(a){if("Area-Averaged"!=a.name){var i="";a.percentWeight&&(i=a.percentWeight.toFixed(1)+" Percent "),r+=t.name+" Parameters,"+i+a.name.split("_").join(" ")+"\r\n",r+=e.tableToCSV($(document.getElementById(e.camelize(t.name+a.name+"ScenarioParamTable"))))+"\n"}}),r+"\n"}(t),t.disclaimers&&(t.disclaimers.Warnings||t.disclaimers.Errors)&&(r+=function(e){var t="*** "+e.name+" Disclaimers ***\r\n";return angular.forEach(e.disclaimer,function(e,r){t+=r+","+e+"\r\n"}),t+"\r\n"}(t)),r+=function(t){var r="";return t.regressionRegions.forEach(function(a){if(a.results){var i="";a.percentWeight&&(i=a.percentWeight.toFixed(1)+" Percent "),r+=t.name+" Flow Report,"+i+a.name.split("_").join(" ")+"\r\n",a.results[0].intervalBounds&&a.results[0].errors&&a.results[0].errors.length>0&&(r+='"PIl: Prediction Interval- Lower, PIu: Prediction Interval- Upper, ASEp: Average Standard Error of Prediction, SE: Standard Error (other-- see report)"\r\n'),r+=e.tableToCSV($(document.getElementById(e.camelize(t.name+a.name+"ScenarioFlowTable"))))+"\n"}}),r+"\n"}(t)}),this.isExceedanceTableOpen=!0,this.isFlowTableOpen=!0,this.isEstimatedFlowFLATableOpen=!0;var a=this;setTimeout(function(){var e="";if(a.extensions)for(var t=0,i=a.extensions;t<i.length;t++){var n=i[t];if("QPPQ"==n.code){e+=n.name+=" (FDCTM)\n",e+="Regression Region:, "+a.selectedFDCTMTabName+"\n";for(var o=0,s=n.parameters;o<s.length;o++){var g=s[o];if(["sdate","edate"].indexOf(g.code)>-1){var l=new Date(g.value);e+=g.name+":, "+l.toLocaleDateString()+"\n"}}e+="\n",e+=a.tableToCSV($("#ReferenceGage")),e+="\n\nExceedance Probabilities\n",e+=a.tableToCSV($("#exceedanceTable")),e+="\n\nEstimated Flows\n",e+=a.tableToCSV($("#flowTable")),e+="\n\n"}}if(a.applications){-1!=a.applications.indexOf("FLA")&&(e+="Flow Anywhere Method",e+="\n\n",e+=a.tableToCSV($("#flowAnywhereReferenceGage")),e+="\n\n",e+=a.tableToCSV($("#flowAnywhereModelParameters")),e+="\n\nEstimated Flows\n",e+=a.tableToCSV($("#estimatedFlowFLATable")),e+="\n\n");var c=-1!=a.applications.indexOf("ChannelWidthWeighting"),A=!1;a.nssService.selectedStatisticsGroupList.forEach(function(e){"Peak-Flow Statistics"==e.name&&(A=!0)}),c&&A&&(e+="Channel-width Methods Weighting\n",document.getElementById("channelWidthWeightingTable")?(e+="PIl: Prediction Interval-Lower, PIu: Prediction Interval-Upper, ASEp: Average Standard Error of Prediction\n",a.nssService.equationWeightingDisclaimers&&a.nssService.equationWeightingDisclaimers.length>0&&(e+="Warning messages:,",a.nssService.equationWeightingDisclaimers.forEach(function(t){e+=t+". "}),e+="\n"),e+=a.tableToCSV($("#channelWidthWeightingTable"))):e+="No method weighting results returned.",e+="\n\n")}r+=e,r+=a.disclaimer+"Application Version: "+a.AppVersion,a.SSServicesVersion&&(r+="\nStreamStats Services Version: "+a.SSServicesVersion),a.NSSServicesVersion&&(r+="\nNSS Services Version: "+a.NSSServicesVersion);var u=new Blob([r],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(u,"data.csv");else{var d=document.createElement("a"),C=URL.createObjectURL(u);void 0!==d.download?(d.setAttribute("href",C),d.setAttribute("download","data.csv"),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)):window.open(C)}this.isExceedanceTableOpen=!1,this.isFlowTableOpen=!1,this.isEstimatedFlowFLATableOpen=!1},300)},t.prototype.downloadGeoJSON=function(){var e=this;gtag("event","Download",{Category:"Report",Type:"Geojson"});var t=this.studyAreaService.selectedStudyArea.FeatureCollection;t.features.forEach(function(t){t.properties.Name=e.studyAreaService.selectedStudyArea.WorkspaceID,t.id&&"globalwatershed"==t.id&&(t.properties=[t.properties,e.studyAreaService.studyAreaParameterList.reduce(function(e,t){return e[t.code]=t.value,e},{})].reduce(function(e,t){return Object.keys(t).forEach(function(r){e[r]=t[r]}),e},{}),t.properties.FlowStatistics=e.nssService.selectedStatisticsGroupList)});var r=angular.toJson(t),a=new Blob([r],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,"data.geojson");else{var i=document.createElement("a"),n=URL.createObjectURL(a);void 0!==i.download?(i.setAttribute("href",n),i.setAttribute("download","data.geojson"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)):window.open(n)}},t.prototype.downloadKML=function(){var e=this;gtag("event","Download",{Category:"Report",Type:"KML"});var t=this.studyAreaService.selectedStudyArea.FeatureCollection;t.features.forEach(function(t){t.properties.Name=e.studyAreaService.selectedStudyArea.WorkspaceID,t.id&&"globalwatershed"==t.id&&(t.properties=[t.properties,e.studyAreaService.studyAreaParameterList.reduce(function(e,t){return e[t.code]=t.value,e},{})].reduce(function(e,t){return Object.keys(t).forEach(function(r){e[r]=t[r]}),e},{}),t.properties.FlowStatistics=e.nssService.selectedStatisticsGroupList)});var r=JSON.parse(angular.toJson(t)),a=tokml(r),i=new Blob([a],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,"data.kml");else{var n=document.createElement("a"),o=URL.createObjectURL(i);void 0!==n.download?(n.setAttribute("href",o),n.setAttribute("download","data.kml"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)):window.open(o)}},t.prototype.downloadShapeFile=function(){gtag("event","Download",{Category:"Report",Type:"Shapefile"});try{var e=null;this.nssService.showFlowsTable&&(e=this.nssService.getflattenNSSTable(this.studyAreaService.selectedStudyArea.WorkspaceID));var t=this.studyAreaService.getflattenStudyArea(),r="Application Version: "+this.AppVersion;this.SSServicesVersion&&(r+="\nStreamStats Services Version: "+this.SSServicesVersion),this.NSSServicesVersion&&(r+="\nNSS Services Version: "+this.NSSServicesVersion),shpwrite.download(t,e,this.disclaimer+r)}catch(e){console.log(e)}},t.prototype.downloadPNG=function(e){for(var t,r=document.getElementById(e).children,a=0;a<r.length;a++)"svg"===r[a].tagName&&(t=r[a]);saveSvgAsPng(t,e+".png")},t.prototype.downloadPDF=function(){var e=new jsPDF("p","pt","letter"),t=document.getElementById("printArea").innerHTML,r={top:80,bottom:60,left:40,width:522};e.fromHTML(t,r.left,r.top,{width:r.width,elementHandlers:{"#bypassme":function(e,t){return!0}}},function(t){e.save("Test.pdf")},r)},t.prototype.collapseSection=function(e,t,r){var a=e.currentTarget.nextElementSibling;"none"===a.style.display?(a.style.display="block","stats"===t&&(this.sectionCollapsed[r]=!1),"basin"===t&&(this.basinCharCollapsed=!1)):(a.style.display="none","stats"===t&&(this.sectionCollapsed[r]=!0),"basin"===t&&(this.basinCharCollapsed=!0))},t.prototype.expandAll=function(e){var t=this,r=document.querySelectorAll(".collapsible-content");"expand"===e?(r.forEach(function(e){e.style.display="block"}),this.basinCharCollapsed=!1,this.nssService.statisticsGroupList.forEach(function(e){t.sectionCollapsed[e.name]=!1}),this.collapsed=!1):(r.forEach(function(e){e.style.display="none"}),this.basinCharCollapsed=!0,this.nssService.statisticsGroupList.forEach(function(e){t.sectionCollapsed[e.name]=!0}),this.collapsed=!0)},t.prototype.ActivateGraphs=function(e){for(var t in e.graphdata={exceedance:{data:[{values:[],area:!0,color:"#7777ff"}],options:{chart:{type:"lineChart",height:450,margin:{top:20,right:30,bottom:60,left:100},x:function(e){return e.label},y:function(e){return e.value},showLegend:!1,valueFormat:function(e){return d3.format(",.3f")(e)},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Discharge (cfs)",tickFormat:function(e){return d3.format(",.0f")(e)},tickValues:[1,10,100,1e3,1e4,1e6]},yScale:d3.scale.log(),title:{enable:!0,text:"Flow Duration Curve Transfer Method (FDCTM) Model Estimated Exceedance Probabilities"}}}},flow:{data:[{key:"Observed",values:this.processData(e.referanceGage.discharge.observations)},{key:"Estimated",values:this.processData(e.estimatedFlow.observations)}],options:{chart:{type:"lineChart",height:450,margin:{top:20,right:30,bottom:60,left:100},x:function(e){return new Date(e.x).getTime()},y:function(e){return e.y},useInteractiveGuideline:!1,interactive:!0,tooltips:!0,xAxis:{tickFormat:function(e){return d3.time.format("%x")(new Date(e))},rotateLabels:-30,showMaxMin:!0},yAxis:{axisLabel:"Estimated Discharge (cfs)",tickFormat:function(e){return null!=e?e.toUSGSvalue():e},showMaxMin:!0},zoom:{enabled:!1}}}}},e.exceedanceProbabilities)e.graphdata.exceedance.data[0].values.push({label:t,value:e.exceedanceProbabilities[t]});e.exceedanceProbabilitiesArray=[],angular.forEach(e.exceedanceProbabilities,function(t,r){e.exceedanceProbabilitiesArray.push({exceedance:r,flowExceeded:t})})},t.prototype.initMap=function(){this.center=new r(39,-96,4),this.layers={baselayers:configuration.basemaps,overlays:{}},this.geojson={},L.Icon.Default.imagePath="images",this.defaults={scrollWheelZoom:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1}},t.prototype.GetRegressionRegionHeader=function(e){var t=e.name.split("_").join(" ");if(e.percentWeight&&e.percentWeight<100)for(var r=0;r<this.studyAreaService.selectedStudyArea.RegressionRegions.length;r++){var a=this.studyAreaService.selectedStudyArea.RegressionRegions[r];if(null!=e.code&&a.code.indexOf(e.code.toUpperCase())>-1){t="{0} Percent ({1} square miles) {2}".format(e.percentWeight.toFixed(1),a.area.toUSGSvalue(),t);break}}return"["+t+"]"},t.prototype.showFeatures=function(e){var t=this;if(this.studyAreaService.selectedStudyArea){if(this.overlays={},e.forEach(function(e){t.addGeoJSON(e.id,e)}),this.studyAreaService.selectedGage&&this.studyAreaService.selectedGage.hasOwnProperty("Latitude_DD")&&this.studyAreaService.selectedGage.hasOwnProperty("Longitude_DD")){var r={type:"Feature",geometry:{coordinates:[this.studyAreaService.selectedGage.Latitude_DD,this.studyAreaService.selectedGage.Longitude_DD],type:"Point"}};this.addGeoJSON("referenceGage",r)}var a=this.studyAreaService.selectedStudyArea.FeatureCollection.bbox;this.leafletData.getMap("reportMap").then(function(e){e.invalidateSize(),e.fitBounds([[a[1],a[0]],[a[3],a[2]]])})}},t.prototype.addGeoJSON=function(e,t){"globalwatershed"==e?this.layers.overlays[e]={name:"Basin Boundary",type:"geoJSONShape",data:this.studyAreaService.simplify(angular.fromJson(angular.toJson(t))),visible:!0,layerOptions:{style:{fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}}}:"globalwatershedpoint"==e?this.layers.overlays[e]={name:"Basin Clicked Point",type:"geoJSONShape",data:t,visible:!0}:"referenceGage"==e?this.geojson[e]={data:t,style:{displayName:"Index Gage"},onEachFeature:function(e,t){var r=L.icon({iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAaJJREFUOI3dzz1IW1EYxvF/TMqpFQsJCF4QOuhUpTpEVCw6RSsdQhFB6hfiF0IDFqkoOCqKEhxEqm0H20YUgpQoqOBWOkgjpQgXowREEC5SuVBE6QtFHXQwYjSJmXzgDO85hx/PayPJsd0TcD6sqM6ZBFqAk7uD4dCyqu3dkLnhRmD6bqB/ q5DwZrl4hv6rb2MWEfEDR4mD + q9ZSl + mAC75 + HOGxvwuYDAx8MNaK / +Os3mUfj5nP + tSSlsUMbKAvfhA / dSKb3qEqvrLtwUS0CeVW + sWkbfxgcsr4zx12rFe + ZJu75PMPK / jcKfQNM1gbKBPz2Az2EzJi + ten / B1LdUse9AGxAhu//ZTXPkwanurrRd3RyeBqRrAfzM48b2IvwfPcWRG9QC76nnvlMDUY2ABkOjgbshHxWvrTRqAYPGo/s9uGWh6A3ivBR3epTZTpeWQmnabB6CkqqFOjbbvi0gG8CcSXF1NMZdCw7zqjAW7iKWOT+sVqtX5TkR6IkGXqx4IMub5EYeIQAlQrmlarmEY+uWVv1ycRDJgGAaRDZOUpINnJ5KDtx5X6hkAAAAASUVORK5CYII=",iconSize:[15,16],iconAnchor:[7.5,8],popupAnchor:[0,-11]});t.setIcon(r)},layerArray:[{layerName:"Index Gage",legend:[{contentType:"image/png",imageData:"iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAaJJREFUOI3dzz1IW1EYxvF/TMqpFQsJCF4QOuhUpTpEVCw6RSsdQhFB6hfiF0IDFqkoOCqKEhxEqm0H20YUgpQoqOBWOkgjpQgXowREEC5SuVBE6QtFHXQwYjSJmXzgDO85hx/PayPJsd0TcD6sqM6ZBFqAk7uD4dCyqu3dkLnhRmD6bqB/ q5DwZrl4hv6rb2MWEfEDR4mD + q9ZSl + mAC75 + HOGxvwuYDAx8MNaK / +Os3mUfj5nP + tSSlsUMbKAvfhA / dSKb3qEqvrLtwUS0CeVW + sWkbfxgcsr4zx12rFe + ZJu75PMPK / jcKfQNM1gbKBPz2Az2EzJi + ten / B1LdUse9AGxAhu//ZTXPkwanurrRd3RyeBqRrAfzM48b2IvwfPcWRG9QC76nnvlMDUY2ABkOjgbshHxWvrTRqAYPGo/s9uGWh6A3ivBR3epTZTpeWQmnabB6CkqqFOjbbvi0gG8CcSXF1NMZdCw7zqjAW7iKWOT+sVqtX5TkR6IkGXqx4IMub5EYeIQAlQrmlarmEY+uWVv1ycRDJgGAaRDZOUpINnJ5KDtx5X6hkAAAAASUVORK5CYII=",label:"Index Gage"}]}]}:this.layers.overlays[e]="regulatedwatershed"==e?{name:"Basin Boundary (Regulated Area)",type:"geoJSONShape",data:t,visible:!0,layerOptions:{style:{fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}}}:{name:e,type:"geoJSONShape",data:t,visible:!1,layerOptions:{style:{fillColor:"red",color:"red"}}}},t.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),r=e.find("tr:has(td)"),a=String.fromCharCode(11),i=String.fromCharCode(0),n='","',o='"\r\n"',s='"';return s+=g(t.map(l)),s+=o,s+=g(r.map(l))+'"';function g(e){return e.get().join(i).split(i).join(o).split(a).join(n)}function l(e,t){var r=$(t),i=r.find("td");return i.length||(i=r.find("th")),i.map(c).get().join(a)}function c(e,t){return $(t).text().replace('"','""')}},t.prototype.camelize=function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")},t.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modal.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},t.prototype.getEstimatedFlow=function(e,t){var r=t.filter(function(t){return t.date==e.date})[0];return r&&r.hasOwnProperty("value")?"number"==typeof r.value?r.value.toUSGSvalue():r.value:"N/A"},t.prototype.processData=function(e){for(var t=[],r=new Date(Math.min.apply(null,e.map(function(e){return new Date(e.date)}))),a=new Date(Math.max.apply(null,e.map(function(e){return new Date(e.date)}))),i=r;i<=a;i.setDate(i.getDate()+1)){var n=e.filter(function(e){return new Date(e.date).getTime()==i.getTime()})[0];void 0==n?t.push({x:i.getTime(),y:null}):t.push({x:i.getTime(),y:n.hasOwnProperty("value")?"number"==typeof n.value?n.value.toUSGSvalue():n.value:null})}return t},t.$inject=["$scope","$modalInstance","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","leafletData","StreamStats.Services.RegionService","StreamStats.Services.ModalService","WiM.Event.EventManager"],t}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ReportController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use strict";var t,r,a=function(){return function(){this.Annual={Graph:{},Table:{}},this.Monthly={Graph:{withdrawals:null,returns:null},Table:{}}}}(),i=function(e){function i(t,r,a,i,n,o,s){var g=e.call(this,r,configuration.baseurls.WaterUseServices)||this;return g.$timeout=n,g.eventManager=o,g.permits_sw={name:"Temporary water-use registrations (surface water)",aveReturn:"",aveWithdrawal:"---"},g.permits_gw={name:"Temporary water-use registrations (ground water)",aveReturn:"",aveWithdrawal:"---"},g.AnnualTotalWithdrawals=0,g.AnnualTotalReturns=0,g.AnnualAveWithdrawals=0,g.AnnualAveReturns=0,t.vm=g,g.modalInstance=i,g.StudyArea=a.selectedStudyArea,g.StudyAreaService=a,g.NSSService=s,g.init(),g}return __extends(i,e),Object.defineProperty(i.prototype,"StartYear",{get:function(){return this._startYear},set:function(e){this.spanYear||(this.EndYear=e),e<=this.EndYear&&e>=this.YearRange.floor&&(this._startYear=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"EndYear",{get:function(){return this._endYear},set:function(e){e>=this.StartYear&&e<=this.YearRange.ceil&&(this._endYear=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"YearRange",{get:function(){return this._yearRange},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"IndexWOReg",{get:function(){return this._indexWOReg},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"IndexWReg",{get:function(){return this._indexWReg},enumerable:!1,configurable:!0}),i.prototype.GetWaterUse=function(){var e=this;this.CanContinue=!1,this.GetWaterUseLabel=!0;var r=configuration.queryparams.Wateruse.format(this.StartYear,this.EndYear,this.includePermits,this.computeReturns,this.computeDomesticWU),a=this.StudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry,i=new WiM.Services.Helpers.RequestInfo(r,!1,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(a));this.Execute(i).then(function(r){e.showResults=!0,e.result=r.data,"Wateruse not available at specified site."!==e.result.Messages&&(r.data.hasOwnProperty("withdrawal")||r.data.hasOwnProperty("return"))||alert("Wateruse not available at specified site."),e.ReportData.Monthly.Graph=e.loadGraphData(t.Monthly),e.ReportData.Annual.Graph=e.loadGraphData(t.Annual),e.ReportData.Monthly.Table=e.GetTableData(t.Monthly),e.ReportData.Annual.Table=e.GetTableData(t.Annual)},function(e){}).finally(function(){e.setIndexes(),e.CanContinue=!0})},i.prototype.Close=function(){this.modalInstance.dismiss("cancel")},i.prototype.Reset=function(){this.init()},i.prototype.Print=function(){window.print()},i.prototype.setIndexes=function(){null!=this.Q10&&null!=this.AnnualTotalReturns&&null!=this.AnnualTotalWithdrawals&&null!=this.permits_gw.aveWithdrawal&&null!=this.permits_sw.aveWithdrawal?(this._indexWOReg=((+this.AnnualAveWithdrawals-+this.AnnualAveReturns)/+this.Q10).toFixed(3),this._indexWReg=((+this.permits_gw.aveWithdrawal+ +this.permits_sw.aveWithdrawal+(+this.AnnualAveWithdrawals-+this.AnnualAveReturns))/+this.Q10).toFixed(3)):(this._indexWOReg="---",this._indexWReg="---")},i.prototype.loadGraphData=function(e){try{var r={returns:[],withdrawals:[]};switch(e){case t.Monthly:new Array(12);if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var a in this.result.withdrawal.monthly){var i=this.result.withdrawal.monthly[a].code;for(var n in i){for(var o=-1,s=0;s<r.withdrawals.length;s++){if(r.withdrawals[s].key==i[n].name){o=s;break}}if(o<0){var g=[];for(s=1;s<=12;s++)g.push({label:this.getMonth(s),stack:"withdrawal",value:0});o=r.withdrawals.push({key:i[n].name,values:g,color:this.generateColorShade(190,350)})-1}r.withdrawals[o].values[+a-1].value=i[n].value}}if(this.result.hasOwnProperty("return")){var l=[];for(var a in this.result.return.monthly)l.push({label:this.getMonth(+a),stack:"withdrawal",value:this.Sum(this.result.return.monthly[a].month,"value")});r.returns.push({key:"returns",color:this.generateColorShade(0,170),values:l})}return r;case t.Annual:if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("annual"))for(var c in this.result.withdrawal.annual){var A=this.result.withdrawal.annual[c];r.withdrawals.push({name:A.name,value:A.value,color:this.generateColorShade(190,350)})}if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("annual"))for(var c in this.result.return.annual){A=this.result.return.annual[c];r.returns.push({name:A.name,value:A.value,color:this.generateColorShade(0,170)})}return r}}catch(e){}},i.prototype.GetTableData=function(e){var r=[],a=[];try{switch(e){case t.Monthly:for(var i=1;i<=12;i++)a.push({month:this.getMonth(i),returns:{name:"return",SW:"---",GW:"---"},withdrawals:{SW:"---",GW:"---",code:[]}});if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var n in this.result.return.monthly)a[+n-1].returns.GW=this.result.return.monthly[n].month.hasOwnProperty("GW")?this.result.return.monthly[n].month.GW.value.toFixed(3):"---",a[+n-1].returns.SW=this.result.return.monthly[n].month.hasOwnProperty("SW")?this.result.return.monthly[n].month.SW.value.toFixed(3):"---",this.AnnualTotalReturns+=("---"==a[+n-1].returns.GW?0:+a[+n-1].returns.GW)+("---"==a[+n-1].returns.SW?0:+a[+n-1].returns.SW);if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("monthly"))for(var o in this.result.withdrawal.monthly)if(a[+o-1].withdrawals.GW=this.result.withdrawal.monthly[o].month.hasOwnProperty("GW")?this.result.withdrawal.monthly[o].month.GW.value.toFixed(3):"---",a[+o-1].withdrawals.SW=this.result.withdrawal.monthly[o].month.hasOwnProperty("SW")?this.result.withdrawal.monthly[o].month.SW.value.toFixed(3):"---",this.AnnualTotalWithdrawals+=("---"==a[+o-1].withdrawals.GW?0:+a[+o-1].withdrawals.GW)+("---"==a[+o-1].withdrawals.SW?0:+a[+o-1].withdrawals.SW),this.result.withdrawal.monthly[o].hasOwnProperty("code")){var s=this.result.withdrawal.monthly[o].code;for(var g in s){var l=-1;for(i=0;i<r.length;i++){if(r[i]==s[g].name){l=i;break}}l<0&&(l=r.push(s[g].name)-1,a.forEach(function(e){e.withdrawals.code.push({name:s[g].name,value:"---"})})),a[+o-1].withdrawals.code[l].value=s[g].value.toFixed(3)}}break;case t.Annual:r=["","Average Return","Average Withdrawal"];var c={name:"Surface Water",aveReturn:"---",aveWithdrawal:"---",unit:"MGD"},A={name:"Groundwater",aveReturn:"---",aveWithdrawal:"---",unit:"MGD"};if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("annual")){var u=this.result.withdrawal.annual;u.hasOwnProperty("SW")&&(c.aveWithdrawal=u.SW.value.toFixed(3)),u.hasOwnProperty("GW")&&(A.aveWithdrawal=u.GW.value.toFixed(3))}if(this.result.hasOwnProperty("return")&&this.result.withdrawal.hasOwnProperty("annual")){var d=this.result.return.annual;d.hasOwnProperty("SW")&&(c.aveReturn=d.SW.value.toFixed(3)),d.hasOwnProperty("GW")&&(A.aveReturn=d.GW.value.toFixed(3))}if(this.result.hasOwnProperty("withdrawal")&&this.result.withdrawal.hasOwnProperty("permitted")){var C=this.result.withdrawal.permitted;C.hasOwnProperty("Intake")&&(this.permits_sw.aveWithdrawal=C.Intake.value),C.hasOwnProperty("Well")&&(this.permits_gw.aveWithdrawal=C.Well.value)}this.AnnualAveReturns=+A.aveReturn+ +c.aveReturn,this.AnnualAveWithdrawals=+A.aveWithdrawal+ +c.aveWithdrawal,a.push(c),a.push(A),a.push({name:"Total",aveReturn:isNaN(+c.aveReturn)&&isNaN(+A.aveReturn)?"---":((isNaN(+c.aveReturn)?0:+c.aveReturn)+(isNaN(+A.aveReturn)?0:+A.aveReturn)).toFixed(3),aveWithdrawal:isNaN(+c.aveWithdrawal)&&isNaN(+A.aveWithdrawal)?"---":((isNaN(+c.aveWithdrawal)?0:+c.aveWithdrawal)+(isNaN(+A.aveWithdrawal)?0:+A.aveWithdrawal)).toFixed(3)}),a.push({name:"",aveReturn:"",aveWithdrawal:""}),a.push(this.permits_sw),a.push(this.permits_gw),a.push({name:"Temporary water-use registrations (total)",aveReturn:"",aveWithdrawal:isNaN(+this.permits_sw.aveWithdrawal)&&isNaN(+this.permits_gw.aveWithdrawal)?"---":(isNaN(+this.permits_sw.aveWithdrawal)?0:+this.permits_sw.aveWithdrawal)+(isNaN(+this.permits_gw.aveWithdrawal)?0:+this.permits_gw.aveWithdrawal)}),a.push({name:"",aveReturn:"",aveWithdrawal:""})}return{values:a,Fields:r}}catch(e){return{values:[],Fields:[]}}},i.prototype.Reduce=function(e){return e.reduce(function(e,t){return isNaN(+e)&&isNaN(+t)?"---":((isNaN(+e)?0:+e)+(isNaN(+t)?0:+t)).toFixed(3)},0)},i.prototype.Sum=function(e,t){var r=0;for(var a in e)r+=e[a][t];return r},i.prototype.Add=function(e,t){return isNaN(+e)&&isNaN(+t)?"---":((isNaN(+e)?0:+e)+(isNaN(+t)?0:+t)).toFixed(3)},i.prototype.DownloadCSV=function(){var e,t=this,r="StreamStats Water Use Report\nState/Region ID,"+this.StudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.StudyArea.WorkspaceID+"\nLatitude,"+this.StudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.StudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime:,"+this.result.processDate.toLocaleString()+"\nStart Year:,"+this.StartYear+"\nEnd Year:,"+this.EndYear+"\r\n";r+=(e=t.StartYear+"-"+t.EndYear+" Average Annual Water Use reported in million gallons/day\n",(e+=t.tableToCSV($("#AnnualWaterUseTable")))+"\r\n"),r+=function(){var e=t.StartYear+"-"+t.EndYear+" Average Water Use by Month reported in million gallons/day\n";return(e+=t.tableToCSV($("#MonthlyWaterUseTable")))+"\r\n"}();var a=new Blob([r],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,"wateruseSummary.csv");else{var i=document.createElement("a"),n=URL.createObjectURL(a);void 0!==i.download?(i.setAttribute("href",n),i.setAttribute("download","wateruseSummary.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)):window.open(n)}},i.prototype.DownloadCSVBySource=function(){var e=this,t=configuration.queryparams.WateruseSourceCSV.format(this.StartYear,this.EndYear,this.includePermits,this.computeReturns,this.computeDomesticWU),r=this.StudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry,a=new WiM.Services.Helpers.RequestInfo(t,!1,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(r),{Accept:"text/csv",Authorization:"Basic dGVzdE1hbmFnZXI6RG9nMQ=="});this.Execute(a).then(function(e){var t="wateruseSummaryBySource.csv",r=new Blob([e.data],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,t);else{var i=document.createElement("a"),n=URL.createObjectURL(r);void 0!==i.download?(i.setAttribute("href",n),i.setAttribute("download",t),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)):window.open(n)}},function(e){}).finally(function(){e.CanContinue=!0})},i.prototype.init=function(){var e=this;"OH"==this.StudyArea.RegionID&&this.StudyAreaService.computeRegressionEquation("Q10");var i=configuration.queryparams.WateruseConfig.format(this.StudyArea.RegionID),n=new WiM.Services.Helpers.RequestInfo(i);this.Execute(n).then(function(t){var r=t.data;e.spanYear=r.minYear!=r.maxYear,e._startYear=r.minYear,e._endYear=r.maxYear,e.includePermits=r.hasPermits,e.computeReturns=r.canComputeReturns,e.computeDomesticWU="oh"==e.StudyArea.RegionID.toLowerCase(),e._yearRange={floor:r.minYear,draggableRange:!0,noSwitching:!0,showTicks:!1,ceil:r.maxYear}},function(t){e._startYear=2005,e._endYear=2012,e._yearRange={floor:2005,draggableRange:!0,noSwitching:!0,showTicks:!1,ceil:2012}}).finally(function(){e.StudyAreaService.onQ10Loaded.subscribe(new WiM.Event.EventHandler(function(t,r){e.Q10=.646316889697*+e.StudyAreaService.selectedStudyArea.wateruseQ10,e.CanContinue=!0,e.StudyAreaService.onQ10Loaded.unsubscribe(new WiM.Event.EventHandler(function(e,t){}))})),"OH"!=e.StudyArea.RegionID&&(e.CanContinue=!0)}),this.showResults=!1,this.SelectedTab=r.Graph,this.SelectedWaterUseType=t.Annual,this.ReportData=new a,this.MonthlyReportOptions={chart:{type:"multiBarHorizontalChart",height:450,visible:!0,stacked:!0,showControls:!1,margin:{top:60,right:30,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},dispatch:{stateChange:function(){e.$timeout(function(){e.loadGraphLabels(0)},500)},renderEnd:function(){e.$timeout(function(){e.loadGraphLabels(0)},500)},resize:function(){console.log("resize"),e.$timeout(function(){e.loadGraphLabels(0)},500)}},showValues:!0,valueFormat:function(e){return d3.format(",.4f")(e)},tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Values in million gallons/day",tickFormat:function(e){return d3.format(",.3f")(e)}},refreshDataOnly:!0,legend:{margin:{top:5,right:40,left:40,bottom:50}}}},this.MonthlyReturnReportOptions={chart:{type:"multiBarHorizontalChart",height:450,visible:!0,stacked:!0,showControls:!1,margin:{top:20,right:30,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format(",.3f")(e)},tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Values in million gallons/day",tickFormat:function(e){return d3.format(",.3f")(e)}}}},this.AnnualReportOptions={chart:{type:"pieChart",height:400,margin:{top:1},x:function(e){return e.name},y:function(e){return e.value},showLabels:!0,tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},duration:500,labelThreshold:.01,labelSunbeamLayout:!1,showLegend:!1},title:{text:"Withdrawals"}},$(window).resize(function(){e.$timeout(function(){e.loadGraphLabels(0)},500)})},i.prototype.getMonth=function(e){switch(e){case 1:return"Jan";case 2:return"Feb";case 3:return"Mar";case 4:return"Apr";case 5:return"May";case 6:return"Jun";case 7:return"Jul";case 8:return"Aug";case 9:return"Sep";case 10:return"Oct";case 11:return"Nov";case 12:return"Dec"}},i.prototype.getWUText=function(e){switch(e.toUpperCase()){case"AQ":return"Aquaculture";case"CO":return"Commercial";case"DO":return"Domestic";case"PH":return"Hydro Electric";case"IN":return"Industrial";case"IR":return"Irrigation";case"LV":return"Livestock";case"MI":return"Mining";case"RM":return"Remediation";case"TE":return"Thermoelectric";case"ST":return"Waste Water Treatment";case"WS":return"Public Supply";case"MF":return"Hydrofracturing";case"CW":return"Wetland augmentation";case"PC":return"Thermoelectric (closed cycle)";case"PO":return"Thermoelectric (once through)"}return e.toUpperCase()},i.prototype.loadGraphLabels=function(e){var t=d3.selectAll(".nv-multibarHorizontal .nv-group"),r=t.map(function(e){return e.length-2});t.filter(function(e,t){return t==r[0]});t.each(function(e,t){var a=d3.select(this);a.selectAll("text").remove(),a.selectAll(".nv-bar").each(function(e){var i=d3.select(this),n=i.node().getBBox().width;i.node().getBBox().height;a.append("text").attr("transform",i.attr("transform")).text(function(){if(t>=r[0])return e.y<.001?0:d3.format(",.3f")((Number(e.y)+Number(e.y0)).toFixed(3))}).attr("dy","1.5em").attr("x",function(){var e=this.getBBox().width;return n-e/2}).attr("class","bar-values")})})},i.prototype.generateColorShade=function(e,t){try{return"hsla("+this.rand(e,e)+","+this.rand(30,100)+"%,"+this.rand(30,70)+"%,1)"}catch(e){return null}},i.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),r=e.find("tr:has(td)"),a=String.fromCharCode(11),i=String.fromCharCode(0),n='","',o='"\r\n"',s='"';return s+=g(t.map(l)),s+=o,s+=g(r.map(l))+'"';function g(e){return e.get().join(i).split(i).join(o).split(a).join(n)}function l(e,t){var r=$(t),i=r.find("td");return i.length||(i=r.find("th")),i.map(c).get().join(a)}function c(e,t){return $(t).text().replace('"','""')}},i.prototype.HSLtoRGB=function(e,t,r){var a,i,n;if(0==t)a=i=n=r;else{var o=function(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e},s=r<.5?r*(1+t):r+t-r*t,g=2*r-s;a=o(g,s,e+1/3),i=o(g,s,e),n=o(g,s,e-1/3)}return{r:Math.round(255*a),g:Math.round(255*i),b:Math.round(255*n)}},i.prototype.RGBtoHEX=function(e,t,r){return this.ToHex(e)+this.ToHex(t)+this.ToHex(r)},i.prototype.ToHex=function(e){var t=Number(e).toString(16);return t.length<2&&(t="0"+t),t},i.prototype.rand=function(e,t){return parseInt(Math.random()*(t-e+1),10)+e},i.$inject=["$scope","$http","StreamStats.Services.StudyAreaService","$modalInstance","$timeout","WiM.Event.EventManager","StreamStats.Services.nssService"],i}(WiM.Services.HTTPServiceBase);!function(e){e[e.Annual=1]="Annual",e[e.Monthly=2]="Monthly"}(t||(t={})),function(e){e[e.Graph=1]="Graph",e[e.Table=2]="Table"}(r||(r={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.WateruseController",i)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use strict";var r,a=function(){return function(){this.TR55={Graph:{},Table:{},PeakQ:{},Infiltration:{},ExcessPrecip:{}},this.RationalMethod={Graph:{},Table:{},PeakQ:{},Infiltration:{},ExcessPrecip:{}}}}(),i=function(t){function i(e,r,a,i,n,o,s,g,l){var c=t.call(this,a,configuration.baseurls.StormRunoffServices)||this;return c.$timeout=g,c.EventManager=l,c.regionParameters=[],c.PrecipOptions=[],c.SelectedParameterList=[],c.GraphLabels=[],c.GraphXValues=[],c.padY=0,c.padY2=0,c.domainY=[],c.domainY2=[],e.vm=c,c.toaster=r,c.modalInstance=s,c.StudyArea=i.selectedStudyArea,c.nssService=n,c.studyAreaService=i,c.regionParameters=o.parameterList,c.BrowserIE=c.detectIE(),c.AppVersion=configuration.version,c.parameterloadedEventHandler=new WiM.Event.EventHandler(function(e,t){t.parameterLoaded&&c.loadParameters()}),c.init(),c.print=function(){gtag("event","Download",{Category:"StormRunoff",Type:"Print"}),window.print()},c}return __extends(i,t),Object.defineProperty(i.prototype,"SelectedPrecip",{get:function(){return this._selectedPrecip},set:function(e){this._selectedPrecip=e,this.PIntensity=null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"SelectedTab",{get:function(){return this._selectedTab},set:function(e){this._selectedTab!=e&&(this._selectedTab=e,this.selectRunoffType())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"SelectedParametersAreValid",{get:function(){for(var e=0;e<this.SelectedParameterList.length;e++){var t=this.SelectedParameterList[e];if(isNaN(t.value))return!1}return!0},enumerable:!1,configurable:!0}),i.prototype.GetStormRunoffResults=function(){var e=this;try{this.CanContinue=!1;if(1==this.SelectedTab){r.TR55;var t=configuration.queryparams.StormRunoffTR55.format(this.SelectedParameterList[0].value,this.SelectedPrecip.value,this.SelectedParameterList[1].value,this.SelectedPrecip.code)}else if(2==this.SelectedTab)r.RationalMethod,t=configuration.queryparams.StormRunoffRationalMethod.format(this.DrnAreaAcres,this.PIntensity,this.SelectedParameterList[1].value,this.SelectedPrecip.code);var a=new WiM.Services.Helpers.RequestInfo(t);this.Execute(a).then(function(t){e.showResults=!0,e.result=t.data,1==e.SelectedTab?(e.ReportData.TR55.Graph=e.loadGraphData(),e.ReportData.TR55.Table=e.GetTableData(),e.setGraphOptions()):2==e.SelectedTab&&e.setPeakQ(e.result.q)},function(t){e.toaster.clear(),e.toaster.pop("error","There was an error retrieving temporal distribution data","HTTP request error",0)}).finally(function(){e.CanContinue=!0,e.hideAlerts=!0})}catch(e){console.log("oops GetStormRunoffResults failed to load ",e)}},i.prototype.validateForm=function(e){return e.$valid?(this.CheckDASize(),!0):(this.CheckDASize(),this.showResults=!1,this.hideAlerts=!1,!1)},i.prototype.ClearResults=function(){for(var e in this.studyAreaService.studyAreaParameterList)this.studyAreaService.studyAreaParameterList[e].value=null;this.SelectedPrecip=this.PrecipOptions[0],this.SelectedPrecip.value=null,this.DrnAreaAcres=null,this.PIntensity=null,this.showResults=!1},i.prototype.CalculateParameters=function(){var t=this;try{this.CanContinue=!1,this.EventManager.SubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,this.parameterloadedEventHandler);var r=configuration.baseurls.ScienceBase+configuration.queryparams.SSURGOexCOMS+configuration.queryparams.SSURGOexCO.format(this.studyAreaService.selectedStudyArea.FeatureCollection.bbox),a=new WiM.Services.Helpers.RequestInfo(r,!0);this.Execute(a).then(function(e){t.showResults=!0,t.excludearea=e.data,t.excludearea.count>0&&alert("The selected basin may have inadequate SSURGO data to properly compute the runoff curve number.")},function(e){}).finally(function(){t.CanContinue=!0,t.hideAlerts=!0});for(var i=0;i<this.SelectedParameterList.length;i++){var n=this.SelectedParameterList[i];-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,n)&&this.studyAreaService.studyAreaParameterList.push(n)}null!=this.SelectedPrecip&&-1==this.checkArrayForObj(this.studyAreaService.studyAreaParameterList,this.SelectedPrecip)&&this.studyAreaService.studyAreaParameterList.push(this.SelectedPrecip),this.studyAreaService.loadParameters()}catch(e){console.log("oops CalculateParams failed to load ",e)}},i.prototype.CheckDASize=function(){switch(this._selectedTab){case r.TR55:return void(this.SelectedParameterList[0].value>25?this.DASizeAlert="Value is greater than recommended maximum threshold of 25 square miles":this.DASizeAlert=null);default:return void(this.DrnAreaAcres>200?this.DASizeAlert="Value is greater than recommended maximum threshold of 200 acres":this.DASizeAlert=null)}},i.prototype.Close=function(){this.modalInstance.dismiss("cancel")},i.prototype.Reset=function(){this.init()},i.prototype.downloadCSV=function(){var e=this;gtag("event","Download",{Category:"StormRunoff",Type:"CSV"});var t="StreamStats Output Report\n\nState/Region ID,"+this.studyAreaService.selectedStudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.studyAreaService.selectedStudyArea.WorkspaceID+"\nLatitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString()+"\n\n";1==this.SelectedTab?t+=function(t){var r="Peak Runoff from "+e.SelectedPrecip.name+" (TR55)\n";r+=e.tableToCSV($("#TR55ParameterTable")),r+="\n"+e.tableToCSV($("#TR55SummaryTable")),r+="\n\n"+e.tableToCSV($("#TR55TabularHydrograph"));var a="";if(e.SelectedParameterList){var i;for(var n in i=Object.keys(e.ReportData.TR55.Table.values[0]))parseInt(n)<14&&"time"!=i[n]&&("span"==i[n]?a+="#,Time,Time (HH:MM)\n":a+="#,"+e.getHeading(i[n])+","+e.getTitle(i[n])+"\n")}return a+"\n"+r+"\r\n"}(this.studyAreaService.studyAreaParameterList):2==this.SelectedTab&&(t+=function(t){var r="Peak Runoff from "+e.SelectedPrecip.name+" (Rational Method)\n";r+=e.tableToCSV($("#RMParameterTable")),r+="\n"+e.tableToCSV($("#RMSummaryTable"));var a="";if(e.SelectedParameterList){var i;for(var n in i=Object.keys(e.ReportData.TR55.Table.values[0]))parseInt(n)<14&&"time"!=i[n]&&("span"==i[n]?a+="#,Time,Time (HH:MM)\n":a+="#,"+e.getHeading(i[n])+","+e.getTitle(i[n])+"\n")}return a+"\n"+r+"\r\n"}(this.studyAreaService.studyAreaParameterList));var r=new Blob([t],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,"data.csv");else{var a=document.createElement("a"),i=URL.createObjectURL(r);void 0!==a.download?(a.setAttribute("href",i),a.setAttribute("download","data.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(i)}},i.prototype.generateColorShade=function(e,t){try{return"hsla("+this.rand(e,e)+","+this.rand(30,100)+"%,"+this.rand(30,70)+"%,1)"}catch(e){return null}},i.prototype.update=function(e){console.log(e)},i.prototype.loadGraphData=function(){try{var e,t=[],r=[],a=[];this.GraphXValues.length=0;for(var i in this.result){var n,o=this.result[i].duration,s=parseFloat(i);this.duration=o,n=this.computeTime(s,o),r.push({x:n,y:this.result[i].q}),a.push({x:n,y:this.result[i].p})}for(var g in r.sort(function(e,t){return e.x-t.x}),a.sort(function(e,t){return e.x-t.x}),e=r[0].x,r)r[g].label=this.getTimeSpan(e,r[g].x),a[g].label=this.getTimeSpan(e,a[g].x);for(var l in r)r[l].hours=this.computeHours(e,r[l].x),a[l].hours=this.computeHours(e,r[l].x);return this.loadGraphLabels(r),this.loadGraphXValues(r),this.loadPadY(r),this.loadDomainY(r),this.loadPadY2(a),this.loadDomainY2(a),t.push({values:r,key:"Discharge (ft³/s)",color:" #009900",type:"line",yAxis:1}),t.push({values:a,key:"Cum. precipitation (in)",color:"#0033ff",type:"line",yAxis:2}),t}catch(e){}},i.prototype.GetTableData=function(){this.ReportData.TR55.PeakQ=0,this.ReportData.TR55.Infiltration=0,this.ReportData.TR55.ExcessPrecip=0;var e=[],t=[];try{for(var r in this.result){var a,i,n=this.result[r].duration,o=parseFloat(r);if(a=this.computeTime(o,n),this.result[r].time=a,t.push(this.result[r]),0==e.length)for(var s in this.result[r])e.push(s);this.setPeakQ(this.result[r].q),this.setInfiltration(this.result[r].pl),this.setExcessPrecip(this.result[r].dPe)}for(var g in t.sort(function(e,t){return e.time-t.time}),i=t[0].time,t)t[g].span=this.getTimeSpan(i,t[g].time);return{values:t,Fields:e}}catch(e){}},i.prototype.setPeakQ=function(e){try{if(1==this.SelectedTab){var t=e;this.ReportData.TR55.PeakQ<t&&(this.ReportData.TR55.PeakQ=t)}else this.ReportData.RationalMethod.PeakQ=e}catch(e){}},i.prototype.setInfiltration=function(e){try{this.ReportData.TR55.Infiltration=this.ReportData.TR55.Infiltration+e}catch(e){}},i.prototype.setExcessPrecip=function(e){try{this.ReportData.TR55.ExcessPrecip=this.ReportData.TR55.ExcessPrecip+e}catch(e){}},i.prototype.getPrecipTitle=function(){return 2==this.SelectedTab?"Precipitation intensity is computed by dividing the "+this.SelectedPrecip.name+" by "+this.SelectedPrecip.name.substr(0,2):void 0},i.prototype.getTitle=function(e){try{switch(e){case"q":return"Discharge (cubic feet per second)";case"drnarea":return"Drainage area (square miles)";case"p":return"Cumulative precipitation (inches)";case"rcn":return"Runoff curve number (unitless)";case"duration":return"Duration of storm (hours)";case"ia":return"Initial abstraction (inches)";case"s":return"Total maximum retention (inches)";case"dP":return"Incremental precipitation (inches)";case"pIa":return"Cumulative precipitation minus initial abstraction (inches)";case"pl":return"Precipitation loss (inches)";case"pe":return"Cumulative precipitation excess (inches)";case"dPe":return"Incremental precipitation excess (inches)"}}catch(e){}},i.prototype.getHeading=function(e){try{switch(e){case"q":return"Q";case"drnarea":return"DRNAREA";case"p":return"P";case"rcn":return"RCN";case"duration":return"Duration";case"ia":return"Ia";case"s":return"S";case"dP":return"dP";case"pIa":return"P-Ia";case"pl":return"Pl";case"pe":return"Pe";case"dPe":return"dPe"}}catch(e){}},i.prototype.setGraphOptions=function(){this.ReportOptions={chart:{type:"multiChart",height:275,width:650,margin:{top:10,right:80,bottom:80,left:90},x:function(e){return e.hours},y:function(e){return e.y},legend:{align:!1,padding:50,width:500},dispatch:{stateChange:function(e){console.log("stateChange")},changeState:function(e){console.log("changeState")},tooltipShow:function(e){console.log("tooltipShow")},tooltipHide:function(e){console.log("tooltipHide")}},useInteractiveGuideline:!0,interactiveLayer:{tooltip:{contentGenerator:function(e){var t=60*e.value%60,r=Math.trunc(e.value),a=(r<10?"0"+r:r)+":"+(t<10?"0"+t:t),i="";for(var n in e.series){var o,s,g=parseFloat(e.series[n].value);g>1e6&&g<1e7&&(s=1e4),g>1e5&&g<1e6&&(s=1e3),g>1e4&&g<1e5&&(s=100),g>1e3&&g<1e4&&(s=10),g>100&&g<1e3&&(s=1),o=parseInt(((g+.5*s)/s).toString())*s,g<100&&(o=Number(g.toPrecision(3))),i+="<tr><td class='legend-color-guide' style='width: 1em;'><div style='background-color: "+e.series[n].color+";'></div></td><td class='key'>"+e.series[n].key+":</td><td><strong>"+o+"</strong></td></tr>"}return"<table>"+("<thead><tr><td colspan='3'><b>"+a+"</b> (HH:mm)</td></tr></thead>")+"<tbody>"+i+"</tbody></table>"}}},xAxis:{showMaxMin:!1,tickValues:this.GraphXValues,axisLabel:"Time (HH:mm)",tickFormat:function(e){var t=Math.trunc(e),r=60*e%60;return(t<10?"0"+t:t)+":"+(r<10?"0"+r:r)},rotateLabels:"45"},yAxis1:{axisLabel:"Discharge (Q), in ft³/s",axisLabelDistance:this.padY,tickFormat:function(e){return d3.format(",.0f")(e)},showMaxMin:!1},yAxis2:{axisLabel:"Cum. precipitation (P), in inches",axisLabelDistance:this.padY2,tickFormat:function(e){return d3.format(",.0f")(e)},showMaxMin:!1},yDomain1:this.domainY,yDomain2:this.domainY2},title:{enable:!0,text:"Runoff hydrograph from "+this.SelectedPrecip.name,css:{"font-size":"10pt","font-weight":"bold"}}}},i.prototype.BrowserAlert=function(){this.BrowserIE&&alert("The Storm Runoff Modeling tool is best viewed with the following browsers\n\n\tChrome\n\tFirefox\n\tEdge")},i.prototype.detectIE=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10),!0;if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10),!0}return-1!=navigator.userAgent.indexOf("Chrome")&&(this.BrowserChrome=!0),!1},i.prototype.init=function(){this.SelectedTab=r.TR55,this.showResults=!1,this.hideAlerts=!1,this.CanContinue=!0,this.showPrint=!1,this.ReportData=new a},i.prototype.loadParameters=function(){this.EventManager.UnSubscribeToEvent(e.Services.onSelectedStudyParametersLoaded,this.parameterloadedEventHandler),this.DrnAreaAcres=(640*this.SelectedParameterList[0].value).toUSGSvalue();var t=parseInt(this.SelectedPrecip.name.substr(0,2));this.PIntensity=(this.SelectedPrecip.value/t).toUSGSvalue(),this.CanContinue=!0},i.prototype.selectRunoffType=function(){switch(this._selectedTab){case r.TR55:this.SelectedParameterList=this.regionParameters.filter(function(e){return-1!=["DRNAREA","RCN"].indexOf(e.code)}),this.SelectedParameterList.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.showResults=!1;break;default:this.SelectedParameterList=this.regionParameters.filter(function(e){return-1!=["DRNAREA","RUNCO_CO"].indexOf(e.code)}),this.SelectedParameterList.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.showResults=!1}this.PrecipOptions=this.regionParameters.filter(function(e){return-1!=["I6H2Y","I6H100Y","I24H2Y","I24H100Y"].indexOf(e.code)}),this.PrecipOptions.forEach(function(e){return e.value=isNaN(e.value)?null:e.value}),this.SelectedPrecip||(this.SelectedPrecip=this.PrecipOptions[0])},i.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),r=e.find("tr:has(td)"),a=String.fromCharCode(11),i=String.fromCharCode(0),n='","',o='"\r\n"',s='"';return s+=g(t.map(l)),s+=o,s+=g(r.map(l))+'"';function g(e){return e.get().join(i).split(i).join(o).split(a).join(n)}function l(e,t){var r=$(t),i=r.find("td");return i.length||(i=r.find("th")),i.map(c).get().join(a)}function c(e,t){return $(t).text().replace('"','""')}},i.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},i.prototype.rand=function(e,t){return parseInt(Math.random()*(t-e+1),10)+e},i.prototype.computeTime=function(e,t){var r=new Date("January 1, 2018 00:00:00"),a=60*e;return r.setMinutes(a),r},i.prototype.computeHours=function(e,t){return(t-e)/36e5},i.prototype.getTimeSpan=function(e,t){var r=t-e,a=r/6e4%60,i=Math.trunc(r/36e5);return(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)},i.prototype.loadGraphLabels=function(e){for(var t in e)this.GraphLabels[t]=e[t].span},i.prototype.loadGraphXValues=function(e){var t=0;if(24==this.duration)for(var r in e)++t%2!=0&&this.GraphXValues.push(e[r].hours);else for(var r in e)this.GraphXValues[r]=e[r].hours},i.prototype.loadPadY=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));t<1e3?this.padY=-10:t>=1e3&&t<1e4?this.padY2=0:t>=1e4&&t<1e6?this.padY=20:t>=1e6&&t<1e8&&(this.padY=30)},i.prototype.loadDomainY=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));this.domainY=[0,10*Math.round((t+.18*t)/10)]},i.prototype.loadDomainY2=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));this.domainY2=[0,t+.18*t]},i.prototype.loadPadY2=function(e){var t=Math.max.apply(Math,e.map(function(e){return e.y}));t<1e3?this.padY2=-30:t>=1e3&&(this.padY2=-10)},i.prototype.sortByKey=function(e,t){return e.sort(function(e,r){var a=e[t],i=r[t];return a<i?-1:a>i?1:0})},i.$inject=["$scope","toaster","$http","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.RegionService","$modalInstance","$timeout","WiM.Event.EventManager"],i}(WiM.Services.HTTPServiceBase);!function(e){e[e.TR55=1]="TR55",e[e.RationalMethod=2]="RationalMethod"}(r||(r={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.StormRunoffController",i)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use string";var t=function(){return function(){}}(),r=function(e){function r(r,a,i,n,o,s){var g=e.call(this,a,"")||this;return r.vm=g,g.StudyArea=n.selectedStudyArea,g.Upload=s,g.http=a,g.sce=i,g.modalInstance=o,g.StudyAreaService=n,g.StudyArea=n.selectedStudyArea,g.freshdeskTicketData=new t,g.selectedHelpTabName="help",g.showSuccessAlert=!1,g.submittingSupportTicket=!1,g.init(),g}return __extends(r,e),r.prototype.Close=function(){this.showSuccessAlert=!1,this.modalInstance.dismiss("cancel")},r.prototype.submitFreshDeskTicket=function(e){var r=this;if(e){var a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.CreateTicket,i=new FormData;i.append("helpdesk_ticket[email]",this.freshdeskTicketData.email),i.append("helpdesk_ticket[subject]",this.freshdeskTicketData.subject),i.append("helpdesk_ticket[description]",this.freshdeskTicketData.description),i.append("helpdesk_ticket[custom_field][regionid_"+this.freshdeskCreds.AccountID+"]",this.RegionID),i.append("helpdesk_ticket[custom_field][workspaceid_"+this.freshdeskCreds.AccountID+"]",this.WorkspaceID),i.append("helpdesk_ticket[custom_field][server_"+this.freshdeskCreds.AccountID+"]",this.Server),i.append("helpdesk_ticket[custom_field][browser_"+this.freshdeskCreds.AccountID+"]",this.Browser),i.append("helpdesk_ticket[custom_field][softwareversion_"+this.freshdeskCreds.AccountID+"]",this.AppVersion),this.freshdeskTicketData.attachment&&i.append("helpdesk_ticket[attachments][][resource]",this.freshdeskTicketData.attachment,this.freshdeskTicketData.attachment.name);var n={Authorization:"Basic "+btoa(this.freshdeskCreds.Token+":X"),"Content-Type":void 0},o=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",i,n,angular.identity);this.submittingSupportTicket=!0,this.Execute(o).then(function(e){r.freshdeskTicketData=new t,r.showSuccessAlert=!0},function(e){}).finally(function(){r.submittingSupportTicket=!1})}},r.prototype.getFreshDeskArticles=function(e){var t={Authorization:"Basic "+btoa(this.freshdeskCreds.Token+":X")},r=configuration.SupportTicketService.BaseURL+e,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);return this.Execute(a).then(function(e){var t=[];if(e.data.folder.articles.length)return e.data.folder.articles.forEach(function(e){2==e.status&&t.push(e)}),t},function(e){return"There was a problem getting this article"}).finally(function(){})},r.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},r.prototype.selectHelpTab=function(e){this.selectedHelpTabName!=e&&(this.selectedHelpTabName=e)},r.prototype.init=function(){var e=this;this.getBrowser(),this.AppVersion=configuration.version,this.freshdeskCreds=this.StudyAreaService.freshdeskCredentials,this.freshdeskCreds&&(this.getFreshDeskArticles(configuration.SupportTicketService.FAQarticlesFolder).then(function(t){e.faqArticles=t}),this.getFreshDeskArticles(configuration.SupportTicketService.UserManualArticlesFolder).then(function(t){e.helpArticles=t})),this.StudyArea&&this.StudyArea.WorkspaceID?this.WorkspaceID=this.StudyArea.WorkspaceID:this.WorkspaceID="",this.StudyArea&&this.StudyArea.RegionID?this.RegionID=this.StudyArea.RegionID:this.RegionID="",this.StudyArea&&this.StudyArea.Server?this.Server=this.StudyArea.Server:this.Server=""},r.prototype.getBrowser=function(){(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)&&(this.Browser="Opera"),"undefined"!=typeof InstallTrigger&&(this.Browser="Firefox"),Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0&&(this.Browser="Safari"),window.chrome&&window.chrome.webstore&&(this.Browser="Chrome"),!document.documentMode&&window.StyleMedia&&(this.Browser="Edge"),document.documentMode&&(this.Browser="IE")},r.$inject=["$scope","$http","$sce","StreamStats.Services.StudyAreaService","$modalInstance","Upload"],r}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.HelpController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use string";var t=function(e){function t(t,r,a,i,n,o,s){var g=e.call(this,r,configuration.baseurls.StreamStats)||this;return t.vm=g,g.sce=a,g.modalInstance=s,g.modalService=i,g.StudyArea=o.selectedStudyArea,g.StudyAreaService=o,g.regionService=n,g.selectedAboutTabName="about",g.regionArticle="<h3>No State or Region Selected</h3>",g.init(),g}return __extends(t,e),t.prototype.Close=function(){this.modalInstance.dismiss("cancel")},t.prototype.selectAboutTab=function(e){this.selectedAboutTabName!=e&&(this.selectedAboutTabName=e)},t.prototype.getActiveNews=function(){var e=this,t={Authorization:"Basic "+btoa(this.freshdeskCreds.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.ActiveNewsFolder,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){var r=[];t.data.folder.articles.length&&("test.streamstats.usgs.gov"==window.location.host?e.activeNewsArticles=t.data.folder.articles:(t.data.folder.articles.forEach(function(e){2==e.status&&r.push(e)}),e.activeNewsArticles=r))},function(e){}).finally(function(){})},t.prototype.getPastNews=function(){var e=this,t={Authorization:"Basic "+btoa(this.freshdeskCreds.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.PastNewsFolder,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){var r=[];t.data.folder.articles.length&&(window.location.host.indexOf("test.streamstats.usgs.gov")>-1?e.pastNewsArticles=t.data.folder.articles:(t.data.folder.articles.forEach(function(e){2==e.status&&r.push(e)}),e.pastNewsArticles=r))},function(e){}).finally(function(){})},t.prototype.getAboutArticle=function(){var e=this,t={Authorization:"Basic "+btoa(this.freshdeskCreds.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.AboutArticle,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){e.aboutArticle=t.data.article.description},function(e){}).finally(function(){})},t.prototype.getRegionHelpArticle=function(){var e,t=this;if(this.modalService.modalOptions&&(this.modalService.modalOptions.tabName&&this.selectAboutTab(this.modalService.modalOptions.tabName),e=this.modalService.modalOptions.regionID),this.regionService.selectedRegion&&(e=this.regionService.selectedRegion.Name),e){var r={Authorization:"Basic "+btoa(this.freshdeskCreds.Token+":X")},a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.RegionInfoFolder,i=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",r);configuration.regions.forEach(function(r,a){r.Name===e&&(r.regionEnabled?(t.regionArticle='<i class="fa fa-spinner fa-3x fa-spin loadingSpinner"></i>',t.Execute(i).then(function(r){r.data.folder.articles.forEach(function(r){r.title!=e||(window.location.host.indexOf("test.streamstats.usgs.gov")>-1?t.regionArticle=r.description:2==r.status&&(t.regionArticle=r.description))})},function(e){}).finally(function(){})):t.regionArticle='<div class="wim-alert">StreamStats has not been developed for <strong>'+r.Name+'</strong>.  Please contact the <a href="mailto:support@streamstats.freshdesk.com">streamstats team</a> if you would like StreamStats enabled for this State/Region.</div>')})}},t.prototype.getDisclaimersArticle=function(){var e=this;console.log("Trying to open disclaimers article");var t={Authorization:"Basic "+btoa(this.freshdeskCreds.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.DisclaimersArticle,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){console.log("Successfully retrieved disclaimers article"),e.disclaimersArticle=t.data.article.description},function(e){}).finally(function(){e.getCreditsArticle()})},t.prototype.getCreditsArticle=function(){var e=this;console.log("Trying to open credits article");var t={Authorization:"Basic "+btoa(this.freshdeskCreds.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.CreditsArticle,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){console.log("Successfully retrieved credits article"),e.disclaimersArticle+=t.data.article.description},function(e){}).finally(function(){})},t.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},t.prototype.init=function(){this.AppVersion=configuration.version,this.freshdeskCreds=this.StudyAreaService.freshdeskCredentials,this.freshdeskCreds&&(this.getAboutArticle(),this.getRegionHelpArticle(),this.getActiveNews(),this.getPastNews(),this.getDisclaimersArticle())},t.prototype.readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var i=r[a];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null},t.prototype.createCookie=function(e,t,r){if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3);var i="; expires="+a.toUTCString()}else i="";document.cookie=e+"="+t+i+"; path=/"},t.$inject=["$scope","$http","$sce","StreamStats.Services.ModalService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","$modalInstance"],t}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.AboutController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use string";var t=function(){function e(e,t,r,a){e.vm=this,this.sce=t,this.modalInstance=r,this.pagecontent=a.modalOptions.placeholder}return e.prototype.Close=function(){this.modalInstance.dismiss("cancel")},e.prototype.convertUnsafe=function(e){return console.log("converting..."),this.sce.trustAsHtml(e)},e.prototype.replaceAll=function(e,t,r){return e.replace(new RegExp(t,"g"),r)},e.prototype.getOldGWWpage=function(){this.pagecontent=""},e.$inject=["$scope","$sce","$modalInstance","StreamStats.Services.ModalService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavigationReportModalController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use string";var t=function(){function e(e,t,r,a,i,n){e.vm=this,this.sce=t,this.modalInstance=r,this.explorationService=i,this.studyAreaService=n,this.DEMresolutionList=["FINEST","10m","30m","90m","1000m"],this.explorationService.selectedMethod.navigationInfo.configuration&&(this.selectExclusiveOption("downstream","Direction"),this.selectOption("flowline","Query Source"),this.checkWorkspaceID()),this.print=function(){gtag("event","Download",{Category:"ElevationProfile",Type:"Print"}),window.print()}}return e.prototype.close=function(){this.explorationService.showElevationChart=!1,this.explorationService.setMethod(0,{}),this.modalInstance.dismiss("cancel")},e.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},e.prototype.selectElevationPoints=function(){this.modalInstance.dismiss("cancel"),this.explorationService.selectElevationPoints=!0},e.prototype.addExplorationPointFromMapt=function(e){this.modalInstance.dismiss("cancel"),this.explorationService.explorationPointType=e},e.prototype.addExplorationPointFromPourpoint=function(e,t,r,a){this.explorationService.selectedMethod.addLocation(e,new WiM.Models.Point(t,r,a))},e.prototype.downloadCSV=function(){gtag("event","Download",{Category:"ElevationProfile",Type:"CSV"});var e="long,lat,elevation(feet),distance(mi)\r\n";this.explorationService.coordinateList.forEach(function(t){e+=t.join(",")+"\r\n"});var t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"elevation-profile.csv");else{var r=document.createElement("a"),a=URL.createObjectURL(t);void 0!==r.download?(r.setAttribute("href",a),r.setAttribute("download","elevation-profile.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(a)}},e.prototype.addLimit=function(e){var t=this;this.selectedLimit=e,this.deleteConfig("Limit"),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(e,r){if("Limit"==e.name){var a=JSON.parse(JSON.stringify(e));a.value=t.selectedLimit,t.explorationService.selectedMethod.navigationConfiguration.push(a)}})},e.prototype.selectExclusiveOption=function(e,t){var r=this;this.selectedDirection=e,this.deleteConfig(t),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(a,i){if(a.name==t){var n=JSON.parse(JSON.stringify(a));n.value=e,r.explorationService.selectedMethod.navigationConfiguration.push(n)}})},e.prototype.selectOption=function(e,t){var r=this;this.selectedQuerySourceList||(this.selectedQuerySourceList=[]);var a=this.selectedQuerySourceList.indexOf(e);a>-1?this.selectedQuerySourceList.splice(a,1):this.selectedQuerySourceList.push(e),this.deleteConfig(t),this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(e,a){if(e.name==t){var i=JSON.parse(JSON.stringify(e));i.value=r.selectedQuerySourceList,r.explorationService.selectedMethod.navigationConfiguration.push(i)}})},e.prototype.checkWorkspaceID=function(){var e=this;this.studyAreaService.selectedStudyArea&&""!==this.studyAreaService.selectedStudyArea.WorkspaceID&&this.explorationService.selectedMethod.navigationInfo.configuration.forEach(function(t,r){"Limit"==t.name&&t.value.forEach(function(t,r){"Polygon geometry"==t.name&&(t.name="Polygon geometry from delineated watershed",t.value=e.studyAreaService.selectedStudyArea.FeatureCollection.features.filter(function(e){return"globalwatershed"==e.id.toLowerCase()})[0].geometry)})})},e.prototype.ExecuteNav=function(){if(this.explorationService.selectedMethod.navigationPointCount==this.explorationService.selectedMethod.minLocations){this.explorationService.explorationMethodBusy=!0,this.explorationService.ExecuteSelectedModel()}},e.prototype.deleteConfig=function(e){var t=this;this.explorationService.selectedMethod.navigationConfiguration.forEach(function(r,a){r.name==e&&t.explorationService.selectedMethod.navigationConfiguration.splice(a,1)})},e.$inject=["$scope","$sce","$modalInstance","StreamStats.Services.ModalService","StreamStats.Services.ExplorationService","StreamStats.Services.StudyAreaService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ExplorationToolsModalController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={})),function(e){!function(e){"use strict";var t=function(){function e(e,t,r,a){e.vm=this,this.sce=r,this.modalInstance=t,this._prosperServices=a,this.init()}return Object.defineProperty(e.prototype,"Location",{get:function(){return this._results.point},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Date",{get:function(){return this._results.date},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Table",{get:function(){return this._table},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ResultsAvailable",{get:function(){return this._resultsAvailable},enumerable:!1,configurable:!0}),e.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},Object.defineProperty(e.prototype,"Description",{get:function(){return this.sce.trustAsHtml("The PRObability of Streamflow PERmanence (PROSPER) model provides annual (2004-2016) streamflow permanence probabilities (SPPs; probabilistic predictions) and streamflow permanence classes (SPCs; categorical wet/ dry with an associated confidence level). Probabilities are of a stream channel having year- round flow at a 30- m spatial resolution. Model methods, output, and appropriate uses are detailed in Jaeger et al. (2018). Interpretation of a pixel as wet or dry will be based on combined consideration of the SPP, the sign of the SPC (negative for dry, positive for wet), and the associated confidence (1 - 5 representing 50% - 95 %). For example, predictions with a negative (positive) sign, high confidence level indicated by an SPC of - 5(5), and an SPP of less than (greater than) 0.5 will be the most reliable.<a href = 'https://doi.org/10.1016/j.hydroa.2018.100005' target = '_blank' > Click here for more information.</a><br><br><b>Contact information:</b><br>Roy Sando<br>U.S. Geological Survey, Wyoming-Montana Water Science Center<br>Email: <a href='mailto:tsando@usgs.gov' target='_blank'>tsando@usgs.gov</a> <br>Phone: 406-457-5953")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"AvailablePredictions",{get:function(){return this._prosperServices.AvailablePredictions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"DisplayedPredictionLayer",{get:function(){return this._prosperServices.DisplayedPrediction},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"SelectedPredictions",{get:function(){return this._prosperServices.SelectedPredictions},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Graph",{get:function(){return this._graph},enumerable:!1,configurable:!0}),e.prototype.Close=function(){this.modalInstance.dismiss("cancel")},e.prototype.Reset=function(){this._prosperServices.ResetSelectedPredictions(),this.init()},e.prototype.Print=function(){gtag("event","Download",{Category:"Prosper",Type:"Print"}),window.print()},e.prototype.DownloadCSV=function(){gtag("event","Download",{Category:"Prosper",Type:"CSV"});var e="StreamStats PROSPER Report\n\n\nLatitude,"+this.Location.lat.toFixed(5)+"\nLongitude,"+this.Location.lng.toFixed(5)+"\nTime,"+this.Date.toLocaleString()+"\n\n";e+=this.Description+"\n\n",e+=this.tableToCSV($("#prosperResults"));var t=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(t,"prosper.csv");else{var r=document.createElement("a"),a=URL.createObjectURL(t);void 0!==r.download?(r.setAttribute("href",a),r.setAttribute("download","prosper.csv"),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(a)}},e.prototype.Query=function(){this._prosperServices.CanQuery=!0,this.modalInstance.dismiss()},e.prototype.ChangeDisplayedLayer=function(e){this.DisplayedPredictionLayer!=e&&(this._prosperServices.DisplayedPrediction=e)},e.prototype.init=function(){null==this._prosperServices.Result?(this._resultsAvailable=!1,this._results=null,this._graph=null):(this._resultsAvailable=!0,this.setResults(this._prosperServices.Result),this._graph={data:this.getGraphData(),options:{chart:{showLegend:!1,height:450,type:"scatterChart",showValues:!1,pointShape:function(e){return"square"},pointSize:10,pointDomain:[0,10],transitionDuration:350,rotateLabels:45,yDomain:[-5,5],margin:{top:20,right:50,bottom:100,left:60},yAxis:{axisLabel:"Streamflow Permanence Class",tickValues:[-5,-4,-3,-2,-1,0,1,2,3,4,5]},xAxis:{tickValues:this._xValues,showMaxMin:!1,rotateLabels:45},scatter:{onlyCircles:!1}}}})},e.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),r=e.find("tr:has(td)"),a=String.fromCharCode(11),i=String.fromCharCode(0),n='","',o='"\r\n"',s='"';return s+=g(t.map(l)),s+=o,s+=g(r.map(l))+'"';function g(e){return e.get().join(i).split(i).join(o).split(a).join(n)}function l(e,t){var r=$(t),i=r.find("td");return i.length||(i=r.find("th")),i.map(c).get().join(a)}function c(e,t){return $(t).text().replace('"','""')}},e.prototype.setResults=function(e){for(var t in this._results=e,this._table={},this._xValues=[],this._results.data)for(var r=0;r<this._results.data[t].length;r++){var a=this._results.data[t][r];"2"==a.name.charAt(0)&&this._xValues.push(a.name),a.name in this._table||(this._table[a.name]={}),this._table[a.name][t]=a.value}this._prosperServices.ResetResults()},e.prototype.getGraphData=function(){var e=this,t=[];return this._results.data.SPC.map(function(e){return e.value}).filter(function(e,t,r){return r.indexOf(e)===t}).forEach(function(r){t.push({key:r,color:e.getDefinedColor(r),values:e._results.data.SPC.filter(function(e){return e.value===r&&"mean"!=e.name.toLowerCase()}).map(function(e){return{x:parseInt(e.name),y:parseInt(e.value)}})})}),t},e.prototype.getDefinedColor=function(e){switch(e){case"-5":return"rgb(255,102,102)";case"-4":return"rgb(255,164,102)";case"-3":return"rgb(255,202,102)";case"-2":return"rgb(255,242,102)";case"-1":return"rgb(241,255,146)";case"0":return"rgb(211,255,188)";case"1":return"rgb(169,255,228)";case"2":return"rgb(122,239,255)";case"3":return"rgb(137,196,255)";case"4":return"rgb(134,155,255)";case"5":return"rgb(109,109,255)";default:return"rgb(64,0,64)"}},e.$inject=["$scope","$modalInstance","$sce","StreamStats.Services.ProsperService"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ProsperController",t)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use string";var r=function(t){function r(e,r,a,i,n,o,s){var g=t.call(this,o,configuration.baseurls.StreamStats)||this;return g.events=n,g.isBusy=!1,g.selectedReferenceGage=null,g.queryBy="Nearest",g.getNearest=!1,g.distance=10,g.stationNumber="",e.vm=g,g.modalInstance=r,g.studyAreaService=i,g.modalService=a,g.eventManager=n,g.toaster=s,g.dateRangeOptions={locale:{format:"MM/DD/YYYY"},eventHandlers:{"hide.daterangepicker":function(e){return g.SetExtensionDate(e)}}},g.studyAreaService.doSelectMapGage=!1,g.init(),g.load(),e.$watch(function(){return g.dateRange.dates},function(e,t){g.studyAreaService.selectedStudyAreaExtensions.forEach(function(e){e.parameters.forEach(function(e){"sdate"==e.code&&(e.value=g.dateRange.dates.startDate),"edate"==e.code&&(e.value=g.dateRange.dates.endDate)})}),e!=t&&g.getNWISDailyValues()}),e.$watch(function(){return g.studyAreaService.allIndexGages},function(e){void 0==e?g.isBusy=!0:(g.referenceGageListAll=e,g.isBusy=!1)}),g}return __extends(r,t),r.prototype.close=function(){this.modalInstance.dismiss("cancel")},r.prototype.ok=function(){this.verifyExtensionCanContinue()&&this.close()},r.prototype.setReferenceGageFromMap=function(e){this.isBusy=!0,this.studyAreaService.doSelectMapGage=!0,this.modalInstance.dismiss("cancel")},r.prototype.setBestCorrelatedReferenceGage=function(){var e=this;this.isBusy=!0,this.studyAreaService.onStudyAreaServiceBusyChanged.subscribe(new WiM.Event.EventHandler(function(){e.onStudyServiceBusyChanged()})),this.studyAreaService.GetKriggedReferenceGages()},r.prototype.SetExtensionDate=function(e){var t=this;this.getExtensionParameters(["sdate","edate"]).forEach(function(e){"sdate"===e.code&&(e.value=t.dateRange.dates.startDate),"edate"===e.code&&(e.value=t.dateRange.dates.endDate)}),this.studyAreaService.extensionDateRange=this.dateRange},r.prototype.init=function(){if(this.selectedReferenceGage=null,null!=this.studyAreaService.selectedStudyAreaExtensions){this.title=this.studyAreaService.selectedStudyAreaExtensions.map(function(e){return e.name}).join(", ");var t=this.getExtensionParameters(),r=t.map(function(e){return e.code});["sid"].some(function(e){return r.indexOf(e)>-1})&&(this.selectedReferenceGage=new e.Models.ReferenceGage("","")),["sdate","edate"].every(function(e){return r.indexOf(e)>-1})&&(void 0!=this.studyAreaService.extensionDateRange?this.dateRange=this.studyAreaService.extensionDateRange:this.dateRange={dates:{startDate:this.addDay(new Date,-30),endDate:this.addDay(new Date,-1)},minDate:new Date(1900,1,1),maxDate:this.addDay(new Date,-1)},t[r.indexOf("sdate")].value=this.dateRange.dates.startDate,t[r.indexOf("edate")].value=this.dateRange.dates.endDate)}},r.prototype.load=function(){var e=this.getExtensionParameters(),t=function(){var t=e.pop();r.selectedReferenceGage&&["sid"].indexOf(t.code)>-1&&("string"!=typeof t.value?r.selectedReferenceGage=t.value:"object"==typeof t.options&&(r.selectedReferenceGage=t.options.filter(function(e){return e.StationID==t.value})[0]),r.referenceGageList=t.options),r.dateRange&&["sdate","edate"].indexOf(t.code)>-1&&("sdate"==t.code&&(r.dateRange.dates.startDate=t.value),"edate"==t.code&&(r.dateRange.dates.endDate=t.value))},r=this;do{t()}while(e.length>0);this.studyAreaService.selectedGage&&(this.studyAreaService.selectedGage=this.selectedReferenceGage),void 0==this.referenceGageList&&""==this.selectedReferenceGage.StationID||(this.getGageInfo(),this.getNWISDailyValues()),"N/A"!=this.getDrainageArea()||this.studyAreaService.loadingDrainageArea||this.studyAreaService.loadDrainageArea(),void 0==this.studyAreaService.allIndexGages&&this.studyAreaService.loadAllIndexGages()},r.prototype.verifyExtensionCanContinue=function(){var e=this;return(!this.dateRange||(this.dateRange.dates.startDate<=this.dateRange.maxDate||this.dateRange.dates.endDate<=this.dateRange.maxDate)&&(this.dateRange.dates.startDate>=this.dateRange.minDate||this.dateRange.dates.endDate>=this.dateRange.minDate)&&this.dateRange.dates.startDate<=this.dateRange.dates.endDate)&&((!this.selectedReferenceGage||""!=this.selectedReferenceGage.StationID)&&(this.studyAreaService.selectedStudyAreaExtensions.forEach(function(t){t.parameters.forEach(function(t){"sid"==t.code&&"string"!=typeof t.value&&(void 0!=t.options&&0!=t.options.length||(t.options=[e.selectedReferenceGage]),t.value=e.selectedReferenceGage.StationID),"sdate"==t.code&&(t.value=e.dateRange.dates.startDate),"edate"==t.code&&(t.value=e.dateRange.dates.endDate)})}),this.studyAreaService.updateExtensions(),this.studyAreaService.extensionsConfigured=!0,!0))},r.prototype.addDay=function(e,t){try{return new Date(e.getTime()+864e5*t)}catch(t){return e}},r.prototype.getExtensionParameters=function(e){void 0===e&&(e=null);var t=this.studyAreaService.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]);return e&&(t=t.filter(function(t){return e.indexOf(t.code)>-1})),t},r.prototype.onStudyServiceBusyChanged=function(){var e=this;this.studyAreaService.onStudyAreaServiceBusyChanged.unsubscribe(new WiM.Event.EventHandler(function(){e.onStudyServiceBusyChanged()})),this.load(),this.isBusy=!1},r.prototype.updateReferenceGage=function(e){this.selectedReferenceGage=e,this.studyAreaService.selectedGage=e},r.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modalService.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},r.prototype.getGageInfo=function(){this.toaster.pop("wait","Querying gage information","Please wait...",0),this.isBusy=!0;var e=!1;if(this.referenceGageList)for(var t=this.referenceGageList.length-1;t>=0;t--){var r=this.referenceGageList[t];this.selectedReferenceGage&&this.selectedReferenceGage.StationID&&r.StationID==this.selectedReferenceGage.StationID&&(e=!0),this.getGageStatsStationInfo(r)}this.selectedReferenceGage&&""!=this.selectedReferenceGage.StationID&&!e&&this.getGageStatsStationInfo(this.selectedReferenceGage)},r.prototype.getGageStatsStationInfo=function(e,t){var r=this;void 0===t&&(t=!1);var a=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStations+e.StationID,i=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(i).then(function(a){var i=a.data;if(i.stationType&&"GS"!=i.stationType.code)t?(r.toaster.clear(),r.toaster.pop("error","Invalid gage","Gage is not continuous record",0),r.isBusy=!1):(r.removeItem(e),0==r.referenceGageList.length?r.toaster.pop("warning","No valid gages returned","Gages without continuous record removed from response",0):(r.toaster.clear(),r.toaster.pop("error","Invalid gage","Gage is not continuous record",0),r.isBusy=!1));else{if(i.hasOwnProperty("isRegulated")&&(e.isRegulated=i.isRegulated),i.hasOwnProperty("stationType")&&(e.stationType=i.stationType),i.hasOwnProperty("statistics")){var n=!1;i.statistics.forEach(function(e){"FDS"==e.statisticGroupType.code&&e.isPreferred&&(n=!0)}),e.HasFlowDurationStats=n}if(i.hasOwnProperty("characteristics")&&i.characteristics.forEach(function(t){"DRNAREA"==t.variableType.code&&(e.DrainageArea=t.value)}),i.hasOwnProperty("name")&&(e.Name=i.name),t&&(r.referenceGageList||(r.referenceGageList=[]),0!=r.referenceGageList.length&&r.referenceGageList.some(function(t){return t.StationID==e.StationID})||r.referenceGageList.unshift(e)),i.hasOwnProperty("location")){var o=r.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),s=r.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),g=turf.point(i.location.coordinates),l=turf.point([s,o]),c=turf.distance(g,l,{units:"miles"});e.distanceFromClick=c.toFixed(2)}r.getNWISPeriodOfRecord(e)}},function(t){if(r.toaster.clear(),r.isBusy=!1,console.log(t),t.headers()["x-usgswim-messages"]){var a=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(a).forEach(function(e){a[e].forEach(function(t){r.toaster.pop(e,e,t)})})}r.removeItem(e)}).finally(function(){})},r.prototype.removeItem=function(e){var t=this.referenceGageList.indexOf(this.referenceGageList.filter(function(t){return t.StationID==e.StationID})[0]);t&&this.referenceGageList.splice(t,1)},r.prototype.getNearestGages=function(){var e=this;this.isBusy=!0,this.toaster.pop("wait","Searching for gages","Please wait...",0);var t=this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),r=this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),a=configuration.baseurls.GageStatsServices;"Nearest"==this.queryBy&&(a+=configuration.queryparams.GageStatsServicesNearest.format(t,r,(1.60934*this.distance).toFixed(0))),"Network"==this.queryBy&&(a+=configuration.queryparams.GageStatsServicesNetwork.format(t,r,(1.60934*this.distance).toFixed(0)));var i=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",{"X-Is-Streamstats":!0});this.referenceGageList=[],this.selectedReferenceGage.StationID="",this.Execute(i).then(function(t){if(e.toaster.clear(),e.isBusy=!1,"string"==typeof t.data)e.toaster.pop("warning","Warning",t.data,0);else if(t.data&&0==t.data.length)e.toaster.pop("warning","Warning","No stations located within search distance");else if(t.data&&t.data.length>0){for(var r=t.data.length-1;r>=0;r--){var a=t.data[r];if("GS"!=a.stationType.code)t.data.splice(r,1),0==t.data.length&&e.toaster.pop("warning","No valid gages returned","Gages without continuous record removed from response",0);else{if(a.hasOwnProperty("statistics")){var i=!1;a.statistics.forEach(function(e){"FDS"==e.statisticGroupType.code&&e.isPreferred&&(i=!0)}),a.HasFlowDurationStats=i}if(a.hasOwnProperty("characteristics")&&a.characteristics.forEach(function(e){"DRNAREA"==e.variableType.code&&(a.DrainageArea=e.value)}),a.hasOwnProperty("name")&&(a.Name=a.name),a.hasOwnProperty("code")&&(a.StationID=a.code),a.hasOwnProperty("location")){var n=e.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),o=e.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),s=turf.point(a.location.coordinates),g=turf.point([o,n]),l=turf.distance(s,g,{units:"miles"});a.distanceFromClick=l.toFixed(2)}e.getNWISPeriodOfRecord(a)}}e.referenceGageList=t.data,e.getNWISDailyValues()}if(t.headers()["x-usgswim-messages"]){var c=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(c).forEach(function(t){c[t].forEach(function(r){e.toaster.pop(t,t,r)})})}},function(t){if(e.toaster.clear(),e.isBusy=!1,console.log(t),t.headers()["x-usgswim-messages"]){var r=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(r).forEach(function(t){r[t].forEach(function(r){e.toaster.pop(t,t,r)})})}else e.toaster.pop("error","There was an error finding nearby gages.","Please retry",0)})},r.prototype.selectGage=function(t){var r=this.studyAreaService.selectedStudyAreaExtensions.reduce(function(e,t){return e.concat(t.parameters)},[]).filter(function(e){return"sid"==e.code.toLowerCase()}),a=new e.Models.ReferenceGage(t.StationID,t.Name);t.geometry&&(a.Latitude_DD=t.geometry.coordinates[0],a.Longitude_DD=t.geometry.coordinates[1]),r[0].options=this.referenceGageList,r[0].value=a,this.selectedReferenceGage=a,this.studyAreaService.selectedGage=a},r.prototype.getStyling=function(e){return e.StationID==this.selectedReferenceGage.StationID?{"background-color":"#ebf0f5"}:{"background-color":"unset"}},r.prototype.getNWISPeriodOfRecord=function(e){var t=this;if(e.StationID){var r=configuration.baseurls.NWISurl+configuration.queryparams.NWISperiodOfRecord+e.StationID,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"TEXT");this.Execute(a).then(function(r){var a=r.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e}),i=a.shift().split("\t");a.shift();do{var n=a.shift().split("\t");if("00060"==n[i.indexOf("parm_cd")]){if(void 0==e.StartDate)e.StartDate=new Date(n[i.indexOf("begin_date")]);else{var o=new Date(n[i.indexOf("begin_date")]);o<e.StartDate&&(e.StartDate=o)}if(void 0==e.EndDate)e.EndDate=new Date(n[i.indexOf("end_date")]);else{var s=new Date(n[i.indexOf("end_date")]);s>e.EndDate&&(e.EndDate=s)}}}while(a.length>0);t.toaster.clear(),t.isBusy=!1},function(e){t.toaster.clear(),t.isBusy=!1,t.toaster.pop("error","Error","NWIS period of record not found",0)}).finally(function(){})}},r.prototype.checkPeriodOfRecord=function(e){return!this.dateRange.dates&&e.hasOwnProperty("SelectEnabled")?e.SelectEnabled:(this.dateRange.dates.startDate>=this.addDay(e.StartDate,1)&&this.addDay(e.EndDate,1)>=this.dateRange.dates.endDate?e.SelectEnabled=!0:e.SelectEnabled=!1,e.SelectEnabled)},r.prototype.checkCorrelationMatrix=function(e){return!this.dateRange.dates&&e.hasOwnProperty("SelectEnabled")?e.SelectEnabled:(-1!==this.referenceGageListAll.map(function(e){return e.id}).indexOf(e.StationID)?e.SelectEnabled=!0:e.SelectEnabled=!1,e.SelectEnabled)},r.prototype.getNWISDailyValues=function(){var e=this;if(this.referenceGageList){var t=this.dateRange.dates.startDate.toISOString();t=t.substr(0,t.indexOf("T"));var r=this.dateRange.dates.endDate.toISOString();r=r.substr(0,r.indexOf("T")),this.referenceGageList.forEach(function(a){a.HasZeroFlows="N/A";var i=configuration.baseurls.NWISurl+configuration.queryparams.NWISdailyValues.format(a.StationID,t,r),n=new WiM.Services.Helpers.RequestInfo(i,!0,WiM.Services.Helpers.methodType.GET,"TEXT");e.Execute(n).then(function(e){var t=e.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e});t.shift(),a.HasZeroFlows=!1,t.length<=2&&(a.HasZeroFlows="N/A");do{var r=t.shift().split("\t"),i=parseInt(r[3]);"number"==typeof i&&0==i&&(a.HasZeroFlows="true")}while(t.length>0)},function(e){a.HasZeroFlows="N/A"})})}},r.prototype.checkCorrelation=function(){return!!this.referenceGageList&&this.referenceGageList.some(function(e){return e.hasOwnProperty("correlation")})},r.prototype.getDrainageArea=function(){var e=this.studyAreaService.studyAreaParameterList.filter(function(e){return"drnarea"==e.code.toLowerCase()})[0];return e&&e.hasOwnProperty("value")?e.value:"N/A"},r.prototype.queryGage=function(){this.toaster.pop("wait","Querying gage information","Please wait...",0),this.isBusy=!0;var t=new e.Models.ReferenceGage(this.stationNumber,"");this.getGageStatsStationInfo(t,!0)},r.$inject=["$scope","$modalInstance","StreamStats.Services.ModalService","StreamStats.Services.StudyAreaService","WiM.Event.EventManager","$http","toaster"],r}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ExtensionModalController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){var t;e.Controllers||(e.Controllers={}),t=function(t){function r(e,r,a,i,n,o,s){var g=t.call(this,o,configuration.baseurls.StreamStats)||this;return g.events=n,g.isBusy=!1,g.selectedReferenceGage=null,e.vm=g,g.modalInstance=r,g.studyAreaService=i,g.modalService=a,g.eventManager=n,g.toaster=s,g.init(),g.load(),g}return __extends(r,t),r.prototype.close=function(){this.modalInstance.dismiss("cancel")},r.prototype.ok=function(){var e=this.verifyExtensionCanContinue();e?this.toaster.pop("error","Error",e,0):(this.close(),this.studyAreaService.flowAnywhereData={},this.studyAreaService.flowAnywhereData.dateRange=this.dateRange,this.studyAreaService.flowAnywhereData.selectedGage=this.selectedReferenceGage,this.toaster.pop("success","Flow Anywhere Method was successfully configured","Please continue",5e3))},r.prototype.init=function(){var t=this;this.isBusy=!0,this.referenceGageList=null;var r=this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),a=this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),i=configuration.baseurls.StreamStatsMapServices+configuration.queryparams.FlowAnywhereGages.format(a,r),n=new WiM.Services.Helpers.RequestInfo(i,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(n).then(function(r){r.data.features?(t.referenceGageList=[],r.data.features.forEach(function(r){t.gage=new e.Models.ReferenceGage(r.attributes["reference_gages.site_id"],r.attributes["reference_gages.site_name"]),t.gage.DrainageArea_sqMI=r.attributes["reference_gages.da_pub_mi2"],t.gage.Latitude_DD=r.attributes["reference_gages.lat_dd_nad"],t.gage.Longitude_DD=r.attributes["reference_gages.long_dd_na"],t.gage.AggregatedRegion=r.attributes["regions_local.Region_Agg"],t.getNWISPeriodOfRecord(t.gage),t.referenceGageList.push(t.gage)})):400==r.error.code&&(t.referenceGageList=null),t.isBusy=!1},function(e){t.toaster.clear(),t.isBusy=!1,t.toaster.pop("error","Error","Error accessing Flow Anywhere gages",0)}).finally(function(){}),this.dateRange={dates:{startDate:this.addDay(new Date,-32),endDate:this.addDay(new Date,-2)},minDate:new Date(1900,1,1),maxDate:this.addDay(new Date,-1)}},r.prototype.load=function(){"N/A"!=this.getDrainageArea()||this.studyAreaService.loadingDrainageArea||this.studyAreaService.loadDrainageArea(),this.studyAreaService.flowAnywhereData&&(this.studyAreaService.flowAnywhereData.selectedGage&&(this.selectedReferenceGage=this.studyAreaService.flowAnywhereData.selectedGage),this.studyAreaService.flowAnywhereData.dateRange&&(this.dateRange=this.studyAreaService.flowAnywhereData.dateRange))},r.prototype.verifyExtensionCanContinue=function(){return this.selectedReferenceGage?""==this.selectedReferenceGage.StationID?"A reference gage must be selected.":!this.dateRange||(this.dateRange.dates.startDate<=this.dateRange.maxDate||this.dateRange.dates.endDate<=this.dateRange.maxDate)&&(this.dateRange.dates.startDate>=this.dateRange.minDate||this.dateRange.dates.endDate>=this.dateRange.minDate)&&this.dateRange.dates.startDate<=this.dateRange.dates.endDate?this.selectedReferenceGage.StartDate>this.dateRange.dates.startDate?"The selected start date is not valid for the selected reference gage.":this.selectedReferenceGage.EndDate<this.dateRange.dates.endDate?"The selected end date is not valid for the selected reference gage.":null:"Date range is not valid.":"A reference gage must be selected."},r.prototype.addDay=function(e,t){try{return new Date(e.getTime()+864e5*t)}catch(t){return e}},r.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modalService.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},r.prototype.selectGage=function(e){this.selectedReferenceGage=e},r.prototype.getStyling=function(e){return this.selectedReferenceGage&&e.StationID==this.selectedReferenceGage.StationID?{"background-color":"#FFF"}:{"background-color":"unset"}},r.prototype.getNWISPeriodOfRecord=function(e){var t=this;if(this.isBusy=!0,e.StationID){var r=configuration.baseurls.NWISurl+configuration.queryparams.NWISperiodOfRecord+e.StationID,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"TEXT");this.Execute(a).then(function(r){var a=r.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e}),i=a.shift().split("\t");a.shift();do{var n=a.shift().split("\t");if("00060"==n[i.indexOf("parm_cd")]){if(void 0==e.StartDate)e.StartDate=new Date(n[i.indexOf("begin_date")]);else{var o=new Date(n[i.indexOf("begin_date")]);o<e.StartDate&&(e.StartDate=o)}if(void 0==e.EndDate)e.EndDate=new Date(n[i.indexOf("end_date")]);else{var s=new Date(n[i.indexOf("end_date")]);s>e.EndDate&&(e.EndDate=s)}}}while(a.length>0);t.toaster.clear(),t.isBusy=!1},function(e){t.toaster.clear(),t.isBusy=!1,t.toaster.pop("error","Error","NWIS period of record not found",0)}).finally(function(){})}},r.prototype.getDrainageArea=function(){var e=this.studyAreaService.studyAreaParameterList.filter(function(e){return"drnarea"==e.code.toLowerCase()})[0];return e&&e.hasOwnProperty("value")?e.value:"N/A"},r.$inject=["$scope","$modalInstance","StreamStats.Services.ModalService","StreamStats.Services.StudyAreaService","WiM.Event.EventManager","$http","toaster"],r}(WiM.Services.HTTPServiceBase),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.FlowAnywhereController",t)}(StreamStats||(StreamStats={}));__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(e){"use strict";var t,r=function(){return function(e){this.code=e}}(),a=(function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(){}(),function(e){function a(t,r,a,i){var n=e.call(this,r,configuration.baseurls.StreamStats)||this;return n.filteredStatGroupsChar=[],n.showPreferred=!1,n.multiselectOptions={displayProp:"name"},n.citationMultiselectOptions={displayProp:"id"},n.URLsToDisplay=[],n.floodFreq=void 0,n.peakDates=void 0,n.estPeakDates=void 0,n.dailyFlow=void 0,n.formattedFloodFreq=[],n.formattedPeakDates=[],n.formattedEstPeakDates=[],n.formattedDailyFlow=[],n.plotlines=!0,n.logScale=!1,t.vm=n,n.modalInstance=i,n.modalService=a,n.init(),n.selectedStatisticGroups=[],n.selectedCitations=[],n.selectedStatGroupsChar=[],n.selectedCitationsChar=[],n.statCitationList=[],n.charCitationList=[],n.showPreferred=!1,n.print=function(){gtag("event","Download",{Category:"GagePage",Type:"Print"}),window.print()},n}return __extends(a,e),Object.defineProperty(a.prototype,"SelectedTab",{get:function(){return this._selectedTab},set:function(e){this._selectedTab!=e&&(this._selectedTab=e)},enumerable:!1,configurable:!0}),a.prototype.Close=function(){this.modalInstance.dismiss("cancel")},a.prototype.getGagePage=function(){var e=this;this.gage=new r(this.modalService.modalOptions.siteid);var t=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStations+this.gage.code,a=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(a).then(function(t){e.gage=t.data,e.gage.lat=t.data.location.coordinates[1],e.gage.lng=t.data.location.coordinates[0],e.gage.statisticsgroups=[],e.gage.citations=[],e.getStationCharacteristics(t.data.characteristics),e.getStationStatistics(t.data.statistics),e.getNWISInfo(),e.getNWISPeriodOfRecord(e.gage),e.additionalLinkCheck(e.gage.code)},function(e){}).finally(function(){})},a.prototype.additionalLinkCheck=function(e){var t=this;this.URLsToDisplay=[];for(var r,a=[{url:"https://streamstats.usgs.gov/gagePages/NC/Sta_"+e+"_daily_discharge_percentiles_table_by-wateryears.txt",text:"Flow-Duration Statistics by Water Year",available:!1},{url:"https://streamstats.usgs.gov/gagePages/NC/Sta_"+e+"_daily_discharge_percentiles_table_by-day-month-seasonal.txt",text:"Flow-Duration Statistics by Period of Record, Calendar Day & Month, & Seasonal Periods",available:!1},{url:"https://streamstats.usgs.gov/gagePages/IA/"+e+"_stats.pdf",text:"Stream Flow Statistics",available:!1}],i=function(e){r=new WiM.Services.Helpers.RequestInfo(a[e].url,!0,WiM.Services.Helpers.methodType.GET,"json"),n.Execute(r).then(function(r){200==r.status&&(a[e].available=!0,t.URLsToDisplay.push(a[e]))},function(e){}).finally(function(){})},n=this,o=0;o<a.length;o++)i(o)},a.prototype.setPreferred=function(e){this.showPreferred=e},a.prototype.getStationCharacteristics=function(e){var t=this;e.forEach(function(e,r){if(e.hasOwnProperty("citation")&&e.citation.id&&(e.citation&&e.citation.citationURL&&(e.citation.citationURL=e.citation.citationURL.replace("#","")),t.checkForCitation(e.citation.id)||t.gage.citations.push(e.citation),t.checkForStatOrCharCitation(e.citation.id,t.charCitationList)||t.charCitationList.push(e.citation)),!t.checkForCharStatisticGroup(e.variableType.statisticGroupTypeID))if(e.hasOwnProperty("statisticGroupType")){var a=e.statisticGroupType;t.filteredStatGroupsChar.push(a)}else t.getCharStatGroup(e.variableType.statisticGroupTypeID)})},a.prototype.checkForCitation=function(e){return this.gage.citations.some(function(t){return t.id===e})},a.prototype.checkForStatOrCharCitation=function(e,t){return t.some(function(t){return t.id===e})},a.prototype.getStationStatistics=function(e){var t=this;e.forEach(function(e,r){if(e.hasOwnProperty("citation")&&e.citation.id&&(e.citation&&e.citation.citationURL&&(e.citation.citationURL=e.citation.citationURL.replace("#","")),t.checkForCitation(e.citation.id)||t.gage.citations.push(e.citation),t.checkForStatOrCharCitation(e.citation.id,t.statCitationList)||t.statCitationList.push(e.citation)),!t.checkForStatisticGroup(e.statisticGroupTypeID))if(e.hasOwnProperty("statisticGroupType")){var a=e.statisticGroupType;t.gage.statisticsgroups.push(a)}else t.getStatGroup(e.statisticGroupTypeID)})},a.prototype.getStatGroup=function(e){var t=this,r=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStatGroups+e,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(a).then(function(e){t.checkForStatisticGroup(e.data.id)||t.gage.statisticsgroups.push(e.data)})},a.prototype.getCharStatGroup=function(e){var t=this,r=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStatGroups+e,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(a).then(function(e){t.checkForCharStatisticGroup(e.data.id)||t.filteredStatGroupsChar.push(e.data)})},a.prototype.checkForStatisticGroup=function(e){return this.gage.statisticsgroups.some(function(t){return t.id===e})},a.prototype.checkForCharStatisticGroup=function(e){return this.filteredStatGroupsChar.some(function(t){return t.id===e})},a.prototype.checkForPredInt=function(e){return this.gage.statistics.some(function(t){return t.statisticGroupTypeID==e&&t.hasOwnProperty("predictionInterval")})},a.prototype.getNWISInfo=function(){var e=this,t=configuration.baseurls.NWISurl+configuration.queryparams.NWISsiteinfo+this.gage.code,r=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(r).then(function(t){var r=t.data.split(e.gage.name)[1].match(/[+-]?((\d+(\.\d*)?)|(\.\d+))/g);e.NWISlat=r[0],e.NWISlng=r[1]})},a.prototype.getNWISPeriodOfRecord=function(e){if(e.code){var t=configuration.baseurls.NWISurl+configuration.queryparams.NWISperiodOfRecord+e.code,r=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"TEXT");this.Execute(r).then(function(t){var r=t.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e}),a=r.shift().split("\t");r.shift();do{var i=r.shift().split("\t");if("00060"==i[a.indexOf("parm_cd")]){if(void 0==e.StartDate)e.StartDate=new Date(i[a.indexOf("begin_date")]);else{var n=new Date(i[a.indexOf("begin_date")]);n<e.StartDate&&(e.StartDate=n)}if(void 0==e.EndDate)e.EndDate=new Date(i[a.indexOf("end_date")]);else{var o=new Date(i[a.indexOf("end_date")]);o>e.EndDate&&(e.EndDate=o)}}}while(r.length>0)},function(t){e.StartDate=void 0,e.EndDate=void 0}).finally(function(){})}},a.prototype.citationSelected=function(e,t){for(var r in t)if(t[r].id===e.citationID)return!0;return!1},a.prototype.downloadCSV=function(){gtag("event","Download",{Category:"GagePage",Type:"CSV"});var e=void 0!==this.gage.StartDate||void 0!==this.gage.EndDate?this.convertDateToString(this.gage.StartDate)+" - "+this.convertDateToString(this.gage.EndDate):"Undefined",t='\ufeffStreamStats Gage Page\n\nGage Information\nName,Value\nUSGS Station Number,"'+this.gage.code+'"\nStation Name,"'+this.gage.name+'"\nStation Type,"'+this.gage.stationType.name+'"\nLatitude,"'+this.gage.lat+'"\nLongitude,"'+this.gage.lng+'"\nNWIS Latitude,"'+this.NWISlat+'"\nNWIS Longitude,"'+this.NWISlng+'"\nIs regulated?,"'+this.gage.isRegulated+'"\nAgency,"'+this.gage.agency.name+'"\nNWIS Discharge Period of Record,"'+e+'"\n\n',r=this;this.gage.characteristics.length>0&&(t+="Physical Characteristics\n\n",this.filteredStatGroupsChar.forEach(function(e){(0==r.selectedStatGroupsChar.length||r.selectedStatGroupsChar.indexOf(e)>-1)&&(t+='"'+e.name+'"\n'+r.tableToCSV($("#physical-characteristics-table-"+e.id))+"\n\n")})),this.gage.statisticsgroups.length>0&&(t+="Streamflow Statistics\n\n",this.gage.statisticsgroups.forEach(function(e){(0==r.selectedStatisticGroups.length||r.selectedStatisticGroups.indexOf(e)>-1)&&(t+='"'+e.name+'"\n'+r.tableToCSV($("#streamflow-statistics-table-"+e.id))+"\n\n")})),this.gage.citations.length>0&&(t+="Citations\n"+this.tableToCSV($("#citations-table"))+"\n\n"),t+='"USGS Data Disclaimer: Unless otherwise stated, all data, metadata and related materials are considered to satisfy the quality standards relative to the purpose for which the data were collected. Although these data and associated metadata have been reviewed for accuracy and completeness and approved for release by the U.S. Geological Survey (USGS), no warranty expressed or implied is made regarding the display or utility of the data for other purposes, nor on all computer systems, nor shall the act of distribution constitute any such warranty."\n"USGS Software Disclaimer: This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the functionality of the software and related material nor shall the fact of release constitute any such warranty. Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held liable for any damages resulting from its authorized or unauthorized use."\n"USGS Product Names Disclaimer: Any use of trade, firm, or product names is for descriptive purposes only and does not imply endorsement by the U.S. Government."\n\n"Application Version:",'+this.AppVersion;var a=new Blob([t],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,"data.csv");else{var i=document.createElement("a"),n=URL.createObjectURL(a);void 0!==i.download?(i.setAttribute("href",n),i.setAttribute("download","data.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)):window.open(n)}},a.prototype.getGagePlots=function(){this.getPeakInfo()},a.prototype.getPeakInfo=function(){var e=this,t="https://nwis.waterdata.usgs.gov/usa/nwis/peak/?format=rdb&site_no="+this.gage.code,r=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(r).then(function(t){var r=[],a=[],i=t.data.split("\n").filter(function(e){return!e.startsWith("#")&&""!=e});i.shift().split("\t"),i.shift();do{var n=i.shift().split("\t"),o={agency_cd:n[0],site_no:n[1],peak_dt:n[2],peak_va:parseInt(n[4])};r.push(o);var s={agency_cd:n[0],site_no:n[1],peak_dt:n[2].replaceAll("-00","-01"),peak_va:parseInt(n[4])};o.peak_dt[8]+o.peak_dt[9]!=="00"&&o.peak_dt[5]+o.peak_dt[6]!=="00"||a.push(s)}while(i.length>0);var g=r.filter(function(e){return e.peak_dt[8]+e.peak_dt[9]!=="00"||e.peak_dt[8]+e.peak_dt[9]!=="00"});e.peakDates=g,e.estPeakDates=a},function(e){}).finally(function(){e.getFloodFreq()})},a.prototype.getFloodFreq=function(){var e=this,t=configuration.baseurls.GageStatsServices+configuration.queryparams.GageStatsServicesStations+this.gage.code,r=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(r).then(function(t){var r=t.data,a=[9,852,8,4,7,3,6,1,501,5,2,500,851,1438,818,2311,2312,2313,2314,2315,2316,2317,2318],i=[];do{for(var n=0,o=r.statistics;n<o.length;n++){var s=o[n];a.indexOf(s.regressionTypeID)>=0&&1==s.isPreferred&&i.push(s)}}while(r.length>0);e.floodFreq=i}).finally(function(){e.getDailyFlow()})},a.prototype.getDailyFlow=function(){var e=this,t="https://nwis.waterservices.usgs.gov/nwis/dv/?format=json&sites="+this.gage.code+"&parameterCd=00060&statCd=00003&startDT=1900-01-01",r=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.Execute(r).then(function(t){var r=t.data.value.timeSeries;if(0!==r.length)var a=r[0].values[0].value;else a=0;e.dailyFlow=a,e.formatData()})},a.prototype.formatData=function(){var e=this;if(this.peakDates&&this.peakDates.forEach(function(t){isNaN(t.peak_va)||e.formattedPeakDates.push({x:new Date(t.peak_dt),y:t.peak_va})}),this.estPeakDates&&this.estPeakDates.forEach(function(t){isNaN(t.peak_va)||e.formattedEstPeakDates.push({x:new Date(t.peak_dt),y:t.peak_va})}),this.dailyFlow&&this.dailyFlow.forEach(function(t){"A"===t.qualifiers[0]&&e.formattedDailyFlow.push({x:new Date(t.dateTime),y:parseInt(t.value)})}),this.floodFreq){this.formattedFloodFreq=[];var t={9:"#9A6324",852:"#800000",8:"#e6194B",818:"#ffd8b1",7:"#f58231",6:"#ffe119",5:"#bfef45",4:"#3cb44b",3:"#42d4f4",1:"#4363d8",501:"#000075",2:"#911eb4",500:"#dcbeff",851:"#fabed4",1438:"#469990",2311:"#f58231",2312:"#3cb44b",2313:"#e6194B",2314:"#bfef45",2315:"#911eb4",2316:"#9A6324",2317:"#ffe119",2318:"#42d4f4"};this.floodFreq.forEach(function(r){var a=r.regressionTypeID,i=r.regressionType.name.substring(0,r.regressionType.name.length-18);e.formattedFloodFreq.push({value:r.value,color:t[a],width:1.5,zIndex:4,label:{text:i+"% AEP"},id:"plotlines"})}),this.createAnnualFlowPlot()}},a.prototype.createAnnualFlowPlot=function(){var e=this;this.chartConfig={chart:{height:550,width:800,zooming:{type:"xy"}},title:{text:"Annual Peak Streamflow",align:"center"},subtitle:{text:"Click and drag in the plot area to zoom in<br>AEP = Annual Exceedance Probability",align:"center"},rangeSelector:{enabled:!0,inputPosition:{align:"left",x:0,y:0},selected:5,buttonPosition:{align:"right",x:0,y:0}},navigator:{enabled:!0},xAxis:{type:"datetime",min:1875,max:2050,title:{text:"Date"},custom:{allowNegativeLog:!0}},yAxis:{title:{text:"Discharge (Q), in ft³/s"},custom:{allowNegativeLog:!0},plotLines:[{value:null,color:null,width:null,zIndex:null,label:{text:null},id:"plotlines"}]},series:[{name:"Daily Streamflow",showInNavigator:!0,tooltip:{headerFormat:"<b>Daily Streamflow</b>",pointFormatter:function(){if(null!==this.formattedPeakDates){var e=this.x.getUTCDate(),t=this.x.getUTCFullYear(),r=this.x.getUTCMonth();return"<br>Date: <b>"+((r+=1)+"/"+e+"/"+t)+"</b><br>Value: <b>"+this.y+" ft³/s"}}},turboThreshold:0,type:"line",color:"#add8f2",data:this.formattedDailyFlow,marker:{symbol:"",radius:3},showInLegend:this.formattedDailyFlow.length>0},{name:"Annual Peak Streamflow",showInNavigator:!1,tooltip:{headerFormat:"<b>Annual Peak Streamflow</b>",pointFormatter:function(){if(null!==this.formattedPeakDates){var e=this.x.getUTCFullYear();this.x.getUTCMonth()>8&&(e+=1);var t=this.x.getUTCDate(),r=this.x.getUTCFullYear(),a=this.x.getUTCMonth();return"<br>Date: <b>"+((a+=1)+"/"+t+"/"+r)+"</b><br>Value: <b>"+this.y+" ft³/s</b><br>Water Year: <b>"+e}}},turboThreshold:0,type:"scatter",color:"black",data:this.formattedPeakDates,marker:{symbol:"circle",radius:3},showInLegend:this.formattedPeakDates.length>0},{name:"Annual Peak Streamflow (Date Estimated)",showInNavigator:!0,tooltip:{headerFormat:"<b>Annual Peak Streamflow</b>",pointFormatter:function(){if(null!==this.formattedPeakDates){var e=this.x.getUTCFullYear();this.x.getUTCMonth()>8&&(e+=1);var t=this.x.getUTCDate(),r=this.x.getUTCFullYear(),a=this.x.getUTCMonth();return"<br>Date (estimated): <b>"+((a+=1)+"/"+t+"/"+r)+"</b><br>Value: <b>"+this.y+" ft³/s</b><br>Water Year: <b>"+e}}},turboThreshold:0,type:"scatter",color:"red",data:this.formattedEstPeakDates,marker:{symbol:"square",radius:3},showInLegend:this.formattedEstPeakDates.length>0}]},this.formattedFloodFreq.forEach(function(t){e.chartConfig.yAxis.plotLines.push(t)})},a.prototype.togglePlotLines=function(){var e=$("#chart1").highcharts();this.plotlines?this.chartConfig.yAxis.plotLines.forEach(function(t){e.yAxis[0].addPlotLine(t)}):e.yAxis[0].removePlotLine("plotlines")},a.prototype.toggleLogLinear=function(){var e=$("#chart1").highcharts();this.logScale?e.yAxis[0].update({type:"logarithmic"}):e.yAxis[0].update({type:"linear"})},a.prototype.init=function(){this.AppVersion=configuration.version,this.getGagePage(),this.getGagePlots(),this.SelectedTab=t.GageInformation},a.prototype.convertDateToString=function(e){var t=e.getFullYear().toString(),r=(e.getMonth()+1).toString(),a=e.getDate().toString(),i=r.split(""),n=a.split("");return t+"-"+(i[1]?r:"0"+i[0])+"-"+(n[1]?a:"0"+n[0])},a.prototype.tableToCSV=function(e){var t=e.find("tr:has(th)"),r=e.find("tr:has(td)"),a=String.fromCharCode(11),i=String.fromCharCode(0),n='","',o='"\r\n"',s='"';return s+=g(t.map(l)),s+=o,s+=g(r.map(l))+'"';function g(e){return e.get().join(i).split(i).join(o).split(a).join(n)}function l(e,t){var r=$(t),i=r.find("td");return i.length||(i=r.find("th")),i.map(c).get().join(a)}function c(e,t){return $(t).text().replace('"','""')}},a.$inject=["$scope","$http","StreamStats.Services.ModalService","$modalInstance"],a}(WiM.Services.HTTPServiceBase));!function(e){e[e.GageInformation=1]="GageInformation",e[e.GageAnalysisPlots=2]="GageAnalysisPlots"}(t||(t={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.GagePageController",a)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;__extends=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}();!function(e){!function(t){"use strict";var r=function(t){function r(e,r,a,i,n,o){var s=t.call(this,a,configuration.baseurls.StreamStats)||this;return s.showPreferred=!1,s.multiselectOptions={displayProp:"name"},s.queryBy="Nearest",s.distance=10,s.nearbyGages=[],e.vm=s,s.modalInstance=n,s.modalService=i,s.init(),s.selectedStatisticGroups=[],s.showPreferred=!1,s.studyAreaService=o,s.toaster=r,s}return __extends(r,t),r.prototype.Close=function(){this.modalInstance.dismiss("cancel")},r.prototype.getNearestGages=function(){var e=this;this.toaster.pop("wait","Searching for gages","Please wait...",0);var t=this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toString(),r=this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toString(),a=configuration.baseurls.GageStatsServices;"Nearest"==this.queryBy&&(a+=configuration.queryparams.GageStatsServicesNearest.format(t,r,this.distance)),"Network"==this.queryBy&&(a+=configuration.queryparams.GageStatsServicesNetwork.format(t,r,this.distance));var i=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",{"X-Is-Streamstats":!0});this.nearbyGages=[],this.Execute(i).then(function(t){if(e.toaster.clear(),"string"==typeof t.data?e.toaster.pop("warning","Warning",t.data,0):t.data.hasOwnProperty("features")&&0==t.data.features.length?e.toaster.pop("warning","Warning","No stations located within search distance"):t.data.hasOwnProperty("features")&&t.data.features.length>0&&(t.data.features.forEach(function(e){if(e.properties.hasOwnProperty("Statistics")){var t=!1;e.properties.Statistics.forEach(function(e){"FDS"==e.statisticGroupType.code&&(t=!0)}),e.properties.HasFlowDurationStats=t}e.properties.hasOwnProperty("Characteristics")&&e.properties.Characteristics.forEach(function(t){"DRNAREA"==t.variableType.code&&(e.properties.DrainageArea=t.value)})}),e.nearbyGages=t.data.features),t.headers()["x-usgswim-messages"]){var r=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(r).forEach(function(t){r[t].forEach(function(r){e.toaster.pop(t,t,r)})})}},function(t){if(e.toaster.clear(),console.log(t),t.headers()["x-usgswim-messages"]){var r=JSON.parse(t.headers()["x-usgswim-messages"]);Object.keys(r).forEach(function(t){r[t].forEach(function(r){e.toaster.pop(t,t,r)})})}else e.toaster.pop("error","There was an error finding nearby gages.","Please retry",0)})},r.prototype.selectGage=function(e){this.studyAreaService.doSelectNearestGage&&(this.Close(),this.studyAreaService.selectGage(e))},r.prototype.openGagePage=function(t){console.log("gage page id:",t),this.modalService.openModal(e.Services.SSModalType.e_gagepage,{siteid:t})},r.prototype.init=function(){this.AppVersion=configuration.version},r.$inject=["$scope","toaster","$http","StreamStats.Services.ModalService","$modalInstance","StreamStats.Services.StudyAreaService"],r}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NearestGagesController",r)}(e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));