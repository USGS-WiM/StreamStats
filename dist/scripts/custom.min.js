var StreamStats;!function(e){var t=function(){function e(e,t,r,a){this.$stateProvider=e,this.$urlRouterProvider=t,this.$locationProvider=r,this.$logProvider=a,this.$stateProvider.state("main",{url:"/?rcode&workspaceID",template:"<ui-view/>",views:{map:{templateUrl:"Views/mapview.html",controller:"StreamStats.Controllers.MapController"},sidebar:{templateUrl:"Views/sidebarview.html",controller:"StreamStats.Controllers.SidebarController"},navbar:{templateUrl:"Views/navigationview.html",controller:"StreamStats.Controllers.NavbarController"},report:{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController"}}}),this.$urlRouterProvider.otherwise("/"),this.$locationProvider.html5Mode(!0),this.$logProvider.debugEnabled(!1)}return e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$logProvider"],e}();angular.module("StreamStats",["ui.router","ui.bootstrap","ui.checkbox","mobile-angular-ui","angulartics","angulartics.google.analytics","toaster","ngAnimate","ngFileUpload","leaflet-directive","StreamStats.Services","StreamStats.Controllers","WiM.Services","WiM.Event","wim_angular","rzModule","nvd3"]).config(t)}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){var t=function(){function e(e,t){this.RegionID=e,this.Pourpoint=t}return e}();e.StudyArea=t}(t=e.Models||(e.Models={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){var t=function(){function e(){this.append=[],this.remove=[]}return e}();e.WatershedEditDecisionList=t}(t=e.Models||(e.Models={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Services",[])}();var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},StreamStats;!function(e){var t;!function(e){"use strict";function t(e,t,r){return new a(e,t,r)}var r=function(){function e(){}return e}();e.StatisticsGroup=r;var a=function(e){function t(t,r,a){e.call(this,t,configuration.baseurls.NSS),this.$q=r,this.toaster=a,this._onSelectedStatisticsGroupChanged=new WiM.Event.Delegate,this.clearNSSdata()}return __extends(t,e),Object.defineProperty(t.prototype,"onSelectedStatisticsGroupChanged",{get:function(){return this._onSelectedStatisticsGroupChanged},enumerable:!0,configurable:!0}),t.prototype.clearNSSdata=function(){this.selectedStatisticsGroupList=[],this.statisticsGroupList=[],this.canUpdate=!0,this.queriedRegions=!1,this.loadingParametersByStatisticsGroup=!1,this.isDone=!1},t.prototype.loadStatisticsGroupTypes=function(e,t){var r=this;if(this.toaster.pop("info","Loading Available Scenarios","Please wait...",0),e||t){var a=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupLookup.format(e,t),i=new WiM.Services.Helpers.RequestInfo(a,!0);this.loadingStatisticsGroup=!0,this.statisticsGroupList=[],this.Execute(i).then(function(e){e.data.length>0&&(r.loadingStatisticsGroup=!1,angular.forEach(e.data,function(e,t){r.statisticsGroupList.push(e)})),r.toaster.clear()},function(e){r.toaster.clear(),r.toaster.pop("error","There was an error Loading Available Scenarios","Please retry",5e3)})["finally"](function(){r.loadingStatisticsGroup=!1})}},t.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},t.prototype.loadParametersByStatisticsGroup=function(e,t,r,a){var i=this;if(this.loadingParametersByStatisticsGroup=!0,e||t||r){var o=configuration.baseurls.NSS+configuration.queryparams.statisticsGroupParameterLookup.format(e,t,r),n=new WiM.Services.Helpers.RequestInfo(o,!0);this.Execute(n).then(function(e){i.loadingParametersByStatisticsGroup=!1,e.data[0].RegressionRegions[0].Parameters&&e.data[0].RegressionRegions[0].Parameters.length>0&&i.selectedStatisticsGroupList.forEach(function(t){e.data[0].StatisticGroupName==t.Name&&(t.StatisticGroupName=t.Name,t.StatisticGroupID=t.ID,e.data[0].RegressionRegions.forEach(function(e){a.forEach(function(t){e.Name==t.name&&(e.PercentWeight=t.percent)})}),t.RegressionRegions=e.data[0].RegressionRegions,i._onSelectedStatisticsGroupChanged.raise(null,WiM.Event.EventArgs.Empty))}),i.toaster.clear()},function(e){i.toaster.clear(),i.toaster.pop("error","There was an error Loading Parameters by Statistics Group","Please retry",5e3)})["finally"](function(){})}},t.prototype.estimateFlows=function(e,t,r,a,i){var o=this;void 0===i&&(i=!1),this.isDone||(this.canUpdate=!1,this.selectedStatisticsGroupList.forEach(function(n){o.toaster.pop("info","Estimating Flows for "+n.Name,"Please wait...",0),n.RegressionRegions.forEach(function(r){r.Results&&delete r.Results,r.Parameters.forEach(function(r){e.forEach(function(e){r.Code.toLowerCase()==e.code.toLowerCase()&&(r.value=e[t])})})});var s=angular.toJson([n],null),l=configuration.baseurls.NSS+configuration.queryparams.estimateFlows.format(r,n.ID,a),c=new WiM.Services.Helpers.RequestInfo(l,!0,1,"json",s);n.Citations=[],o.Execute(c).then(function(e){var r=e.data[0].Links[0].Href;if(i||o.getSelectedCitations(r,n),e.headers()["usgswim-messages"]){var a=e.headers()["usgswim-messages"].split(";");n.Disclaimers={},a.forEach(function(e){var t=e.split(":");"warning"==t[0]&&(n.Disclaimers.Warnings=t[1].trim()),"error"==t[0]&&(n.Disclaimers.Error=t[1].trim())})}e.data[0].RegressionRegions[0].Results&&e.data[0].RegressionRegions[0].Results.length>0?(o.toaster.clear(),i?n.RegressionRegions.forEach(function(r){r.Parameters.forEach(function(a){for(var i=e.data[0].RegressionRegions,o=0;o<i.length;o++)if(i[o].ID===r.ID)for(var n=0;n<i[o].Parameters.length;n++)i[o].Parameters[n].Code==a.Code&&(a[t]=i[o].Parameters[n].Value)}),r.Results.forEach(function(a){for(var i=e.data[0].RegressionRegions,o=0;o<i.length;o++)if(i[o].ID===r.ID)for(var n=0;n<i[o].Results.length;n++)i[o].Results[n].code==a.code&&(a[t]=i[o].Results[n].Value)})}):(n.RegressionRegions=[],n.RegressionRegions=e.data[0].RegressionRegions)):(o.toaster.clear(),o.toaster.pop("error","There was an error Estimating Flows","No results were returned",5e3),o.isDone=!0)},function(e){o.toaster.clear(),o.toaster.pop("error","There was an error Estimating Flows","HTTP request error",5e3)})["finally"](function(){o.canUpdate=!0})}))},t.prototype.getSelectedCitations=function(e,t){var r=this;this.toaster.pop("info","Requesting selected citations","Please wait...",5e3);var a=e,i=new WiM.Services.Helpers.RequestInfo(a,!0,0,"json");this.Execute(i).then(function(e){e.data[0]&&e.data[0].ID&&t.Citations.push(e.data[0])},function(e){r.toaster.clear(),r.toaster.pop("error","There was an error getting selected Citations","Please retry",5e3)})["finally"](function(){})},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster"],angular.module("StreamStats.Services").factory("StreamStats.Services.nssService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},StreamStats;!function(e){var t;!function(e){"use strict";function t(e,t,r,a){return new i(e,t,r,a)}var r=function(){function e(){}return e}();e.Region=r;var a=function(){function e(){}return e}();e.Parameter=a,e.onSelectedRegionChanged="onSelectedRegionChanged";var i=function(t){function r(r,a,i,o){t.call(this,r,configuration.baseurls.StreamStats),this.$q=a,this.eventManager=o,this.toaster=i,this.regionList=[],this.parameterList=[],this.masterRegionList=configuration.regions,this.loadNationalMapLayers(),this.streamStatsAvailable=!1,this.eventManager.AddEvent(e.onSelectedRegionChanged)}return __extends(r,t),Object.defineProperty(r.prototype,"selectedRegion",{get:function(){return this._selectedRegion},set:function(t){this._selectedRegion!=t&&(this._selectedRegion=t,this.eventManager.RaiseEvent(e.onSelectedRegionChanged,this,WiM.Event.EventArgs.Empty))},enumerable:!0,configurable:!0}),r.prototype.clearRegion=function(){this.regionList=[],this.parameterList=[],this.regionMapLayerList=[],this.selectedRegion=null,this.regionMapLayerListLoaded=!1,this.resetView=!1},r.prototype.intersect=function(e,t){return Math.max(e.left,t.left)<Math.min(e.right,t.right)&&Math.min(e.top,t.top)>Math.max(e.bottom,e.bottom)},r.prototype.loadRegionListByExtent=function(e,t,r,a,i){var o=this;void 0===i&&(i=4326),this.regionList.length=0;var n={top:a,bottom:r,left:t,right:e};configuration.regions.forEach(function(e,t){var r={top:e.Bounds[1][0],bottom:e.Bounds[0][0],left:e.Bounds[0][1],right:e.Bounds[1][1]};o.intersect(n,r)&&o.regionList.push(e)})},r.prototype.loadRegionListByRegion=function(e){this.regionList.length=0;var t=this.getRegion(e);return null==t?!1:(this.regionList.push(t),!0)},r.prototype.loadNationalMapLayers=function(){var e=this,t=configuration.baseurls.StreamStats+"/arcgis/rest/services/ss_studyAreas_prod/MapServer?f=pjson",r=new WiM.Services.Helpers.RequestInfo(t,!0,WiM.Services.Helpers.methodType.GET,"json");this.nationalMapLayerList=[],this.Execute(r).then(function(t){t.data.layers.forEach(function(t,r){e.nationalMapLayerList.push([t.name,t.id])})},function(t){return console.log("No national map layers found"),e.$q.reject(t.data)})},r.prototype.loadMapLayersByRegion=function(e){var t=this;this.regionMapLayerListLoaded=!1;var r=configuration.baseurls.StreamStats+configuration.queryparams.SSStateLayers.format(e.toLowerCase()),a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json");this.regionMapLayerList=[],this.Execute(a).then(function(e){return e.data.layers?(e.data.layers.forEach(function(e,r){var a=!1;("stream grid"==e.name.toLowerCase()||"area of limited functionality"==e.name.toLowerCase())&&(a=!0),t.regionMapLayerList.push([e.name,e.id,a])}),void(t.regionMapLayerListLoaded=!0)):void t.toaster.pop("warning","No map layers available","",5e3)},function(e){return console.log("No region map layers found"),t.$q.reject(e.data)})["finally"](function(){})},r.prototype.loadParametersByRegion=function(){var e=this;if(this.selectedRegion){var t=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSAvailableParams.format(this.selectedRegion.RegionID),r=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(r).then(function(t){t.data.parameters&&t.data.parameters.length>0?(e.streamStatsAvailable=!0,t.data.parameters.forEach(function(t){try{t.checked=!1,t.toggleable=!0,e.parameterList.push(t)}catch(r){alert(r)}})):(e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3))},function(t){console.log("Bad response from the regression service"),e.streamStatsAvailable=!1,e.toaster.pop("warning","StreamStats not available here at this time","",5e3)})["finally"](function(){})}},r.prototype.getRegion=function(e){var t=configuration.regions;try{for(var r=0;r<t.length;r++)if(t[r].Name.toUpperCase().trim()===e.toUpperCase().trim()||t[r].RegionID.toUpperCase().trim()===e.toUpperCase().trim())return t[r];return null}catch(a){return null}},r}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster","WiM.Event.EventManager"],angular.module("StreamStats.Services").factory("StreamStats.Services.RegionService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},StreamStats;!function(e){var t;!function(t){"use strict";function r(e,t,r,a){return new i(e,t,r,a)}t.onSelectedStudyAreaChanged="onSelectedStudyAreaChanged",t.onStudyAreaReset="onStudyAreaReset",t.onEditClick="onEditClick";var a=function(e){function t(){e.call(this)}return __extends(t,e),t}(WiM.Event.EventArgs);t.StudyAreaEventArgs=a;var i=function(r){function i(e,a,i,o){var n=this;r.call(this,e,configuration.baseurls.StreamStats),this.$http=e,this.$q=a,this.eventManager=i,i.AddEvent(t.onSelectedStudyAreaChanged),i.AddEvent(t.onStudyAreaReset),i.SubscribeToEvent(t.onSelectedStudyAreaChanged,new WiM.Event.EventHandler(function(e,t){n.onStudyAreaChanged(e,t)})),i.AddEvent(t.onEditClick),this._studyAreaList=[],this.toaster=o,this.clearStudyArea(),this.showDelineateButton=!1,this.servicesURL=configuration.baseurls.StreamStatsServices}return __extends(i,r),Object.defineProperty(i.prototype,"StudyAreaList",{get:function(){return this._studyAreaList},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectedStudyArea",{get:function(){return this._selectedStudyArea},set:function(e){this.canUpdate&&this._selectedStudyArea!=e&&(this._selectedStudyArea=e,this.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,this,a.Empty))},enumerable:!0,configurable:!0}),i.prototype.editBasin=function(e){this.Disclaimers.isEdited=!0,this.drawControlOption=e,this.eventManager.RaiseEvent(t.onEditClick,this,WiM.Event.EventArgs.Empty)},i.prototype.undoEdit=function(){delete this.Disclaimers.isEdited,this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,this,a.Empty)},i.prototype.AddStudyArea=function(e){this.clearStudyArea(),this.StudyAreaList.push(e),this.selectedStudyArea=e},i.prototype.RemoveStudyArea=function(){},i.prototype.clearStudyArea=function(){this.canUpdate=!0,this.regulationCheckComplete=!0,this.parametersLoaded=!1,this.parametersLoading=!1,this.doDelineateFlag=!1,this.checkingDelineatedPoint=!1,this.studyAreaParameterList=[],this.regulationCheckResults=[],this.Disclaimers={},this.showEditToolbar=!1,this.WatershedEditDecisionList=new e.Models.WatershedEditDecisionList,this.selectedStudyArea=null,this.showDelineateButton=!1,this.reportGenerated=!1,this.regressionRegionQueryComplete=!1,this.regressionRegionQueryLoading=!1,this.eventManager.RaiseEvent(t.onStudyAreaReset,this,WiM.Event.EventArgs.Empty)},i.prototype.loadStudyBoundary=function(){var e=this;this.toaster.pop("info","Delineating Basin","Please wait...",0),this.canUpdate=!1;var r=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSdelineation.format("geojson",this.selectedStudyArea.RegionID,this.selectedStudyArea.Pourpoint.Longitude.toString(),this.selectedStudyArea.Pourpoint.Latitude.toString(),this.selectedStudyArea.Pourpoint.crs.toString(),!1),i=new WiM.Services.Helpers.RequestInfo(r,!0);this.Execute(i).then(function(t){e.selectedStudyArea.Server=t.headers()["usgswim-hostname"],e.selectedStudyArea.Features=t.data.hasOwnProperty("featurecollection")?t.data.featurecollection:null,e.selectedStudyArea.WorkspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null,e.selectedStudyArea.Date=new Date,e.toaster.clear()},function(t){e.toaster.clear(),e.toaster.pop("error","Error Delineating Basin","Please retry",5e3)})["finally"](function(){e.canUpdate=!0,e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,a.Empty)})},i.prototype.loadWatershed=function(r,i){var o=this;try{this.toaster.pop("info","Opening Basin","Please wait...",0);var n=new e.Models.StudyArea(r,null);this.AddStudyArea(n);var s=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSwatershedByWorkspace.format("geojson",r,i,4326,!1),l=new WiM.Services.Helpers.RequestInfo(s,!0);this.Execute(l).then(function(e){o.selectedStudyArea.Features=e.data.hasOwnProperty("featurecollection")?e.data.featurecollection:null,o.selectedStudyArea.WorkspaceID=e.data.hasOwnProperty("workspaceID")?e.data.workspaceID:null,o.selectedStudyArea.Date=new Date,o.selectedStudyArea.Features.forEach(function(e){var t=angular.fromJson(angular.toJson(e));if("globalwatershedpoint"==t.name){var r=t.feature.features[0].bbox;return void(o.selectedStudyArea.Pourpoint=new WiM.Models.Point(r[0],r[1],t.feature.crs.properties.code))}})},function(e){o.toaster.clear(),o.toaster.pop("error","Error Delineating Basin","Please retry",5e3)})["finally"](function(){o.canUpdate=!0,o.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,o,a.Empty),o.toaster.clear()})}catch(c){return}},i.prototype.loadEditedStudyBoundary=function(){var r=this;this.toaster.pop("info","Loading Edited Basin","Please wait...",0),this.canUpdate=!1;var i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSeditBasin.format("geojson",this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,this.selectedStudyArea.Pourpoint.crs.toString()),o=new WiM.Services.Helpers.RequestInfo(i,!0,WiM.Services.Helpers.methodType.PUT,"json",angular.toJson(this.WatershedEditDecisionList),{});this.Execute(o).then(function(t){r.AddStudyArea(new e.Models.StudyArea(r.selectedStudyArea.RegionID,r.selectedStudyArea.Pourpoint)),r.selectedStudyArea.Features=t.data.hasOwnProperty("featurecollection")?t.data.featurecollection:null,r.selectedStudyArea.WorkspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null,r.selectedStudyArea.Date=new Date,r.toaster.clear()},function(e){r.toaster.clear(),r.toaster.pop("error","Error Delineating Basin","Please retry",5e3)})["finally"](function(){r.canUpdate=!0;var e=new a;e.studyArea=r.selectedStudyArea,r.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,r,e),r.Disclaimers.isEdited=!0})},i.prototype.loadParameters=function(){var e=this;if(this.toaster.pop("info","Calculating Selected Basin Characteristics","Please wait...",0),this.parametersLoading=!0,this.parametersLoaded=!1,!this.selectedStudyArea||!this.selectedStudyArea.WorkspaceID||!this.selectedStudyArea.RegionID)return void alert("No Study Area");var t=[];this.studyAreaParameterList.map(function(e){t.push(e.code)});var r=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(this.selectedStudyArea.RegionID,this.selectedStudyArea.WorkspaceID,t.join(",")),a=new WiM.Services.Helpers.RequestInfo(r,!0);this.Execute(a).then(function(t){if(t.data.parameters&&t.data.parameters.length>0){var r=t.data.parameters;e.loadParameterResults(r),e.parametersLoaded=!0,e.Disclaimers.isRegulated&&e.loadRegulatedParameterResults(e.regulationCheckResults.parameters)}e.toaster.clear()},function(t){e.toaster.clear(),e.toaster.pop("error","Error Calculating Basin Characteristics","Please retry",5e3)})["finally"](function(){e.parametersLoading=!1})},i.prototype.queryLandCover=function(){var e=this;this.toaster.pop("info","Querying Land Cover Data with your Basin","Please wait...",0);var t='{"geometryType":"esriGeometryPolygon","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polygon", "rings":['+JSON.stringify(this.selectedStudyArea.Features[1].feature.features[0].geometry.coordinates)+"]}}]}",r=configuration.baseurls.NationalMapRasterServices+configuration.queryparams.NLCDQueryService,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",{InputLineFeatures:t,returnZ:!0,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(t){e.toaster.clear(),t.data.length>0&&e.toaster.pop("success","Land Cover was succcessfully queried","Please continue",5e3)},function(t){return e.toaster.pop("error","There was an HTTP error querying Land Cover","Please retry",5e3),e.$q.reject(t.data)})["finally"](function(){})},i.prototype.queryRegressionRegions=function(){var e=this;this.toaster.pop("info","Querying regression regions with your Basin","Please wait...",0),this.regressionRegionQueryLoading=!0,this.regressionRegionQueryComplete=!1;var t=angular.toJson(this.selectedStudyArea.Features[1].feature,null),r=configuration.baseurls.GISserver+configuration.queryparams.RegressionRegionQueryService,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",{geometry:t,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(t){return e.toaster.clear(),e.regressionRegionQueryComplete=!0,t.data.error?void e.toaster.pop("error","There was an error querying regression regions",t.data.error.message,5e3):0==t.data.length?void e.toaster.pop("error","Regression region query failed","This type of query may not be supported here at this time",5e3):void(t.data.length>0&&(e.selectedStudyArea.RegressionRegions=t.data,e.toaster.pop("success","Regression regions were succcessfully queried","Please continue",5e3)))},function(t){return e.toaster.pop("error","There was an HTTP error querying Regression regions","Please retry",5e3),e.$q.reject(t.data)})["finally"](function(){e.regressionRegionQueryLoading=!1})},i.prototype.upstreamRegulation=function(){var e=this;this.toaster.pop("info","Checking for Upstream Regulation","Please wait...",0),this.regulationCheckComplete=!1;var r=angular.toJson(this.selectedStudyArea.Features[1].feature,null),i=configuration.baseurls.GISserver+configuration.queryparams.regulationService.format(this.selectedStudyArea.RegionID),o=new WiM.Services.Helpers.RequestInfo(i,!0,WiM.Services.Helpers.methodType.POST,"json",{watershed:r,outputcrs:4326,f:"geojson"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(o).then(function(r){r.data.percentarearegulated>0?(e.toaster.clear(),e.toaster.pop("success","Map updated with Regulated Area","Continue to 'Modify Basin Characteristics' to see area-weighted basin characteristics",5e3),e.selectedStudyArea.Features.push(r.data.featurecollection[0]),e.regulationCheckResults=r.data,e.Disclaimers.isRegulated=!0,e.eventManager.RaiseEvent(t.onSelectedStudyAreaChanged,e,a.Empty)):(e.Disclaimers.isRegulated=!1,e.toaster.clear(),e.toaster.pop("warning","No regulation found","Please continue",5e3))},function(t){e.toaster.clear(),e.toaster.pop("error","Error Checking for Upstream Regulation","Please retry",5e3)})["finally"](function(){e.regulationCheckComplete=!0})},i.prototype.loadParameterResults=function(e){this.toaster.pop("info","Loading Basin Characteristics","Please wait...");var t=this.studyAreaParameterList;e.map(function(e){angular.forEach(t,function(t,r){return e.code.toUpperCase().trim()===t.code.toUpperCase().trim()?void(t.value=e.value):void 0})})},i.prototype.loadRegulatedParameterResults=function(e){this.toaster.pop("info","Loading Regulated Basin Characteristics","Please wait...");var t=this.studyAreaParameterList;e.map(function(r){angular.forEach(t,function(a,i){if(r.code.toUpperCase().trim()===a.code.toUpperCase().trim()){switch(r.operation){case"Sum":a.unRegulatedValue=a.value-r.value;break;case"WeightedAverage":var o,n,s,l;angular.forEach(t,function(e,t){e.code==r.operationField&&(o=e.value)}),angular.forEach(e,function(e,t){e.code==r.operationField&&(n=e.value)}),s=r.value,l=a.value;var c=n*(s/o),u=l-c,d=o-n,h=u*(o/d);a.unRegulatedValue=h}return void(a.regulatedValue=r.value)}})})},i.prototype.onStudyAreaChanged=function(e,t){this.selectedStudyArea&&this.selectedStudyArea.Features&&!this.regressionRegionQueryComplete&&this.queryRegressionRegions()},i}(WiM.Services.HTTPServiceBase);r.$inject=["$http","$q","WiM.Event.EventManager","toaster"],angular.module("StreamStats.Services").factory("StreamStats.Services.StudyAreaService",r)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},StreamStats;!function(e){var t;!function(e){"use strict";function t(e,t,a){return new r(e,t,a)}var r=function(e){function t(t,r,a){e.call(this,t,configuration.baseurls.StreamStats),this.$q=r,this.toaster=a,this.drawElevationProfile=!1,this.drawMeasurement=!1,this.showElevationChart=!1,this.allowStreamgageQuery=!1,this.measurementData=""}return __extends(t,e),t.prototype.elevationProfile=function(e){var t=this,r="http://elevation.arcgis.com/arcgis/rest/services/Tools/ElevationSync/GPServer/Profile/execute",a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",{InputLineFeatures:e,returnZ:!0,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(e){var r=e.data.results[0].value.features[0].geometry.paths[0];r.length>0&&(t.elevationProfileGeoJSON={name:"NewFeatureType",type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:r},properties:""}]})},function(e){})["finally"](function(){})},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q","toaster"],angular.module("StreamStats.Services").factory("StreamStats.Services.ExplorationService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strict";function t(e){return new r(e)}var r=function(){function e(e){this.modal=e}return e.prototype.openModal=function(e,t){void 0===t&&(t=null),t&&(this.modalOptions=t),this.modal.open(this.getModalSettings(e))},e.prototype.getModalSettings=function(e){try{switch(e){case a.e_report:return{templateUrl:"Views/reportview.html",controller:"StreamStats.Controllers.ReportController",size:"lg",backdropClass:"backdropZ",windowClass:"windowZ"};case a.e_wateruse:return{templateUrl:"Views/wateruse.html",controller:"StreamStats.Controllers.WateruseController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case a.e_about:return{templateUrl:"Views/about.html",controller:"StreamStats.Controllers.AboutController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case a.e_help:return{templateUrl:"Views/help.html",controller:"StreamStats.Controllers.HelpController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};default:return!1}}catch(t){return!1}},e}();!function(e){e[e.e_report=1]="e_report",e[e.e_wateruse=2]="e_wateruse",e[e.e_about=3]="e_about",e[e.e_help=4]="e_help"}(e.SSModalType||(e.SSModalType={}));var a=e.SSModalType;t.$inject=["$modal"],angular.module("StreamStats.Services").factory("StreamStats.Services.ModalService",t)}(t=e.Services||(e.Services={}))}(StreamStats||(StreamStats={})),function(){"use strict";angular.module("StreamStats.Controllers",[])}();var StreamStats;!function(e){var t;!function(t){"use strict";var r=function(){function e(){this.lat=0,this.lng=0}return e}(),a=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),i=function(){function e(e,t,r,a,i){void 0===i&&(i=void 0),this.name=e,this.url=t,this.type=r,this.visible=a,this.layerOptions=i}return e}(),o=function(){function e(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=!0),this.maxZoom=e,this.minZoom=t,this.zoomControl=r}return e}(),n=function(){function t(t,r,a,i,o,n,s,l,c,u,d,h,p){var g=this;this.$scope=t,this.center=null,this.layers=null,this.mapDefaults=null,this.mapPoint=null,this.bounds=null,this.markers=null,this.geojson=null,this.events=null,this.layercontrol=null,this.regionLayer=null,t.vm=this,this.init(),this.toaster=r,this.angulartics=a,this.searchService=l,this.$locationService=i,this.regionServices=c,this.leafletBoundsHelperService=n,this.leafletData=s,this.studyArea=u,this.nssService=d,this.explorationService=h,this.eventManager=p,this.eventManager.SubscribeToEvent(e.Services.onSelectedStudyAreaChanged,new WiM.Event.EventHandler(function(){g.onSelectedStudyAreaChanged()})),this.eventManager.SubscribeToEvent(WiM.Directives.onLayerChanged,new WiM.Event.EventHandler(function(e,t){g.onLayerChanged(e,t)})),this.eventManager.SubscribeToEvent(WiM.Services.onSelectedAreaOfInterestChanged,new WiM.Event.EventHandler(function(e,t){g.onSelectedAreaOfInterestChanged(e,t)})),this.eventManager.SubscribeToEvent(e.Services.onSelectedRegionChanged,new WiM.Event.EventHandler(function(){g.onSelectedRegionChanged()})),this.eventManager.SubscribeToEvent(e.Services.onEditClick,new WiM.Event.EventHandler(function(e,t){g.basinEditor()})),this.eventManager.SubscribeToEvent(e.Services.onStudyAreaReset,new WiM.Event.EventHandler(function(){g.removeGeoJson()})),t.$on("leafletDirectiveMap.mousemove",function(e,t){var r=t.leafletEvent.latlng;g.mapPoint.lat=r.lat,g.mapPoint.lng=r.lng}),t.$on("leafletDirectiveMap.drag",function(e,t){g.cursorStyle="grabbing"}),t.$on("leafletDirectiveMap.dragend",function(e,t){g.cursorStyle="pointer"}),t.$on("leafletDirectiveMap.click",function(e,t){u.doDelineateFlag&&g.checkDelineatePoint(t.leafletEvent.latlng),h.allowStreamgageQuery&&g.queryStreamgages(t.leafletEvent)}),t.$watch(function(){return g.bounds},function(e,t){return g.mapBoundsChange(t,e)}),t.$watch(function(){return g.explorationService.elevationProfileGeoJSON},function(e,t){e&&g.displayElevationProfile()}),t.$watch(function(){return g.explorationService.drawElevationProfile},function(e,t){e&&g.elevationProfile()}),t.$watch(function(){return g.explorationService.drawMeasurement},function(e,t){e&&g.measurement()}),t.$watch(function(){return g.regionServices.regionMapLayerListLoaded},function(e,t){e&&g.addRegionOverlayLayers(g.regionServices.selectedRegion.RegionID)}),t.$watch(function(){return g.regionServices.resetView},function(e,t){e&&g.resetMap()}),t.$on("$locationChangeStart",function(){return g.updateRegion()}),t.$watch(function(){return u.doDelineateFlag},function(e,t){return e?g.cursorStyle="crosshair":g.cursorStyle="pointer"}),o.rcode&&(this.regionServices.loadParametersByRegion(),this.setBoundsByRegion(o.rcode)),o.rcode&&o.workspaceID&&(this.regionServices.loadParametersByRegion(),this.studyArea.loadWatershed(o.rcode,o.workspaceID)),t.$watch(function(){return g.studyArea.regressionRegionQueryComplete},function(e,t){e&&g.studyArea.selectedStudyArea.RegressionRegions&&g.nssService.loadStatisticsGroupTypes(g.regionServices.selectedRegion.RegionID,g.studyArea.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","))})}return t.prototype.init=function(){this.center=new a(39,-100,3),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers},this.mapDefaults=new o(null,3,!0),this.markers={},this.geojson={},this.regionLayer={},this.controls={scale:!0,draw:{draw:{polygon:!1,polyline:!1,rectangle:!1,circle:!1,marker:!1}},custom:new Array(L.control.locate({follow:!1,locateOptions:{maxZoom:15}}),L.control.elevation({imperial:!0}))},this.events={map:{enable:["mousemove"]}},this.mapPoint=new r,L.Icon.Default.imagePath="images"},t.prototype.scaleLookup=function(e){switch(e){case 19:return"1,128";case 18:return"2,256";case 17:return"4,513";case 16:return"9,027";case 15:return"18,055";case 14:return"36,111";case 13:return"72,223";case 12:return"144,447";case 11:return"288,895";case 10:return"577,790";case 9:return"1,155,581";case 8:return"2,311,162";case 7:return"4,622,324";case 6:return"9,244,649";case 5:return"18,489,298";case 4:return"36,978,596";case 3:return"73,957,193";case 2:return"147,914,387";case 1:return"295,828,775";case 0:return"591,657,550"}},t.prototype.queryNationalMapLayers=function(e){var t=this;this.leafletData.getMap().then(function(r){t.leafletData.getLayers().then(function(a){r.getZoom()>=8||(t.toaster.pop("info","Information","Querying National map layers...",0),t.cursorStyle="wait",t.angulartics.eventTrack("initialOperation",{category:"Map",label:"Map click query"}),a.overlays.SSLayer.identify().on(r).at(e.latlng).returnGeometry(!1).run(function(a,i){if(i.features.length<1)return t.cursorStyle="pointer",t.toaster.clear(),t.toaster.pop("warning","Warning","No State/Regional Study Found",5e3),void r.panBy([0,1]);var o=[];i.features.forEach(function(e){t.regionServices.nationalMapLayerList.forEach(function(t){e.layerId==t[1]&&("State Applications"==t[0]||"Regional Studies"==t[0])&&r.getZoom()<=7&&("State Applications"==t[0]&&o.push(e.properties.ST_ABBR),"Regional Studies"==t[0]&&o.push(e.properties.st_abbr))})}),o.length<1||(1==o.length&&t.regionServices.masterRegionList.forEach(function(e){
e.RegionID==o[0]&&(t.setBoundsByRegion(o[0]),t.regionServices.selectedRegion&&t.regionServices.loadParametersByRegion())}),o.length>1&&r.setView(e.latlng,9),t.toaster.clear(),t.cursorStyle="pointer")}))})})},t.prototype.initiateStreamgageQuery=function(){this.explorationService.allowStreamgageQuery=!this.explorationService.allowStreamgageQuery},t.prototype.queryStreamgages=function(e){var t=this;this.toaster.pop("info","Information","Querying Streamgages...",0),this.cursorStyle="wait",this.markers={},this.angulartics.eventTrack("explorationTools",{category:"Map",label:"queryStreamgages"}),this.leafletData.getMap().then(function(r){t.leafletData.getLayers().then(function(a){if(r.getZoom()<=8)return t.cursorStyle="pointer",t.toaster.clear(),void t.toaster.pop("warning","Warning","You must be at Zoom Level 9 or greater to query streamgages",5e3);var i;t.regionServices.nationalMapLayerList.forEach(function(e){"streamgages"==e[0].toLowerCase()&&(i='"'+e[1]+'"')}),a.overlays.SSLayer.identify().on(r).at(e.latlng).returnGeometry(!1).tolerance(5).layers(i).run(function(a,i){return t.toaster.clear(),t.cursorStyle="pointer",i.features&&0!=i.features.length?void i.features.forEach(function(a){var i="",o=["latitude","longitude","sta_id","sta_name","featureurl","drnarea"];angular.forEach(a.properties,function(e,t){if(-1!=o.indexOf(t))if("featureurl"==t){var r=e.split("site_no=")[1],a="http://streamstatsags.cr.usgs.gov/gagepages/html/"+r+".htm";i+='<strong>NWIS page: </strong><a href="'+e+' "target="_blank">link</a></br><strong>StreamStats Gage page: </strong><a href="'+a+'" target="_blank">link</a></br>'}else i+="<strong>"+t+": </strong>"+e+"</br>"}),t.markers.regionalQueryResult={lat:e.latlng.lat,lng:e.latlng.lng,message:i,focus:!0,draggable:!1},r.panBy([0,1]),t.toaster.clear()}):void t.toaster.pop("warning","Warning","No streamgages were found",5e3)})})})},t.prototype.elevationProfile=function(){var e=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.measurementData="",this.explorationService.showElevationChart=!0;var t;this.controls.custom.forEach(function(e){e._container.className.indexOf("elevation")>-1&&(t=e)}),this.angulartics.eventTrack("explorationTools",{category:"Map",label:"elevationProfile"}),this.leafletData.getMap().then(function(r){e.leafletData.getLayers().then(function(a){var i=a.overlays.draw;i.clearLayers(),e.drawController({metric:!1},!0),delete e.geojson.elevationProfileLine3D,r.on("draw:drawstart",function(e){t.clear()}),r.on("draw:created",function(t){r.removeEventListener("draw:created");var a=t.layer.toGeoJSON(),i='{"geometryType":"esriGeometryPolyline","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polyline", "paths":['+JSON.stringify(a.geometry.coordinates)+"]}}]}";e.cursorStyle="wait",e.toaster.pop("info","Information","Querying the elevation service...",0),e.explorationService.elevationProfile(i),e.explorationService.drawElevationProfile=!1,r.panBy([0,1])})})})},t.prototype.drawController=function(e,t){var r=this;return t?void this.leafletData.getMap().then(function(t){r.drawControl=new L.Draw.Polyline(t,e),r.drawControl.enable()}):(this.drawControl.disable(),void(this.drawControl=void 0))},t.prototype.displayElevationProfile=function(){var e;this.controls.custom.forEach(function(t){t._container&&t._container.className.indexOf("elevation")>-1&&(e=t)}),this.geojson.elevationProfileLine3D={data:this.explorationService.elevationProfileGeoJSON,style:{color:"#ff7800",weight:5,opacity:.65},onEachFeature:e.addData.bind(e)},this.leafletData.getMap().then(function(t){var r=e.onAdd(t);document.getElementById("elevation-div").innerHTML="",document.getElementById("elevation-div").appendChild(r)}),this.toaster.clear(),this.cursorStyle="pointer"},t.prototype.showLocation=function(){var e;this.controls.custom.forEach(function(t){t._container.className.indexOf("leaflet-control-locate")>-1&&(e=t)}),e.start()},t.prototype.resetMap=function(){this.regionServices.clearRegion(),this.studyArea.clearStudyArea(),this.nssService.clearNSSdata(),this.removeOverlayLayers("_region",!0),this.center=new a(39,-100,3)},t.prototype.resetExplorationTools=function(){document.getElementById("elevation-div").innerHTML="",document.getElementById("measurement-div").innerHTML="",this.drawControl&&this.drawController({},!1),this.explorationService.allowStreamgageQuery=!1,this.explorationService.drawMeasurement=!1,this.explorationService.measurementData="",this.explorationService.drawElevationProfile=!1,this.explorationService.showElevationChart=!1},t.prototype.measurement=function(){var e=this;document.getElementById("elevation-div").innerHTML="",this.explorationService.measurementData="Click the map to begin\nDouble click to end the Drawing",this.angulartics.eventTrack("explorationTools",{category:"Map",label:"measurement"}),this.leafletData.getMap().then(function(t){e.leafletData.getLayers().then(function(r){var a=!1;e.drawController({shapeOptions:{color:"blue"},metric:!1},!0);var i=r.overlays.draw;i.clearLayers();var o=function(){e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString()},n=function(){0==a&&(a=!0,e.explorationService.measurementData="Total Length: ",t.on("mousemove",o))},s=function(r){var a=r.layer;i.addLayer(a),i.addTo(t),e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString(),t.off("click",n),t.off("mousemove",o),t.off("draw:created",s),e.drawControl.disable(),e.explorationService.drawMeasurement=!1};t.on("click",n),t.on("draw:created",s)})})},t.prototype.checkDelineatePoint=function(e){var t=this;this.studyArea.checkingDelineatedPoint=!0,this.toaster.pop("info","Information","Validating your clicked point...",5e3),this.cursorStyle="wait",this.markers={},this.markers.pourpoint={lat:e.lat,lng:e.lng,message:"Your clicked point</br></br><strong>Latitude: </strong>"+e.lat.toFixed(5)+"</br><strong>Longitude: </strong>"+e.lng.toFixed(5),focus:!0,draggable:!1},this.studyArea.doDelineateFlag=!1;var r="visible:";this.regionServices.regionMapLayerList.forEach(function(e){("area of limited functionality"==e[0].toLowerCase()||"areas of limited functionality"==e[0].toLowerCase())&&(r+=String(e[1]))}),this.leafletData.getMap().then(function(a){t.leafletData.getLayers().then(function(i){t.angulartics.eventTrack("delineationClick",{category:"Map",label:t.regionServices.selectedRegion.Name}),a.invalidateSize();var o=t.regionServices.selectedRegion.RegionID+"_region";i.overlays[o].identify().on(a).at(e).returnGeometry(!1).layers(r).run(function(r,a){if(0==a.features.length)t.angulartics.eventTrack("validatePoint",{category:"Map",label:"valid"}),t.toaster.pop("success","Your clicked point is valid","Delineating your basin now...",5e3),t.studyArea.checkingDelineatedPoint=!1,t.startDelineate(e);else{t.studyArea.Disclaimers.isInExclusionArea=!0,t.studyArea.checkingDelineatedPoint=!1;var i=a.features[0].properties.ExcludeCode,o=a.features[0].properties.ExcludeReason;1==i?(t.toaster.pop("error","Delineation and flow statistic computation not allowed here",o,0),t.angulartics.eventTrack("validatePoint",{category:"Map",label:"not allowed"})):(t.toaster.pop("warning","Delineation and flow statistic computation possible but not advised",o,!0,0),t.startDelineate(e),t.angulartics.eventTrack("validatePoint",{category:"Map",label:"not advised"}))}t.cursorStyle="pointer"})})})},t.prototype.basinEditor=function(){var e=this;if(this.geojson.globalwatershed.data.features.length>1)return void this.toaster.pop("warning","Warning","You cannot edit a global watershed",5e3);var t=angular.fromJson(angular.toJson(this.geojson.globalwatershed.data.features[0])),r=[];t.geometry.coordinates[0].forEach(function(e){r.push([e[1],e[0]])}),this.leafletData.getMap().then(function(a){e.leafletData.getLayers().then(function(i){var o=i.overlays.draw;o.clearLayers();var n=new L.Draw.Polygon(a,o);n.enable(),a.on("draw:created",function(i){a.removeEventListener("draw:created");var n=i.layer;o.addLayer(n);var s=n.toGeoJSON().geometry.coordinates[0],l=[];s.forEach(function(e){l.push([e[1],e[0]])});var c=L.polygon(r),u=L.polygon(l);if("add"==e.studyArea.drawControlOption){var d=greinerHormann.union(c,u);e.studyArea.WatershedEditDecisionList.append.push(n.toGeoJSON())}if("remove"==e.studyArea.drawControlOption){var d=greinerHormann.diff(c,u);if(2==d.length)return alert("Splitting polygons is not permitted"),void o.clearLayers();e.studyArea.WatershedEditDecisionList.remove.push(n.toGeoJSON())}t.geometry.coordinates[0]=[],d.forEach(function(e){t.geometry.coordinates[0].push([e[1],e[0]])}),e.geojson.globalwatershed.data.features[0]=t,o.clearLayers()})})})},t.prototype.onSelectedAreaOfInterestChanged=function(e,t){this.angulartics.eventTrack("Search",{category:"Sidebar"}),this.markers={};var r=t.selectedAreaOfInterest;if("U.S. State or Territory"==r.Category)var a=9;else var a=14;this.markers.AOI={lat:r.Latitude,lng:r.Longitude,message:r.Name,focus:!0,draggable:!1},this.leafletData.getMap().then(function(e){e.setView([r.Latitude,r.Longitude],a)})},t.prototype.onSelectedRegionChanged=function(){this.regionServices.selectedRegion&&(this.removeOverlayLayers("_region",!0),this.regionServices.loadMapLayersByRegion(this.regionServices.selectedRegion.RegionID))},t.prototype.onSelectedStudyAreaChanged=function(){var e=this;if(this.removeOverlayLayers("globalwatershed",!0),this.studyArea.selectedStudyArea&&this.studyArea.selectedStudyArea.Features){this.studyArea.selectedStudyArea.Features.forEach(function(t){var r=angular.fromJson(angular.toJson(t));e.addGeoJSON(r.name,r.feature),e.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,e,new WiM.Directives.LegendLayerAddedEventArgs(r.name,"geojson",e.geojson[r.name].style))}),this.markers={};var t=this.geojson.globalwatershed.data.features[0].bbox;if(this.leafletData.getMap().then(function(e){e.fitBounds([[t[1],t[0]],[t[3],t[2]]],{})}),!this.nssService.queriedRegions){if(!this.regionServices.selectedRegion.ScenariosAvailable)return void(this.studyArea.regressionRegionQueryComplete=!0);this.nssService.queriedRegions=!0}}},t.prototype.removeGeoJson=function(e){void 0===e&&(e="");for(var t in this.geojson)"function"!=typeof this.geojson[t]&&(delete this.geojson[t],this.eventManager.RaiseEvent(WiM.Directives.onLayerRemoved,this,new WiM.Directives.LegendLayerRemovedEventArgs(t,"geojson")))},t.prototype.addGeoJSON=function(e,t){if("globalwatershed"==e)this.geojson[e]={data:t,style:{displayName:"Basin Boundary",imagesrc:"data:image/png;base64,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",fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}};else if("globalwatershedpoint"==e){var r=this.studyArea.selectedStudyArea.Pourpoint.Latitude,a=this.studyArea.selectedStudyArea.Pourpoint.Longitude,i=this.studyArea.selectedStudyArea.RegionID,o=this.studyArea.selectedStudyArea.WorkspaceID;this.geojson[e]={data:t,onEachFeature:function(e,t){var n="<strong>Latitude: </strong>"+r+"</br><strong>Longitude: </strong>"+a+"</br><strong>Region: </strong>"+i+"</br><strong>WorkspaceID: </strong>"+o+"</br>";angular.forEach(e.properties,function(e,t){n+="<strong>"+t+": </strong>"+e+"</br>"}),t.bindPopup(n)},style:{displayName:"Basin Clicked Point",imagesrc:"data:image/png;base64,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",visible:!0}}}else"regulatedWatershed"==e&&(this.geojson[e]={data:t,style:{displayName:"Basin Boundary (Regulated Area)",imagesrc:"data:image/png;base64,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",fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}})},t.prototype.onLayerChanged=function(e,t){if("visible"===t.PropertyName)if(t.Value)for(var r=0;r<this.studyArea.selectedStudyArea.Features.length;r++){var a=angular.fromJson(angular.toJson(this.studyArea.selectedStudyArea.Features[r]));a.name==t.LayerName&&this.addGeoJSON(t.LayerName,a.feature)}else delete this.geojson[t.LayerName]},t.prototype.mapBoundsChange=function(e,t){this.nomnimalZoomLevel=this.scaleLookup(this.center.zoom),this.center.zoom>=8&&e!==t&&this.regionServices.loadRegionListByExtent(this.bounds.northEast.lng,this.bounds.southWest.lng,this.bounds.southWest.lat,this.bounds.northEast.lat),this.center.zoom<8&&e!==t&&(this.regionServices.regionList=[]),this.center.zoom>=15?this.studyArea.showDelineateButton=!0:this.studyArea.showDelineateButton=!1},t.prototype.updateRegion=function(){var e=this.$locationService.search().region;this.setBoundsByRegion(e)},t.prototype.setBoundsByRegion=function(e){e&&this.regionServices.loadRegionListByRegion(e)&&(this.regionServices.selectedRegion=this.regionServices.regionList[0],this.bounds=this.leafletBoundsHelperService.createBoundsFromArray(this.regionServices.selectedRegion.Bounds))},t.prototype.addRegionOverlayLayers=function(e){var t=this;if(!(this.regionServices.regionMapLayerList.length<1)){this.layers.overlays[e+"_region"]=new i(e+" Map layers",configuration.baseurls.StreamStats+"/arcgis/rest/services/{0}_ss/MapServer".format(e.toLowerCase()),"agsDynamic",!0,{opacity:1,format:"png8",f:"image"}),this.leafletData.getLayers().then(function(r){var a=r.overlays[e+"_region"],i=[];t.regionServices.regionMapLayerList.forEach(function(e){e[2]&&i.push(e[1])}),a.setLayers([i])});var r=this.regionServices.selectedRegion.Layers;if(void 0!=r)for(var a in r)this.layers.overlays[a+"_region"]=r[a]}},t.prototype.removeOverlayLayers=function(e,t){var r=this;void 0===t&&(t=!1);var a;a=this.getLayerIdsByID(e,this.layers.overlays,t),a.forEach(function(e){delete r.layers.overlays[e]})},t.prototype.getLayerIdsByName=function(e,t,r){var a=[];for(var i in t)t[i].hasOwnProperty("name")&&(r?t[i].name.indexOf(e)>-1:t[i].name===e)&&a.push(i);return a},t.prototype.getLayerIdsByID=function(e,t,r){var a=[];for(var i in t)(r?i.indexOf(e)>-1:i===e)&&a.push(i);return a},t.prototype.startDelineate=function(t){var r=new e.Models.StudyArea(this.regionServices.selectedRegion.RegionID,new WiM.Models.Point(t.lat,t.lng,"4326"));this.studyArea.AddStudyArea(r),this.studyArea.loadStudyBoundary()},t.$inject=["$scope","toaster","$analytics","$location","$stateParams","leafletBoundsHelpers","leafletData","WiM.Services.SearchAPIService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ExplorationService","WiM.Event.EventManager"],t}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.MapController",n)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(t){"use strinct";var r,a=function(){function t(e,t,a,i,o,n,s,l,c,u,d){var h=this;this.EventManager=d,e.vm=this,this.init(),this.toaster=t,this.angulartics=a,this.searchService=i,this.sideBarCollapsed=!1,this.selectedProcedure=r.INIT,this.regionService=o,this.nssService=s,this.studyAreaService=n,this.modalService=l,this.leafletData=c,this.multipleParameterSelectorAdd=!0,this.explorationService=u,s.onSelectedStatisticsGroupChanged.subscribe(this._onSelectedStatisticsGroupChangedHandler),e.$watch(function(){return h.regionService.selectedRegion},function(e,t){null==e?h.setProcedureType(1):h.setProcedureType(2)}),e.$watch(function(){return h.studyAreaService.parametersLoaded},function(e,t){e!=t&&(null==e?h.setProcedureType(3):h.setProcedureType(4))})}return t.prototype.getLocations=function(e){return this.searchService.getLocations(e)},t.prototype.setProcedureType=function(e){return this.selectedProcedure!=e&&this.canUpdateProcedure(e)?void(this.selectedProcedure=e):(3==this.selectedProcedure&&4==e&&this.toaster.pop("warning","Warning","Make sure you calculate selected basin characteristics before continuing",5e3),void(2!=this.selectedProcedure||3!=e&&4!=e||this.toaster.pop("warning","Warning","Make sure you have delineated a basin and clicked continue",5e3)))},t.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},t.prototype.onAOISelect=function(e){this.EventManager.RaiseEvent(WiM.Services.onSelectedAreaOfInterestChanged,this,new WiM.Services.SearchAPIEventArgs(e))},t.prototype.zoomRegion=function(e){angular.fromJson(e)},t.prototype.setRegion=function(e){this.angulartics.eventTrack("initialOperation",{category:"SideBar",label:"Region Selection Button"}),(void 0==this.regionService.selectedRegion||this.regionService.selectedRegion.RegionID!==e.RegionID)&&(this.regionService.selectedRegion=e),this.setProcedureType(2),this.regionService.loadParametersByRegion()},t.prototype.openStatePage=function(t,r){t.stopPropagation(),t.preventDefault(),console.log("Opening state page for: ",r),this.modalService.openModal(e.Services.SSModalType.e_about,{tabName:"regionInfo",regionID:r})},t.prototype.resetWorkSpace=function(){this.studyAreaService.clearStudyArea(),this.studyAreaService.showDelineateButton=!0,this.nssService.clearNSSdata()},t.prototype.startSearch=function(e){e.stopPropagation(),e.preventDefault(),$("#sapi-searchTextBox").trigger($.Event("keyup",{keyCode:13}))},t.prototype.startDelineate=function(){var e=this;this.leafletData.getMap().then(function(t){return t.getZoom()<15?void e.toaster.pop("error","Delineate","You must be at or above zoom level 15 to delineate."):(e.toaster.pop("success","Delineate","Click on a blue stream cell to start delineation"),void(e.studyAreaService.doDelineateFlag=!e.studyAreaService.doDelineateFlag))})},t.prototype.setStatisticsGroup=function(e){var t=this.checkArrayForObj(this.nssService.selectedStatisticsGroupList,e);-1!=t?this.nssService.selectedStatisticsGroupList.splice(t,1):(this.nssService.selectedStatisticsGroupList.push(e),this.nssService.loadParametersByStatisticsGroup(this.regionService.selectedRegion.RegionID,e.ID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","),this.studyAreaService.selectedStudyArea.RegressionRegions))},t.prototype.checkArrayForObj=function(e,t){for(var r=0;r<e.length;r++)if(angular.equals(e[r],t))return r;return-1},t.prototype.multipleParameterSelector=function(){var e=this;this.regionService.parameterList.forEach(function(t){var r=e.checkArrayForObj(e.studyAreaService.studyAreaParameterList,t);e.multipleParameterSelectorAdd?(-1==r&&e.studyAreaService.studyAreaParameterList.push(t),t.checked=!0):r>-1&&t.toggleable&&(e.studyAreaService.studyAreaParameterList.splice(r,1),t.checked=!1)}),this.multipleParameterSelectorAdd=!this.multipleParameterSelectorAdd},t.prototype.updateStudyAreaParameterList=function(e){if(0==e.toggleable)return this.toaster.pop("warning",e.code+" is required by one of the selected scenarios","It cannot be unselected"),void(e.checked=!0);var t=this.studyAreaService.studyAreaParameterList.indexOf(e);t>-1?this.studyAreaService.studyAreaParameterList.splice(t,1):this.studyAreaService.studyAreaParameterList.push(e)},t.prototype.calculateParameters=function(){this.angulartics.eventTrack("CalculateParameters",{category:"SideBar",label:this.regionService.selectedRegion.Name+"; "+this.studyAreaService.studyAreaParameterList.map(function(e){return e.code}).join(",")}),this.studyAreaService.loadParameters()},t.prototype.submitBasinEdits=function(){this.studyAreaService.showEditToolbar=!1,this.studyAreaService.Disclaimers.isEdited&&(this.nssService.clearNSSdata(),this.studyAreaService.loadEditedStudyBoundary())},t.prototype.selectScenarios=function(){this.setProcedureType(3)},t.prototype.generateReport=function(){this.angulartics.eventTrack("CalculateFlows",{category:"SideBar",label:this.regionService.selectedRegion.Name+"; "+this.nssService.selectedStatisticsGroupList.map(function(e){return e.Name}).join(",")}),this.nssService.selectedStatisticsGroupList.length>0&&this.nssService.showFlowsTable&&(this.nssService.estimateFlows(this.studyAreaService.studyAreaParameterList,"value",this.regionService.selectedRegion.RegionID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(",")),this.studyAreaService.Disclaimers.isRegulated&&this.nssService.estimateFlows(this.studyAreaService.studyAreaParameterList,"unRegulatedValue",this.regionService.selectedRegion.RegionID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){return e.code}).join(","),!0)),this.modalService.openModal(e.Services.SSModalType.e_report),this.studyAreaService.reportGenerated=!0},t.prototype.checkRegulation=function(){console.log("checking for regulation"),this.studyAreaService.upstreamRegulation()},t.prototype.queryRegressionRegions=function(){return this.regionService.selectedRegion.ScenariosAvailable?(this.nssService.queriedRegions=!0,void this.studyAreaService.queryRegressionRegions()):void(this.studyAreaService.regressionRegionQueryComplete=!0)},t.prototype.queryStatisticsGroupTypes=function(){this.nssService.loadStatisticsGroupTypes(this.regionService.selectedRegion.RegionID,this.studyAreaService.selectedStudyArea.RegressionRegions.map(function(e){
return e.code}).join(","))},t.prototype.onSelectedStatisticsGroupChanged=function(){var e=this;this.nssService.selectedStatisticsGroupList.length>0?this.nssService.showFlowsTable=!0:this.nssService.showFlowsTable=!1,this.regionService.parameterList.forEach(function(t){e.nssService.selectedStatisticsGroupList.forEach(function(r){r.RegressionRegions&&r.RegressionRegions.forEach(function(r){r.Parameters.forEach(function(r){t.code.toLowerCase()==r.Code.toLowerCase()&&(-1==e.checkArrayForObj(e.studyAreaService.studyAreaParameterList,t)&&e.studyAreaService.studyAreaParameterList.push(t),t.checked=!0,t.toggleable=!1)})})})})},t.prototype.OpenWateruse=function(){this.modalService.openModal(e.Services.SSModalType.e_wateruse)},t.prototype.init=function(){var e=this;this._onSelectedStatisticsGroupChangedHandler=new WiM.Event.EventHandler(function(){e.onSelectedStatisticsGroupChanged()})},t.prototype.canUpdateProcedure=function(e){try{switch(e){case r.INIT:return!0;case r.IDENTIFY:return null!=this.regionService.selectedRegion;case r.SELECT:return this.studyAreaService.regressionRegionQueryComplete;case r.BUILD:return this.studyAreaService.parametersLoaded;default:return!1}}catch(t){return!1}},t.prototype.sm=function(e){try{}catch(t){}},t.$inject=["$scope","toaster","$analytics","WiM.Services.SearchAPIService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","StreamStats.Services.ModalService","leafletData","StreamStats.Services.ExplorationService","WiM.Event.EventManager"],t}();!function(e){e[e.INIT=1]="INIT",e[e.IDENTIFY=2]="IDENTIFY",e[e.SELECT=3]="SELECT",e[e.BUILD=4]="BUILD"}(r||(r={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.SidebarController",a)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},StreamStats;!function(e){var t;!function(t){"use strict";var r=function(t){function r(e,r,a,i){t.call(this,r,configuration.baseurls.StreamStatsServices),e.vm=this,this.modalService=a,this.checkActiveNews(),this.newArticleCount=0}return __extends(r,t),r.prototype.checkActiveNews=function(){var t=this;console.log("Checking for active news articles");var r={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.ActiveNewsFolder,i=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",r);this.Execute(i).then(function(r){console.log("Successfully retrieved active news articles page"),r.data.folder.articles.length>0&&(r.data.folder.articles.forEach(function(e){null==t.readCookie(e.id)&&(console.log("New news article found: ",e),t.newArticleCount+=1,t.createCookie(e.id,!0,30))}),t.newArticleCount>0&&t.modalService.openModal(e.Services.SSModalType.e_about,{tabName:"news",regionID:""}))},function(e){})["finally"](function(){})},r.prototype.openReport=function(){this.modalService.openModal(e.Services.SSModalType.e_report)},r.prototype.openAbout=function(){this.modalService.openModal(e.Services.SSModalType.e_about)},r.prototype.openHelp=function(){this.modalService.openModal(e.Services.SSModalType.e_help)},r.prototype.readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var i=r[a];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null},r.prototype.createCookie=function(e,t,r){if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3);var i="; expires="+a.toUTCString()}else var i="";document.cookie=e+"="+t+i+"; path=/"},r.$inject=["$scope","$http","StreamStats.Services.ModalService","StreamStats.Services.StudyAreaService"],r}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.NavbarController",r)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var StreamStats;!function(e){var t;!function(e){"use strinct";var t=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),r=function(){function e(e,t,r,a,i,o){var n=this;this.markers=null,this.overlays=null,this.center=null,this.layers=null,e.vm=this,this.angulartics=t,this.studyAreaService=a,this.nssService=i,this.leafletData=o,this.reportTitle="StreamStats Report",this.reportComments="Some comments here",this.initMap(),e.$on("leafletDirectiveMap.load",function(e,t){n.showFeatures()}),this.close=function(){r.dismiss("cancel")},this.print=function(){window.print()}}return e.prototype.initMap=function(){this.center=new t(39,-96,4),this.layers={baselayers:configuration.basemaps,overlays:{}},L.Icon.Default.imagePath="images",this.defaults={scrollWheelZoom:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1}},e.prototype.showFeatures=function(){var e=this;this.studyAreaService.selectedStudyArea&&(this.overlays={},this.studyAreaService.selectedStudyArea.Features.forEach(function(t){if("globalwatershed"==t.name){e.layers.overlays[t.name]={name:"Basin Boundary",type:"geoJSONShape",data:t.feature,visible:!0,layerOptions:{style:{fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}}};var r=e.layers.overlays[t.name].data.features[0].bbox;e.leafletData.getMap().then(function(e){e.invalidateSize(),e.fitBounds([[r[1],r[0]],[r[3],r[2]]])})}"globalwatershedpoint"==t.name&&(e.layers.overlays[t.name]={name:"Basin Clicked Point",type:"geoJSONShape",data:t.feature,visible:!0}),"regulatedWatershed"==t.name&&(e.layers.overlays.globalwatershedregulated={name:"Basin Boundary (Regulated Area)",type:"geoJSONShape",data:t.feature,visible:!0,layerOptions:{style:{fillColor:"red",weight:2,opacity:1,color:"white",fillOpacity:.5}}})}))},e.prototype.downloadCSV=function(){var e=this;this.angulartics.eventTrack("Download",{category:"Report",label:"CSV"});var t="data.csv",r=function(t){var r="\n\nParameters\n";return r+=e.studyAreaService.Disclaimers.isRegulated?"Name,Value,Reglated Value, Unregulated Value, Unit\n":"Name,Value,Unit\n",t.forEach(function(t){r+=e.studyAreaService.Disclaimers.isRegulated?t.name+","+t.value+","+t.unRegulatedValue.toFixed(2)+","+t.regulatedValue.toFixed(2)+","+t.unit+"\n":t.name+","+t.value+","+t.unit+"\n"}),r+"\n"},a=function(e){var t="";return e.RegressionRegions.forEach(function(r){"Area-Averaged"!=r.Name&&(t+=e.Name+" Parameters, "+r.PercentWeight.toFixed(0)+" Percent  "+r.Name.split("_").join(" ")+"\n",t+="Name,Value,Min Limit, Max Limit\n",r.Parameters&&r.Parameters.forEach(function(e){t+=e.Name+","+e.Value+","+e.Limits.Min.toFixed(2)+","+e.Limits.Max.toFixed(2)+"\n"}))}),t+"\n"},i=function(e){var t="";return e.RegressionRegions.forEach(function(r){var a;a=r.PercentWeight?r.PercentWeight.toFixed(0)+" Percent ":"",t+=e.Name+" Flow Report, "+a+r.Name.split("_").join(" ")+"\n",t+="Name,Value,Unit,Prediction Error\n",r.Results.forEach(function(e){var r;r=e.Unit?e.Unit.Abbr:"";var a;a=e.Errors?e.Errors[0].Value:"--",t+=e.Name+","+e.Value.toFixed(0)+","+r+","+a+"\n"})}),t+"\n"},o="StreamStats Output Report\n\nState/Region ID,"+this.studyAreaService.selectedStudyArea.RegionID.toUpperCase()+"\nWorkspace ID,"+this.studyAreaService.selectedStudyArea.WorkspaceID+"\nLatitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Latitude.toFixed(5)+"\nLongitude,"+this.studyAreaService.selectedStudyArea.Pourpoint.Longitude.toFixed(5)+"\nTime,"+this.studyAreaService.selectedStudyArea.Date.toLocaleString();o+=r(this.studyAreaService.studyAreaParameterList),this.nssService.selectedStatisticsGroupList.forEach(function(e){o+=a(e),o+=i(e)});var n=new Blob([o],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(n,t);else{var s=document.createElement("a"),l=URL.createObjectURL(n);void 0!==s.download?(s.setAttribute("href",l),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)):window.open(l)}},e.prototype.downloadGeoJSON=function(){var e=angular.toJson(this.studyAreaService.selectedStudyArea.Features[1].feature),t="data.geojson",r=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,t);else{var a=document.createElement("a"),i=URL.createObjectURL(r);void 0!==a.download?(a.setAttribute("href",i),a.setAttribute("download",t),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)):window.open(i)}},e.prototype.downloadPDF=function(){var e=new jsPDF("p","pt","letter"),t=document.getElementById("printArea").innerHTML,r={"#bypassme":function(e,t){return!0}},a={top:80,bottom:60,left:40,width:522};e.fromHTML(t,a.left,a.top,{width:a.width,elementHandlers:r},function(t){e.save("Test.pdf")},a)},e.$inject=["$scope","$analytics","$modalInstance","StreamStats.Services.StudyAreaService","StreamStats.Services.nssService","leafletData"],e}();angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.ReportController",r)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},StreamStats;!function(e){var t;!function(e){"use strict";var t,r=function(){function e(){this.Annual={Graph:{},Table:{}},this.Monthly={Graph:{withdrawals:null,returns:null},Table:{}}}return e}(),a=function(e){function a(t,r,a,i,o){e.call(this,r,configuration.baseurls.StreamStatsServices),this.$timeout=o,t.vm=this,this.modalInstance=i,this.StudyArea=a.selectedStudyArea,this.init()}return __extends(a,e),Object.defineProperty(a.prototype,"StartYear",{get:function(){return this._startYear},set:function(e){this.spanYear||(this.EndYear=e),e<=this.EndYear&&e>=this.YearRange.floor&&(this._startYear=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"EndYear",{get:function(){return this._endYear},set:function(e){e>=this.StartYear&&e<=this.YearRange.ceil&&(this._endYear=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"YearRange",{get:function(){return this._yearRange},enumerable:!0,configurable:!0}),a.prototype.GetWaterUse=function(){var e=this;this.CanContiue=!1;var r=configuration.queryparams.Wateruse.format(this.StudyArea.RegionID,this.StudyArea.WorkspaceID,this.StartYear,this.EndYear),a=new WiM.Services.Helpers.RequestInfo(r);this.Execute(a).then(function(r){e.showResults=!0,e.result=r.data,"Wateruse not available at specified site."===e.result.Messages&&alert(e.result.Messages),e.GetGraphData(t.Monthly),e.GetGraphData(t.Annual),e.ReportData.Monthly.Table=e.GetTableData(t.Monthly),e.ReportData.Annual.Table=e.GetTableData(t.Annual)},function(e){})["finally"](function(){e.CanContiue=!0})},a.prototype.Close=function(){this.modalInstance.dismiss("cancel")},a.prototype.Reset=function(){this.init()},a.prototype.Print=function(){window.print()},a.prototype.GetGraphData=function(e){var r=this;switch(e){case t.Monthly:this.ReportData.Monthly.Graph.withdrawals=[],this.result.hasOwnProperty("DailyMonthlyAveWithdrawalsByCode")&&(this.ReportData.Monthly.Graph.withdrawals=this.result.DailyMonthlyAveWithdrawalsByCode.map(function(e){return{key:r.getWUText(e[0].name.slice(-2)),values:e.map(function(e){return{label:e.name.substring(6,9),stack:e.type,value:e.value}})}})),this.ReportData.Monthly.Graph.returns=[];var a=[];this.result.hasOwnProperty("MonthlyWaterUseCoeff")?this.result.MonthlyWaterUseCoeff.forEach(function(e){"Total Returns"===e.name&&"MGD"===e.unit&&a.push({label:e.type,stack:e.name,value:e.value})}):this.result.hasOwnProperty("DailyMonthlyAveDischarges")&&(a=this.result.DailyMonthlyAveDischarges.map(function(e){return{label:e.name.substring(6,9),stack:e.type,value:e.value}})),this.ReportData.Monthly.Graph.returns.push({key:"Returns",values:a,color:"#ff7f0e"});break;case t.Annual:this.ReportData.Annual.Graph=[],this.result.hasOwnProperty("AveGWWithdrawals")?this.ReportData.Annual.Graph.push({name:"Groundwater withdrawal",value:this.result.AveGWWithdrawals.value}):this.result.hasOwnProperty("DailyAnnualAveGWWithdrawal")&&this.ReportData.Annual.Graph.push({name:"Groundwater withdrawal",value:this.result.DailyAnnualAveGWWithdrawal.value}),this.result.hasOwnProperty("AveSWWithdrawals")?this.ReportData.Annual.Graph.push({name:"Surface water withdrawal",value:this.result.AveSWWithdrawals.value}):this.result.hasOwnProperty("DailyAnnualAveSWWithdrawal")&&this.ReportData.Annual.Graph.push({name:"Surface water withdrawal",value:this.result.DailyAnnualAveSWWithdrawal.value})}},a.prototype.GetTableData=function(e){var r=this,a=[],i=[];switch(e){case t.Monthly:for(var o=0;12>o;o++)i.push({month:this.getMonth(o),returns:{},withdrawals:[]});if(this.result.hasOwnProperty("MonthlyWaterUseCoeff")){var n=0;this.result.MonthlyWaterUseCoeff.forEach(function(e){"Total Returns"===e.name&&"MGD"===e.unit&&(i[n].returns=e,n++)})}else if(this.result.hasOwnProperty("DailyMonthlyAveDischarges")){var n=0;this.result.DailyMonthlyAveDischarges.forEach(function(e){"Discharge"===e.type&&"MGD"===e.unit&&(i[n].returns=e,n++)})}this.result.hasOwnProperty("DailyMonthlyAveWithdrawalsByCode")&&this.result.DailyMonthlyAveWithdrawalsByCode.forEach(function(e){a.push(r.getWUText(e[0].name.slice(-2))),i[0].withdrawals.push(e[0]),i[1].withdrawals.push(e[1]),i[2].withdrawals.push(e[2]),i[3].withdrawals.push(e[3]),i[4].withdrawals.push(e[4]),i[5].withdrawals.push(e[5]),i[6].withdrawals.push(e[6]),i[7].withdrawals.push(e[7]),i[8].withdrawals.push(e[8]),i[9].withdrawals.push(e[9]),i[10].withdrawals.push(e[10]),i[11].withdrawals.push(e[11])});break;case t.Annual:a=["","Average Return","Average Withdrawal"],this.result.hasOwnProperty("AveSWWithdrawals")?i.push({name:"Surface Water",aveReturn:"---",aveWithdrawal:this.result.AveSWWithdrawals.value.toFixed(3),unit:"MGD"}):this.result.hasOwnProperty("DailyAnnualAveSWWithdrawal")&&i.push({name:"Surface Water",aveReturn:"---",aveWithdrawal:this.result.DailyAnnualAveSWWithdrawal.value.toFixed(3),unit:"MGD"}),this.result.hasOwnProperty("AveGWWithdrawals")?i.push({name:"Groundwater",aveReturn:"---",aveWithdrawal:this.result.AveGWWithdrawals.value.toFixed(3),unit:"MGD"}):this.result.hasOwnProperty("DailyAnnualAveSWWithdrawal")&&i.push({name:"Groundwater",aveReturn:"---",aveWithdrawal:this.result.DailyAnnualAveGWWithdrawal.value.toFixed(3),unit:"MGD"}),this.result.hasOwnProperty("AveReturns")?i.push({name:"Total",aveReturn:this.result.AveReturns.value.toFixed(3),aveWithdrawal:(this.result.AveSWWithdrawals.value+this.result.AveGWWithdrawals.value).toFixed(3),unit:"MGD"}):this.result.hasOwnProperty("DailyAnnualAveDischarge")&&i.push({name:"Total",aveReturn:this.result.DailyAnnualAveDischarge.value.toFixed(3),aveWithdrawal:(this.result.DailyAnnualAveGWWithdrawal.value+this.result.DailyAnnualAveSWWithdrawal.value).toFixed(3),unit:"MGD"}),i.push({name:"",aveReturn:"",aveWithdrawal:""}),this.result.hasOwnProperty("TotalTempStats")&&(i.push({name:"Temporary water-use registrations (surface water)",aveReturn:"",aveWithdrawal:this.result.TotalTempStats[2].value.toFixed(3),unit:"MGD"}),i.push({name:"Temporary water-use registrations (groundwater)",aveReturn:"",aveWithdrawal:this.result.TotalTempStats[1].value.toFixed(3),unit:"MGD"}),i.push({name:"Temporary water-use registrations (total)",aveReturn:"",aveWithdrawal:this.result.TotalTempStats[0].value.toFixed(3),unit:"MGD"}),i.push({name:"",aveReturn:"",aveWithdrawal:""}),i.push({name:"Water-use index (dimensionless) without temporary registrations:",aveReturn:"",aveWithdrawal:this.result.TotalTempStats[4].value.toFixed(3),unit:"Dimensionless"}),i.push({name:"Water-use index (dimensionless) with temporary registrations:",aveReturn:"",aveWithdrawal:this.result.TotalTempStats[3].value.toFixed(3),unit:"Dimensionless"}))}return{values:i,Fields:a}},a.prototype.Reduce=function(e){return e.reduce(function(e,t){return Number(e)+Number(t.value)},0)},a.prototype.init=function(){var e=this,a=configuration.queryparams.WateruseConfig.format(this.StudyArea.RegionID),o=new WiM.Services.Helpers.RequestInfo(a);this.Execute(o).then(function(t){var r=t.data;e.spanYear=r.yearspan,e._startYear=r.syear,e._endYear=e.spanYear?r.eyear:r.syear,e._yearRange={floor:r.syear,draggableRange:!0,noSwitching:!0,showTicks:!1,ceil:r.eyear}},function(t){e._startYear=2005,e._endYear=2012,e._yearRange={floor:2005,draggableRange:!0,noSwitching:!0,showTicks:!1,ceil:2012}})["finally"](function(){e.CanContiue=!0,e.showResults=!1,e.SelectedTab=i.Graph,e.SelectedWaterUseType=t.Annual,e.ReportData=new r,e.MonthlyReportOptions={chart:{type:"multiBarHorizontalChart",height:450,visible:!0,stacked:!0,showControls:!1,margin:{top:20,right:30,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},dispatch:{stateChange:function(){e.$timeout(function(){e.loadGraphLabels(0)},500)},renderEnd:function(){e.$timeout(function(){e.loadGraphLabels(0)},500)}},showValues:!0,valueFormat:function(e){return d3.format(",.4f")(e)},tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Values in million gallons/day",tickFormat:function(e){return d3.format(",.3f")(e)}},refreshDataOnly:!0}},e.MonthlyReturnReportOptions={chart:{type:"multiBarHorizontalChart",height:450,visible:!0,stacked:!1,showControls:!1,margin:{top:20,right:30,bottom:60,left:55},x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format(",.3f")(e)},tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Values in million gallons/day",tickFormat:function(e){return d3.format(",.3f")(e)}}}},e.AnnualReportOptions={chart:{type:"pieChart",height:500,x:function(e){return e.name},y:function(e){return e.value},showLabels:!0,tooltip:{valueFormatter:function(e){return d3.format(",.4f")(e)+" million gal/day"}},duration:500,labelThreshold:.01,labelSunbeamLayout:!1,legend:{margin:{top:5,right:35,bottom:5,left:0}}}}})},a.prototype.getMonth=function(e){switch(e){case 0:return"Jan";case 1:return"Feb";case 2:return"Mar";case 3:return"Apr";case 4:return"May";case 5:return"Jun";case 6:return"Jul";case 7:return"Aug";case 8:return"Sep";case 9:return"Oct";case 10:return"Nov";case 11:return"Dec"}},a.prototype.getWUText=function(e){switch(e.toUpperCase()){case"AQ":return"Aquaculture";case"CO":return"Commercial";case"DO":return"Domestic";case"PH":return"Hydro Electric";case"IN":return"Industrial";case"IR":return"Irrigation";case"LV":return"Livestock";case"MI":return"Mining";case"RM":return"Remediation";case"TE":return"Thermoelectric";case"ST":return"Waste Water Treatment";case"WS":return"Public Supply";case"MF":return"Hydrofracturing";case"CW":return"Wetland augmentation";case"PC":return"Thermoelectric (closed cycle)";case"PO":return"Thermoelectric (once through)"}return e.toUpperCase()},a.prototype.loadGraphLabels=function(e){var t=d3.selectAll("g.nv-multibarHorizontal"),r=t.selectAll("g.nv-group").map(function(e){return e.length}),a=t.selectAll("g.nv-group").filter(function(t,a){return a==r[e]-1}).selectAll("g.positive");t.select("g.nv-barsWrap");a.each(function(e,t){var r=d3.select(this).selectAll("text");r.text(d3.format(",.3f")(e.y1.toFixed(3))),r.attr("dy","1.32em")})},a.$inject=["$scope","$http","StreamStats.Services.StudyAreaService","$modalInstance","$timeout"],a}(WiM.Services.HTTPServiceBase);!function(e){e[e.Annual=1]="Annual",e[e.Monthly=2]="Monthly"}(t||(t={}));var i;!function(e){e[e.Graph=1]="Graph",e[e.Table=2]="Table"}(i||(i={})),angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.WateruseController",a)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},StreamStats;!function(e){var t;!function(e){"use string";var t=function(){function e(){}return e}(),r=function(e){function r(r,a,i,o,n,s){e.call(this,a,""),r.vm=this,this.StudyArea=o.selectedStudyArea,this.Upload=s,this.http=a,this.sce=i,this.modalInstance=n,this.StudyArea=o.selectedStudyArea,this.freshdeskTicketData=new t,this.selectedHelpTabName="faq",this.showSuccessAlert=!1,this.submittingSupportTicket=!1,this.init()}return __extends(r,e),r.prototype.Close=function(){this.showSuccessAlert=!1,this.modalInstance.dismiss("cancel")},r.prototype.submitFreshDeskTicket=function(e){var r=this;if(e){var a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.CreateTicket,i=new FormData;i.append("helpdesk_ticket[email]",this.freshdeskTicketData.email),i.append("helpdesk_ticket[subject]",this.freshdeskTicketData.subject),i.append("helpdesk_ticket[description]",this.freshdeskTicketData.description),i.append("helpdesk_ticket[custom_field][regionid_"+configuration.SupportTicketService.AccountID+"]",this.RegionID),i.append("helpdesk_ticket[custom_field][workspaceid_"+configuration.SupportTicketService.AccountID+"]",this.WorkspaceID),i.append("helpdesk_ticket[custom_field][server_"+configuration.SupportTicketService.AccountID+"]",this.Server),i.append("helpdesk_ticket[custom_field][browser_"+configuration.SupportTicketService.AccountID+"]",this.Browser),i.append("helpdesk_ticket[custom_field][softwareversion_"+configuration.SupportTicketService.AccountID+"]",this.AppVersion),this.freshdeskTicketData.attachment&&i.append("helpdesk_ticket[attachments][][resource]",this.freshdeskTicketData.attachment,this.freshdeskTicketData.attachment.name);var o={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X"),"Content-Type":void 0},n=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.POST,"json",i,o,angular.identity);this.submittingSupportTicket=!0,this.Execute(n).then(function(e){r.freshdeskTicketData=new t,r.showSuccessAlert=!0},function(e){})["finally"](function(){r.submittingSupportTicket=!1})}},r.prototype.getFAQarticles=function(){var e=this,t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.FAQarticlesFolder,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){e.faqArticles=t.data.folder.articles},function(e){})["finally"](function(){})},r.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},r.prototype.selectHelpTab=function(e){this.selectedHelpTabName!=e&&(this.selectedHelpTabName=e)},r.prototype.init=function(){this.getAppVersion(),this.getBrowser(),this.getFAQarticles(),this.StudyArea&&this.StudyArea.WorkspaceID?this.WorkspaceID=this.StudyArea.WorkspaceID:this.WorkspaceID="",this.StudyArea&&this.StudyArea.RegionID?this.RegionID=this.StudyArea.RegionID:this.RegionID="",this.StudyArea&&this.StudyArea.Server?this.Server=this.StudyArea.Server:this.Server=""},r.prototype.getBrowser=function(){(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)&&(this.Browser="Opera"),"undefined"!=typeof InstallTrigger&&(this.Browser="Firefox"),Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0&&(this.Browser="Safari"),window.chrome&&window.chrome.webstore&&(this.Browser="Chrome"),!document.documentMode&&window.StyleMedia&&(this.Browser="Edge"),document.documentMode&&(this.Browser="IE")},r.prototype.getAppVersion=function(){var e=this;$.getJSON("version.js",function(t){e.AppVersion=t.version})},r.$inject=["$scope","$http","$sce","StreamStats.Services.StudyAreaService","$modalInstance","Upload"],r}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.HelpController",r)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},StreamStats;!function(e){var t;!function(e){"use string";var t=function(e){function t(t,r,a,i,o,n,s){e.call(this,r,configuration.baseurls.StreamStatsServices),t.vm=this,this.sce=a,this.modalInstance=s,this.modalService=i,this.StudyArea=n.selectedStudyArea,this.regionService=o,this.selectedAboutTabName="about",this.init()}return __extends(t,e),t.prototype.Close=function(){this.modalInstance.dismiss("cancel")},t.prototype.selectAboutTab=function(e){this.selectedAboutTabName!=e&&(this.selectedAboutTabName=e)},t.prototype.getActiveNews=function(){var e=this,t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.ActiveNewsFolder,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){t.data.folder.articles.length&&(e.activeNewsArticles=t.data.folder.articles)},function(e){})["finally"](function(){})},t.prototype.getPastNews=function(){var e=this,t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.PastNewsFolder,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){e.pastNewsArticles=t.data.folder.articles},function(e){})["finally"](function(){})},t.prototype.getAboutArticle=function(){var e=this,t={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},r=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.AboutArticle,a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.GET,"json","",t);this.Execute(a).then(function(t){e.aboutArticle=t.data.article.description},function(e){})["finally"](function(){})},t.prototype.getRegionHelpArticle=function(){var e,t=this;if(this.modalService.modalOptions&&(this.modalService.modalOptions.tabName&&this.selectAboutTab(this.modalService.modalOptions.tabName),e=this.modalService.modalOptions.regionID),this.regionService.selectedRegion&&(e=this.regionService.selectedRegion.Name),e){var r={Authorization:"Basic "+btoa(configuration.SupportTicketService.Token+":X")},a=configuration.SupportTicketService.BaseURL+configuration.SupportTicketService.RegionInfoFolder,i=new WiM.Services.Helpers.RequestInfo(a,!0,WiM.Services.Helpers.methodType.GET,"json","",r);this.regionArticle=null,this.Execute(i).then(function(r){r.data.folder.articles.forEach(function(r){return r.title==e?void(t.regionArticle=r):void 0})},function(e){})["finally"](function(){})}},t.prototype.convertUnsafe=function(e){return this.sce.trustAsHtml(e)},t.prototype.init=function(){this.getAboutArticle(),this.getRegionHelpArticle(),this.getActiveNews(),this.getPastNews()},t.prototype.readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var i=r[a];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null},t.prototype.createCookie=function(e,t,r){if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3);var i="; expires="+a.toUTCString()}else var i="";document.cookie=e+"="+t+i+"; path=/"},t.$inject=["$scope","$http","$sce","StreamStats.Services.ModalService","StreamStats.Services.RegionService","StreamStats.Services.StudyAreaService","$modalInstance"],t}(WiM.Services.HTTPServiceBase);angular.module("StreamStats.Controllers").controller("StreamStats.Controllers.AboutController",t)}(t=e.Controllers||(e.Controllers={}))}(StreamStats||(StreamStats={}));